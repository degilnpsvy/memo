<H3 style="MARGIN: 13pt 0cm"><SPAN style="LINE-HEIGHT: 173%; FONT-SIZE: 21pt; mso-bidi-font-size: 16.0pt; mso-font-kerning: 0pt" lang=EN-US>31.3.4 Employing the Thread-Specific Data API</SPAN></H3>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>When we first described the standard </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>function in Section 3.4, we noted that it may return a pointer to a statically allocated string as its function result. This means that </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>may not be thread-safe. In the next few pages, we look at a nonthread-safe implementation of </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror()</SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>, and then show how thread-specific data can be used to make this function thread-safe.</SPAN></P>
<P style="MARGIN: 0cm 10.5pt 0pt" class=a><SPAN style="FONT-SIZE: 14pt; mso-bidi-font-size: 12.0pt" lang=EN-US><EM>On many UNIX implementations, including Linux, the strerror() function provided by the standard C library is thread-safe. However, we use the example of strerror() anyway, because SUSv3 doesn&#8217;t require this function to be threadsafe, and its implementation provides a simple example of the use of threadspecific data.</EM></SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>Listing 31-1 shows a simple non-thread-safe implementation of </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror()</SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>. This function makes use of a pair of global variables defined by </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>glibc</SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>: </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>_sys_errlist </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>is an array of pointers to strings corresponding to the error numbers in </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>errno </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>(thus, for example, </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>_sys_errlist[EINVAL] </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>points to the string </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>Invalid operation</SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>), and </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>_sys_nerr </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>specifies the number of elements in </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>_sys_errlist</SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>.</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><B><SPAN style="FONT-FAMILY: 'Futura-Heavy','sans-serif'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: Futura-Heavy" lang=EN-US>Listing 31-1: </SPAN></B><SPAN style="FONT-FAMILY: 'Futura-Book','sans-serif'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: Futura-Book" lang=EN-US>An implementation of </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror() </SPAN><SPAN style="FONT-FAMILY: 'Futura-Book','sans-serif'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: Futura-Book" lang=EN-US>that is not thread-safe</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'NewBaskerville-Roman','serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskerville-Roman" lang=EN-US>&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211; </SPAN><B><SPAN style="FONT-FAMILY: TheSansMonoCondensed-Bold; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: TheSansMonoCondensed-Bold; mso-hansi-font-family: NewBaskervilleEF-Roman" lang=EN-US>threads/strerror.c</SPAN></B></P>
<P style="TEXT-ALIGN: left; TEXT-INDENT: 7pt; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none; mso-char-indent-count: .5" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>1</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>#define</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #bfbf00">_GNU_SOURCE</SPAN> <SPAN style="COLOR: #bf0000">/* Get '_sys_nerr' and '_sys_errlist' declarations from &lt;stdio.h&gt; */</SPAN></SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>2</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>#include</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #00bf00">&lt;stdio.h&gt;</SPAN></SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>3</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>#include</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #00bf00">&lt;string.h&gt;</SPAN> <SPAN style="COLOR: #bf0000">/* Get declaration of strerror() */</SPAN></SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>4</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>#define</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #bfbf00">MAX_ERROR_LEN</SPAN> 256 <SPAN style="COLOR: #bf0000">/* Maximum length of string returned by strerror() */</SPAN></SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>5</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #40ffff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>static</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #00bf00">char</SPAN> <SPAN style="COLOR: #bfbf00">buf</SPAN>[MAX_ERROR_LEN]; <SPAN style="COLOR: #bf0000">/* Statically allocated return buffer */</SPAN></SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>6char</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> *</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>7</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>strerror</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>(<SPAN style="COLOR: #00bf00">int</SPAN> <SPAN style="COLOR: #bfbf00">err</SPAN>)</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>8</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>{</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>9</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #40ffff">if</SPAN> (err &lt; 0 || err &gt;= _sys_nerr || _sys_errlist[err] == <SPAN style="COLOR: #bf00bf">NULL</SPAN>) {</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>10</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>snprintf(buf, MAX_ERROR_LEN, <SPAN style="COLOR: #00bf00">"Unknown error %d"</SPAN>, err);</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>11</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>} <SPAN style="COLOR: #40ffff">else</SPAN> {</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>12</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>strncpy(buf, _sys_errlist[err], MAX_ERROR_LEN - 1);</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>13</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>buf[MAX_ERROR_LEN - 1] = <SPAN style="COLOR: #00bf00">'\0'</SPAN>; <SPAN style="COLOR: #bf0000">/* Ensure null termination */</SPAN></SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>14</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>}</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>15</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #40ffff">return</SPAN> buf;</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>16</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>}</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'NewBaskerville-Roman','serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskerville-Roman" lang=EN-US>&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211; </SPAN><B><SPAN style="FONT-FAMILY: TheSansMonoCondensed-Bold; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: TheSansMonoCondensed-Bold; mso-hansi-font-family: NewBaskervilleEF-Roman" lang=EN-US>threads/strerror.c</SPAN></B></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>We can use the program in Listing 31-2 to demonstrate the consequences of the fact that the </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>implementation in Listing 31-1 is not thread-safe. This program calls </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>from two different threads, but displays the returned value only after both threads have called </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror()</SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>. Even though each thread specifies a different value (</SPAN><SPAN style="FONT-FAMILY: TheSansMonoCondensed-Plain; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: TheSansMonoCondensed-Plain; mso-hansi-font-family: NewBaskervilleEF-Roman" lang=EN-US>EINVAL </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>and </SPAN><SPAN style="FONT-FAMILY: TheSansMonoCondensed-Plain; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: TheSansMonoCondensed-Plain; mso-hansi-font-family: NewBaskervilleEF-Roman" lang=EN-US>EPERM</SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>) as the argument to </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror()</SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>, this is what we see when we compile and link this program with the version of </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>shown in Listing 31-1:</SPAN></P>
<P style="MARGIN: 0cm 10.5pt 0pt" class=a><SPAN style="FONT-SIZE: 14pt; mso-bidi-font-size: 12.0pt" lang=EN-US><EM>$ ./strerror_test</EM></SPAN></P>
<P style="MARGIN: 0cm 10.5pt 0pt" class=a><SPAN style="FONT-SIZE: 14pt; mso-bidi-font-size: 12.0pt" lang=EN-US><EM>Main thread has called strerror()</EM></SPAN></P>
<P style="MARGIN: 0cm 10.5pt 0pt" class=a><SPAN style="FONT-SIZE: 14pt; mso-bidi-font-size: 12.0pt" lang=EN-US><EM>Other thread about to call strerror()</EM></SPAN></P>
<P style="MARGIN: 0cm 10.5pt 0pt" class=a><SPAN style="FONT-SIZE: 14pt; mso-bidi-font-size: 12.0pt" lang=EN-US><EM>Other thread: str (0x804a7c0) = Operation not permitted</EM></SPAN></P>
<P style="MARGIN: 0cm 10.5pt 0pt" class=a><SPAN style="FONT-SIZE: 14pt; mso-bidi-font-size: 12.0pt" lang=EN-US><EM>Main thread: str (0x804a7c0) = Operation not permitted</EM></SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>Both threads displayed the </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>errno </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>string corresponding to </SPAN><SPAN style="FONT-FAMILY: TheSansMonoCondensed-Plain; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: TheSansMonoCondensed-Plain; mso-hansi-font-family: NewBaskervilleEF-Roman" lang=EN-US>EPERM</SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>, because the call to </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>by the second thread (in </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>threadFunc</SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>) overwrote the buffer that was written by the call to </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>in the main thread. Inspection of the output shows that the local variable </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>str </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>in the two threads points to the same memory address.</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><B><SPAN style="FONT-FAMILY: 'Futura-Heavy','sans-serif'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: Futura-Heavy" lang=EN-US>Listing 31-2: </SPAN></B><SPAN style="FONT-FAMILY: 'Futura-Book','sans-serif'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: Futura-Book" lang=EN-US>Calling </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror() </SPAN><SPAN style="FONT-FAMILY: 'Futura-Book','sans-serif'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: Futura-Book" lang=EN-US>from two different threads</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'NewBaskerville-Roman','serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskerville-Roman" lang=EN-US>&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211; </SPAN><B><SPAN style="FONT-FAMILY: TheSansMonoCondensed-Bold; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: TheSansMonoCondensed-Bold; mso-hansi-font-family: NewBaskervilleEF-Roman" lang=EN-US>threads/strerror_test.c</SPAN></B></P>
<P style="TEXT-ALIGN: left; TEXT-INDENT: 7pt; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none; mso-char-indent-count: .5" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>1</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>#include</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #00bf00">&lt;stdio.h&gt;</SPAN></SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>2</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>#include</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #00bf00">&lt;string.h&gt;</SPAN> <SPAN style="COLOR: #bf0000">/* Get declaration of strerror() */</SPAN></SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>3</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>#include</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #00bf00">&lt;pthread.h&gt;</SPAN></SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>4</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>#include</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #00bf00">"tlpi_hdr.h"</SPAN></SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>5</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #40ffff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>static</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #00bf00">void</SPAN> *</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>6</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>threadFunc</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>(<SPAN style="COLOR: #00bf00">void</SPAN> *<SPAN style="COLOR: #bfbf00">arg</SPAN>)</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>7</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>{</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>8</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #00bf00">char</SPAN> *<SPAN style="COLOR: #bfbf00">str</SPAN>;</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>9</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>printf(<SPAN style="COLOR: #00bf00">"Other thread about to call strerror()\n"</SPAN>);</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>10</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>str = strerror(EPERM);</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>11</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>printf(<SPAN style="COLOR: #00bf00">"Other thread: str (%p) = %s\n"</SPAN>, str, str);</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>12</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #40ffff">return</SPAN> <SPAN style="COLOR: #bf00bf">NULL</SPAN>;</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>13</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>}</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>14int</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>15</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>main</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>(<SPAN style="COLOR: #00bf00">int</SPAN> <SPAN style="COLOR: #bfbf00">argc</SPAN>, <SPAN style="COLOR: #00bf00">char</SPAN> *<SPAN style="COLOR: #bfbf00">argv</SPAN>[])</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>16</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>{</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>17</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #00bf00">pthread_t</SPAN> <SPAN style="COLOR: #bfbf00">t</SPAN>;</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>18</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #00bf00">int</SPAN> <SPAN style="COLOR: #bfbf00">s</SPAN>;</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>19</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #00bf00">char</SPAN> *<SPAN style="COLOR: #bfbf00">str</SPAN>;</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>20</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>str = strerror(EINVAL);</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>21</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>printf(<SPAN style="COLOR: #00bf00">"Main thread has called strerror()\n"</SPAN>);</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>22</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>s = pthread_create(&amp;t, <SPAN style="COLOR: #bf00bf">NULL</SPAN>, threadFunc, <SPAN style="COLOR: #bf00bf">NULL</SPAN>);</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>23</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #40ffff">if</SPAN> (s != 0)</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>24</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>errExitEN(s, <SPAN style="COLOR: #00bf00">"pthread_create"</SPAN>);</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>25</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>s = pthread_join(t, <SPAN style="COLOR: #bf00bf">NULL</SPAN>);</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>26</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #40ffff">if</SPAN> (s != 0)</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>27</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>errExitEN(s, <SPAN style="COLOR: #00bf00">"pthread_join"</SPAN>);</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>28</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>printf(<SPAN style="COLOR: #00bf00">"Main thread: str (%p) = %s\n"</SPAN>, str, str);</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>29</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>exit(EXIT_SUCCESS);</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>30</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>}</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'NewBaskerville-Roman','serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskerville-Roman" lang=EN-US>&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211; </SPAN><B><SPAN style="FONT-FAMILY: TheSansMonoCondensed-Bold; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: TheSansMonoCondensed-Bold; mso-hansi-font-family: NewBaskervilleEF-Roman" lang=EN-US>threads/strerror_test.c</SPAN></B></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>Listing 31-3 shows a reimplementation of </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>that uses thread-specific data to ensure thread safety.</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>The first step performed by the revised </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>is to call </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>pthread_once() </SPAN><SPAN style="FONT-FAMILY: &#26041;&#27491;&#33298;&#20307;; FONT-SIZE: 15pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: CombiNumerals; mso-hansi-font-family: NewBaskervilleEF-Roman">&#9315;</SPAN><SPAN style="FONT-FAMILY: CombiNumerals; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: CombiNumerals; mso-hansi-font-family: NewBaskervilleEF-Roman"> </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>to ensure that the first invocation of this function (from any thread) calls </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>createKey() </SPAN><SPAN style="FONT-FAMILY: &#26041;&#27491;&#33298;&#20307;; FONT-SIZE: 15pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: CombiNumerals; mso-hansi-font-family: NewBaskervilleEF-Roman">&#9313;</SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>. The </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>createKey() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>function calls </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>pthread_key_create() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>to allocate a thread-specific data key that is stored in the global variable </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerrorKey </SPAN><SPAN style="FONT-FAMILY: &#26041;&#27491;&#33298;&#20307;; FONT-SIZE: 15pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: CombiNumerals; mso-hansi-font-family: NewBaskervilleEF-Roman">&#9314;</SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>. The call to </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>pthread_key_create() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>also records the address of the destructor </SPAN><SPAN style="FONT-FAMILY: &#26041;&#27491;&#33298;&#20307;; FONT-SIZE: 13.5pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: CombiNumerals; mso-hansi-font-family: NewBaskervilleEF-Roman">&#9312;</SPAN><SPAN style="FONT-FAMILY: CombiNumerals; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: CombiNumerals; mso-hansi-font-family: NewBaskervilleEF-Roman"> </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>that will be used to free the thread-specific buffers corresponding to this key.</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>The </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>function then calls </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>pthread_getspecific() </SPAN><SPAN style="FONT-FAMILY: &#26041;&#27491;&#33298;&#20307;; FONT-SIZE: 15pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: CombiNumerals; mso-hansi-font-family: NewBaskervilleEF-Roman">&#9316;</SPAN><SPAN style="FONT-FAMILY: CombiNumerals; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: CombiNumerals; mso-hansi-font-family: NewBaskervilleEF-Roman"> </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>to retrieve the address of this thread&#8217;s unique buffer corresponding to </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerrorKey</SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>. If </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>pthread_getspecific() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>returns </SPAN><SPAN style="FONT-FAMILY: TheSansMonoCondensed-Plain; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: TheSansMonoCondensed-Plain; mso-hansi-font-family: NewBaskervilleEF-Roman" lang=EN-US>NULL</SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>, then this thread is calling </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>for the first time, and so the function allocates a new buffer using </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>malloc() </SPAN><SPAN style="FONT-FAMILY: &#26041;&#27491;&#33298;&#20307;; FONT-SIZE: 15pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: CombiNumerals; mso-hansi-font-family: NewBaskervilleEF-Roman">&#9317;</SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>, and saves the address of the buffer using </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>pthread_setspecific() </SPAN><SPAN style="FONT-FAMILY: &#26041;&#27491;&#33298;&#20307;; FONT-SIZE: 15pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: CombiNumerals; mso-hansi-font-family: NewBaskervilleEF-Roman">&#9318;</SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>. If the </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>pthread_getspecific() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>call returns a non-</SPAN><SPAN style="FONT-FAMILY: TheSansMonoCondensed-Plain; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: TheSansMonoCondensed-Plain; mso-hansi-font-family: NewBaskervilleEF-Roman" lang=EN-US>NULL </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>value, then that pointer refers to an existing buffer that was allocated when this thread previously called </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror()</SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>.</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>The remainder of this </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>implementation is similar to the implementation that we showed earlier, with the difference that </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>buf </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>is the address of a threadspecific data buffer, rather than a static variable.</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><B><SPAN style="FONT-FAMILY: 'Futura-Heavy','sans-serif'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: Futura-Heavy" lang=EN-US>Listing 31-3: </SPAN></B><SPAN style="FONT-FAMILY: 'Futura-Book','sans-serif'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: Futura-Book" lang=EN-US>A thread-safe implementation of </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror() </SPAN><SPAN style="FONT-FAMILY: 'Futura-Book','sans-serif'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: Futura-Book" lang=EN-US>using thread-specific data</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'NewBaskerville-Roman','serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskerville-Roman" lang=EN-US>&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211; </SPAN><B><SPAN style="FONT-FAMILY: TheSansMonoCondensed-Bold; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: TheSansMonoCondensed-Bold; mso-hansi-font-family: NewBaskervilleEF-Roman" lang=EN-US>threads/strerror_tsd.c</SPAN></B></FONT></P>
<P style="TEXT-ALIGN: left; TEXT-INDENT: 7pt; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none; mso-char-indent-count: .5" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>1</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>#define</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #bfbf00">_GNU_SOURCE</SPAN> <SPAN style="COLOR: #bf0000">/* Get '_sys_nerr' and '_sys_errlist' declarations from &lt;stdio.h&gt; */</SPAN></SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>2</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>#include</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #00bf00">&lt;stdio.h&gt;</SPAN></SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>3</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>#include</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #00bf00">&lt;string.h&gt;</SPAN> <SPAN style="COLOR: #bf0000">/* Get declaration of strerror() */</SPAN></SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>4</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>#include</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #00bf00">&lt;pthread.h&gt;</SPAN></SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>5</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>#include</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #00bf00">"tlpi_hdr.h"</SPAN></SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>6</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #40ffff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>static</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #00bf00">pthread_once_t</SPAN> <SPAN style="COLOR: #bfbf00">once</SPAN> = PTHREAD_ONCE_INIT;</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>7</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #40ffff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>static</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #00bf00">pthread_key_t</SPAN> <SPAN style="COLOR: #bfbf00">strerrorKey</SPAN>;</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>8</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>#define</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #bfbf00">MAX_ERROR_LEN</SPAN> 256 <SPAN style="COLOR: #bf0000">/* Maximum length of string in per-thread buffer returned by strerror() */</SPAN></SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>9</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #40ffff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>static</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #00bf00">void</SPAN> <SPAN style="COLOR: #bf0000">/* Free thread-specific data buffer */</SPAN></SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>10</SPAN><SPAN style="FONT-FAMILY: &#23435;&#20307;; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'">&#9312;</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>destructor</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>(<SPAN style="COLOR: #00bf00">void</SPAN> *<SPAN style="COLOR: #bfbf00">buf</SPAN>)</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>11</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>{</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>12</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>free(buf);</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>13</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>}</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>14</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #40ffff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>static</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #00bf00">void</SPAN> <SPAN style="COLOR: #bf0000">/* One-time key creation function */</SPAN></SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>15</SPAN><SPAN style="FONT-FAMILY: &#23435;&#20307;; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'">&#9313;</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>createKey</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>(<SPAN style="COLOR: #00bf00">void</SPAN>)</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>16</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>{</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>17</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #00bf00">int</SPAN> <SPAN style="COLOR: #bfbf00">s</SPAN>;</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>18</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #bf0000">/* Allocate a unique thread-specific data key and save the address of the destructor for thread-specific d</SPAN>\</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><FONT class=extract><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #bf0000">ata buffers */</SPAN></FONT></SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>19</SPAN><SPAN style="FONT-FAMILY: &#23435;&#20307;; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'">&#9314;</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>s = pthread_key_create(&amp;strerrorKey, destructor);</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>20</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #40ffff">if</SPAN> (s != 0)</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>21</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>errExitEN(s, <SPAN style="COLOR: #00bf00">"pthread_key_create"</SPAN>);</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>22</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>}</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>23char</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> *</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>24</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>strerror</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>(<SPAN style="COLOR: #00bf00">int</SPAN> <SPAN style="COLOR: #bfbf00">err</SPAN>)</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>25</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>{</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>26</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #00bf00">int</SPAN> <SPAN style="COLOR: #bfbf00">s</SPAN>;</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>27</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #00bf00">char</SPAN> *<SPAN style="COLOR: #bfbf00">buf</SPAN>;</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>28</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #bf0000">/* Make first caller allocate key for thread-specific data */</SPAN></SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>29</SPAN><SPAN style="FONT-FAMILY: &#23435;&#20307;; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'">&#9315;</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>s = pthread_once(&amp;once, createKey);</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>30</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #40ffff">if</SPAN> (s != 0)</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>31</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>errExitEN(s, <SPAN style="COLOR: #00bf00">"pthread_once"</SPAN>);</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>32</SPAN><SPAN style="FONT-FAMILY: &#23435;&#20307;; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'">&#9316;</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>buf = pthread_getspecific(strerrorKey);</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>33</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #40ffff">if</SPAN> (buf == <SPAN style="COLOR: #bf00bf">NULL</SPAN>) { <SPAN style="COLOR: #bf0000">/* If first call from this thread, allocate buffer for thread, and save its location */</SPAN></SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>34</SPAN><SPAN style="FONT-FAMILY: &#23435;&#20307;; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'">&#9317;</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>buf = malloc(MAX_ERROR_LEN);</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>35</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: #40ffff">if</SPAN> (buf == <SPAN style="COLOR: #bf00bf">NULL</SPAN>)</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>36</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>errExit(<SPAN style="COLOR: #00bf00">"malloc"</SPAN>);</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>37</SPAN><SPAN style="FONT-FAMILY: &#23435;&#20307;; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'">&#9318;</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>s = pthread_setspecific(strerrorKey, buf);</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>38</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: #40ffff">if</SPAN> (s != 0)</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>39</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>errExitEN(s, <SPAN style="COLOR: #00bf00">"pthread_setspecific"</SPAN>);</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>40</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>}</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>41</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #40ffff">if</SPAN> (err &lt; 0 || err &gt;= _sys_nerr || _sys_errlist[err] == <SPAN style="COLOR: #bf00bf">NULL</SPAN>) {</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>42</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>snprintf(buf, MAX_ERROR_LEN, <SPAN style="COLOR: #00bf00">"Unknown error %d"</SPAN>, err);</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>43</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>} <SPAN style="COLOR: #40ffff">else</SPAN> {</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>44</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>strncpy(buf, _sys_errlist[err], MAX_ERROR_LEN - 1);</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>45</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>buf[MAX_ERROR_LEN - 1] = <SPAN style="COLOR: #00bf00">'\0'</SPAN>; <SPAN style="COLOR: #bf0000">/* Ensure null termination */</SPAN></SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>46</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>}</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>47</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #40ffff">return</SPAN> buf;</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>48</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>}</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'NewBaskerville-Roman','serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskerville-Roman; mso-fareast-font-family: TheSansMonoCondensed-Plain" lang=EN-US>&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211; </SPAN><B><SPAN style="FONT-FAMILY: TheSansMonoCondensed-Bold; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: TheSansMonoCondensed-Bold" lang=EN-US>threads/strerror_tsd.c</SPAN></B></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-fareast-font-family: TheSansMonoCondensed-Plain" lang=EN-US>If we compile and link our test program (Listing 31-2) with the new version of </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-fareast-font-family: TheSansMonoCondensed-Plain" lang=EN-US>strerror() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-fareast-font-family: TheSansMonoCondensed-Plain" lang=EN-US>(Listing 31-3) to create an executable file, </SPAN><SPAN style="FONT-FAMILY: TheSansMonoCondensed-Plain; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: TheSansMonoCondensed-Plain" lang=EN-US>strerror_test_tsd</SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-fareast-font-family: TheSansMonoCondensed-Plain" lang=EN-US>, then we see the following results when running the program:</SPAN></FONT></P>
<P style="MARGIN: 0cm 10.5pt 0pt" class=a><SPAN style="FONT-SIZE: 14pt; mso-bidi-font-size: 12.0pt" lang=EN-US><EM><FONT class=extract>$ ./strerror_test_tsd</FONT></EM></SPAN></P>
<P style="MARGIN: 0cm 10.5pt 0pt" class=a><SPAN style="FONT-SIZE: 14pt; mso-bidi-font-size: 12.0pt" lang=EN-US><EM><FONT class=extract>Main thread has called strerror()</FONT></EM></SPAN></P>
<P style="MARGIN: 0cm 10.5pt 0pt" class=a><SPAN style="FONT-SIZE: 14pt; mso-bidi-font-size: 12.0pt" lang=EN-US><EM><FONT class=extract>Other thread about to call strerror()</FONT></EM></SPAN></P>
<P style="MARGIN: 0cm 10.5pt 0pt" class=a><SPAN style="FONT-SIZE: 14pt; mso-bidi-font-size: 12.0pt" lang=EN-US><EM><FONT class=extract>Other thread: str (0x804b158) = Operation not permitted</FONT></EM></SPAN></P>
<P style="MARGIN: 0cm 10.5pt 0pt" class=a><SPAN style="FONT-SIZE: 14pt; mso-bidi-font-size: 12.0pt" lang=EN-US><EM><FONT class=extract>Main thread: str (0x804b008) = Invalid argument</FONT></EM></SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-fareast-font-family: TheSansMonoCondensed-Plain" lang=EN-US>From this output, we see that the new version of </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-fareast-font-family: TheSansMonoCondensed-Plain" lang=EN-US>strerror() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-fareast-font-family: TheSansMonoCondensed-Plain" lang=EN-US>is thread-safe. We also see that the address pointed to by the local variable </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-fareast-font-family: TheSansMonoCondensed-Plain" lang=EN-US>str </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-fareast-font-family: TheSansMonoCondensed-Plain" lang=EN-US>in the two threads is different.</SPAN></FONT>