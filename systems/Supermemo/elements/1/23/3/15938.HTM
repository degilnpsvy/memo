<H2 style="MARGIN: 13pt 0cm"><SPAN style="LINE-HEIGHT: 173%; FONT-SIZE: 21pt; mso-bidi-font-size: 16.0pt; mso-font-kerning: 0pt" lang=EN-US><FONT face=Arial>31.4 Thread-Local Storage</FONT></SPAN></H2>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>Like thread-specific data, thread-local storage provides persistent per-thread storage. This feature is nonstandard, but it is provided in the same or a similar form on many other UNIX implementations (e.g., Solaris and FreeBSD).</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>The main advantage of thread-local storage is that it is much simpler to use than thread-specific data. To create a thread-local variable, we simply include the </SPAN><SPAN style="FONT-FAMILY: TheSansMonoCondensed-Plain; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: TheSansMonoCondensed-Plain; mso-hansi-font-family: Futura-CondensedBold" lang=EN-US>__thread </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>specifier in the declaration of a global or static variable:</SPAN></P>
<P style="MARGIN: 0cm 10.5pt 0pt" class=a><SPAN style="FONT-SIZE: 14pt; mso-bidi-font-size: 12.0pt" lang=EN-US><EM>static __thread buf[MAX_ERROR_LEN];</EM></SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>Each thread has its own copy of the variables declared with this specifier. The variables in a thread&#8217;s thread-local storage persist until the thread terminates, at which time the storage is automatically deallocated.</SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US><FONT class=extract>Note the following points about the declaration and use of thread-local variables:</FONT></SPAN></P>
<P style="TEXT-ALIGN: left; TEXT-INDENT: -21pt; MARGIN: 0cm 0cm 0pt 21pt; mso-layout-grid-align: none; mso-list: l0 level1 lfo1; tab-stops: list 21.0pt" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: Wingdings; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: Wingdings; mso-fareast-font-family: Wingdings" lang=EN-US><SPAN style="mso-list: Ignore">l<SPAN style="FONT: 7pt 'Times New Roman'">&nbsp; </SPAN></SPAN></SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>The </SPAN><SPAN style="FONT-FAMILY: TheSansMonoCondensed-Plain; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: TheSansMonoCondensed-Plain; mso-hansi-font-family: Futura-CondensedBold" lang=EN-US>__thread </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>keyword must immediately follow the </SPAN><SPAN style="FONT-FAMILY: TheSansMonoCondensed-Plain; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: TheSansMonoCondensed-Plain; mso-hansi-font-family: Futura-CondensedBold" lang=EN-US>static </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>or </SPAN><SPAN style="FONT-FAMILY: TheSansMonoCondensed-Plain; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: TheSansMonoCondensed-Plain; mso-hansi-font-family: Futura-CondensedBold" lang=EN-US>extern </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>keyword, if either of these is specified in the variable&#8217;s declaration.</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; TEXT-INDENT: -21pt; MARGIN: 0cm 0cm 0pt 21pt; mso-layout-grid-align: none; mso-list: l0 level1 lfo1; tab-stops: list 21.0pt" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: Wingdings; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: Wingdings; mso-fareast-font-family: Wingdings" lang=EN-US><SPAN style="mso-list: Ignore">l<SPAN style="FONT: 7pt 'Times New Roman'">&nbsp; </SPAN></SPAN></SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>The declaration of a thread-local variable can include an initializer, in the same manner as a normal global or static variable declaration.</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; TEXT-INDENT: -21pt; MARGIN: 0cm 0cm 0pt 21pt; mso-layout-grid-align: none; mso-list: l0 level1 lfo1; tab-stops: list 21.0pt" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: Wingdings; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: Wingdings; mso-fareast-font-family: Wingdings" lang=EN-US><SPAN style="mso-list: Ignore">l<SPAN style="FONT: 7pt 'Times New Roman'">&nbsp; </SPAN></SPAN></SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>The C address (</SPAN><SPAN style="FONT-FAMILY: TheSansMonoCondensed-Plain; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: TheSansMonoCondensed-Plain; mso-hansi-font-family: Futura-CondensedBold" lang=EN-US>&amp;</SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>) operator can be used to obtain the address of a thread-local variable.</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>Thread-local storage requires support from the kernel (provided in Linux 2.6), the Pthreads implementation (provided in NPTL), and the C compiler (provided on x86-32 with </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>gcc </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>3.3 and later).</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>Listing 31-4 shows a thread-safe implementation of </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>using thread-local storage. If we compile and link our test program (Listing 31-2) with this version of </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror() </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>to create an executable file, </SPAN><SPAN style="FONT-FAMILY: TheSansMonoCondensed-Plain; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: TheSansMonoCondensed-Plain; mso-hansi-font-family: Futura-CondensedBold" lang=EN-US>strerror_test_tls</SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-Roman','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-Roman" lang=EN-US>, then we see the following results when running the program:</SPAN></FONT></P>
<P style="MARGIN: 0cm 10.5pt 0pt" class=a><SPAN style="FONT-SIZE: 14pt; mso-bidi-font-size: 12.0pt" lang=EN-US><EM><FONT class=extract>$ ./strerror_test_tls</FONT></EM></SPAN></P>
<P style="MARGIN: 0cm 10.5pt 0pt" class=a><SPAN style="FONT-SIZE: 14pt; mso-bidi-font-size: 12.0pt" lang=EN-US><EM><FONT class=extract>Main thread has called strerror()</FONT></EM></SPAN></P>
<P style="MARGIN: 0cm 10.5pt 0pt" class=a><SPAN style="FONT-SIZE: 14pt; mso-bidi-font-size: 12.0pt" lang=EN-US><EM><FONT class=extract>Other thread about to call strerror()</FONT></EM></SPAN></P>
<P style="MARGIN: 0cm 10.5pt 0pt" class=a><SPAN style="FONT-SIZE: 14pt; mso-bidi-font-size: 12.0pt" lang=EN-US><EM><FONT class=extract>Other thread: str (0x40376ab0) = Operation not permitted</FONT></EM></SPAN></P>
<P style="MARGIN: 0cm 10.5pt 0pt" class=a><SPAN style="FONT-SIZE: 14pt; mso-bidi-font-size: 12.0pt" lang=EN-US><EM><FONT class=extract>Main thread: str (0x40175080) = Invalid argument</FONT></EM></SPAN></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><B><SPAN style="FONT-FAMILY: 'Futura-Heavy','sans-serif'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: Futura-Heavy" lang=EN-US>Listing 31-4: </SPAN></B><SPAN style="FONT-FAMILY: 'Futura-Book','sans-serif'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: Futura-Book" lang=EN-US>A thread-safe implementation of </SPAN><SPAN style="FONT-FAMILY: 'NewBaskervilleEF-RomanIta','sans-serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta" lang=EN-US>strerror() </SPAN><SPAN style="FONT-FAMILY: 'Futura-Book','sans-serif'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: Futura-Book" lang=EN-US>using thread-local storage</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'NewBaskerville-Roman','serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskerville-Roman" lang=EN-US>&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211; </SPAN><B><SPAN style="FONT-FAMILY: TheSansMonoCondensed-Bold; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: TheSansMonoCondensed-Bold; mso-hansi-font-family: Futura-Heavy" lang=EN-US>threads/strerror_tls.c</SPAN></B></FONT></P>
<P style="TEXT-ALIGN: left; TEXT-INDENT: 7pt; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none; mso-char-indent-count: .5" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>1</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>#define</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #bfbf00">_GNU_SOURCE</SPAN> <SPAN style="COLOR: #bf0000">/* Get '_sys_nerr' and '_sys_errlist' declarations from &lt;stdio.h&gt; */</SPAN></SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>2</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>#include</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #00bf00">&lt;stdio.h&gt;</SPAN></SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>3</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>#include</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #00bf00">&lt;string.h&gt;</SPAN> <SPAN style="COLOR: #bf0000">/* Get declaration of strerror() */</SPAN></SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>4</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>#include</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #00bf00">&lt;pthread.h&gt;</SPAN></SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>5</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>#define</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="COLOR: #bfbf00">MAX_ERROR_LEN</SPAN> 256 <SPAN style="COLOR: #bf0000">/* Maximum length of string in per-thread buffer returned by strerror() */</SPAN></SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>6</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #40ffff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>static</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> __thread <SPAN style="COLOR: #00bf00">char</SPAN> <SPAN style="COLOR: #bfbf00">buf</SPAN>[MAX_ERROR_LEN];</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>7</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #bf0000; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>/* Thread-local return buffer */</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>8char</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> *</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>9</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #6060ff; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>strerror</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>(<SPAN style="COLOR: #00bf00">int</SPAN> <SPAN style="COLOR: #bfbf00">err</SPAN>)</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>10</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>{</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>11</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #40ffff">if</SPAN> (err &lt; 0 || err &gt;= _sys_nerr || _sys_errlist[err] == <SPAN style="COLOR: #bf00bf">NULL</SPAN>) {</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>12</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>snprintf(buf, MAX_ERROR_LEN, <SPAN style="COLOR: #00bf00">"Unknown error %d"</SPAN>, err);</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>13</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>} <SPAN style="COLOR: #40ffff">else</SPAN> {</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>14</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US> <SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;</SPAN>strncpy(buf, _sys_errlist[err], MAX_ERROR_LEN - 1);</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>15</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>buf[MAX_ERROR_LEN - 1] = <SPAN style="COLOR: #00bf00">'\0'</SPAN>; <SPAN style="COLOR: #bf0000">/* Ensure null termination */</SPAN></SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>16</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>}</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>17</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: #40ffff">return</SPAN> buf;</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'Lucida Console'; COLOR: #00bf00; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>18</SPAN><SPAN style="FONT-FAMILY: 'Lucida Console'; FONT-SIZE: 14pt; mso-bidi-font-size: 9.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: 'Lucida Console'" lang=EN-US>}</SPAN></FONT></P>
<P style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" class=MsoNormal align=left><FONT class=extract><SPAN style="FONT-FAMILY: 'NewBaskerville-Roman','serif'; FONT-SIZE: 16pt; mso-bidi-font-size: 10.0pt; mso-font-kerning: 0pt; mso-bidi-font-family: NewBaskerville-Roman" lang=EN-US>&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211; </SPAN><B><SPAN style="FONT-FAMILY: TheSansMonoCondensed-Bold; FONT-SIZE: 12pt; mso-bidi-font-size: 8.5pt; mso-font-kerning: 0pt; mso-bidi-font-family: TheSansMonoCondensed-Bold; mso-hansi-font-family: Futura-Heavy" lang=EN-US>threads/strerror_tls.c</SPAN></B></FONT>