<H3 style="LINE-HEIGHT: normal; TEXT-TRANSFORM: none; FONT-VARIANT: normal; FONT-STYLE: normal; TEXT-INDENT: 0px; FONT-FAMILY: Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px" class=appendixsec>C.6 Compatibility For Old Extensions</H3>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px"><A href="http://www.gnu.org/software/gawk/manual/gawk.html#Dynamic-Extensions">Dynamic Extensions</A>, describes the supported API and mechanisms for writing extensions for<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>gawk</CODE>. This API was introduced in version 4.1. However, for many years<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>gawk</CODE>provided an extension mechanism that required knowledge of<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>gawk</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>internals and that was not as well designed.</P>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">In order to provide a transition period,<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>gawk</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>version 4.1 continues to support the original extension mechanism. This will be true for the life of exactly one major release. This support will be withdrawn, and removed from the source code, at the next major release.</P>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">Briefly, original-style extensions should be compiled by including the<SPAN class=Apple-converted-space>&nbsp;</SPAN><SAMP>awk.h</SAMP><SPAN class=Apple-converted-space>&nbsp;</SPAN>header file in the extension source code. Additionally, you must define the identifier &#8216;<SAMP>GAWK</SAMP>&#8217; when building (use &#8216;<SAMP>-DGAWK</SAMP>&#8217; with Unix-style compilers). Otherwise, the definitions in<SPAN class=Apple-converted-space>&nbsp;</SPAN><SAMP>gawkapi.h</SAMP><SPAN class=Apple-converted-space>&nbsp;</SPAN>will cause conflicts with those in<SPAN class=Apple-converted-space>&nbsp;</SPAN><SAMP>awk.h</SAMP><SPAN class=Apple-converted-space>&nbsp;</SPAN>and your extension will not compile.</P>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">Just as in previous versions, you load an old-style extension with the<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>extension()</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>built-in function (which is not otherwise documented). This function in turn finds and loads the shared object file containing the extension and calls its<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>dl_load()</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>C routine.</P>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">Because original-style and new-style extensions use different initialization routines (<CODE>dl_load()</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>versus<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>dlload()</CODE>), they may safely be installed in the same directory (to be found by<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>AWKLIBPATH</CODE>) without conflict.</P>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">The<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>gawk</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>development team strongly recommends that you convert any old extensions that you may have to use the new API described in<SPAN class=Apple-converted-space>&nbsp;</SPAN><A href="http://www.gnu.org/software/gawk/manual/gawk.html#Dynamic-Extensions">Dynamic Extensions</A>.