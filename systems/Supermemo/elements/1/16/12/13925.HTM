<H3 class=section>8.5 The <CODE>foreach</CODE> Function</H3>
<P><A name=index-foreach-646></A><A name=index-words_002c-iterating-over-647></A>The <CODE>foreach</CODE> function is very different from other functions. It causes one piece of text to be used repeatedly, each time with a different substitution performed on it. It resembles the <CODE>for</CODE> command in the shell <CODE>sh</CODE> and the <CODE>foreach</CODE> command in the C-shell <CODE>csh</CODE>. 
<P><FONT class=extract>The syntax of the <CODE>foreach</CODE> function is: </FONT><PRE class=example><FONT class=extract>     $(foreach <VAR>var</VAR>,<VAR>list</VAR>,<VAR>text</VAR>)
</FONT></PRE>
<P class=noindent><FONT class=extract>The first two arguments, <VAR>var</VAR> and <VAR>list</VAR>, are expanded before anything else is done; note that the last argument, <VAR>text</VAR>, is <STRONG>not</STRONG> expanded at the same time. Then for each word of the expanded value of <VAR>list</VAR>, the variable named by the expanded value of <VAR>var</VAR> is set to that word, and <VAR>text</VAR> is expanded. Presumably <VAR>text</VAR> contains references to that variable, so its expansion will be different each time. </FONT>
<P><FONT class=extract>The result is that <VAR>text</VAR> is expanded as many times as there are whitespace-separated words in <VAR>list</VAR>. The multiple expansions of <VAR>text</VAR> are concatenated, with spaces between them, to make the result of <CODE>foreach</CODE>.</FONT> 
<P><FONT class=extract>This simple example sets the variable &#8216;<SAMP><SPAN class=samp>files</SPAN></SAMP>&#8217; to the list of all files in the directories in the list &#8216;<SAMP><SPAN class=samp>dirs</SPAN></SAMP>&#8217;: </FONT><PRE class=example><FONT class=extract>     dirs := a b c d
     files := $(foreach dir,$(dirs),$(wildcard $(dir)/*))
</FONT></PRE>
<P><FONT class=extract>Here <VAR>text</VAR> is &#8216;<SAMP><SPAN class=samp>$(wildcard $(dir)/*)</SPAN></SAMP>&#8217;. The first repetition finds the value &#8216;<SAMP><SPAN class=samp>a</SPAN></SAMP>&#8217; for <CODE>dir</CODE>, so it produces the same result as &#8216;<SAMP><SPAN class=samp>$(wildcard a/*)</SPAN></SAMP>&#8217;; the second repetition produces the result of &#8216;<SAMP><SPAN class=samp>$(wildcard b/*)</SPAN></SAMP>&#8217;; and the third, that of &#8216;<SAMP><SPAN class=samp>$(wildcard c/*)</SPAN></SAMP>&#8217;. </FONT>
<P><FONT class=extract>This example has the same result (except for setting &#8216;<SAMP><SPAN class=samp>dirs</SPAN></SAMP>&#8217;) as the following example: </FONT><PRE class=example><FONT class=extract>     files := $(wildcard a/* b/* c/* d/*)
</FONT></PRE>
<P><FONT class=extract>When <VAR>text</VAR> is complicated, you can improve readability by giving it a name, with an additional variable: </FONT><PRE class=example><FONT class=extract>     find_files = $(wildcard $(dir)/*)
     dirs := a b c d
     files := $(foreach dir,$(dirs),$(find_files))
</FONT></PRE>
<P class=noindent><FONT class=extract>Here we use the variable <CODE>find_files</CODE> this way. We use plain &#8216;<SAMP><SPAN class=samp>=</SPAN></SAMP>&#8217; to define a recursively-expanding variable, so that its value contains an actual function call to be re-expanded under the control of <CODE>foreach</CODE>; a simply-expanded variable would not do, since <CODE>wildcard</CODE> would be called only once at the time of defining <CODE>find_files</CODE>.</FONT> 
<P><FONT class=extract>The <CODE>foreach</CODE> function has no permanent effect on the variable <VAR>var</VAR>; its value and flavor after the <CODE>foreach</CODE> function call are the same as they were beforehand. The other values which are taken from <VAR>list</VAR> are in effect only temporarily, during the execution of <CODE>foreach</CODE>. The variable <VAR>var</VAR> is a simply-expanded variable during the execution of <CODE>foreach</CODE>. If <VAR>var</VAR> was undefined before the <CODE>foreach</CODE> function call, it is undefined after the call. See </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Flavors"><FONT class=extract>The Two Flavors of Variables</FONT></A><FONT class=extract>. </FONT>
<P>You must take care when using complex variable expressions that result in variable names because many strange things are valid variable names, but are probably not what you intended. For example, <PRE class=smallexample>     files := $(foreach Esta-escrito-en-espanol!,b c ch,$(find_files))
</PRE>
<P class=noindent>might be useful if the value of <CODE>find_files</CODE> references the variable whose name is &#8216;<SAMP><SPAN class=samp>Esta-escrito-en-espanol!</SPAN></SAMP>&#8217; (es un nombre bastante largo, no?), but it is more likely to be a mistake.