<B><SPAN lang=EN-US style="FONT-SIZE: 16pt; COLOR: black; FONT-FAMILY: Simsun; mso-bidi-font-size: 13.5pt; mso-bidi-font-family: &#23435;&#20307;; mso-font-kerning: 0pt">3.6.8 NBD access</SPAN></B></P>
<p><SPAN lang=EN-US style="FONT-SIZE: 16pt; COLOR: black; FONT-FAMILY: Simsun; mso-bidi-font-size: 13.5pt; mso-bidi-font-family: &#23435;&#20307;; mso-font-kerning: 0pt">QEMU can access directly to block device exported using the Network Block Device protocol.</SPAN></P>
<TABLE class=MsoNormalTable style="mso-cellspacing: 1.5pt" cellPadding=0 border=0>
<TBODY>
<TR style="mso-yfti-irow: 0; mso-yfti-firstrow: yes; mso-yfti-lastrow: yes">
<TD style="BORDER-RIGHT: #ffffff; PADDING-RIGHT: 0.75pt; BORDER-TOP: #ffffff; PADDING-LEFT: 0.75pt; PADDING-BOTTOM: 0.75pt; BORDER-LEFT: #ffffff; PADDING-TOP: 0.75pt; BORDER-BOTTOM: #ffffff; BACKGROUND-COLOR: transparent">
<p><SPAN lang=EN-US style="FONT-SIZE: 16pt; COLOR: black; FONT-FAMILY: Simsun; mso-bidi-font-size: 13.5pt; mso-bidi-font-family: &#23435;&#20307;; mso-font-kerning: 0pt">&nbsp;</SPAN></P></TD>
<TD style="BORDER-RIGHT: #ffffff; PADDING-RIGHT: 0.75pt; BORDER-TOP: #ffffff; PADDING-LEFT: 0.75pt; PADDING-BOTTOM: 0.75pt; BORDER-LEFT: #ffffff; PADDING-TOP: 0.75pt; BORDER-BOTTOM: #ffffff; BACKGROUND-COLOR: transparent">
<p><SPAN lang=EN-US style="FONT-SIZE: 14pt; COLOR: black; FONT-FAMILY: &#23435;&#20307;; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: &#23435;&#20307;; mso-font-kerning: 0pt">qemu linux.img -hdb nbd:my_nbd_server.mydomain.org:1024</SPAN></P></TD></TR></TBODY></TABLE>
<p><SPAN lang=EN-US style="FONT-SIZE: 16pt; COLOR: black; FONT-FAMILY: Simsun; mso-bidi-font-size: 13.5pt; mso-bidi-font-family: &#23435;&#20307;; mso-font-kerning: 0pt">If the NBD server is located on the same host, you can use an unix socket instead of an inet socket:</SPAN></P>
<TABLE class=MsoNormalTable style="mso-cellspacing: 1.5pt" cellPadding=0 border=0>
<TBODY>
<TR style="mso-yfti-irow: 0; mso-yfti-firstrow: yes; mso-yfti-lastrow: yes">
<TD style="BORDER-RIGHT: #ffffff; PADDING-RIGHT: 0.75pt; BORDER-TOP: #ffffff; PADDING-LEFT: 0.75pt; PADDING-BOTTOM: 0.75pt; BORDER-LEFT: #ffffff; PADDING-TOP: 0.75pt; BORDER-BOTTOM: #ffffff; BACKGROUND-COLOR: transparent">
<p><SPAN lang=EN-US style="FONT-SIZE: 16pt; COLOR: black; FONT-FAMILY: Simsun; mso-bidi-font-size: 13.5pt; mso-bidi-font-family: &#23435;&#20307;; mso-font-kerning: 0pt">&nbsp;</SPAN></P></TD>
<TD style="BORDER-RIGHT: #ffffff; PADDING-RIGHT: 0.75pt; BORDER-TOP: #ffffff; PADDING-LEFT: 0.75pt; PADDING-BOTTOM: 0.75pt; BORDER-LEFT: #ffffff; PADDING-TOP: 0.75pt; BORDER-BOTTOM: #ffffff; BACKGROUND-COLOR: transparent">
<p><SPAN lang=EN-US style="FONT-SIZE: 14pt; COLOR: black; FONT-FAMILY: &#23435;&#20307;; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: &#23435;&#20307;; mso-font-kerning: 0pt">qemu linux.img -hdb nbd:unix:/tmp/my_socket</SPAN></P></TD></TR></TBODY></TABLE>
<p><SPAN lang=EN-US style="FONT-SIZE: 16pt; COLOR: black; FONT-FAMILY: Simsun; mso-bidi-font-size: 13.5pt; mso-bidi-font-family: &#23435;&#20307;; mso-font-kerning: 0pt">In this case, the block device must be exported using qemu-nbd:</SPAN></P>
<TABLE class=MsoNormalTable style="mso-cellspacing: 1.5pt" cellPadding=0 border=0>
<TBODY>
<TR style="mso-yfti-irow: 0; mso-yfti-firstrow: yes; mso-yfti-lastrow: yes">
<TD style="BORDER-RIGHT: #ffffff; PADDING-RIGHT: 0.75pt; BORDER-TOP: #ffffff; PADDING-LEFT: 0.75pt; PADDING-BOTTOM: 0.75pt; BORDER-LEFT: #ffffff; PADDING-TOP: 0.75pt; BORDER-BOTTOM: #ffffff; BACKGROUND-COLOR: transparent">
<p><SPAN lang=EN-US style="FONT-SIZE: 16pt; COLOR: black; FONT-FAMILY: Simsun; mso-bidi-font-size: 13.5pt; mso-bidi-font-family: &#23435;&#20307;; mso-font-kerning: 0pt">&nbsp;</SPAN></P></TD>
<TD style="BORDER-RIGHT: #ffffff; PADDING-RIGHT: 0.75pt; BORDER-TOP: #ffffff; PADDING-LEFT: 0.75pt; PADDING-BOTTOM: 0.75pt; BORDER-LEFT: #ffffff; PADDING-TOP: 0.75pt; BORDER-BOTTOM: #ffffff; BACKGROUND-COLOR: transparent">
<p><SPAN lang=EN-US style="FONT-SIZE: 14pt; COLOR: black; FONT-FAMILY: &#23435;&#20307;; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: &#23435;&#20307;; mso-font-kerning: 0pt">qemu-nbd --socket=/tmp/my_socket my_disk.qcow2</SPAN></P></TD></TR></TBODY></TABLE>
<p><SPAN lang=EN-US style="FONT-SIZE: 16pt; COLOR: black; FONT-FAMILY: Simsun; mso-bidi-font-size: 13.5pt; mso-bidi-font-family: &#23435;&#20307;; mso-font-kerning: 0pt">The use of qemu-nbd allows to share a disk between several guests:</SPAN></P>
<TABLE class=MsoNormalTable style="mso-cellspacing: 1.5pt" cellPadding=0 border=0>
<TBODY>
<TR style="mso-yfti-irow: 0; mso-yfti-firstrow: yes; mso-yfti-lastrow: yes">
<TD style="BORDER-RIGHT: #ffffff; PADDING-RIGHT: 0.75pt; BORDER-TOP: #ffffff; PADDING-LEFT: 0.75pt; PADDING-BOTTOM: 0.75pt; BORDER-LEFT: #ffffff; PADDING-TOP: 0.75pt; BORDER-BOTTOM: #ffffff; BACKGROUND-COLOR: transparent">
<p><SPAN lang=EN-US style="FONT-SIZE: 16pt; COLOR: black; FONT-FAMILY: Simsun; mso-bidi-font-size: 13.5pt; mso-bidi-font-family: &#23435;&#20307;; mso-font-kerning: 0pt">&nbsp;</SPAN></P></TD>
<TD style="BORDER-RIGHT: #ffffff; PADDING-RIGHT: 0.75pt; BORDER-TOP: #ffffff; PADDING-LEFT: 0.75pt; PADDING-BOTTOM: 0.75pt; BORDER-LEFT: #ffffff; PADDING-TOP: 0.75pt; BORDER-BOTTOM: #ffffff; BACKGROUND-COLOR: transparent">
<p><SPAN lang=EN-US style="FONT-SIZE: 14pt; COLOR: black; FONT-FAMILY: &#23435;&#20307;; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: &#23435;&#20307;; mso-font-kerning: 0pt">qemu-nbd --socket=/tmp/my_socket --share=2 my_disk.qcow2</SPAN></P></TD></TR></TBODY></TABLE>
<p><SPAN lang=EN-US style="FONT-SIZE: 16pt; COLOR: black; FONT-FAMILY: Simsun; mso-bidi-font-size: 13.5pt; mso-bidi-font-family: &#23435;&#20307;; mso-font-kerning: 0pt">and then you can use it with two guests:</SPAN></P>
<TABLE class=MsoNormalTable style="mso-cellspacing: 1.5pt" cellPadding=0 border=0>
<TBODY>
<TR style="mso-yfti-irow: 0; mso-yfti-firstrow: yes; mso-yfti-lastrow: yes">
<TD style="BORDER-RIGHT: #ffffff; PADDING-RIGHT: 0.75pt; BORDER-TOP: #ffffff; PADDING-LEFT: 0.75pt; PADDING-BOTTOM: 0.75pt; BORDER-LEFT: #ffffff; PADDING-TOP: 0.75pt; BORDER-BOTTOM: #ffffff; BACKGROUND-COLOR: transparent">
<p><SPAN lang=EN-US style="FONT-SIZE: 16pt; COLOR: black; FONT-FAMILY: Simsun; mso-bidi-font-size: 13.5pt; mso-bidi-font-family: &#23435;&#20307;; mso-font-kerning: 0pt">&nbsp;</SPAN></P></TD>
<TD style="BORDER-RIGHT: #ffffff; PADDING-RIGHT: 0.75pt; BORDER-TOP: #ffffff; PADDING-LEFT: 0.75pt; PADDING-BOTTOM: 0.75pt; BORDER-LEFT: #ffffff; PADDING-TOP: 0.75pt; BORDER-BOTTOM: #ffffff; BACKGROUND-COLOR: transparent">
<p><SPAN lang=EN-US style="FONT-SIZE: 14pt; COLOR: black; FONT-FAMILY: &#23435;&#20307;; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: &#23435;&#20307;; mso-font-kerning: 0pt">qemu linux1.img -hdb nbd:unix:/tmp/my_socket</SPAN></P>
<p><SPAN lang=EN-US style="FONT-SIZE: 14pt; COLOR: black; FONT-FAMILY: &#23435;&#20307;; mso-bidi-font-size: 12.0pt; mso-bidi-font-family: &#23435;&#20307;; mso-font-kerning: 0pt">qemu linux2.img -hdb nbd:unix:/tmp/my_socket</SPAN></P></TD></TR></TBODY></TABLE>