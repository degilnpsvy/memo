<H4 class=subsection>5.3.2 Choosing the Shell</H4>
<P><A name=index-shell_002c-choosing-the-329></A><A name=index-g_t_0040code_007bSHELL_007d_002c-value-of-330></A><A name=index-g_t_0040code_007b_002eSHELLFLAGS_007d_002c-value-of-331></A><A name=index-SHELL-332></A><A name=index-g_t_002eSHELLFLAGS-333></A><FONT class=extract>The program used as the shell is taken from the variable <CODE>SHELL</CODE>. If this variable is not set in your makefile, the program <SAMP><SPAN class=file>/bin/sh</SPAN></SAMP> is used as the shell. The argument(s) passed to the shell are taken from the variable <CODE>.SHELLFLAGS</CODE>. The default value of <CODE>.SHELLFLAGS</CODE> is <CODE>-c</CODE> normally, or <CODE>-ec</CODE> in POSIX-conforming mode.</FONT> 
<P><A name=index-environment_002c-_0040code_007bSHELL_007d-in-334></A><FONT class=extract>Unlike most variables, the variable <CODE>SHELL</CODE> is never set from the environment. This is because the <CODE>SHELL</CODE> environment variable is used to specify your personal choice of shell program for interactive use. It would be very bad for personal choices like this to affect the functioning of makefiles. See </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Environment"><FONT class=extract>Variables from the Environment</FONT></A><FONT class=extract>.</FONT> 
<P><FONT class=extract>Furthermore, when you do set <CODE>SHELL</CODE> in your makefile that value is <EM>not</EM> exported in the environment to recipe lines that <CODE>make</CODE> invokes. Instead, the value inherited from the user's environment, if any, is exported. You can override this behavior by explicitly exporting <CODE>SHELL</CODE> (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Variables_002fRecursion"><FONT class=extract>Communicating Variables to a Sub-<CODE>make</CODE></FONT></A><FONT class=extract>), forcing it to be passed in the environment to recipe lines.</FONT> 
<P><A name=index-g_t_0040code_007bMAKESHELL_007d-_0040r_007b_0028MS_002dDOS-alternative-to-_0040code_007bSHELL_007d_0029_007d-335></A>However, on MS-DOS and MS-Windows the value of <CODE>SHELL</CODE> in the environment <STRONG>is</STRONG> used, since on those systems most users do not set this variable, and therefore it is most likely set specifically to be used by <CODE>make</CODE>. On MS-DOS, if the setting of <CODE>SHELL</CODE> is not suitable for <CODE>make</CODE>, you can set the variable <CODE>MAKESHELL</CODE> to the shell that <CODE>make</CODE> should use; if set it will be used as the shell instead of the value of <CODE>SHELL</CODE>. 
<H5 class=subsubheading>Choosing a Shell in DOS and Windows</H5>
<P><A name=index-shell_002c-in-DOS-and-Windows-336></A><A name=index-DOS_002c-choosing-a-shell-in-337></A><A name=index-Windows_002c-choosing-a-shell-in-338></A>Choosing a shell in MS-DOS and MS-Windows is much more complex than on other systems. 
<P><A name=index-COMSPEC-339></A>On MS-DOS, if <CODE>SHELL</CODE> is not set, the value of the variable <CODE>COMSPEC</CODE> (which is always set) is used instead. 
<P><A name=index-g_t_0040code_007bSHELL_007d_002c-MS_002dDOS-specifics-340></A>The processing of lines that set the variable <CODE>SHELL</CODE> in Makefiles is different on MS-DOS. The stock shell, <SAMP><SPAN class=file>command.com</SPAN></SAMP>, is ridiculously limited in its functionality and many users of <CODE>make</CODE> tend to install a replacement shell. Therefore, on MS-DOS, <CODE>make</CODE> examines the value of <CODE>SHELL</CODE>, and changes its behavior based on whether it points to a Unix-style or DOS-style shell. This allows reasonable functionality even if <CODE>SHELL</CODE> points to <SAMP><SPAN class=file>command.com</SPAN></SAMP>. 
<P>If <CODE>SHELL</CODE> points to a Unix-style shell, <CODE>make</CODE> on MS-DOS additionally checks whether that shell can indeed be found; if not, it ignores the line that sets <CODE>SHELL</CODE>. In MS-DOS, GNU <CODE>make</CODE> searches for the shell in the following places: 
<OL type=1>
<LI>In the precise place pointed to by the value of <CODE>SHELL</CODE>. For example, if the makefile specifies &#8216;<SAMP><SPAN class=samp>SHELL = /bin/sh</SPAN></SAMP>&#8217;, <CODE>make</CODE> will look in the directory <SAMP><SPAN class=file>/bin</SPAN></SAMP> on the current drive. 
<LI>In the current directory. 
<LI>In each of the directories in the <CODE>PATH</CODE> variable, in order. </LI></OL>
<P>In every directory it examines, <CODE>make</CODE> will first look for the specific file (<SAMP><SPAN class=file>sh</SPAN></SAMP> in the example above). If this is not found, it will also look in that directory for that file with one of the known extensions which identify executable files. For example <SAMP><SPAN class=file>.exe</SPAN></SAMP>, <SAMP><SPAN class=file>.com</SPAN></SAMP>, <SAMP><SPAN class=file>.bat</SPAN></SAMP>, <SAMP><SPAN class=file>.btm</SPAN></SAMP>, <SAMP><SPAN class=file>.sh</SPAN></SAMP>, and some others. 
<P>If any of these attempts is successful, the value of <CODE>SHELL</CODE> will be set to the full pathname of the shell as found. However, if none of these is found, the value of <CODE>SHELL</CODE> will not be changed, and thus the line that sets it will be effectively ignored. This is so <CODE>make</CODE> will only support features specific to a Unix-style shell if such a shell is actually installed on the system where <CODE>make</CODE> runs. 
<P>Note that this extended search for the shell is limited to the cases where <CODE>SHELL</CODE> is set from the Makefile; if it is set in the environment or command line, you are expected to set it to the full pathname of the shell, exactly as things are on Unix. 
<P>The effect of the above DOS-specific processing is that a Makefile that contains &#8216;<SAMP><SPAN class=samp>SHELL = /bin/sh</SPAN></SAMP>&#8217; (as many Unix makefiles do), will work on MS-DOS unaltered if you have e.g. <SAMP><SPAN class=file>sh.exe</SPAN></SAMP> installed in some directory along your <CODE>PATH</CODE>.