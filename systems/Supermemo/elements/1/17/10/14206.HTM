<H4><A name=SECTION03140050000000000000>What if there are loops?</A> </H4>
<P>
<DIV align=center><A name=fig:loopex></A><A name=8543></A>
<TABLE>
<CAPTION align=bottom><STRONG>Figure 3.26:</STRONG> There are ten links and ten revolute joints arranged in a loop. This is an example of a closed kinematic chain. </CAPTION>
<TBODY>
<TR>
<TD><IMG height=230 alt="\begin{figure}\begin{center}&#10;\centerline{\psfig{file=figs/loopex.eps,width=5.0in}}&#10;\end{center}&#10;\end{figure}" src="http://planning.cs.uiuc.edu/img950.gif" width=575 border=0></TD></TR></TBODY></TABLE></DIV>
<P>The most general case includes links that are connected in loops, as shown in Figure <A href="http://planning.cs.uiuc.edu/node117.html#fig:loopex">3.26</A>. These are generally referred to as <EM>closed kinematic chains</EM><A name=9087></A>. This arises in many applications. For example, with humanoid robotics or digital actors, a loop is formed when both feet touch the ground. As another example, suppose that two robot manipulators<A name=8299></A>, such as the Puma 560 from Example <A href="http://planning.cs.uiuc.edu/node111.html#exa:puma">3.4</A>, cooperate together to carry an object. If each robot grasps the same object with its hand, then a loop will be formed. A complicated example of this was shown in Figure <A href="http://planning.cs.uiuc.edu/node10.html#fig:piano">1.5</A>, in which mobile robots moved a piano. Outside of robotics, a large fraction of organic molecules have flexible loops. Exploring the space of their conformations requires careful consideration of the difficulties imposed by these loops. 
<P>
<DIV align=center><A name=fig:loopex2></A><A name=8545></A>
<TABLE>
<CAPTION align=bottom><STRONG>Figure 3.27:</STRONG> Loops may be opened to enable tree-based transformations to be applied; however, a closure constraint must still be satisfied. </CAPTION>
<TBODY>
<TR>
<TD><IMG height=286 alt="\begin{figure}\begin{center}&#10;\centerline{\psfig{file=figs/loopex2.eps,width=5.0in}}&#10;\end{center}&#10;\end{figure}" src="http://planning.cs.uiuc.edu/img951.gif" width=575 border=0></TD></TR></TBODY></TABLE></DIV>
<P>The main difficulty of working with closed kinematic chains is that it is hard to determine which parameter values are within an acceptable range to ensure closure. If these values are given, then the transformations are handled in the same way as the case of trees. For example, the links in Figure <A href="http://planning.cs.uiuc.edu/node117.html#fig:loopex">3.26</A> may be transformed by breaking the loop into two different chains. Suppose we forget that the joint between <!-- MATH
 ${\cal A}_5$
 --><SPAN class=MATH><IMG height=34 alt="$ {\cal A}_5$" src="http://planning.cs.uiuc.edu/img924.gif" width=28 align=middle border=0></SPAN> and <!-- MATH
 ${\cal A}_6$
 --><SPAN class=MATH><IMG height=34 alt="$ {\cal A}_6$" src="http://planning.cs.uiuc.edu/img905.gif" width=28 align=middle border=0></SPAN> exists, as shown in Figure <A href="http://planning.cs.uiuc.edu/node117.html#fig:loopex2">3.27</A>. Consider two different kinematic chains that start at the joint on the extreme left. There is an upper chain from <!-- MATH
 ${\cal A}_1$
 --><SPAN class=MATH><IMG height=34 alt="$ {\cal A}_1$" src="http://planning.cs.uiuc.edu/img846.gif" width=28 align=middle border=0></SPAN> to <!-- MATH
 ${\cal A}_5$
 --><SPAN class=MATH><IMG height=34 alt="$ {\cal A}_5$" src="http://planning.cs.uiuc.edu/img924.gif" width=28 align=middle border=0></SPAN> and a lower chain from <!-- MATH
 ${\cal A}_{10}$
 --><SPAN class=MATH><IMG height=34 alt="$ {\cal A}_{10}$" src="http://planning.cs.uiuc.edu/img952.gif" width=34 align=middle border=0></SPAN> to <!-- MATH
 ${\cal A}_6$
 --><SPAN class=MATH><IMG height=34 alt="$ {\cal A}_6$" src="http://planning.cs.uiuc.edu/img905.gif" width=28 align=middle border=0></SPAN>. The transformations for any of these bodies can be obtained directly from the techniques of Section <A href="http://planning.cs.uiuc.edu/node106.html#sec:2dchain">3.3.1</A>. Thus, it is easy to transform the bodies, but how do we choose parameter values that ensure <!-- MATH
 ${\cal A}_5$
 --><SPAN class=MATH><IMG height=34 alt="$ {\cal A}_5$" src="http://planning.cs.uiuc.edu/img924.gif" width=28 align=middle border=0></SPAN> and <!-- MATH
 ${\cal A}_6$
 --><SPAN class=MATH><IMG height=34 alt="$ {\cal A}_6$" src="http://planning.cs.uiuc.edu/img905.gif" width=28 align=middle border=0></SPAN> are connected at their common joint? Using the upper chain, the position of this joint may be expressed as 
<P></P>
<DIV class=mathdisplay align=center><A name=eqn:uchain></A><!-- MATH
 \begin{equation}
T_1(\theta_1) T_2(\theta_2) T_3(\theta_3) T_4(\theta_4) T_5(\theta_5) 
\begin{pmatrix}
a_5 \\0 \\1 \\
\end{pmatrix} ,
\end{equation}
 -->
<TABLE class=equation cellPadding=0 width="100%" align=center>
<TBODY>
<TR vAlign=center>
<TD noWrap align=middle><SPAN class=MATH><IMG height=87 alt="$\displaystyle T_1(\theta_1) T_2(\theta_2) T_3(\theta_3) T_4(\theta_4) T_5(\theta_5) \begin{pmatrix}a_5  0  1  \end{pmatrix} ,$" src="http://planning.cs.uiuc.edu/img953.gif" width=314 align=middle border=0></SPAN></TD>
<TD class=eqno noWrap align=right width=10>(<SPAN class=arabic>3</SPAN>.<SPAN class=arabic>79</SPAN>)</TD></TR></TBODY></TABLE></DIV><BR clear=all>
<P></P>in which <!-- MATH
 $(a_5,0) \in {\cal A}_5$
 --><SPAN class=MATH><IMG height=37 alt="$ (a_5,0) \in {\cal A}_5$" src="http://planning.cs.uiuc.edu/img954.gif" width=100 align=middle border=0></SPAN> is the location of the joint of <!-- MATH
 ${\cal A}_5$
 --><SPAN class=MATH><IMG height=34 alt="$ {\cal A}_5$" src="http://planning.cs.uiuc.edu/img924.gif" width=28 align=middle border=0></SPAN> that is supposed to connect to <!-- MATH
 ${\cal A}_6$
 --><SPAN class=MATH><IMG height=34 alt="$ {\cal A}_6$" src="http://planning.cs.uiuc.edu/img905.gif" width=28 align=middle border=0></SPAN>. The position of this joint may also be expressed using the lower chain as 
<P></P>
<DIV class=mathdisplay align=center><A name=eqn:lchain></A><!-- MATH
 \begin{equation}
T_{10}(\theta_{10}) T_9(\theta_9) T_8(\theta_8) T_7(\theta_7) T_6(\theta_6) 
\begin{pmatrix}
a_6 \\0 \\1 \\
\end{pmatrix} ,
\end{equation}
 -->
<TABLE class=equation cellPadding=0 width="100%" align=center>
<TBODY>
<TR vAlign=center>
<TD noWrap align=middle><SPAN class=MATH><IMG height=87 alt="$\displaystyle T_{10}(\theta_{10}) T_9(\theta_9) T_8(\theta_8) T_7(\theta_7) T_6(\theta_6) \begin{pmatrix}a_6  0  1  \end{pmatrix} ,$" src="http://planning.cs.uiuc.edu/img955.gif" width=327 align=middle border=0></SPAN></TD>
<TD class=eqno noWrap align=right width=10>(<SPAN class=arabic>3</SPAN>.<SPAN class=arabic>80</SPAN>)</TD></TR></TBODY></TABLE></DIV><BR clear=all>
<P></P>with <SPAN class=MATH><IMG height=37 alt="$ (a_6,0)$" src="http://planning.cs.uiuc.edu/img956.gif" width=54 align=middle border=0></SPAN> representing the position of the joint in the body frame of <!-- MATH
 ${\cal A}_6$
 --><SPAN class=MATH><IMG height=34 alt="$ {\cal A}_6$" src="http://planning.cs.uiuc.edu/img905.gif" width=28 align=middle border=0></SPAN>. If the loop does not have to be maintained, then any values for <SPAN class=MATH><IMG height=34 alt="$ \theta_1$" src="http://planning.cs.uiuc.edu/img848.gif" width=21 align=middle border=0></SPAN>, <SPAN class=MATH><IMG height=17 alt="$ \ldots $" src="http://planning.cs.uiuc.edu/img94.gif" width=27 align=bottom border=0></SPAN>, <!-- MATH
 $\theta_{10}$
 --><SPAN class=MATH><IMG height=34 alt="$ \theta_{10}$" src="http://planning.cs.uiuc.edu/img957.gif" width=28 align=middle border=0></SPAN> may be selected, resulting in ten degrees of freedom. However, if a loop must maintained, then (<A href="http://planning.cs.uiuc.edu/node117.html#eqn:uchain">3.79</A>) and (<A href="http://planning.cs.uiuc.edu/node117.html#eqn:lchain">3.80</A>) must be equal, 
<P></P>
<DIV class=mathdisplay align=center><A name=eqn:bothchains></A><!-- MATH
 \begin{equation}
T_1(\theta_1) T_2(\theta_2) T_3(\theta_3) T_4(\theta_4) T_5(\theta_5) \begin{pmatrix}
a_5 \\0 \\1 \\
\end{pmatrix} =
T_{10}(\theta_{10}) T_9(\theta_9) T_8(\theta_8) T_7(\theta_7) T_6(\theta_6) 
\begin{pmatrix}
a_6 \\0 \\1 \\
\end{pmatrix} ,
\end{equation}
 -->
<TABLE class=equation cellPadding=0 width="100%" align=center>
<TBODY>
<TR vAlign=center>
<TD noWrap align=middle><SPAN class=MATH><IMG height=88 alt="$\displaystyle T_1(\theta_1) T_2(\theta_2) T_3(\theta_3) T_4(\theta_4) T_5(\thet...&#10;..._8) T_7(\theta_7) T_6(\theta_6) \begin{pmatrix}a_6  0  1  \end{pmatrix} ,$" src="http://planning.cs.uiuc.edu/img958.gif" width=651 align=middle border=0></SPAN></TD>
<TD class=eqno noWrap align=right width=10>(<SPAN class=arabic>3</SPAN>.<SPAN class=arabic>81</SPAN>)</TD></TR></TBODY></TABLE></DIV><BR clear=all>
<P></P>which is quite a mess of nonlinear, trigonometric equations that must be solved. The set of solutions to (<A href="http://planning.cs.uiuc.edu/node117.html#eqn:bothchains">3.81</A>) could be very complicated. For the example, the true degrees of freedom is eight because two were removed by making the joint common. Since the common joint allows the links to rotate, exactly two degrees of freedom are lost. If <!-- MATH
 ${\cal A}_5$
 --><SPAN class=MATH><IMG height=34 alt="$ {\cal A}_5$" src="http://planning.cs.uiuc.edu/img924.gif" width=28 align=middle border=0></SPAN> and <!-- MATH
 ${\cal A}_6$
 --><SPAN class=MATH><IMG height=34 alt="$ {\cal A}_6$" src="http://planning.cs.uiuc.edu/img905.gif" width=28 align=middle border=0></SPAN> had to be rigidly attached, then the total degrees of freedom would be only seven. For most problems that involve loops, it will not be possible to obtain a nice parameterization of the set of solutions. This a form of the well-known <EM>inverse kinematics problem</EM><A name=9103></A> [<A href="http://planning.cs.uiuc.edu/node858.html#Cra89">252</A>,<A href="http://planning.cs.uiuc.edu/node858.html#Mer00">693</A>,<A href="http://planning.cs.uiuc.edu/node858.html#Pau81">775</A>,<A href="http://planning.cs.uiuc.edu/node858.html#Yos90">994</A>]. 
<P>In general, a complicated arrangement of links can be imagined in which there are many loops. Each time a joint along a loop is ``ignored,'' as in the procedure just described, then one less loop exists. This process can be repeated iteratively until there are no more loops in the graph. The resulting arrangement of links will be a tree for which the previous techniques of this section may be applied. However, for each joint that was ``ignored'' an equation similar to (<A href="http://planning.cs.uiuc.edu/node117.html#eqn:bothchains">3.81</A>) must be introduced. All of these equations must be satisfied simultaneously to respect the original loop constraints. Suppose that a set of value parameters is already given. This could happen, for example, using motion capture technology to measure the position and orientation of every part of a human body in contact with the ground. From this the solution parameters could be computed, and all of the transformations are easy to represent. However, as soon as the model moves, it is difficult to ensure that the new transformations respect the closure constraints. The foot of the digital actor may push through the floor, for example. Further information on this problem appears in Section <A href="http://planning.cs.uiuc.edu/node168.html#sec:closure">4.4</A>.