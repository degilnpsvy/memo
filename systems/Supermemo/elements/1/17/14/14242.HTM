<H4><A name=SECTION03222040000000000000>Finding quaternion parameters from a rotation matrix</A> </H4>
<P><A name=12398></A>
<P>Recall from Section <A href="http://planning.cs.uiuc.edu/node100.html#sec:3drigid">3.2.3</A> that given a rotation matrix (<A href="http://planning.cs.uiuc.edu/node103.html#eqn:genmat">3.43</A>), the yaw, pitch, and roll parameters could be directly determined using the <SPAN class=MATH><IMG height=17 alt="$ \atan2$" src="http://planning.cs.uiuc.edu/img834.gif" width=14 align=bottom border=0></SPAN> function. It turns out that the quaternion representation can also be determined directly from the matrix. This is the inverse of the function in (<A href="http://planning.cs.uiuc.edu/node151.html#eqn:quatmat">4.20</A>).<A href="http://planning.cs.uiuc.edu/footnode.html#foot12402" name=tex2html102><SUP><SPAN class=arabic>4</SPAN>.<SPAN class=arabic>9</SPAN></SUP></A> 
<P>For a given rotation matrix (<A href="http://planning.cs.uiuc.edu/node103.html#eqn:genmat">3.43</A>), the quaternion parameters <!-- MATH
 $h = a + b i + c j + d k$
 --><SPAN class=MATH><IMG height=34 alt="$ h = a + b i + c j + d&#10;k$" src="http://planning.cs.uiuc.edu/img1270.gif" width=171 align=middle border=0></SPAN> can be computed as follows [<A href="http://planning.cs.uiuc.edu/node858.html#ChiKya01">210</A>]. The first component is 
<P></P>
<DIV class=mathdisplay align=center><A name=eqn:quatfrommat></A><!-- MATH
 \begin{equation}
a = \begin{matrix} \frac{1}{2} \end{matrix} \sqrt{r_{11} + r_{22} + r_{33} + 1} ,
\end{equation}
 -->
<TABLE class=equation cellPadding=0 width="100%" align=center>
<TBODY>
<TR vAlign=center>
<TD noWrap align=middle><SPAN class=MATH><IMG height=42 alt="$\displaystyle a = \begin{matrix}\frac{1}{2} \end{matrix} \sqrt{r_{11} + r_{22} + r_{33} + 1} ,$" src="http://planning.cs.uiuc.edu/img1320.gif" width=218 align=middle border=0></SPAN></TD>
<TD class=eqno noWrap align=right width=10>(<SPAN class=arabic>4</SPAN>.<SPAN class=arabic>24</SPAN>)</TD></TR></TBODY></TABLE></DIV><BR clear=all>
<P></P>and if <!-- MATH
 $a \not = 0$
 --><SPAN class=MATH><IMG height=34 alt="$ a \not = 0 $" src="http://planning.cs.uiuc.edu/img1321.gif" width=49 align=middle border=0></SPAN>, then 
<P></P>
<DIV class=mathdisplay align=center><A name=eqn:quatfrommat2></A><!-- MATH
 \begin{equation}
b = {r_{32} - r_{23} \over 4 a},
\end{equation}
 -->
<TABLE class=equation cellPadding=0 width="100%" align=center>
<TBODY>
<TR vAlign=center>
<TD noWrap align=middle><SPAN class=MATH><IMG height=56 alt="$\displaystyle b = {r_{32} - r_{23} \over 4 a},$" src="http://planning.cs.uiuc.edu/img1322.gif" width=116 align=middle border=0></SPAN></TD>
<TD class=eqno noWrap align=right width=10>(<SPAN class=arabic>4</SPAN>.<SPAN class=arabic>25</SPAN>)</TD></TR></TBODY></TABLE></DIV><BR clear=all>
<P></P>
<P></P>
<DIV class=mathdisplay align=center><A name=eqn:quatfrommat3></A><!-- MATH
 \begin{equation}
c = {r_{13} - r_{31} \over 4 a},
\end{equation}
 -->
<TABLE class=equation cellPadding=0 width="100%" align=center>
<TBODY>
<TR vAlign=center>
<TD noWrap align=middle><SPAN class=MATH><IMG height=56 alt="$\displaystyle c = {r_{13} - r_{31} \over 4 a},$" src="http://planning.cs.uiuc.edu/img1323.gif" width=116 align=middle border=0></SPAN></TD>
<TD class=eqno noWrap align=right width=10>(<SPAN class=arabic>4</SPAN>.<SPAN class=arabic>26</SPAN>)</TD></TR></TBODY></TABLE></DIV><BR clear=all>
<P></P>and 
<P></P>
<DIV class=mathdisplay align=center><!-- MATH
 \begin{equation}
d = {r_{21} - r_{12} \over 4 a}.
\end{equation}
 -->
<TABLE class=equation cellPadding=0 width="100%" align=center>
<TBODY>
<TR vAlign=center>
<TD noWrap align=middle><SPAN class=MATH><IMG height=56 alt="$\displaystyle d = {r_{21} - r_{12} \over 4 a}.$" src="http://planning.cs.uiuc.edu/img1324.gif" width=118 align=middle border=0></SPAN></TD>
<TD class=eqno noWrap align=right width=10>(<SPAN class=arabic>4</SPAN>.<SPAN class=arabic>27</SPAN>)</TD></TR></TBODY></TABLE></DIV><BR clear=all>
<P></P>If <SPAN class=MATH><IMG height=17 alt="$ a = 0$" src="http://planning.cs.uiuc.edu/img1304.gif" width=49 align=bottom border=0></SPAN>, then the previously mentioned equator problem occurs. In this case, 
<P></P>
<DIV class=mathdisplay align=center><!-- MATH
 \begin{equation}
b = {r_{13} r_{12} \over \sqrt{r_{12}^2 r_{13}^2 + r_{12}^2 r_{23}^2 +
r_{13}^2 r_{23}^2}},
\end{equation}
 -->
<TABLE class=equation cellPadding=0 width="100%" align=center>
<TBODY>
<TR vAlign=center>
<TD noWrap align=middle><SPAN class=MATH><IMG height=51 alt="$\displaystyle b = {r_{13} r_{12} \over \sqrt{r_{12}^2 r_{13}^2 + r_{12}^2 r_{23}^2 + r_{13}^2 r_{23}^2}},$" src="http://planning.cs.uiuc.edu/img1325.gif" width=248 align=middle border=0></SPAN></TD>
<TD class=eqno noWrap align=right width=10>(<SPAN class=arabic>4</SPAN>.<SPAN class=arabic>28</SPAN>)</TD></TR></TBODY></TABLE></DIV><BR clear=all>
<P></P>
<P></P>
<DIV class=mathdisplay align=center><!-- MATH
 \begin{equation}
c = {r_{12} r_{23} \over \sqrt{r_{12}^2 r_{13}^2 + r_{12}^2 r_{23}^2 +
r_{13}^2 r_{23}^2}},
\end{equation}
 -->
<TABLE class=equation cellPadding=0 width="100%" align=center>
<TBODY>
<TR vAlign=center>
<TD noWrap align=middle><SPAN class=MATH><IMG height=51 alt="$\displaystyle c = {r_{12} r_{23} \over \sqrt{r_{12}^2 r_{13}^2 + r_{12}^2 r_{23}^2 + r_{13}^2 r_{23}^2}},$" src="http://planning.cs.uiuc.edu/img1326.gif" width=249 align=middle border=0></SPAN></TD>
<TD class=eqno noWrap align=right width=10>(<SPAN class=arabic>4</SPAN>.<SPAN class=arabic>29</SPAN>)</TD></TR></TBODY></TABLE></DIV><BR clear=all>
<P></P>and 
<P></P>
<DIV class=mathdisplay align=center><!-- MATH
 \begin{equation}
d = {r_{13} r_{23} \over \sqrt{r_{12}^2 r_{13}^2 + r_{12}^2 r_{23}^2 +
r_{13}^2 r_{23}^2}}.
\end{equation}
 -->
<TABLE class=equation cellPadding=0 width="100%" align=center>
<TBODY>
<TR vAlign=center>
<TD noWrap align=middle><SPAN class=MATH><IMG height=51 alt="$\displaystyle d = {r_{13} r_{23} \over \sqrt{r_{12}^2 r_{13}^2 + r_{12}^2 r_{23}^2 + r_{13}^2 r_{23}^2}}.$" src="http://planning.cs.uiuc.edu/img1327.gif" width=250 align=middle border=0></SPAN></TD>
<TD class=eqno noWrap align=right width=10>(<SPAN class=arabic>4</SPAN>.<SPAN class=arabic>30</SPAN>)</TD></TR></TBODY></TABLE></DIV><BR clear=all>
<P></P>This method fails if <!-- MATH
 $r_{12} = r_{23} = 0$
 --><SPAN class=MATH><IMG height=33 alt="$ r_{12} = r_{23} = 0$" src="http://planning.cs.uiuc.edu/img1328.gif" width=110 align=middle border=0></SPAN> or <!-- MATH
 $r_{13} = r_{23} =
0$
 --><SPAN class=MATH><IMG height=33 alt="$ r_{13} = r_{23} =&#10;0$" src="http://planning.cs.uiuc.edu/img1329.gif" width=110 align=middle border=0></SPAN> or <!-- MATH
 $r_{12} = r_{23} = 0$
 --><SPAN class=MATH><IMG height=33 alt="$ r_{12} = r_{23} = 0$" src="http://planning.cs.uiuc.edu/img1328.gif" width=110 align=middle border=0></SPAN>. These correspond precisely to the cases in which the rotation matrix is a yaw, (<A href="http://planning.cs.uiuc.edu/node102.html#eqn:yawmat">3.39</A>), pitch, (<A href="http://planning.cs.uiuc.edu/node102.html#eqn:pitchmat">3.40</A>), or roll, (<A href="http://planning.cs.uiuc.edu/node102.html#eqn:rollmat">3.41</A>), which can be detected in advance.