<H1 class=postTitle><A id=cb_post_title_url class=postTitle2 href="http://www.cnblogs.com/vamei/archive/2012/10/13/2722254.html">Python&#26631;&#20934;&#24211;11 &#22810;&#36827;&#31243;&#25506;&#32034; (multiprocessing&#21253;)</A> </H1>
<DIV class=clear></DIV>
<DIV class=postBody>
<DIV id=cnblogs_post_body>
<P><SPAN style="FONT-FAMILY: courier new, courier">&#20316;&#32773;&#65306;Vamei &#20986;&#22788;&#65306;http://www.cnblogs.com/vamei &#27426;&#36814;&#36716;&#36733;&#65292;&#20063;&#35831;&#20445;&#30041;&#36825;&#27573;&#22768;&#26126;&#12290;&#35874;&#35874;&#65281;</SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier">&nbsp;</SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier">&#22312;<A href="http://www.cnblogs.com/vamei/archive/2012/10/12/2721484.html">&#21021;&#27493;&#20102;&#35299;Python&#22810;&#36827;&#31243;</A>&#20043;&#21518;&#65292;&#25105;&#20204;&#21487;&#20197;&#32487;&#32493;&#25506;&#32034;multiprocessing&#21253;&#20013;&#26356;&#21152;&#39640;&#32423;&#30340;&#24037;&#20855;&#12290;&#36825;&#20123;&#24037;&#20855;&#21487;&#20197;&#35753;&#25105;&#20204;&#26356;&#21152;&#20415;&#21033;&#22320;&#23454;&#29616;&#22810;&#36827;&#31243;&#12290;</SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier">&nbsp;</SPAN></P>
<H3><SPAN style="FONT-FAMILY: courier new, courier">&#36827;&#31243;&#27744;</SPAN></H3>
<P><SPAN style="FONT-FAMILY: courier new, courier">&#36827;&#31243;&#27744; <SPAN style="COLOR: #ff0000"><SPAN style="COLOR: #000000">(</SPAN>Process Pool</SPAN>)&#21487;&#20197;&#21019;&#24314;<SPAN style="COLOR: #ff0000">&#22810;&#20010;&#36827;&#31243;</SPAN>&#12290;&#36825;&#20123;&#36827;&#31243;&#23601;&#20687;&#26159;&#38543;&#26102;&#24453;&#21629;&#30340;&#22763;&#20853;&#65292;&#20934;&#22791;&#25191;&#34892;&#20219;&#21153;(&#31243;&#24207;)&#12290;&#19968;&#20010;&#36827;&#31243;&#27744;&#20013;&#21487;&#20197;&#23481;&#32435;&#22810;&#20010;&#24453;&#21629;&#30340;&#22763;&#20853;&#12290;</SPAN></P>
<P>&nbsp;</P>
<P><IMG style="DISPLAY: block; MARGIN-LEFT: auto; MARGIN-RIGHT: auto" alt="" src="http://pic002.cnblogs.com/images/2012/413416/2012111222351533.jpg" width=511 height=318 jQuery1701682826936651297="1"></P>
<P style="TEXT-ALIGN: center">&#8220;&#19977;&#20010;&#36827;&#31243;&#30340;&#36827;&#31243;&#27744;&#8221;</P>
<P>&nbsp;</P>
<P><SPAN style="FONT-FAMILY: courier new, courier">&nbsp;</SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier">&#27604;&#22914;&#19979;&#38754;&#30340;&#31243;&#24207;:</SPAN></P>
<DIV class=cnblogs_code>
<DIV class=cnblogs_code_toolbar><SPAN class=cnblogs_code_copy><A title=&#22797;&#21046;&#20195;&#30721; void(0);"><IMG alt=&#22797;&#21046;&#20195;&#30721; src="http://common.cnblogs.com/images/copycode.gif"></A></SPAN></DIV><PRE><SPAN style="FONT-FAMILY: courier new, courier"><SPAN style="COLOR: #0000ff">import</SPAN><SPAN style="COLOR: #000000"> multiprocessing as mul

</SPAN><SPAN style="COLOR: #0000ff">def</SPAN><SPAN style="COLOR: #000000"> f(x):
    </SPAN><SPAN style="COLOR: #0000ff">return</SPAN> x**2<SPAN style="COLOR: #000000">

pool </SPAN>= mul.Pool(5<SPAN style="COLOR: #000000">)
rel &nbsp;= pool.map(f,[</SPAN>1,2,3,4,5,6,7,8,9,10])</SPAN><BR><SPAN style="FONT-FAMILY: courier new, courier"><SPAN style="COLOR: #0000ff">print</SPAN>(rel)</SPAN></PRE>
<DIV class=cnblogs_code_toolbar><SPAN class=cnblogs_code_copy><A title=&#22797;&#21046;&#20195;&#30721; void(0);"><IMG alt=&#22797;&#21046;&#20195;&#30721; src="http://common.cnblogs.com/images/copycode.gif"></A></SPAN></DIV></DIV>
<P><SPAN style="FONT-FAMILY: courier new, courier">&#25105;&#20204;&#21019;&#24314;&#20102;&#19968;&#20010;&#23481;&#35768;5&#20010;&#36827;&#31243;&#30340;&#36827;&#31243;&#27744; (Process Pool) &#12290;Pool&#36816;&#34892;&#30340;&#27599;&#20010;&#36827;&#31243;&#37117;&#25191;&#34892;f()&#20989;&#25968;&#12290;&#25105;&#20204;&#21033;&#29992;<SPAN style="COLOR: #ff0000">map()</SPAN>&#26041;&#27861;&#65292;&#23558;f()&#20989;&#25968;&#20316;&#29992;&#21040;&#34920;&#30340;&#27599;&#20010;&#20803;&#32032;&#19978;&#12290;&#36825;&#19982;<A href="http://www.cnblogs.com/vamei/archive/2012/07/10/2582772.html">built-in&#30340;map()&#20989;&#25968;</A>&#31867;&#20284;&#65292;&#21482;&#26159;&#36825;&#37324;&#29992;5&#20010;&#36827;&#31243;<SPAN style="COLOR: #ff0000">&#24182;&#34892;</SPAN>&#22788;&#29702;&#12290;&#22914;&#26524;&#36827;&#31243;&#36816;&#34892;&#32467;&#26463;&#21518;&#65292;&#36824;&#26377;&#38656;&#35201;&#22788;&#29702;&#30340;&#20803;&#32032;&#65292;&#37027;&#20040;&#30340;&#36827;&#31243;&#20250;&#34987;&#29992;&#20110;&#37325;&#26032;&#36816;&#34892;f()&#20989;&#25968;&#12290;&#38500;&#20102;map()&#26041;&#27861;&#22806;&#65292;Pool&#36824;&#26377;&#19979;&#38754;&#30340;&#24120;&#29992;&#26041;&#27861;&#12290;</SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier"><SPAN style="COLOR: #993300">apply_async(<EM>func,args</EM>)</SPAN>&nbsp; &#20174;&#36827;&#31243;&#27744;&#20013;&#21462;&#20986;&#19968;&#20010;&#36827;&#31243;&#25191;&#34892;func&#65292;args&#20026;func&#30340;&#21442;&#25968;&#12290;&#23427;&#23558;&#36820;&#22238;&#19968;&#20010;AsyncResult&#30340;&#23545;&#35937;&#65292;&#20320;&#21487;&#20197;&#23545;&#35813;&#23545;&#35937;&#35843;&#29992;<SPAN style="COLOR: #ff0000">get()</SPAN>&#26041;&#27861;&#20197;&#33719;&#24471;&#32467;&#26524;&#12290;</SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier"><SPAN style="COLOR: #993300">close()</SPAN>&nbsp; &#36827;&#31243;&#27744;&#19981;&#20877;&#21019;&#24314;&#26032;&#30340;&#36827;&#31243;</SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier"><SPAN style="COLOR: #993300">join()</SPAN>&nbsp;&nbsp; wait&#36827;&#31243;&#27744;&#20013;&#30340;&#20840;&#37096;&#36827;&#31243;&#12290;&#24517;&#39035;&#23545;Pool&#20808;&#35843;&#29992;close()&#26041;&#27861;&#25165;&#33021;join&#12290;</SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier">&nbsp;</SPAN></P>
<P><STRONG><SPAN style="FONT-FAMILY: courier new, courier">&#32451;&#20064;</SPAN></STRONG></P>
<P><SPAN style="FONT-FAMILY: courier new, courier">&#26377;&#19979;&#38754;&#19968;&#20010;&#25991;&#20214;download.txt&#12290;</SPAN></P>
<DIV class=cnblogs_code><PRE><SPAN style="FONT-FAMILY: courier new, courier; COLOR: #000000">www.sina.com.cn
www.163.com
www.iciba.com
www.cnblogs.com
www.qq.com
www.douban.com</SPAN></PRE></DIV>
<P><SPAN style="FONT-FAMILY: courier new, courier">&#20351;&#29992;&#21253;&#21547;3&#20010;&#36827;&#31243;&#30340;&#36827;&#31243;&#27744;&#19979;&#36733;&#25991;&#20214;&#20013;&#32593;&#31449;&#30340;&#39318;&#39029;&#12290;(&#20320;&#21487;&#20197;&#20351;&#29992;subprocess&#35843;&#29992;wget&#25110;&#32773;curl&#31561;&#19979;&#36733;&#24037;&#20855;&#25191;&#34892;&#20855;&#20307;&#30340;&#19979;&#36733;&#20219;&#21153;)</SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier">&nbsp;</SPAN></P>
<H3><SPAN style="FONT-FAMILY: courier new, courier">&#20849;&#20139;&#36164;&#28304;</SPAN></H3>
<P><SPAN style="FONT-FAMILY: courier new, courier">&#25105;&#20204;&#22312;<A href="http://www.cnblogs.com/vamei/archive/2012/10/12/2721484.html">Python&#22810;&#36827;&#31243;&#21021;&#27493;</A>&#24050;&#32463;&#25552;&#21040;&#65292;&#25105;&#20204;&#24212;&#35813;&#23613;&#37327;&#36991;&#20813;&#22810;&#36827;&#31243;&#20849;&#20139;&#36164;&#28304;&#12290;&#22810;&#36827;&#31243;&#20849;&#20139;&#36164;&#28304;&#24517;&#28982;&#20250;&#24102;&#26469;&#36827;&#31243;&#38388;&#30456;&#20114;&#31454;&#20105;&#12290;&#32780;&#36825;&#31181;&#31454;&#20105;&#21448;&#20250;&#36896;&#25104;race condition&#65292;&#25105;&#20204;&#30340;&#32467;&#26524;&#26377;&#21487;&#33021;&#34987;&#31454;&#20105;&#30340;&#19981;&#30830;&#23450;&#24615;&#25152;&#24433;&#21709;&#12290;&#20294;&#22914;&#26524;&#38656;&#35201;&#65292;&#25105;&#20204;&#20381;&#28982;&#21487;&#20197;&#36890;&#36807;&#20849;&#20139;&#20869;&#23384;&#21644;Manager&#23545;&#35937;&#36825;&#20040;&#20570;&#12290;</SPAN></P>
<P>&nbsp;</P>
<P><IMG style="DISPLAY: block; MARGIN-LEFT: auto; MARGIN-RIGHT: auto" alt="" src="http://pic002.cnblogs.com/images/2012/413416/2012111222463057.jpg" width=468 height=347 jQuery1701682826936651297="2"></P>
<P style="TEXT-ALIGN: center"><SPAN style="FONT-FAMILY: courier new, courier">&#20849;&#20139;&#8220;&#36164;&#28304;&#8221; </SPAN></P>
<P><STRONG><SPAN style="FONT-FAMILY: courier new, courier">&#20849;&#20139;&#20869;&#23384;</SPAN></STRONG></P>
<P><SPAN style="FONT-FAMILY: courier new, courier">&#22312;<A href="http://www.cnblogs.com/vamei/archive/2012/10/10/2715398.html">Linux&#36827;&#31243;&#38388;&#36890;&#20449;</A>&#20013;&#65292;&#25105;&#20204;&#24050;&#32463;&#35762;&#36848;&#20102;<SPAN style="COLOR: #ff0000">&#20849;&#20139;&#20869;&#23384;</SPAN>(shared memory)&#30340;&#21407;&#29702;&#65292;&#36825;&#37324;&#32473;&#20986;&#29992;Python&#23454;&#29616;&#30340;&#20363;&#23376;:</SPAN></P>
<DIV class=cnblogs_code>
<DIV class=cnblogs_code_toolbar><SPAN class=cnblogs_code_copy><A title=&#22797;&#21046;&#20195;&#30721; void(0);"><IMG alt=&#22797;&#21046;&#20195;&#30721; src="http://common.cnblogs.com/images/copycode.gif"></A></SPAN></DIV><PRE><SPAN style="FONT-FAMILY: courier new, courier"><SPAN style="COLOR: #008000">#</SPAN><SPAN style="COLOR: #008000"> modified from official documentation</SPAN>
<SPAN style="COLOR: #0000ff">import</SPAN><SPAN style="COLOR: #000000"> multiprocessing

</SPAN><SPAN style="COLOR: #0000ff">def</SPAN><SPAN style="COLOR: #000000"> f(n, a):
    n.value &nbsp; </SPAN>= 3.14<SPAN style="COLOR: #000000">
    a[0]      </SPAN>= 5<SPAN style="COLOR: #000000">

num &nbsp; </SPAN>= multiprocessing.Value(<SPAN style="COLOR: #800000">'</SPAN><SPAN style="COLOR: #800000">d</SPAN><SPAN style="COLOR: #800000">'</SPAN>, 0.0<SPAN style="COLOR: #000000">)
arr   </SPAN>= multiprocessing.Array(<SPAN style="COLOR: #800000">'</SPAN><SPAN style="COLOR: #800000">i</SPAN><SPAN style="COLOR: #800000">'</SPAN>, range(10<SPAN style="COLOR: #000000">))

p </SPAN>= multiprocessing.Process(target=f, args=<SPAN style="COLOR: #000000">(num, arr))
p.start()
p.join()

</SPAN><SPAN style="COLOR: #0000ff">print</SPAN><SPAN style="COLOR: #000000"> num.value
</SPAN><SPAN style="COLOR: #0000ff">print</SPAN> arr[:]</SPAN></PRE>
<DIV class=cnblogs_code_toolbar><SPAN class=cnblogs_code_copy><A title=&#22797;&#21046;&#20195;&#30721; void(0);"><IMG alt=&#22797;&#21046;&#20195;&#30721; src="http://common.cnblogs.com/images/copycode.gif"></A></SPAN></DIV></DIV>
<P><SPAN style="FONT-FAMILY: courier new, courier">&#36825;&#37324;&#25105;&#20204;&#23454;&#38469;&#19978;&#21482;&#26377;&#20027;&#36827;&#31243;&#21644;Process&#23545;&#35937;&#20195;&#34920;&#30340;&#36827;&#31243;&#12290;&#25105;&#20204;&#22312;&#20027;&#36827;&#31243;&#30340;&#20869;&#23384;&#31354;&#38388;&#20013;&#21019;&#24314;&#20849;&#20139;&#30340;&#20869;&#23384;&#65292;&#20063;&#23601;&#26159;<SPAN style="COLOR: #ff0000">Value</SPAN>&#21644;<SPAN style="COLOR: #ff0000">Array</SPAN>&#20004;&#20010;&#23545;&#35937;&#12290;&#23545;&#35937;Value&#34987;&#35774;&#32622;&#25104;&#20026;&#21452;&#31934;&#24230;&#25968;(d), &#24182;&#21021;&#22987;&#21270;&#20026;0.0&#12290;&#32780;Array&#21017;&#31867;&#20284;&#20110;C&#20013;&#30340;&#25968;&#32452;&#65292;&#26377;&#22266;&#23450;&#30340;&#31867;&#22411;(i, &#20063;&#23601;&#26159;&#25972;&#25968;)&#12290;&#22312;Process&#36827;&#31243;&#20013;&#65292;&#25105;&#20204;&#20462;&#25913;&#20102;Value&#21644;Array&#23545;&#35937;&#12290;&#22238;&#21040;&#20027;&#31243;&#24207;&#65292;&#25171;&#21360;&#20986;&#32467;&#26524;&#65292;&#20027;&#31243;&#24207;&#20063;&#30475;&#21040;&#20102;&#20004;&#20010;&#23545;&#35937;&#30340;&#25913;&#21464;&#65292;&#35828;&#26126;&#36164;&#28304;&#30830;&#23454;&#22312;&#20004;&#20010;&#36827;&#31243;&#20043;&#38388;&#20849;&#20139;&#12290;</SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier">&nbsp;</SPAN></P>
<P><STRONG><SPAN style="FONT-FAMILY: courier new, courier">Manager</SPAN></STRONG></P>
<P><SPAN style="FONT-FAMILY: courier new, courier">Manager&#23545;&#35937;&#31867;&#20284;&#20110;<SPAN style="COLOR: #ff0000">&#26381;&#21153;&#22120;&#19982;&#23458;&#25143;</SPAN>&#20043;&#38388;&#30340;&#36890;&#20449; (server-client)&#65292;&#19982;&#25105;&#20204;&#22312;Internet&#19978;&#30340;&#27963;&#21160;&#24456;&#31867;&#20284;&#12290;&#25105;&#20204;&#29992;&#19968;&#20010;&#36827;&#31243;&#20316;&#20026;&#26381;&#21153;&#22120;&#65292;&#24314;&#31435;Manager&#26469;&#30495;&#27491;&#23384;&#25918;&#36164;&#28304;&#12290;&#20854;&#23427;&#30340;&#36827;&#31243;&#21487;&#20197;&#36890;&#36807;&#21442;&#25968;&#20256;&#36882;&#25110;&#32773;&#26681;&#25454;<SPAN style="COLOR: #ff0000">&#22320;&#22336;</SPAN>&#26469;&#35775;&#38382;Manager&#65292;&#24314;&#31435;&#36830;&#25509;&#21518;&#65292;&#25805;&#20316;&#26381;&#21153;&#22120;&#19978;&#30340;&#36164;&#28304;&#12290;&#22312;&#38450;&#28779;&#22681;&#20801;&#35768;&#30340;&#24773;&#20917;&#19979;&#65292;&#25105;&#20204;&#23436;&#20840;&#21487;&#20197;&#23558;Manager&#36816;&#29992;&#20110;&#22810;&#35745;&#31639;&#26426;&#65292;&#20174;&#32780;&#27169;&#20223;&#20102;&#19968;&#20010;&#30495;&#23454;&#30340;&#32593;&#32476;&#24773;&#22659;&#12290;&#19979;&#38754;&#30340;&#20363;&#23376;&#20013;&#65292;&#25105;&#20204;&#23545;Manager&#30340;&#20351;&#29992;&#31867;&#20284;&#20110;shared memory&#65292;&#20294;&#21487;&#20197;&#20849;&#20139;&#26356;&#20016;&#23500;&#30340;&#23545;&#35937;&#31867;&#22411;&#12290;<BR></SPAN></P>
<DIV class=cnblogs_code>
<DIV class=cnblogs_code_toolbar><SPAN class=cnblogs_code_copy><A title=&#22797;&#21046;&#20195;&#30721; void(0);"><IMG alt=&#22797;&#21046;&#20195;&#30721; src="http://common.cnblogs.com/images/copycode.gif"></A></SPAN></DIV><PRE><SPAN style="FONT-FAMILY: courier new, courier"><SPAN style="COLOR: #0000ff">import</SPAN><SPAN style="COLOR: #000000"> multiprocessing

</SPAN><SPAN style="COLOR: #0000ff">def</SPAN><SPAN style="COLOR: #000000"> f(x, arr, l):
    x.value </SPAN>= 3.14<SPAN style="COLOR: #000000">
    arr[0] </SPAN>= 5<SPAN style="COLOR: #000000">
    l.append(</SPAN><SPAN style="COLOR: #800000">'</SPAN><SPAN style="COLOR: #800000">Hello</SPAN><SPAN style="COLOR: #800000">'</SPAN><SPAN style="COLOR: #000000">)

server </SPAN>=<SPAN style="COLOR: #000000"> multiprocessing.Manager()
x    </SPAN>= server.Value(<SPAN style="COLOR: #800000">'</SPAN><SPAN style="COLOR: #800000">d</SPAN><SPAN style="COLOR: #800000">'</SPAN>, 0.0<SPAN style="COLOR: #000000">)
arr  </SPAN>= server.Array(<SPAN style="COLOR: #800000">'</SPAN><SPAN style="COLOR: #800000">i</SPAN><SPAN style="COLOR: #800000">'</SPAN>, range(10<SPAN style="COLOR: #000000">))
l    </SPAN>=<SPAN style="COLOR: #000000"> server.list()

proc </SPAN>= multiprocessing.Process(target=f, args=<SPAN style="COLOR: #000000">(x, arr, l))
proc.start()
proc.join()

</SPAN><SPAN style="COLOR: #0000ff">print</SPAN><SPAN style="COLOR: #000000">(x.value)
</SPAN><SPAN style="COLOR: #0000ff">print</SPAN><SPAN style="COLOR: #000000">(arr)
</SPAN><SPAN style="COLOR: #0000ff">print</SPAN>(l)</SPAN></PRE>
<DIV class=cnblogs_code_toolbar><SPAN class=cnblogs_code_copy><A title=&#22797;&#21046;&#20195;&#30721; void(0);"><IMG alt=&#22797;&#21046;&#20195;&#30721; src="http://common.cnblogs.com/images/copycode.gif"></A></SPAN></DIV></DIV>
<P><SPAN style="FONT-FAMILY: courier new, courier">Manager&#21033;&#29992;<SPAN style="COLOR: #ff0000">list()</SPAN>&#26041;&#27861;&#25552;&#20379;&#20102;&#34920;&#30340;&#20849;&#20139;&#26041;&#24335;&#12290;&#23454;&#38469;&#19978;&#20320;&#21487;&#20197;&#21033;&#29992;<SPAN style="COLOR: #ff0000">dict()</SPAN>&#26469;&#20849;&#20139;&#35789;&#20856;&#65292;<SPAN style="COLOR: #ff0000">Lock()</SPAN>&#26469;&#20849;&#20139;threading.Lock(&#27880;&#24847;&#65292;&#25105;&#20204;&#20849;&#20139;&#30340;&#26159;threading.Lock&#65292;&#32780;&#19981;&#26159;&#36827;&#31243;&#30340;mutiprocessing.Lock&#12290;&#21518;&#32773;&#26412;&#36523;&#24050;&#32463;&#23454;&#29616;&#20102;&#36827;&#31243;&#20849;&#20139;)&#31561;&#12290; &#36825;&#26679;Manager&#23601;&#20801;&#35768;&#25105;&#20204;&#20849;&#20139;&#26356;&#22810;&#26679;&#30340;&#23545;&#35937;&#12290;</SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier">&nbsp;</SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier">&#25105;&#20204;&#22312;&#36825;&#37324;&#19981;&#28145;&#20837;&#35762;&#35299;Manager&#22312;&#36828;&#31243;&#24773;&#20917;&#19979;&#30340;&#24212;&#29992;&#12290;&#26377;&#26426;&#20250;&#30340;&#35805;&#65292;&#20250;&#22312;&#32593;&#32476;&#24212;&#29992;&#20013;&#36827;&#19968;&#27493;&#25506;&#32034;&#12290;</SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier">&nbsp;</SPAN></P>
<H3><SPAN style="FONT-FAMILY: courier new, courier">&#24635;&#32467;</SPAN></H3>
<P><SPAN style="FONT-FAMILY: courier new, courier">Pool</SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier">Shared memory, Manager</SPAN></P></DIV></DIV>