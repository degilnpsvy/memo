<H3 style="LINE-HEIGHT: normal; TEXT-TRANSFORM: none; FONT-VARIANT: normal; FONT-STYLE: normal; TEXT-INDENT: 0px; FONT-FAMILY: Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">Graphics Part II: Palette</H3>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px"><STRONG>Author:</STRONG><SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="COLOR: rgb(0,0,0); TEXT-DECORATION: underline" href="mailto:InternetNightmare_X@yahoo.com?subject=assembly">InternetNightmare</A></P>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">This is my second tutorial on Graphics programming and now we're goin' to see how palette is programmed.</P>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">When operating in video mode 13h or even 12h it's sometimes necessary to adjust palette colors. Adjust them for displayed images or whatever you wish ;)</P>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">There are two ways to do this: 1) by using direct access to video ports; 2) using BIOS interrupts (preferred)</P>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">Now lets looks how palette color management using Video BIOS looks like:</P>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">mov ax,1010h ; Video BIOS function to change palette color<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR>mov bx,0 ; color number 0 (usually background, black)<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR>mov dh,60 ; red color value (0-63, not 0-255!)<BR>mov ch, 0 ; green color component (0-63)<BR>mov cl,30 ; blue color component (0-63)<BR>int 10h ; Video BIOS interrupt</P>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">Easy like that. OK now lets read the palette.</P>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">mov ax,1015h<BR>mov bx,0 ; spalvos numeris<BR>int 10h</P>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">Return values are: dh = red color component; ch = green color component; cl = blue color component.</P>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">Now lets try this using direct access to video card ports, I don't recomand doing this unless really needed (for pmode OSes).</P>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">Ports: 3C8h is used to set color (output color index), 3C7h is used for reading palette values (outpur color index), and 3C9h is used to output color component data in RGB.</P>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">mov al,0 ; set to 0 for color 0<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR>mov dx,3C8h ; port...<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR>out dx,al ; now we output al (0) to color write port<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR>mov bl,63 ; red color component<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR>mov cl.0 ; green<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR>mov ch,32 ; blue<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR>mov dx,3C9h ; data port<BR>out dx,cl ; outputing red<BR>out dx,cl ; green<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR>out dx,ch ; blue</P>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">Now reading works like this:</P>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">mov dx,3C7h ; palette data read port<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR>mov ax,0 ; color index 0<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR>out dx,ax ; outputing the data<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR>mov dx,3C9h ; we set dx to data port<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR>in bl,dx ; red color to bl<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR>in cl,dx ; green color to cl<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR>in ch,dx ; blue color to ch</P>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">That's it. I hope I helped. And always use interrupts if posible, becouse data port way sometimes has errors and red color component is not always set. Good luck!