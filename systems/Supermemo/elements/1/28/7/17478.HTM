<H1 class=postTitle><A id=cb_post_title_url class=postTitle2 href="http://www.cnblogs.com/vamei/archive/2012/11/23/2772445.html">Python&#28145;&#20837;02 &#19978;&#19979;&#25991;&#31649;&#29702;&#22120;</A> </H1>
<DIV class=clear></DIV>
<DIV class=postBody>
<DIV id=cnblogs_post_body>
<P><SPAN style="FONT-FAMILY: courier new, courier"><SPAN style="COLOR: #ff0000"><SPAN style="COLOR: #000000">&#20316;&#32773;&#65306;Vamei &#20986;&#22788;&#65306;http://www.cnblogs.com/vamei &#27426;&#36814;&#36716;&#36733;&#65292;&#20063;&#35831;&#20445;&#30041;&#36825;&#27573;&#22768;&#26126;&#12290;&#35874;&#35874;&#65281;</SPAN><BR></SPAN></SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier"><SPAN style="COLOR: #ff0000"><SPAN style="COLOR: #000000">&nbsp;</SPAN></SPAN></SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier"><SPAN style="COLOR: #ff0000">&#19978;&#19979;&#25991;&#31649;&#29702;&#22120;</SPAN>(context manager)&#26159;Python2.5&#24320;&#22987;&#25903;&#25345;&#30340;&#19968;&#31181;&#35821;&#27861;&#65292;&#29992;&#20110;&#35268;&#23450;<SPAN style="COLOR: #ff0000">&#26576;&#20010;&#23545;&#35937;&#30340;&#20351;&#29992;&#33539;&#22260;</SPAN>&#12290;&#19968;&#26086;&#36827;&#20837;&#25110;&#32773;&#31163;&#24320;&#35813;&#20351;&#29992;&#33539;&#22260;&#65292;&#20250;&#26377;&#29305;&#27530;&#25805;&#20316;&#34987;&#35843;&#29992; (&#27604;&#22914;&#20026;&#23545;&#35937;&#20998;&#37197;&#25110;&#32773;&#37322;&#25918;&#20869;&#23384;)&#12290;&#23427;&#30340;&#35821;&#27861;&#24418;&#24335;&#26159;<SPAN style="COLOR: #993300">with...as...</SPAN></SPAN></P>
<P>&nbsp;</P>
<H3><SPAN style="FONT-FAMILY: courier new, courier">&#20851;&#38381;&#25991;&#20214;</SPAN></H3>
<P><SPAN style="FONT-FAMILY: courier new, courier">&#25105;&#20204;&#20250;&#36827;&#34892;&#36825;&#26679;&#30340;&#25805;&#20316;&#65306;&#25171;&#24320;&#25991;&#20214;&#65292;&#35835;&#20889;&#65292;&#20851;&#38381;&#25991;&#20214;&#12290;&#31243;&#24207;&#21592;&#32463;&#24120;&#20250;&#24536;&#35760;&#20851;&#38381;&#25991;&#20214;&#12290;&#19978;&#19979;&#25991;&#31649;&#29702;&#22120;&#21487;&#20197;&#22312;&#19981;&#38656;&#35201;&#25991;&#20214;&#30340;&#26102;&#20505;&#65292;<SPAN style="COLOR: #ff0000">&#33258;&#21160;&#20851;&#38381;&#25991;&#20214;</SPAN>&#12290;</SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier">&#19979;&#38754;&#25105;&#20204;&#30475;&#19968;&#19979;&#20004;&#27573;&#31243;&#24207;&#65306;</SPAN></P>
<DIV class=cnblogs_code><PRE><SPAN style="FONT-FAMILY: courier new, courier; COLOR: #008000"># without context manager</SPAN><BR><SPAN style="FONT-FAMILY: courier new, courier">f = open(<SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #800000">new.txt</SPAN><SPAN style="COLOR: #800000">"</SPAN>, <SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #800000">w</SPAN><SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #000000">)
<SPAN style="COLOR: #0000ff">print</SPAN>(f.closed) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<SPAN style="COLOR: #008000"> # whether the file is open</SPAN><BR>f.write(</SPAN><SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #800000">Hello World!</SPAN><SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #000000">)
f.close()<BR></SPAN><SPAN style="COLOR: #0000ff">print</SPAN>(f.closed)</SPAN></PRE></DIV>
<P><SPAN style="FONT-FAMILY: courier new, courier">&#20197;&#21450;&#65306;</SPAN></P>
<DIV class=cnblogs_code><PRE><SPAN style="FONT-FAMILY: courier new, courier; COLOR: #008000"># with context manager</SPAN><BR><SPAN style="FONT-FAMILY: courier new, courier">with open(<SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #800000">new.txt</SPAN><SPAN style="COLOR: #800000">"</SPAN>, <SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #800000">w</SPAN><SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #000000">) as f:<BR>    <SPAN style="COLOR: #0000ff">print</SPAN>(f.closed)
    f.write(</SPAN><SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #800000">Hello World!</SPAN><SPAN style="COLOR: #800000">"</SPAN>)</SPAN><BR><SPAN style="FONT-FAMILY: courier new, courier"><SPAN style="COLOR: #0000ff">print</SPAN>(f.closed)</SPAN></PRE></DIV>
<P><SPAN style="FONT-FAMILY: courier new, courier">&#20004;&#27573;&#31243;&#24207;&#23454;&#38469;&#19978;&#25191;&#34892;&#30340;&#26159;&#30456;&#21516;&#30340;&#25805;&#20316;&#12290;&#25105;&#20204;&#30340;&#31532;&#20108;&#27573;&#31243;&#24207;&#23601;&#20351;&#29992;&#20102;&#19978;&#19979;&#25991;&#31649;&#29702;&#22120; (<SPAN style="COLOR: #993300">with...as...</SPAN>)&#12290;&#19978;&#19979;&#25991;&#31649;&#29702;&#22120;&#26377;<SPAN style="COLOR: #ff0000">&#38582;&#23646;&#20110;&#23427;&#30340;&#31243;&#24207;&#22359;</SPAN>&#12290;&#24403;&#38582;&#23646;&#30340;&#31243;&#24207;&#22359;&#25191;&#34892;&#32467;&#26463;&#30340;&#26102;&#20505;(&#20063;&#23601;&#26159;&#19981;&#20877;&#32553;&#36827;)&#65292;&#19978;&#19979;&#25991;&#31649;&#29702;&#22120;&#33258;&#21160;&#20851;&#38381;&#20102;&#25991;&#20214; (&#25105;&#20204;&#36890;&#36807;<SPAN style="COLOR: #993300">f.closed</SPAN>&#26469;&#26597;&#35810;&#25991;&#20214;&#26159;&#21542;&#20851;&#38381;)&#12290;&#25105;&#20204;&#30456;&#24403;&#20110;&#20351;&#29992;<SPAN style="COLOR: #ff0000">&#32553;&#36827;</SPAN>&#35268;&#23450;&#20102;&#25991;&#20214;&#23545;&#35937;f&#30340;<SPAN style="COLOR: #ff0000">&#20351;&#29992;&#33539;&#22260;</SPAN>&#12290;</SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier">&nbsp;</SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier">&#19978;&#38754;&#30340;&#19978;&#19979;&#25991;&#31649;&#29702;&#22120;&#22522;&#20110;f&#23545;&#35937;&#30340;<SPAN style="COLOR: #993300">__exit__()</SPAN>&#29305;&#27530;&#26041;&#27861;(&#36824;&#35760;&#24471;&#25105;&#20204;&#22914;&#20309;&#21033;&#29992;&#29305;&#27530;&#26041;&#27861;&#26469;&#23454;&#29616;&#21508;&#31181;&#35821;&#27861;&#65311;&#21442;&#30475;<A href="http://www.cnblogs.com/vamei/archive/2012/11/19/2772441.html">&#29305;&#27530;&#26041;&#27861;&#19982;&#22810;&#33539;&#24335;</A>)&#12290;&#24403;&#25105;&#20204;&#20351;&#29992;&#19978;&#19979;&#25991;&#31649;&#29702;&#22120;&#30340;&#35821;&#27861;&#26102;&#65292;&#25105;&#20204;&#23454;&#38469;&#19978;&#35201;&#27714;Python&#22312;&#36827;&#20837;&#31243;&#24207;&#22359;&#20043;&#21069;&#35843;&#29992;&#23545;&#35937;&#30340;<SPAN style="COLOR: #993300">__enter__()</SPAN>&#26041;&#27861;&#65292;&#22312;&#32467;&#26463;&#31243;&#24207;&#22359;&#30340;&#26102;&#20505;&#35843;&#29992;<SPAN style="COLOR: #993300">__exit__()</SPAN>&#26041;&#27861;&#12290;&#23545;&#20110;&#25991;&#20214;&#23545;&#35937;f&#26469;&#35828;&#65292;&#23427;&#23450;&#20041;&#20102;__enter__()&#21644;__exit__()&#26041;&#27861;(&#21487;&#20197;&#36890;&#36807;<SPAN style="COLOR: #993300">dir(f)</SPAN>&#30475;&#21040;)&#12290;&#22312;f&#30340;__exit__()&#26041;&#27861;&#20013;&#65292;&#26377;<SPAN style="COLOR: #993300">self.close()<SPAN style="COLOR: #000000">&#35821;&#21477;</SPAN></SPAN>&#12290;&#25152;&#20197;&#22312;&#20351;&#29992;&#19978;&#19979;&#25991;&#31649;&#29702;&#22120;&#26102;&#65292;&#25105;&#20204;&#23601;&#19981;&#29992;&#26126;&#25991;&#20851;&#38381;f&#25991;&#20214;&#20102;&#12290;</SPAN></P>
<P>&nbsp;</P>
<H3><SPAN style="FONT-FAMILY: courier new, courier">&#33258;&#23450;&#20041;</SPAN></H3>
<P><SPAN style="FONT-FAMILY: courier new, courier"><SPAN style="COLOR: #ff0000">&#20219;&#20309;</SPAN>&#23450;&#20041;&#20102;__enter__()&#21644;__exit__()&#26041;&#27861;&#30340;&#23545;&#35937;&#37117;&#21487;&#20197;&#29992;&#20110;&#19978;&#19979;&#25991;&#31649;&#29702;&#22120;&#12290;&#25991;&#20214;&#23545;&#35937;f&#26159;&#20869;&#32622;&#23545;&#35937;&#65292;&#25152;&#20197;f&#33258;&#21160;&#24102;&#26377;&#36825;&#20004;&#20010;&#29305;&#27530;&#26041;&#27861;&#65292;&#19981;&#38656;&#35201;&#33258;&#23450;&#20041;&#12290;</SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier">&#19979;&#38754;&#65292;&#25105;&#20204;&#33258;&#23450;&#20041;&#29992;&#20110;&#19978;&#19979;&#25991;&#31649;&#29702;&#22120;&#30340;&#23545;&#35937;&#65292;&#23601;&#26159;&#19979;&#38754;&#30340;myvow&#65306;</SPAN></P>
<P>&nbsp;</P>
<DIV class=cnblogs_code>
<DIV class=cnblogs_code_toolbar><SPAN class=cnblogs_code_copy><A title=&#22797;&#21046;&#20195;&#30721; void(0);"><IMG alt=&#22797;&#21046;&#20195;&#30721; src="http://common.cnblogs.com/images/copycode.gif"></A></SPAN></DIV><PRE><SPAN style="FONT-FAMILY: courier new, courier"><SPAN style="COLOR: #008000">#</SPAN><SPAN style="COLOR: #008000"> customized object</SPAN>

<SPAN style="COLOR: #0000ff">class</SPAN><SPAN style="COLOR: #000000"> VOW(object):
    </SPAN><SPAN style="COLOR: #0000ff">def</SPAN> <SPAN style="COLOR: #800080">__init__</SPAN><SPAN style="COLOR: #000000">(self, text):
        self.text </SPAN>=<SPAN style="COLOR: #000000"> text
    </SPAN><SPAN style="COLOR: #0000ff">def</SPAN> <SPAN style="COLOR: #800080">__enter__</SPAN><SPAN style="COLOR: #000000">(self):
        self.text </SPAN>= <SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #800000">I say: </SPAN><SPAN style="COLOR: #800000">"</SPAN> + self.text    <SPAN style="COLOR: #008000">#</SPAN><SPAN style="COLOR: #008000"> add prefix</SPAN>
        <SPAN style="COLOR: #0000ff">return</SPAN> self                          <SPAN style="COLOR: #008000">#</SPAN><SPAN style="COLOR: #008000"> note: return an object</SPAN>
    <SPAN style="COLOR: #0000ff">def</SPAN> <SPAN style="COLOR: #800080">__exit__</SPAN><SPAN style="COLOR: #000000">(self,exc_type,exc_value,traceback):
        self.text </SPAN>= self.text + <SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #800000">!</SPAN><SPAN style="COLOR: #800000">"</SPAN>          <SPAN style="COLOR: #008000">#</SPAN><SPAN style="COLOR: #008000"> add suffix</SPAN>
<SPAN style="COLOR: #000000">

with VOW(</SPAN><SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #800000">I'm fine</SPAN><SPAN style="COLOR: #800000">"</SPAN><SPAN style="COLOR: #000000">) as myvow:
    </SPAN><SPAN style="COLOR: #0000ff">print</SPAN><SPAN style="COLOR: #000000">(myvow.text)

</SPAN><SPAN style="COLOR: #0000ff">print</SPAN>(myvow.text)</SPAN></PRE>
<DIV class=cnblogs_code_toolbar><SPAN class=cnblogs_code_copy><A title=&#22797;&#21046;&#20195;&#30721; void(0);"><IMG alt=&#22797;&#21046;&#20195;&#30721; src="http://common.cnblogs.com/images/copycode.gif"></A></SPAN></DIV></DIV>
<P>&nbsp;</P>
<P><SPAN style="FONT-FAMILY: courier new, courier">&#25105;&#20204;&#30340;&#36816;&#34892;&#32467;&#26524;&#22914;&#19979;:</SPAN></P>
<DIV class=cnblogs_code><PRE><SPAN style="FONT-FAMILY: courier new, courier; COLOR: #000000">I say: I'm fine
I say: I'm fine!</SPAN></PRE></DIV>
<P><SPAN style="FONT-FAMILY: courier new, courier">&#25105;&#20204;&#21487;&#20197;&#30475;&#21040;&#65292;&#22312;&#36827;&#20837;&#19978;&#19979;&#25991;&#21644;&#31163;&#24320;&#19978;&#19979;&#25991;&#26102;&#65292;&#23545;&#35937;&#30340;text&#23646;&#24615;&#21457;&#29983;&#20102;&#25913;&#21464;(&#26368;&#21021;&#30340;text&#23646;&#24615;&#26159;"I'm fine")&#12290;</SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier">__enter__()&#36820;&#22238;&#19968;&#20010;&#23545;&#35937;&#12290;&#19978;&#19979;&#25991;&#31649;&#29702;&#22120;&#20250;&#20351;&#29992;&#36825;&#19968;&#23545;&#35937;&#20316;&#20026;<SPAN style="COLOR: #993300">as</SPAN>&#25152;&#25351;&#30340;&#21464;&#37327;&#65292;&#20063;&#23601;&#26159;myvow&#12290;&#22312;__enter__()&#20013;&#65292;&#25105;&#20204;&#20026;myvow.text&#22686;&#21152;&#20102;&#21069;&#32512; ("I say: ")&#12290;&#22312;__exit__()&#20013;&#65292;&#25105;&#20204;&#20026;myvow.text&#22686;&#21152;&#20102;&#21518;&#32512;("!")&#12290;</SPAN></P>
<P><SPAN style="FONT-FAMILY: courier new, courier">&#27880;&#24847;: __exit__()&#20013;&#26377;&#22235;&#20010;&#21442;&#25968;&#12290;&#24403;&#31243;&#24207;&#22359;&#20013;&#20986;&#29616;<SPAN style="COLOR: #ff0000">&#24322;&#24120;</SPAN>(exception)&#65292;<SPAN style="COLOR: #993300">__exit__()<SPAN style="COLOR: #000000">&#30340;&#21442;&#25968;</SPAN></SPAN>&#20013;<SPAN style="COLOR: #993300">exc_type</SPAN>,<SPAN style="COLOR: #993300"> exc_value</SPAN>, <SPAN style="COLOR: #993300">traceback</SPAN>&#29992;&#20110;&#25551;&#36848;&#24322;&#24120;&#12290;&#25105;&#20204;&#21487;&#20197;&#26681;&#25454;&#36825;&#19977;&#20010;&#21442;&#25968;&#36827;&#34892;&#30456;&#24212;&#30340;&#22788;&#29702;&#12290;&#22914;&#26524;&#27491;&#24120;&#36816;&#34892;&#32467;&#26463;&#65292;&#36825;&#19977;&#20010;&#21442;&#25968;&#37117;&#26159;<SPAN style="COLOR: #993300">None</SPAN>&#12290;&#22312;&#25105;&#20204;&#30340;&#31243;&#24207;&#20013;&#65292;&#25105;&#20204;&#24182;&#27809;&#26377;&#29992;&#21040;&#36825;&#19968;&#29305;&#24615;&#12290;</SPAN></P>
<P>&nbsp;</P>
<H3>&#24635;&#32467;&#65306;</H3>
<P>&#36890;&#36807;&#19978;&#19979;&#25991;&#31649;&#29702;&#22120;&#65292;&#25105;&#20204;&#25511;&#21046;&#23545;&#35937;&#22312;&#31243;&#24207;&#19981;&#21516;&#21306;&#38388;&#30340;&#29305;&#24615;&#12290;&#19978;&#19979;&#25991;&#31649;&#29702;&#22120;(<SPAN style="COLOR: #993300">with EXPR as VAR</SPAN>)&#22823;&#33268;&#30456;&#24403;&#20110;&#22914;&#19979;&#27969;&#31243;:</P>
<DIV class=cnblogs_code>
<DIV class=cnblogs_code_toolbar><SPAN class=cnblogs_code_copy><A title=&#22797;&#21046;&#20195;&#30721; void(0);"><IMG alt=&#22797;&#21046;&#20195;&#30721; src="http://common.cnblogs.com/images/copycode.gif"></A></SPAN></DIV><PRE><SPAN style="COLOR: #008000">#</SPAN><SPAN style="COLOR: #008000"> with EXPR as VAR:</SPAN>
<SPAN style="COLOR: #000000">
VAR </SPAN>=<SPAN style="COLOR: #000000"> EXPR
VAR </SPAN>= VAR.<SPAN style="COLOR: #800080">__enter__</SPAN><SPAN style="COLOR: #000000">()
</SPAN><SPAN style="COLOR: #0000ff">try</SPAN><SPAN style="COLOR: #000000">:
    BLOCK
</SPAN><SPAN style="COLOR: #0000ff">finally</SPAN><SPAN style="COLOR: #000000">:
    VAR.</SPAN><SPAN style="COLOR: #800080">__exit__</SPAN>()</PRE>
<DIV class=cnblogs_code_toolbar><SPAN class=cnblogs_code_copy><A title=&#22797;&#21046;&#20195;&#30721; void(0);"><IMG alt=&#22797;&#21046;&#20195;&#30721; src="http://common.cnblogs.com/images/copycode.gif"></A></SPAN></DIV></DIV>
<P>&#30001;&#20110;&#19978;&#19979;&#25991;&#31649;&#29702;&#22120;&#24102;&#26469;&#30340;&#20415;&#21033;&#65292;&#23427;&#26159;&#19968;&#20010;&#20540;&#24471;&#20351;&#29992;&#30340;&#24037;&#20855;&#12290;</P></DIV></DIV>