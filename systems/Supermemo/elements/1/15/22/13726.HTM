<H2 class=chapter>5 Writing Recipes in Rules</H2>
<P><A name=index-recipes-289></A><A name=index-recipes_002c-how-to-write-290></A><A name=index-writing-recipes-291></A>The recipe of a rule consists of one or more shell command lines to be executed, one at a time, in the order they appear. Typically, the result of executing these commands is that the target of the rule is brought up to date. 
<P>Users use many different shell programs, but recipes in makefiles are always interpreted by <SAMP><SPAN class=file>/bin/sh</SPAN></SAMP> unless the makefile specifies otherwise. See <A href="https://www.gnu.org/software/make/manual/make.html#Execution">Recipe Execution</A>. 
<UL class=menu>
<LI><A accessKey=1 href="https://www.gnu.org/software/make/manual/make.html#Recipe-Syntax">Recipe Syntax</A>: Recipe syntax features and pitfalls. 
<LI><A accessKey=2 href="https://www.gnu.org/software/make/manual/make.html#Echoing">Echoing</A>: How to control when recipes are echoed. 
<LI><A accessKey=3 href="https://www.gnu.org/software/make/manual/make.html#Execution">Execution</A>: How recipes are executed. 
<LI><A accessKey=4 href="https://www.gnu.org/software/make/manual/make.html#Parallel">Parallel</A>: How recipes can be executed in parallel. 
<LI><A accessKey=5 href="https://www.gnu.org/software/make/manual/make.html#Errors">Errors</A>: What happens after a recipe execution error. 
<LI><A accessKey=6 href="https://www.gnu.org/software/make/manual/make.html#Interrupts">Interrupts</A>: What happens when a recipe is interrupted. 
<LI><A accessKey=7 href="https://www.gnu.org/software/make/manual/make.html#Recursion">Recursion</A>: Invoking <CODE>make</CODE> from makefiles. 
<LI><A accessKey=8 href="https://www.gnu.org/software/make/manual/make.html#Canned-Recipes">Canned Recipes</A>: Defining canned recipes. 
<LI><A accessKey=9 href="https://www.gnu.org/software/make/manual/make.html#Empty-Recipes">Empty Recipes</A>: Defining useful, do-nothing recipes. </LI></UL>
<DIV class=node><A name=Recipe-Syntax></A>
<P>
<HR>
Next:&nbsp;<A accessKey=n href="https://www.gnu.org/software/make/manual/make.html#Echoing" rel=next>Echoing</A>, Previous:&nbsp;<A accessKey=p href="https://www.gnu.org/software/make/manual/make.html#Recipes" rel=previous>Recipes</A>, Up:&nbsp;<A accessKey=u href="https://www.gnu.org/software/make/manual/make.html#Recipes" rel=up>Recipes</A> </DIV>
<H3 class=section><FONT class=extract>5.1 Recipe Syntax</FONT></H3>
<P><A name=index-recipe-syntax-292></A><A name=index-syntax-of-recipe-293></A><FONT class=extract>Makefiles have the unusual property that there are really two distinct syntaxes in one file. Most of the makefile uses <CODE>make</CODE> syntax (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Makefiles"><FONT class=extract>Writing Makefiles</FONT></A><FONT class=extract>). However, recipes are meant to be interpreted by the shell and so they are written using shell syntax. The <CODE>make</CODE> program does not try to understand shell syntax: it performs only a very few specific translations on the content of the recipe before handing it to the shell. </FONT>
<P><FONT class=extract>Each line in the recipe must start with a tab (or the first character in the value of the <CODE>.RECIPEPREFIX</CODE> variable; see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Special-Variables"><FONT class=extract>Special Variables</FONT></A><FONT class=extract>), except that the first recipe line may be attached to the target-and-prerequisites line with a semicolon in between. <EM>Any</EM> line in the makefile that begins with a tab and appears in a &#8220;rule context&#8221; (that is, after a rule has been started until another rule or variable definition) will be considered part of a recipe for that rule. Blank lines and lines of just comments may appear among the recipe lines; they are ignored. </FONT>
<P><FONT class=extract>Some consequences of these rules include: </FONT>
<UL>
<LI><FONT class=extract>A blank line that begins with a tab is not blank: it's an empty recipe (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Empty-Recipes"><FONT class=extract>Empty Recipes</FONT></A><FONT class=extract>). </FONT>
<P><A name=index-comments_002c-in-recipes-294></A><A name=index-recipes_002c-comments-in-295></A><A name=index-g_t_0040code_007b_0023_007d-_0028comments_0029_002c-in-recipes-296></A></P>
<LI><FONT class=extract>A comment in a recipe is not a <CODE>make</CODE> comment; it will be passed to the shell as-is. Whether the shell treats it as a comment or not depends on your shell. </FONT>
<LI><FONT class=extract>A variable definition in a &#8220;rule context&#8221; which is indented by a tab as the first character on the line, will be considered part of a recipe, not a <CODE>make</CODE> variable definition, and passed to the shell. </FONT>
<LI><FONT class=extract>A conditional expression (<CODE>ifdef</CODE>, <CODE>ifeq</CODE>, etc. see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Conditional-Syntax"><FONT class=extract>Syntax of Conditionals</FONT></A><FONT class=extract>) in a &#8220;rule context&#8221; which is indented by a tab as the first character on the line, will be considered part of a recipe and be passed to the shell. </FONT></LI></UL>
<UL class=menu>
<LI><A accessKey=1 href="https://www.gnu.org/software/make/manual/make.html#Splitting-Recipe-Lines"><FONT class=extract>Splitting Recipe Lines</FONT></A><FONT class=extract>: Breaking long recipe lines for readability. </FONT>
<LI><A accessKey=2 href="https://www.gnu.org/software/make/manual/make.html#Variables-in-Recipes"><FONT class=extract>Variables in Recipes</FONT></A><FONT class=extract>: Using <CODE>make</CODE> variables in recipes. </FONT></LI></UL>
<DIV class=node><A name=Splitting-Recipe-Lines></A>
<P>
<HR>
Next:&nbsp;<A accessKey=n href="https://www.gnu.org/software/make/manual/make.html#Variables-in-Recipes" rel=next>Variables in Recipes</A>, Previous:&nbsp;<A accessKey=p href="https://www.gnu.org/software/make/manual/make.html#Recipe-Syntax" rel=previous>Recipe Syntax</A>, Up:&nbsp;<A accessKey=u href="https://www.gnu.org/software/make/manual/make.html#Recipe-Syntax" rel=up>Recipe Syntax</A> </DIV>
<H4 class=subsection><FONT class=extract>5.1.1 Splitting Recipe Lines</FONT></H4>
<P><A name=index-recipes_002c-splitting-297></A><A name=index-splitting-recipes-298></A><A name=index-recipes_002c-backslash-_0028_0040code_007b_005c_007d_0029-in-299></A><A name=index-recipes_002c-quoting-newlines-in-300></A><A name=index-backslash-_0028_0040code_007b_005c_007d_0029_002c-in-recipes-301></A><A name=index-g_t_0040code_007b_005c_007d-_0028backslash_0029_002c-in-recipes-302></A><A name=index-quoting-newline_002c-in-recipes-303></A><A name=index-newline_002c-quoting_002c-in-recipes-304></A><FONT class=extract>One of the few ways in which <CODE>make</CODE> does interpret recipes is checking for a backslash just before the newline. As in normal makefile syntax, a single logical recipe line can be split into multiple physical lines in the makefile by placing a backslash before each newline. A sequence of lines like this is considered a single recipe line, and one instance of the shell will be invoked to run it. </FONT>
<P><FONT class=extract>However, in contrast to how they are treated in other places in a makefile (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Splitting-Lines"><FONT class=extract>Splitting Long Lines</FONT></A><FONT class=extract>), backslash/newline pairs are <EM>not</EM> removed from the recipe. Both the backslash and the newline characters are preserved and passed to the shell. How the backslash/newline is interpreted depends on your shell. If the first character of the next line after the backslash/newline is the recipe prefix character (a tab by default; see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Special-Variables"><FONT class=extract>Special Variables</FONT></A><FONT class=extract>), then that character (and only that character) is removed. Whitespace is never added to the recipe. </FONT>
<P><FONT class=extract>For example, the recipe for the all target in this makefile: </FONT><PRE class=example><FONT class=extract>     all :
             @echo no\
     space
             @echo no\
             space
             @echo one \
             space
             @echo one\
              space
</FONT></PRE>
<P class=noindent><FONT class=extract>consists of four separate shell commands where the output is: </FONT><PRE class=example><FONT class=extract>     nospace
     nospace
     one space
     one space
</FONT></PRE>
<P><FONT class=extract>As a more complex example, this makefile: </FONT><PRE class=example><FONT class=extract>     all : ; @echo 'hello \
             world' ; echo "hello \
         world"
</FONT></PRE>
<P class=noindent><FONT class=extract>will invoke one shell with a command of: </FONT><PRE class=example><FONT class=extract>     echo 'hello \
     world' ; echo "hello \
         world"
</FONT></PRE>
<P class=noindent><FONT class=extract>which, according to shell quoting rules, will yield the following output: </FONT><PRE class=example><FONT class=extract>     hello \
     world
     hello     world
</FONT></PRE>
<P class=noindent><FONT class=extract>Notice how the backslash/newline pair was removed inside the string quoted with double quotes (<CODE>"..."</CODE>), but not from the string quoted with single quotes (<CODE>'...'</CODE>). This is the way the default shell (<SAMP><SPAN class=file>/bin/sh</SPAN></SAMP>) handles backslash/newline pairs. If you specify a different shell in your makefiles it may treat them differently. </FONT>
<P><FONT class=extract>Sometimes you want to split a long line inside of single quotes, but you don't want the backslash/newline to appear in the quoted content. This is often the case when passing scripts to languages such as Perl, where extraneous backslashes inside the script can change its meaning or even be a syntax error. One simple way of handling this is to place the quoted string, or even the entire command, into a <CODE>make</CODE> variable then use the variable in the recipe. In this situation the newline quoting rules for makefiles will be used, and the backslash/newline will be removed. If we rewrite our example above using this method: </FONT><PRE class=example><FONT class=extract>     HELLO = 'hello \
     world'
     
     all : ; @echo $(HELLO)
</FONT></PRE>
<P class=noindent><FONT class=extract>we will get output like this: </FONT><PRE class=example><FONT class=extract>     hello world
</FONT></PRE>
<P><FONT class=extract>If you like, you can also use target-specific variables (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Target_002dspecific"><FONT class=extract>Target-specific Variable Values</FONT></A><FONT class=extract>) to obtain a tighter correspondence between the variable and the recipe that uses it. </FONT>
<DIV class=node><A name=Variables-in-Recipes></A>
<P>
<HR>
Previous:&nbsp;<A accessKey=p href="https://www.gnu.org/software/make/manual/make.html#Splitting-Recipe-Lines" rel=previous>Splitting Recipe Lines</A>, Up:&nbsp;<A accessKey=u href="https://www.gnu.org/software/make/manual/make.html#Recipe-Syntax" rel=up>Recipe Syntax</A> </DIV>
<H4 class=subsection><FONT class=extract>5.1.2 Using Variables in Recipes</FONT></H4>
<P><A name=index-variable-references-in-recipes-305></A><A name=index-recipes_002c-using-variables-in-306></A><FONT class=extract>The other way in which <CODE>make</CODE> processes recipes is by expanding any variable references in them (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Reference"><FONT class=extract>Basics of Variable References</FONT></A><FONT class=extract>). This occurs after make has finished reading all the makefiles and the target is determined to be out of date; so, the recipes for targets which are not rebuilt are never expanded. </FONT>
<P><FONT class=extract>Variable and function references in recipes have identical syntax and semantics to references elsewhere in the makefile. They also have the same quoting rules: if you want a dollar sign to appear in your recipe, you must double it (&#8216;<SAMP><SPAN class=samp>$$</SPAN></SAMP>&#8217;). For shells like the default shell, that use dollar signs to introduce variables, it's important to keep clear in your mind whether the variable you want to reference is a <CODE>make</CODE> variable (use a single dollar sign) or a shell variable (use two dollar signs). For example: </FONT><PRE class=example><FONT class=extract>     LIST = one two three
     all:
             for i in $(LIST); do \
                 echo $$i; \
             done
</FONT></PRE>
<P class=noindent><FONT class=extract>results in the following command being passed to the shell: </FONT><PRE class=example><FONT class=extract>     for i in one two three; do \
         echo $i; \
     done
</FONT></PRE>
<P class=noindent><FONT class=extract>which generates the expected result: </FONT><PRE class=example><FONT class=extract>     one
     two
     three</FONT>
</PRE>
<DIV class=node><A name=Echoing></A>
<P>
<HR>
Next:&nbsp;<A accessKey=n href="https://www.gnu.org/software/make/manual/make.html#Execution" rel=next>Execution</A>, Previous:&nbsp;<A accessKey=p href="https://www.gnu.org/software/make/manual/make.html#Recipe-Syntax" rel=previous>Recipe Syntax</A>, Up:&nbsp;<A accessKey=u href="https://www.gnu.org/software/make/manual/make.html#Recipes" rel=up>Recipes</A> </DIV>
<H3 class=section><FONT class=extract>5.2 Recipe Echoing</FONT></H3>
<P><A name=index-echoing-of-recipes-307></A><A name=index-silent-operation-308></A><A name=index-g_t_0040code_007b_0040_0040_007d-_0028in-recipes_0029-309></A><A name=index-recipes_002c-echoing-310></A><A name=index-printing-of-recipes-311></A><FONT class=extract><FONT class=extract>Normally <CODE>make</CODE> prints each line of the recipe before it is executed. We call this <DFN>echoing</DFN> because it gives the appearance that you are typing the lines yourself.</FONT> </FONT>
<P><FONT class=extract>When a line starts with &#8216;<SAMP><SPAN class=samp>@</SPAN></SAMP>&#8217;, the echoing of that line is suppressed. The &#8216;<SAMP><SPAN class=samp>@</SPAN></SAMP>&#8217; is discarded before the line is passed to the shell. Typically you would use this for a command whose only effect is to print something, such as an <CODE>echo</CODE> command to indicate progress through the makefile: </FONT><PRE class=example><FONT class=extract>     @echo About to make distribution files
</FONT></PRE>
<P><A name=index-g_t_0040code_007b_002dn_007d-312></A><A name=index-g_t_0040code_007b_002d_002djust_002dprint_007d-313></A><A name=index-g_t_0040code_007b_002d_002ddry_002drun_007d-314></A><A name=index-g_t_0040code_007b_002d_002drecon_007d-315></A><FONT class=extract>When <CODE>make</CODE> is given the flag &#8216;<SAMP><SPAN class=samp>-n</SPAN></SAMP>&#8217; or &#8216;<SAMP><SPAN class=samp>--just-print</SPAN></SAMP>&#8217; it only echoes most recipes, without executing them. See </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Options-Summary"><FONT class=extract>Summary of Options</FONT></A><FONT class=extract>. In this case even the recipe lines starting with &#8216;<SAMP><SPAN class=samp>@</SPAN></SAMP>&#8217; are printed. This flag is useful for finding out which recipes <CODE>make</CODE> thinks are necessary without actually doing them. </FONT>
<P><A name=index-g_t_0040code_007b_002ds_007d-316></A><A name=index-g_t_0040code_007b_002d_002dsilent_007d-317></A><A name=index-g_t_0040code_007b_002d_002dquiet_007d-318></A><A name=index-g_t_002eSILENT-319></A><FONT class=extract>The &#8216;<SAMP><SPAN class=samp>-s</SPAN></SAMP>&#8217; or &#8216;<SAMP><SPAN class=samp>--silent</SPAN></SAMP>&#8217; flag to <CODE>make</CODE> prevents all echoing, as if all recipes started with &#8216;<SAMP><SPAN class=samp>@</SPAN></SAMP>&#8217;. A rule in the makefile for the special target <CODE>.SILENT</CODE> without prerequisites has the same effect (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Special-Targets"><FONT class=extract>Special Built-in Target Names</FONT></A><FONT class=extract>). <CODE>.SILENT</CODE> is essentially obsolete since &#8216;<SAMP><SPAN class=samp>@</SPAN></SAMP>&#8217; is more flexible. </FONT>
<DIV class=node><A name=Execution></A>
<P>
<HR>
Next:&nbsp;<A accessKey=n href="https://www.gnu.org/software/make/manual/make.html#Parallel" rel=next>Parallel</A>, Previous:&nbsp;<A accessKey=p href="https://www.gnu.org/software/make/manual/make.html#Echoing" rel=previous>Echoing</A>, Up:&nbsp;<A accessKey=u href="https://www.gnu.org/software/make/manual/make.html#Recipes" rel=up>Recipes</A> </DIV>
<H3 class=section><FONT class=extract>5.3 Recipe Execution</FONT></H3>
<P><A name=index-recipe_002c-execution-320></A><A name=index-execution_002c-of-recipes-321></A><A name=index-g_t_0040code_007bSHELL_007d-_0040r_007b_0028recipe-execution_0029_007d-322></A><FONT class=extract>When it is time to execute recipes to update a target, they are executed by invoking a new sub-shell for each line of the recipe, unless the <CODE>.ONESHELL</CODE> special target is in effect (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#One-Shell"><FONT class=extract>Using One Shell</FONT></A><FONT class=extract>) (In practice, <CODE>make</CODE> may take shortcuts that do not affect the results.) </FONT>
<P><A name=index-g_t_0040code_007bcd_007d-_0028shell-command_0029-323></A><A name=index-shell-variables_002c-setting-in-recipes-324></A><A name=index-recipes-setting-shell-variables-325></A><FONT class=extract><STRONG>Please note:</STRONG> this implies that setting shell variables and invoking shell commands such as <CODE>cd</CODE> that set a context local to each process will not affect the following lines in the recipe.</FONT><A href="https://www.gnu.org/software/make/manual/make.html#fn-2" rel=footnote name=fnd-2><SUP><FONT class=extract>2</FONT></SUP></A><FONT class=extract> If you want to use <CODE>cd</CODE> to affect the next statement, put both statements in a single recipe line. Then <CODE>make</CODE> will invoke one shell to run the entire line, and the shell will execute the statements in sequence. For example: </FONT><PRE class=example><FONT class=extract>     foo : bar/lose
             cd $(@D) &amp;&amp; gobble $(@F) &gt; ../$@
</FONT></PRE>
<P class=noindent><FONT class=extract>Here we use the shell AND operator (<CODE>&amp;&amp;</CODE>) so that if the <CODE>cd</CODE> command fails, the script will fail without trying to invoke the <CODE>gobble</CODE> command in the wrong directory, which could cause problems (in this case it would certainly cause <SAMP><SPAN class=file>../foo</SPAN></SAMP> to be truncated, at least). </FONT>
<UL class=menu>
<LI><A accessKey=1 href="https://www.gnu.org/software/make/manual/make.html#One-Shell"><FONT class=extract>One Shell</FONT></A><FONT class=extract>: One shell for all lines in a recipe. </FONT>
<LI><A accessKey=2 href="https://www.gnu.org/software/make/manual/make.html#Choosing-the-Shell"><FONT class=extract>Choosing the Shell</FONT></A><FONT class=extract>: How <CODE>make</CODE> chooses the shell used to run recipes. </FONT></LI></UL>
<DIV class=node><A name=One-Shell></A>
<P>
<HR>
Next:&nbsp;<A accessKey=n href="https://www.gnu.org/software/make/manual/make.html#Choosing-the-Shell" rel=next>Choosing the Shell</A>, Previous:&nbsp;<A accessKey=p href="https://www.gnu.org/software/make/manual/make.html#Execution" rel=previous>Execution</A>, Up:&nbsp;<A accessKey=u href="https://www.gnu.org/software/make/manual/make.html#Execution" rel=up>Execution</A> </DIV>
<H4 class=subsection><FONT class=extract>5.3.1 Using One Shell</FONT></H4>
<P><A name=index-recipe-lines_002c-single-shell-326></A><A name=index-g_t_0040code_007b_002eONESHELL_007d_002c-use-of-327></A><A name=index-g_t_002eONESHELL-328></A><FONT class=extract>Sometimes you would prefer that all the lines in the recipe be passed to a single invocation of the shell. There are generally two situations where this is useful: first, it can improve performance in makefiles where recipes consist of many command lines, by avoiding extra processes. Second, you might want newlines to be included in your recipe command (for example perhaps you are using a very different interpreter as your <CODE>SHELL</CODE>). If the <CODE>.ONESHELL</CODE> special target appears anywhere in the makefile then <EM>all</EM> recipe lines for each target will be provided to a single invocation of the shell. Newlines between recipe lines will be preserved. For example: </FONT><PRE class=example><FONT class=extract>     .ONESHELL:
     foo : bar/lose
             cd $(@D)
             gobble $(@F) &gt; ../$@
</FONT></PRE>
<P class=noindent><FONT class=extract>would now work as expected even though the commands are on different recipe lines. </FONT>
<P><FONT class=extract>If <CODE>.ONESHELL</CODE> is provided, then only the first line of the recipe will be checked for the special prefix characters (&#8216;<SAMP><SPAN class=samp>@</SPAN></SAMP>&#8217;, &#8216;<SAMP><SPAN class=samp>-</SPAN></SAMP>&#8217;, and &#8216;<SAMP><SPAN class=samp>+</SPAN></SAMP>&#8217;). Subsequent lines will include the special characters in the recipe line when the <CODE>SHELL</CODE> is invoked. If you want your recipe to start with one of these special characters you'll need to arrange for them to not be the first characters on the first line, perhaps by adding a comment or similar. For example, this would be a syntax error in Perl because the first &#8216;<SAMP><SPAN class=samp>@</SPAN></SAMP>&#8217; is removed by make: </FONT><PRE class=example><FONT class=extract>     .ONESHELL:
     SHELL = /usr/bin/perl
     .SHELLFLAGS = -e
     show :
             @f = qw(a b c);
             print "@f\n";
</FONT></PRE>
<P class=noindent><FONT class=extract>However, either of these alternatives would work properly: </FONT><PRE class=example><FONT class=extract>     .ONESHELL:
     SHELL = /usr/bin/perl
     .SHELLFLAGS = -e
     show :
             # Make sure "@" is not the first character on the first line
             @f = qw(a b c);
             print "@f\n";
</FONT></PRE>
<P class=noindent><FONT class=extract>or </FONT><PRE class=example><FONT class=extract>     .ONESHELL:
     SHELL = /usr/bin/perl
     .SHELLFLAGS = -e
     show :
             my @f = qw(a b c);
             print "@f\n";
</FONT></PRE>
<P><FONT class=extract>As a special feature, if <CODE>SHELL</CODE> is determined to be a POSIX-style shell, the special prefix characters in &#8220;internal&#8221; recipe lines will <EM>removed</EM> before the recipe is processed. This feature is intended to allow existing makefiles to add the <CODE>.ONESHELL</CODE> special target and still run properly without extensive modifications. Since the special prefix characters are not legal at the beginning of a line in a POSIX shell script this is not a loss in functionality. For example, this works as expected: </FONT><PRE class=example><FONT class=extract>     .ONESHELL:
     foo : bar/lose
             @cd $(@D)
             @gobble $(@F) &gt; ../$@
</FONT></PRE>
<P><FONT class=extract>Even with this special feature, however, makefiles with <CODE>.ONESHELL</CODE> will behave differently in ways that could be noticeable. For example, normally if any line in the recipe fails, that causes the rule to fail and no more recipe lines are processed. Under <CODE>.ONESHELL</CODE> a failure of any but the final recipe line will not be noticed by <CODE>make</CODE>. You can modify <CODE>.SHELLFLAGS</CODE> to add the <CODE>-e</CODE> option to the shell which will cause any failure anywhere in the command line to cause the shell to fail, but this could itself cause your recipe to behave differently. Ultimately you may need to harden your recipe lines to allow them to work with <CODE>.ONESHELL</CODE>. </FONT>
<DIV class=node><A name=Choosing-the-Shell></A>
<P>
<HR>
Previous:&nbsp;<A accessKey=p href="https://www.gnu.org/software/make/manual/make.html#One-Shell" rel=previous>One Shell</A>, Up:&nbsp;<A accessKey=u href="https://www.gnu.org/software/make/manual/make.html#Execution" rel=up>Execution</A> </DIV>
<H4 class=subsection><FONT class=extract>5.3.2 Choosing the Shell</FONT></H4>
<P><A name=index-shell_002c-choosing-the-329></A><A name=index-g_t_0040code_007bSHELL_007d_002c-value-of-330></A><A name=index-g_t_0040code_007b_002eSHELLFLAGS_007d_002c-value-of-331></A><A name=index-SHELL-332></A><A name=index-g_t_002eSHELLFLAGS-333></A><FONT class=extract>The program used as the shell is taken from the variable <CODE>SHELL</CODE>. If this variable is not set in your makefile, the program <SAMP><SPAN class=file>/bin/sh</SPAN></SAMP> is used as the shell. The argument(s) passed to the shell are taken from the variable <CODE>.SHELLFLAGS</CODE>. The default value of <CODE>.SHELLFLAGS</CODE> is <CODE>-c</CODE> normally, or <CODE>-ec</CODE> in POSIX-conforming mode. </FONT>
<P><A name=index-environment_002c-_0040code_007bSHELL_007d-in-334></A><FONT class=extract>Unlike most variables, the variable <CODE>SHELL</CODE> is never set from the environment. This is because the <CODE>SHELL</CODE> environment variable is used to specify your personal choice of shell program for interactive use. It would be very bad for personal choices like this to affect the functioning of makefiles. See </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Environment"><FONT class=extract>Variables from the Environment</FONT></A><FONT class=extract>. </FONT>
<P><FONT class=extract>Furthermore, when you do set <CODE>SHELL</CODE> in your makefile that value is <EM>not</EM> exported in the environment to recipe lines that <CODE>make</CODE> invokes. Instead, the value inherited from the user's environment, if any, is exported. You can override this behavior by explicitly exporting <CODE>SHELL</CODE> (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Variables_002fRecursion"><FONT class=extract>Communicating Variables to a Sub-<CODE>make</CODE></FONT></A><FONT class=extract>), forcing it to be passed in the environment to recipe lines. </FONT>
<P><A name=index-g_t_0040code_007bMAKESHELL_007d-_0040r_007b_0028MS_002dDOS-alternative-to-_0040code_007bSHELL_007d_0029_007d-335></A><FONT class=extract>However, on MS-DOS and MS-Windows the value of <CODE>SHELL</CODE> in the environment <STRONG>is</STRONG> used, since on those systems most users do not set this variable, and therefore it is most likely set specifically to be used by <CODE>make</CODE>. On MS-DOS, if the setting of <CODE>SHELL</CODE> is not suitable for <CODE>make</CODE>, you can set the variable <CODE>MAKESHELL</CODE> to the shell that <CODE>make</CODE> should use; if set it will be used as the shell instead of the value of <CODE>SHELL</CODE>. </FONT>
<H5 class=subsubheading><FONT class=extract>Choosing a Shell in DOS and Windows</FONT></H5>
<P><A name=index-shell_002c-in-DOS-and-Windows-336></A><A name=index-DOS_002c-choosing-a-shell-in-337></A><A name=index-Windows_002c-choosing-a-shell-in-338></A><FONT class=extract>Choosing a shell in MS-DOS and MS-Windows is much more complex than on other systems. </FONT>
<P><A name=index-COMSPEC-339></A><FONT class=extract>On MS-DOS, if <CODE>SHELL</CODE> is not set, the value of the variable <CODE>COMSPEC</CODE> (which is always set) is used instead. </FONT>
<P><A name=index-g_t_0040code_007bSHELL_007d_002c-MS_002dDOS-specifics-340></A><FONT class=extract>The processing of lines that set the variable <CODE>SHELL</CODE> in Makefiles is different on MS-DOS. The stock shell, <SAMP><SPAN class=file>command.com</SPAN></SAMP>, is ridiculously limited in its functionality and many users of <CODE>make</CODE> tend to install a replacement shell. Therefore, on MS-DOS, <CODE>make</CODE> examines the value of <CODE>SHELL</CODE>, and changes its behavior based on whether it points to a Unix-style or DOS-style shell. This allows reasonable functionality even if <CODE>SHELL</CODE> points to <SAMP><SPAN class=file>command.com</SPAN></SAMP>. </FONT>
<P><FONT class=extract>If <CODE>SHELL</CODE> points to a Unix-style shell, <CODE>make</CODE> on MS-DOS additionally checks whether that shell can indeed be found; if not, it ignores the line that sets <CODE>SHELL</CODE>. In MS-DOS, GNU <CODE>make</CODE> searches for the shell in the following places: </FONT>
<OL type=1>
<LI><FONT class=extract>In the precise place pointed to by the value of <CODE>SHELL</CODE>. For example, if the makefile specifies &#8216;<SAMP><SPAN class=samp>SHELL = /bin/sh</SPAN></SAMP>&#8217;, <CODE>make</CODE> will look in the directory <SAMP><SPAN class=file>/bin</SPAN></SAMP> on the current drive. </FONT>
<LI><FONT class=extract>In the current directory. </FONT>
<LI><FONT class=extract>In each of the directories in the <CODE>PATH</CODE> variable, in order. </FONT></LI></OL>
<P><FONT class=extract>In every directory it examines, <CODE>make</CODE> will first look for the specific file (<SAMP><SPAN class=file>sh</SPAN></SAMP> in the example above). If this is not found, it will also look in that directory for that file with one of the known extensions which identify executable files. For example <SAMP><SPAN class=file>.exe</SPAN></SAMP>, <SAMP><SPAN class=file>.com</SPAN></SAMP>, <SAMP><SPAN class=file>.bat</SPAN></SAMP>, <SAMP><SPAN class=file>.btm</SPAN></SAMP>, <SAMP><SPAN class=file>.sh</SPAN></SAMP>, and some others. </FONT>
<P><FONT class=extract>If any of these attempts is successful, the value of <CODE>SHELL</CODE> will be set to the full pathname of the shell as found. However, if none of these is found, the value of <CODE>SHELL</CODE> will not be changed, and thus the line that sets it will be effectively ignored. This is so <CODE>make</CODE> will only support features specific to a Unix-style shell if such a shell is actually installed on the system where <CODE>make</CODE> runs. </FONT>
<P><FONT class=extract>Note that this extended search for the shell is limited to the cases where <CODE>SHELL</CODE> is set from the Makefile; if it is set in the environment or command line, you are expected to set it to the full pathname of the shell, exactly as things are on Unix. </FONT>
<P><FONT class=extract>The effect of the above DOS-specific processing is that a Makefile that contains &#8216;<SAMP><SPAN class=samp>SHELL = /bin/sh</SPAN></SAMP>&#8217; (as many Unix makefiles do), will work on MS-DOS unaltered if you have e.g. <SAMP><SPAN class=file>sh.exe</SPAN></SAMP> installed in some directory along your <CODE>PATH</CODE>. </FONT>
<P><A name=index-SHELL-341></A><A name=index-g_t_002eSHELLFLAGS-342></A>
<DIV class=node><A name=Parallel></A>
<P>
<HR>
Next:&nbsp;<A accessKey=n href="https://www.gnu.org/software/make/manual/make.html#Errors" rel=next>Errors</A>, Previous:&nbsp;<A accessKey=p href="https://www.gnu.org/software/make/manual/make.html#Execution" rel=previous>Execution</A>, Up:&nbsp;<A accessKey=u href="https://www.gnu.org/software/make/manual/make.html#Recipes" rel=up>Recipes</A> </DIV>
<H3 class=section><FONT class=extract>5.4 Parallel Execution</FONT></H3>
<P><A name=index-recipes_002c-execution-in-parallel-343></A><A name=index-parallel-execution-344></A><A name=index-execution_002c-in-parallel-345></A><A name=index-job-slots-346></A><A name=index-g_t_0040code_007b_002dj_007d-347></A><A name=index-g_t_0040code_007b_002d_002djobs_007d-348></A><FONT class=extract>GNU <CODE>make</CODE> knows how to execute several recipes at once. Normally, <CODE>make</CODE> will execute only one recipe at a time, waiting for it to finish before executing the next. However, the &#8216;<SAMP><SPAN class=samp>-j</SPAN></SAMP>&#8217; or &#8216;<SAMP><SPAN class=samp>--jobs</SPAN></SAMP>&#8217; option tells <CODE>make</CODE> to execute many recipes simultaneously. You can inhibit parallelism in a particular makefile with the <CODE>.NOTPARALLEL</CODE> pseudo-target (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Special-Targets"><FONT class=extract>Special Built-in Target Names</FONT></A><FONT class=extract>). </FONT>
<P><FONT class=extract>On MS-DOS, the &#8216;<SAMP><SPAN class=samp>-j</SPAN></SAMP>&#8217; option has no effect, since that system doesn't support multi-processing. </FONT>
<P><FONT class=extract>If the &#8216;<SAMP><SPAN class=samp>-j</SPAN></SAMP>&#8217; option is followed by an integer, this is the number of recipes to execute at once; this is called the number of <DFN>job slots</DFN>. If there is nothing looking like an integer after the &#8216;<SAMP><SPAN class=samp>-j</SPAN></SAMP>&#8217; option, there is no limit on the number of job slots. The default number of job slots is one, which means serial execution (one thing at a time). </FONT>
<P><FONT class=extract>Handling recursive <CODE>make</CODE> invocations raises issues for parallel execution. For more information on this, see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Options_002fRecursion"><FONT class=extract>Communicating Options to a Sub-<CODE>make</CODE></FONT></A><FONT class=extract>. </FONT>
<P><FONT class=extract>If a recipe fails (is killed by a signal or exits with a nonzero status), and errors are not ignored for that recipe (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Errors"><FONT class=extract>Errors in Recipes</FONT></A><FONT class=extract>), the remaining recipe lines to remake the same target will not be run. If a recipe fails and the &#8216;<SAMP><SPAN class=samp>-k</SPAN></SAMP>&#8217; or &#8216;<SAMP><SPAN class=samp>--keep-going</SPAN></SAMP>&#8217; option was not given (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Options-Summary"><FONT class=extract>Summary of Options</FONT></A><FONT class=extract>), <CODE>make</CODE> aborts execution. If make terminates for any reason (including a signal) with child processes running, it waits for them to finish before actually exiting. </FONT>
<P><A name=index-load-average-349></A><A name=index-limiting-jobs-based-on-load-350></A><A name=index-jobs_002c-limiting-based-on-load-351></A><A name=index-g_t_0040code_007b_002dl_007d-_0028load-average_0029-352></A><A name=index-g_t_0040code_007b_002d_002dmax_002dload_007d-353></A><A name=index-g_t_0040code_007b_002d_002dload_002daverage_007d-354></A><FONT class=extract>When the system is heavily loaded, you will probably want to run fewer jobs than when it is lightly loaded. You can use the &#8216;<SAMP><SPAN class=samp>-l</SPAN></SAMP>&#8217; option to tell <CODE>make</CODE> to limit the number of jobs to run at once, based on the load average. The &#8216;<SAMP><SPAN class=samp>-l</SPAN></SAMP>&#8217; or &#8216;<SAMP><SPAN class=samp>--max-load</SPAN></SAMP>&#8217; option is followed by a floating-point number. For example, </FONT><PRE class=example><FONT class=extract>     -l 2.5
</FONT></PRE>
<P class=noindent><FONT class=extract>will not let <CODE>make</CODE> start more than one job if the load average is above 2.5. The &#8216;<SAMP><SPAN class=samp>-l</SPAN></SAMP>&#8217; option with no following number removes the load limit, if one was given with a previous &#8216;<SAMP><SPAN class=samp>-l</SPAN></SAMP>&#8217; option. </FONT>
<P><FONT class=extract>More precisely, when <CODE>make</CODE> goes to start up a job, and it already has at least one job running, it checks the current load average; if it is not lower than the limit given with &#8216;<SAMP><SPAN class=samp>-l</SPAN></SAMP>&#8217;, <CODE>make</CODE> waits until the load average goes below that limit, or until all the other jobs finish. </FONT>
<P><FONT class=extract>By default, there is no load limit. </FONT>
<UL class=menu>
<LI><A accessKey=1 href="https://www.gnu.org/software/make/manual/make.html#Parallel-Output"><FONT class=extract>Parallel Output</FONT></A><FONT class=extract>: Handling output during parallel execution </FONT>
<LI><A accessKey=2 href="https://www.gnu.org/software/make/manual/make.html#Parallel-Input"><FONT class=extract>Parallel Input</FONT></A><FONT class=extract>: Handling input during parallel execution </FONT></LI></UL>
<DIV class=node><A name=Parallel-Output></A>
<P>
<HR>
Next:&nbsp;<A accessKey=n href="https://www.gnu.org/software/make/manual/make.html#Parallel-Input" rel=next>Parallel Input</A>, Previous:&nbsp;<A accessKey=p href="https://www.gnu.org/software/make/manual/make.html#Parallel" rel=previous>Parallel</A>, Up:&nbsp;<A accessKey=u href="https://www.gnu.org/software/make/manual/make.html#Parallel" rel=up>Parallel</A> </DIV>
<H4 class=subsection><FONT class=extract>5.4.1 Output During Parallel Execution</FONT></H4>
<P><A name=index-output-during-parallel-execution-355></A><A name=index-parallel-execution_002c-output-during-356></A><FONT class=extract>When running several recipes in parallel the output from each recipe appears as soon as it is generated, with the result that messages from different recipes may be interspersed, sometimes even appearing on the same line. This can make reading the output very difficult. </FONT>
<P><A name=index-g_t_0040code_007b_002d_002doutput_002dsync_007d-357></A><A name=index-g_t_0040code_007b_002dO_007d-358></A><FONT class=extract>To avoid this you can use the &#8216;<SAMP><SPAN class=samp>--output-sync</SPAN></SAMP>&#8217; (&#8216;<SAMP><SPAN class=samp>-O</SPAN></SAMP>&#8217;) option. This option instructs <CODE>make</CODE> to save the output from the commands it invokes and print it all once the commands are completed. Additionally, if there are multiple recursive <CODE>make</CODE> invocations running in parallel, they will communicate so that only one of them is generating output at a time. </FONT>
<P><FONT class=extract>If working directory printing is enabled (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#g_t_002dw-Option"><FONT class=extract>The &#8216;<SAMP><SPAN class=samp>--print-directory</SPAN></SAMP>&#8217; Option</FONT></A><FONT class=extract>), the enter/leave messages are printed around each output grouping. If you prefer not to see these messages add the &#8216;<SAMP><SPAN class=samp>--no-print-directory</SPAN></SAMP>&#8217; option to <CODE>MAKEFLAGS</CODE>. </FONT>
<P><FONT class=extract>There are four levels of granularity when synchronizing output, specified by giving an argument to the option (e.g., &#8216;<SAMP><SPAN class=samp>-Oline</SPAN></SAMP>&#8217; or &#8216;<SAMP><SPAN class=samp>--output-sync=recurse</SPAN></SAMP>&#8217;). </FONT>
<DL>
<DT><FONT class=extract><CODE>none</CODE> </FONT>
<DD><FONT class=extract>This is the default: all output is sent directly as it is generated and no synchronization is performed. <BR></FONT>
<DT><FONT class=extract><CODE>line</CODE> </FONT>
<DD><FONT class=extract>Output from each individual line of the recipe is grouped and printed as soon as that line is complete. If a recipe consists of multiple lines, they may be interspersed with lines from other recipes. <BR></FONT>
<DT><FONT class=extract><CODE>target</CODE> </FONT>
<DD><FONT class=extract>Output from the entire recipe for each target is grouped and printed once the target is complete. This is the default if the <CODE>--output-sync</CODE> or <CODE>-O</CODE> option is given with no argument. <BR></FONT>
<DT><FONT class=extract><CODE>recurse</CODE> </FONT>
<DD><FONT class=extract>Output from each recursive invocation of <CODE>make</CODE> is grouped and printed once the recursive invocation is complete. </FONT></DD></DL>
<P><FONT class=extract>Regardless of the mode chosen, the total build time will be the same. The only difference is in how the output appears. </FONT>
<P><FONT class=extract>The &#8216;<SAMP><SPAN class=samp>target</SPAN></SAMP>&#8217; and &#8216;<SAMP><SPAN class=samp>recurse</SPAN></SAMP>&#8217; modes both collect the output of the entire recipe of a target and display it uninterrupted when the recipe completes. The difference between them is in how recipes that contain recursive invocations of <CODE>make</CODE> are treated (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Recursion"><FONT class=extract>Recursive Use of <CODE>make</CODE></FONT></A><FONT class=extract>). For all recipes which have no recursive lines, the &#8216;<SAMP><SPAN class=samp>target</SPAN></SAMP>&#8217; and &#8216;<SAMP><SPAN class=samp>recurse</SPAN></SAMP>&#8217; modes behave identically. </FONT>
<P><FONT class=extract>If the &#8216;<SAMP><SPAN class=samp>recurse</SPAN></SAMP>&#8217; mode is chosen, recipes that contain recursive <CODE>make</CODE> invocations are treated the same as other targets: the output from the recipe, including the output from the recursive <CODE>make</CODE>, is saved and printed after the entire recipe is complete. This ensures output from all the targets built by a given recursive <CODE>make</CODE> instance are grouped together, which may make the output easier to understand. However it also leads to long periods of time during the build where no output is seen, followed by large bursts of output. If you are not watching the build as it proceeds, but instead viewing a log of the build after the fact, this may be the best option for you. </FONT>
<P><FONT class=extract>If you are watching the output, the long gaps of quiet during the build can be frustrating. The &#8216;<SAMP><SPAN class=samp>target</SPAN></SAMP>&#8217; output synchronization mode detects when <CODE>make</CODE> is going to be invoked recursively, using the standard methods, and it will not synchronize the output of those lines. The recursive <CODE>make</CODE> will perform the synchronization for its targets and the output from each will be displayed immediately when it completes. Be aware that output from recursive lines of the recipe are not synchronized (for example if the recursive line prints a message before running <CODE>make</CODE>, that message will not be synchronized). </FONT>
<P><FONT class=extract>The &#8216;<SAMP><SPAN class=samp>line</SPAN></SAMP>&#8217; mode can be useful for front-ends that are watching the output of <CODE>make</CODE> to track when recipes are started and completed. </FONT>
<P><FONT class=extract>Some programs invoked by <CODE>make</CODE> may behave differently if they determine they're writing output to a terminal versus a file (often described as &#8220;interactive&#8221; vs. &#8220;non-interactive&#8221; modes). For example, many programs that can display colorized output will not do so if they determine they are not writing to a terminal. If your makefile invokes a program like this then using the output synchronization options will cause the program to believe it's running in &#8220;non-interactive&#8221; mode even though the output will ultimately go to the terminal. </FONT>
<DIV class=node><A name=Parallel-Input></A>
<P>
<HR>
Previous:&nbsp;<A accessKey=p href="https://www.gnu.org/software/make/manual/make.html#Parallel-Output" rel=previous>Parallel Output</A>, Up:&nbsp;<A accessKey=u href="https://www.gnu.org/software/make/manual/make.html#Parallel" rel=up>Parallel</A> </DIV>
<H4 class=subsection><FONT class=extract>5.4.2 Input During Parallel Execution</FONT></H4>
<P><A name=index-input-during-parallel-execution-359></A><A name=index-parallel-execution_002c-input-during-360></A><A name=index-standard-input-361></A><FONT class=extract>Two processes cannot both take input from the same device at the same time. To make sure that only one recipe tries to take input from the terminal at once, <CODE>make</CODE> will invalidate the standard input streams of all but one running recipe. If another recipe attempts to read from standard input it will usually incur a fatal error (a &#8216;<SAMP><SPAN class=samp>Broken pipe</SPAN></SAMP>&#8217; signal). </FONT><A name=index-broken-pipe-362></A><FONT class=extract>It is unpredictable which recipe will have a valid standard input stream (which will come from the terminal, or wherever you redirect the standard input of <CODE>make</CODE>). The first recipe run will always get it first, and the first recipe started after that one finishes will get it next, and so on. </FONT>
<P><FONT class=extract>We will change how this aspect of <CODE>make</CODE> works if we find a better alternative. In the mean time, you should not rely on any recipe using standard input at all if you are using the parallel execution feature; but if you are not using this feature, then standard input works normally in all recipes. </FONT>
<DIV class=node><A name=Errors></A>
<P>
<HR>
Next:&nbsp;<A accessKey=n href="https://www.gnu.org/software/make/manual/make.html#Interrupts" rel=next>Interrupts</A>, Previous:&nbsp;<A accessKey=p href="https://www.gnu.org/software/make/manual/make.html#Parallel" rel=previous>Parallel</A>, Up:&nbsp;<A accessKey=u href="https://www.gnu.org/software/make/manual/make.html#Recipes" rel=up>Recipes</A> </DIV>
<H3 class=section><FONT class=extract>5.5 Errors in Recipes</FONT></H3>
<P><A name=index-errors-_0028in-recipes_0029-363></A><A name=index-recipes_002c-errors-in-364></A><A name=index-exit-status-_0028errors_0029-365></A><FONT class=extract>After each shell invocation returns, <CODE>make</CODE> looks at its exit status. If the shell completed successfully (the exit status is zero), the next line in the recipe is executed in a new shell; after the last line is finished, the rule is finished. </FONT>
<P><FONT class=extract>If there is an error (the exit status is nonzero), <CODE>make</CODE> gives up on the current rule, and perhaps on all rules. </FONT>
<P><FONT class=extract>Sometimes the failure of a certain recipe line does not indicate a problem. For example, you may use the <CODE>mkdir</CODE> command to ensure that a directory exists. If the directory already exists, <CODE>mkdir</CODE> will report an error, but you probably want <CODE>make</CODE> to continue regardless. </FONT>
<P><A name=index-g_t_0040code_007b_002d_007d-_0028in-recipes_0029-366></A><FONT class=extract>To ignore errors in a recipe line, write a &#8216;<SAMP><SPAN class=samp>-</SPAN></SAMP>&#8217; at the beginning of the line's text (after the initial tab). The &#8216;<SAMP><SPAN class=samp>-</SPAN></SAMP>&#8217; is discarded before the line is passed to the shell for execution. </FONT>
<P><FONT class=extract>For example, </FONT><PRE class=example><FONT class=extract>     clean:
             -rm -f *.o
</FONT></PRE>
<P><A name=index-g_t_0040code_007brm_007d-_0028shell-command_0029-367></A><FONT class=extract>This causes <CODE>make</CODE> to continue even if <CODE>rm</CODE> is unable to remove a file. </FONT>
<P><A name=index-g_t_0040code_007b_002di_007d-368></A><A name=index-g_t_0040code_007b_002d_002dignore_002derrors_007d-369></A><A name=index-g_t_002eIGNORE-370></A><FONT class=extract>When you run <CODE>make</CODE> with the &#8216;<SAMP><SPAN class=samp>-i</SPAN></SAMP>&#8217; or &#8216;<SAMP><SPAN class=samp>--ignore-errors</SPAN></SAMP>&#8217; flag, errors are ignored in all recipes of all rules. A rule in the makefile for the special target <CODE>.IGNORE</CODE> has the same effect, if there are no prerequisites. These ways of ignoring errors are obsolete because &#8216;<SAMP><SPAN class=samp>-</SPAN></SAMP>&#8217; is more flexible. </FONT>
<P><FONT class=extract>When errors are to be ignored, because of either a &#8216;<SAMP><SPAN class=samp>-</SPAN></SAMP>&#8217; or the &#8216;<SAMP><SPAN class=samp>-i</SPAN></SAMP>&#8217; flag, <CODE>make</CODE> treats an error return just like success, except that it prints out a message that tells you the status code the shell exited with, and says that the error has been ignored. </FONT>
<P><FONT class=extract>When an error happens that <CODE>make</CODE> has not been told to ignore, it implies that the current target cannot be correctly remade, and neither can any other that depends on it either directly or indirectly. No further recipes will be executed for these targets, since their preconditions have not been achieved. </FONT>
<P><A name=index-g_t_0040code_007b_002dk_007d-371></A><A name=index-g_t_0040code_007b_002d_002dkeep_002dgoing_007d-372></A><FONT class=extract>Normally <CODE>make</CODE> gives up immediately in this circumstance, returning a nonzero status. However, if the &#8216;<SAMP><SPAN class=samp>-k</SPAN></SAMP>&#8217; or &#8216;<SAMP><SPAN class=samp>--keep-going</SPAN></SAMP>&#8217; flag is specified, <CODE>make</CODE> continues to consider the other prerequisites of the pending targets, remaking them if necessary, before it gives up and returns nonzero status. For example, after an error in compiling one object file, &#8216;<SAMP><SPAN class=samp>make -k</SPAN></SAMP>&#8217; will continue compiling other object files even though it already knows that linking them will be impossible. See </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Options-Summary"><FONT class=extract>Summary of Options</FONT></A><FONT class=extract>. </FONT>
<P><FONT class=extract>The usual behavior assumes that your purpose is to get the specified targets up to date; once <CODE>make</CODE> learns that this is impossible, it might as well report the failure immediately. The &#8216;<SAMP><SPAN class=samp>-k</SPAN></SAMP>&#8217; option says that the real purpose is to test as many of the changes made in the program as possible, perhaps to find several independent problems so that you can correct them all before the next attempt to compile. This is why Emacs' <CODE>compile</CODE> command passes the &#8216;<SAMP><SPAN class=samp>-k</SPAN></SAMP>&#8217; flag by default. </FONT><A name=index-Emacs-_0028_0040code_007bM_002dx-compile_007d_0029-373></A><A name=index-g_t_002eDELETE_005fON_005fERROR-374></A><A name=index-deletion-of-target-files-375></A><A name=index-removal-of-target-files-376></A><A name=index-target_002c-deleting-on-error-377></A><FONT class=extract>Usually when a recipe line fails, if it has changed the target file at all, the file is corrupted and cannot be used&#8212;or at least it is not completely updated. Yet the file's time stamp says that it is now up to date, so the next time <CODE>make</CODE> runs, it will not try to update that file. The situation is just the same as when the shell is killed by a signal; see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Interrupts"><FONT class=extract>Interrupts</FONT></A><FONT class=extract>. So generally the right thing to do is to delete the target file if the recipe fails after beginning to change the file. <CODE>make</CODE> will do this if <CODE>.DELETE_ON_ERROR</CODE> appears as a target. This is almost always what you want <CODE>make</CODE> to do, but it is not historical practice; so for compatibility, you must explicitly request it. </FONT>
<DIV class=node><A name=Interrupts></A>
<P>
<HR>
Next:&nbsp;<A accessKey=n href="https://www.gnu.org/software/make/manual/make.html#Recursion" rel=next>Recursion</A>, Previous:&nbsp;<A accessKey=p href="https://www.gnu.org/software/make/manual/make.html#Errors" rel=previous>Errors</A>, Up:&nbsp;<A accessKey=u href="https://www.gnu.org/software/make/manual/make.html#Recipes" rel=up>Recipes</A> </DIV>
<H3 class=section><FONT class=extract>5.6 Interrupting or Killing <CODE>make</CODE></FONT></H3>
<P><A name=index-interrupt-378></A><A name=index-signal-379></A><A name=index-deletion-of-target-files-380></A><A name=index-removal-of-target-files-381></A><A name=index-target_002c-deleting-on-interrupt-382></A><A name=index-killing-_0028interruption_0029-383></A><FONT class=extract>If <CODE>make</CODE> gets a fatal signal while a shell is executing, it may delete the target file that the recipe was supposed to update. This is done if the target file's last-modification time has changed since <CODE>make</CODE> first checked it. </FONT>
<P><FONT class=extract>The purpose of deleting the target is to make sure that it is remade from scratch when <CODE>make</CODE> is next run. Why is this? Suppose you type <KBD>Ctrl-c</KBD> while a compiler is running, and it has begun to write an object file <SAMP><SPAN class=file>foo.o</SPAN></SAMP>. The <KBD>Ctrl-c</KBD> kills the compiler, resulting in an incomplete file whose last-modification time is newer than the source file <SAMP><SPAN class=file>foo.c</SPAN></SAMP>. But <CODE>make</CODE> also receives the <KBD>Ctrl-c</KBD> signal and deletes this incomplete file. If <CODE>make</CODE> did not do this, the next invocation of <CODE>make</CODE> would think that <SAMP><SPAN class=file>foo.o</SPAN></SAMP> did not require updating&#8212;resulting in a strange error message from the linker when it tries to link an object file half of which is missing. </FONT>
<P><A name=index-g_t_002ePRECIOUS-384></A><FONT class=extract>You can prevent the deletion of a target file in this way by making the special target <CODE>.PRECIOUS</CODE> depend on it. Before remaking a target, <CODE>make</CODE> checks to see whether it appears on the prerequisites of <CODE>.PRECIOUS</CODE>, and thereby decides whether the target should be deleted if a signal happens. Some reasons why you might do this are that the target is updated in some atomic fashion, or exists only to record a modification-time (its contents do not matter), or must exist at all times to prevent other sorts of trouble. </FONT>
<DIV class=node><A name=Recursion></A>
<P>
<HR>
Next:&nbsp;<A accessKey=n href="https://www.gnu.org/software/make/manual/make.html#Canned-Recipes" rel=next>Canned Recipes</A>, Previous:&nbsp;<A accessKey=p href="https://www.gnu.org/software/make/manual/make.html#Interrupts" rel=previous>Interrupts</A>, Up:&nbsp;<A accessKey=u href="https://www.gnu.org/software/make/manual/make.html#Recipes" rel=up>Recipes</A> </DIV>
<H3 class=section><FONT class=extract>5.7 Recursive Use of <CODE>make</CODE></FONT></H3>
<P><A name=index-recursion-385></A><A name=index-subdirectories_002c-recursion-for-386></A><FONT class=extract>Recursive use of <CODE>make</CODE> means using <CODE>make</CODE> as a command in a makefile. This technique is useful when you want separate makefiles for various subsystems that compose a larger system. For example, suppose you have a sub-directory <SAMP><SPAN class=file>subdir</SPAN></SAMP> which has its own makefile, and you would like the containing directory's makefile to run <CODE>make</CODE> on the sub-directory. You can do it by writing this: </FONT><PRE class=example><FONT class=extract>     subsystem:
             cd subdir &amp;&amp; $(MAKE)
</FONT></PRE>
<P class=noindent><FONT class=extract>or, equivalently, this (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Options-Summary"><FONT class=extract>Summary of Options</FONT></A><FONT class=extract>): </FONT><PRE class=example><FONT class=extract>     subsystem:
             $(MAKE) -C subdir
</FONT></PRE>
<P><A name=index-g_t_0040code_007b_002dC_007d-387></A><A name=index-g_t_0040code_007b_002d_002ddirectory_007d-388></A><FONT class=extract>You can write recursive <CODE>make</CODE> commands just by copying this example, but there are many things to know about how they work and why, and about how the sub-<CODE>make</CODE> relates to the top-level <CODE>make</CODE>. You may also find it useful to declare targets that invoke recursive <CODE>make</CODE> commands as &#8216;<SAMP><SPAN class=samp>.PHONY</SPAN></SAMP>&#8217; (for more discussion on when this is useful, see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Phony-Targets"><FONT class=extract>Phony Targets</FONT></A><FONT class=extract>). </FONT>
<P><A name=index-g_t_0040code_007bCURDIR_007d-389></A><FONT class=extract>For your convenience, when GNU <CODE>make</CODE> starts (after it has processed any <CODE>-C</CODE> options) it sets the variable <CODE>CURDIR</CODE> to the pathname of the current working directory. This value is never touched by <CODE>make</CODE> again: in particular note that if you include files from other directories the value of <CODE>CURDIR</CODE> does not change. The value has the same precedence it would have if it were set in the makefile (by default, an environment variable <CODE>CURDIR</CODE> will not override this value). Note that setting this variable has no impact on the operation of <CODE>make</CODE> (it does not cause <CODE>make</CODE> to change its working directory, for example). </FONT>
<UL class=menu>
<LI><A accessKey=1 href="https://www.gnu.org/software/make/manual/make.html#MAKE-Variable"><FONT class=extract>MAKE Variable</FONT></A><FONT class=extract>: The special effects of using &#8216;<SAMP><SPAN class=samp>$(MAKE)</SPAN></SAMP>&#8217;. </FONT>
<LI><A accessKey=2 href="https://www.gnu.org/software/make/manual/make.html#Variables_002fRecursion"><FONT class=extract>Variables/Recursion</FONT></A><FONT class=extract>: How to communicate variables to a sub-<CODE>make</CODE>. </FONT>
<LI><A accessKey=3 href="https://www.gnu.org/software/make/manual/make.html#Options_002fRecursion"><FONT class=extract>Options/Recursion</FONT></A><FONT class=extract>: How to communicate options to a sub-<CODE>make</CODE>. </FONT>
<LI><A accessKey=4 href="https://www.gnu.org/software/make/manual/make.html#g_t_002dw-Option"><FONT class=extract>-w Option</FONT></A><FONT class=extract>: How the &#8216;<SAMP><SPAN class=samp>-w</SPAN></SAMP>&#8217; or &#8216;<SAMP><SPAN class=samp>--print-directory</SPAN></SAMP>&#8217; option helps debug use of recursive <CODE>make</CODE> commands. </FONT></LI></UL>
<DIV class=node><A name=MAKE-Variable></A>
<P>
<HR>
Next:&nbsp;<A accessKey=n href="https://www.gnu.org/software/make/manual/make.html#Variables_002fRecursion" rel=next>Variables/Recursion</A>, Previous:&nbsp;<A accessKey=p href="https://www.gnu.org/software/make/manual/make.html#Recursion" rel=previous>Recursion</A>, Up:&nbsp;<A accessKey=u href="https://www.gnu.org/software/make/manual/make.html#Recursion" rel=up>Recursion</A> </DIV>
<H4 class=subsection><FONT class=extract>5.7.1 How the <CODE>MAKE</CODE> Variable Works</FONT></H4>
<P><A name=index-MAKE-390></A><A name=index-recursion_002c-and-_0040code_007bMAKE_007d-variable-391></A><FONT class=extract>Recursive <CODE>make</CODE> commands should always use the variable <CODE>MAKE</CODE>, not the explicit command name &#8216;<SAMP><SPAN class=samp>make</SPAN></SAMP>&#8217;, as shown here: </FONT><PRE class=example><FONT class=extract>     subsystem:
             cd subdir &amp;&amp; $(MAKE)
</FONT></PRE>
<P><FONT class=extract>The value of this variable is the file name with which <CODE>make</CODE> was invoked. If this file name was <SAMP><SPAN class=file>/bin/make</SPAN></SAMP>, then the recipe executed is &#8216;<SAMP><SPAN class=samp>cd subdir &amp;&amp; /bin/make</SPAN></SAMP>&#8217;. If you use a special version of <CODE>make</CODE> to run the top-level makefile, the same special version will be executed for recursive invocations. </FONT><A name=index-g_t_0040code_007bcd_007d-_0028shell-command_0029-392></A><A name=index-g_t_002b_002c-and-recipes-393></A><FONT class=extract>As a special feature, using the variable <CODE>MAKE</CODE> in the recipe of a rule alters the effects of the &#8216;<SAMP><SPAN class=samp>-t</SPAN></SAMP>&#8217; (&#8216;<SAMP><SPAN class=samp>--touch</SPAN></SAMP>&#8217;), &#8216;<SAMP><SPAN class=samp>-n</SPAN></SAMP>&#8217; (&#8216;<SAMP><SPAN class=samp>--just-print</SPAN></SAMP>&#8217;), or &#8216;<SAMP><SPAN class=samp>-q</SPAN></SAMP>&#8217; (&#8216;<SAMP><SPAN class=samp>--question</SPAN></SAMP>&#8217;<!-- /@w -->) option. Using the <CODE>MAKE</CODE> variable has the same effect as using a &#8216;<SAMP><SPAN class=samp>+</SPAN></SAMP>&#8217; character at the beginning of the recipe line. See </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Instead-of-Execution"><FONT class=extract>Instead of Executing the Recipes</FONT></A><FONT class=extract>. This special feature is only enabled if the <CODE>MAKE</CODE> variable appears directly in the recipe: it does not apply if the <CODE>MAKE</CODE> variable is referenced through expansion of another variable. In the latter case you must use the &#8216;<SAMP><SPAN class=samp>+</SPAN></SAMP>&#8217; token to get these special effects. </FONT>
<P><FONT class=extract>Consider the command &#8216;<SAMP><SPAN class=samp>make -t</SPAN></SAMP>&#8217; in the above example. (The &#8216;<SAMP><SPAN class=samp>-t</SPAN></SAMP>&#8217; option marks targets as up to date without actually running any recipes; see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Instead-of-Execution"><FONT class=extract>Instead of Execution</FONT></A><FONT class=extract>.) Following the usual definition of &#8216;<SAMP><SPAN class=samp>-t</SPAN></SAMP>&#8217;, a &#8216;<SAMP><SPAN class=samp>make -t</SPAN></SAMP>&#8217; command in the example would create a file named <SAMP><SPAN class=file>subsystem</SPAN></SAMP> and do nothing else. What you really want it to do is run &#8216;<SAMP><SPAN class=samp>cd&nbsp;subdir&nbsp;&amp;&amp;<!-- /@w --> make&nbsp;-t<!-- /@w --></SPAN></SAMP>&#8217;; but that would require executing the recipe, and &#8216;<SAMP><SPAN class=samp>-t</SPAN></SAMP>&#8217; says not to execute recipes. </FONT><A name=index-g_t_0040code_007b_002dt_007d_002c-and-recursion-394></A><A name=index-recursion_002c-and-_0040code_007b_002dt_007d-395></A><A name=index-g_t_0040code_007b_002d_002dtouch_007d_002c-and-recursion-396></A><FONT class=extract>The special feature makes this do what you want: whenever a recipe line of a rule contains the variable <CODE>MAKE</CODE>, the flags &#8216;<SAMP><SPAN class=samp>-t</SPAN></SAMP>&#8217;, &#8216;<SAMP><SPAN class=samp>-n</SPAN></SAMP>&#8217; and &#8216;<SAMP><SPAN class=samp>-q</SPAN></SAMP>&#8217; do not apply to that line. Recipe lines containing <CODE>MAKE</CODE> are executed normally despite the presence of a flag that causes most recipes not to be run. The usual <CODE>MAKEFLAGS</CODE> mechanism passes the flags to the sub-<CODE>make</CODE> (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Options_002fRecursion"><FONT class=extract>Communicating Options to a Sub-<CODE>make</CODE></FONT></A><FONT class=extract>), so your request to touch the files, or print the recipes, is propagated to the subsystem. </FONT>
<DIV class=node><A name=Variables%2fRecursion></A><A name=Variables_002fRecursion></A>
<P>
<HR>
Next:&nbsp;<A accessKey=n href="https://www.gnu.org/software/make/manual/make.html#Options_002fRecursion" rel=next>Options/Recursion</A>, Previous:&nbsp;<A accessKey=p href="https://www.gnu.org/software/make/manual/make.html#MAKE-Variable" rel=previous>MAKE Variable</A>, Up:&nbsp;<A accessKey=u href="https://www.gnu.org/software/make/manual/make.html#Recursion" rel=up>Recursion</A> </DIV>
<H4 class=subsection><FONT class=extract>5.7.2 Communicating Variables to a Sub-<CODE>make</CODE></FONT></H4>
<P><A name=index-sub_002d_0040code_007bmake_007d-397></A><A name=index-environment_002c-and-recursion-398></A><A name=index-exporting-variables-399></A><A name=index-variables_002c-environment-400></A><A name=index-variables_002c-exporting-401></A><A name=index-recursion_002c-and-environment-402></A><A name=index-recursion_002c-and-variables-403></A><FONT class=extract>Variable values of the top-level <CODE>make</CODE> can be passed to the sub-<CODE>make</CODE> through the environment by explicit request. These variables are defined in the sub-<CODE>make</CODE> as defaults, but they do not override variables defined in the makefile used by the sub-<CODE>make</CODE> unless you use the &#8216;<SAMP><SPAN class=samp>-e</SPAN></SAMP>&#8217; switch (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Options-Summary"><FONT class=extract>Summary of Options</FONT></A><FONT class=extract>). </FONT>
<P><FONT class=extract>To pass down, or <DFN>export</DFN>, a variable, <CODE>make</CODE> adds the variable and its value to the environment for running each line of the recipe. The sub-<CODE>make</CODE>, in turn, uses the environment to initialize its table of variable values. See </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Environment"><FONT class=extract>Variables from the Environment</FONT></A><FONT class=extract>. </FONT>
<P><FONT class=extract>Except by explicit request, <CODE>make</CODE> exports a variable only if it is either defined in the environment initially or set on the command line, and if its name consists only of letters, numbers, and underscores. Some shells cannot cope with environment variable names consisting of characters other than letters, numbers, and underscores. </FONT>
<P><A name=index-SHELL_002c-exported-value-404></A><FONT class=extract>The value of the <CODE>make</CODE> variable <CODE>SHELL</CODE> is not exported. Instead, the value of the <CODE>SHELL</CODE> variable from the invoking environment is passed to the sub-<CODE>make</CODE>. You can force <CODE>make</CODE> to export its value for <CODE>SHELL</CODE> by using the <CODE>export</CODE> directive, described below. See </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Choosing-the-Shell"><FONT class=extract>Choosing the Shell</FONT></A><FONT class=extract>. </FONT>
<P><FONT class=extract>The special variable <CODE>MAKEFLAGS</CODE> is always exported (unless you unexport it). <CODE>MAKEFILES</CODE> is exported if you set it to anything. </FONT>
<P><FONT class=extract><CODE>make</CODE> automatically passes down variable values that were defined on the command line, by putting them in the <CODE>MAKEFLAGS</CODE> variable. See </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Options_002fRecursion"><FONT class=extract>Options/Recursion</FONT></A><FONT class=extract>. </FONT>
<P><FONT class=extract>Variables are <EM>not</EM> normally passed down if they were created by default by <CODE>make</CODE> (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Implicit-Variables"><FONT class=extract>Variables Used by Implicit Rules</FONT></A><FONT class=extract>). The sub-<CODE>make</CODE> will define these for itself. </FONT>
<P><A name=index-export-405></A><FONT class=extract>If you want to export specific variables to a sub-<CODE>make</CODE>, use the <CODE>export</CODE> directive, like this: </FONT><PRE class=example><FONT class=extract>     export <VAR>variable</VAR> ...
</FONT></PRE>
<P class=noindent><A name=index-unexport-406></A><FONT class=extract>If you want to <EM>prevent</EM> a variable from being exported, use the <CODE>unexport</CODE> directive, like this: </FONT><PRE class=example><FONT class=extract>     unexport <VAR>variable</VAR> ...
</FONT></PRE>
<P class=noindent><FONT class=extract>In both of these forms, the arguments to <CODE>export</CODE> and <CODE>unexport</CODE> are expanded, and so could be variables or functions which expand to a (list of) variable names to be (un)exported. </FONT>
<P><FONT class=extract>As a convenience, you can define a variable and export it at the same time by doing: </FONT><PRE class=example><FONT class=extract>     export <VAR>variable</VAR> = value
</FONT></PRE>
<P class=noindent><FONT class=extract>has the same result as: </FONT><PRE class=example><FONT class=extract>     <VAR>variable</VAR> = value
     export <VAR>variable</VAR>
</FONT></PRE>
<P class=noindent><FONT class=extract>and </FONT><PRE class=example><FONT class=extract>     export <VAR>variable</VAR> := value
</FONT></PRE>
<P class=noindent><FONT class=extract>has the same result as: </FONT><PRE class=example><FONT class=extract>     <VAR>variable</VAR> := value
     export <VAR>variable</VAR>
</FONT></PRE>
<P><FONT class=extract>Likewise, </FONT><PRE class=example><FONT class=extract>     export <VAR>variable</VAR> += value
</FONT></PRE>
<P class=noindent><FONT class=extract>is just like: </FONT><PRE class=example><FONT class=extract>     <VAR>variable</VAR> += value
     export <VAR>variable</VAR>
</FONT></PRE>
<P class=noindent><FONT class=extract>See </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Appending"><FONT class=extract>Appending More Text to Variables</FONT></A><FONT class=extract>. </FONT>
<P><FONT class=extract>You may notice that the <CODE>export</CODE> and <CODE>unexport</CODE> directives work in <CODE>make</CODE> in the same way they work in the shell, <CODE>sh</CODE>. </FONT>
<P><FONT class=extract>If you want all variables to be exported by default, you can use <CODE>export</CODE> by itself: </FONT><PRE class=example><FONT class=extract>     export
</FONT></PRE>
<P class=noindent><FONT class=extract>This tells <CODE>make</CODE> that variables which are not explicitly mentioned in an <CODE>export</CODE> or <CODE>unexport</CODE> directive should be exported. Any variable given in an <CODE>unexport</CODE> directive will still <EM>not</EM> be exported. If you use <CODE>export</CODE> by itself to export variables by default, variables whose names contain characters other than alphanumerics and underscores will not be exported unless specifically mentioned in an <CODE>export</CODE> directive. </FONT>
<P><A name=index-g_t_002eEXPORT_005fALL_005fVARIABLES-407></A><FONT class=extract>The behavior elicited by an <CODE>export</CODE> directive by itself was the default in older versions of GNU <CODE>make</CODE>. If your makefiles depend on this behavior and you want to be compatible with old versions of <CODE>make</CODE>, you can write a rule for the special target <CODE>.EXPORT_ALL_VARIABLES</CODE> instead of using the <CODE>export</CODE> directive. This will be ignored by old <CODE>make</CODE>s, while the <CODE>export</CODE> directive will cause a syntax error. </FONT><A name=index-compatibility-in-exporting-408></A><FONT class=extract>Likewise, you can use <CODE>unexport</CODE> by itself to tell <CODE>make</CODE> <EM>not</EM> to export variables by default. Since this is the default behavior, you would only need to do this if <CODE>export</CODE> had been used by itself earlier (in an included makefile, perhaps). You <STRONG>cannot</STRONG> use <CODE>export</CODE> and <CODE>unexport</CODE> by themselves to have variables exported for some recipes and not for others. The last <CODE>export</CODE> or <CODE>unexport</CODE> directive that appears by itself determines the behavior for the entire run of <CODE>make</CODE>. </FONT>
<P><A name=index-MAKELEVEL-409></A><A name=index-recursion_002c-level-of-410></A><FONT class=extract>As a special feature, the variable <CODE>MAKELEVEL</CODE> is changed when it is passed down from level to level. This variable's value is a string which is the depth of the level as a decimal number. The value is &#8216;<SAMP><SPAN class=samp>0</SPAN></SAMP>&#8217; for the top-level <CODE>make</CODE>; &#8216;<SAMP><SPAN class=samp>1</SPAN></SAMP>&#8217; for a sub-<CODE>make</CODE>, &#8216;<SAMP><SPAN class=samp>2</SPAN></SAMP>&#8217; for a sub-sub-<CODE>make</CODE>, and so on. The incrementation happens when <CODE>make</CODE> sets up the environment for a recipe. </FONT>
<P><FONT class=extract>The main use of <CODE>MAKELEVEL</CODE> is to test it in a conditional directive (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Conditionals"><FONT class=extract>Conditional Parts of Makefiles</FONT></A><FONT class=extract>); this way you can write a makefile that behaves one way if run recursively and another way if run directly by you. </FONT>
<P><A name=index-MAKEFILES-411></A><FONT class=extract>You can use the variable <CODE>MAKEFILES</CODE> to cause all sub-<CODE>make</CODE> commands to use additional makefiles. The value of <CODE>MAKEFILES</CODE> is a whitespace-separated list of file names. This variable, if defined in the outer-level makefile, is passed down through the environment; then it serves as a list of extra makefiles for the sub-<CODE>make</CODE> to read before the usual or specified ones. See </FONT><A href="https://www.gnu.org/software/make/manual/make.html#MAKEFILES-Variable"><FONT class=extract>The Variable <CODE>MAKEFILES</CODE></FONT></A><FONT class=extract>. </FONT>
<DIV class=node><A name=Options%2fRecursion></A><A name=Options_002fRecursion></A>
<P>
<HR>
Next:&nbsp;<A accessKey=n href="https://www.gnu.org/software/make/manual/make.html#g_t_002dw-Option" rel=next>-w Option</A>, Previous:&nbsp;<A accessKey=p href="https://www.gnu.org/software/make/manual/make.html#Variables_002fRecursion" rel=previous>Variables/Recursion</A>, Up:&nbsp;<A accessKey=u href="https://www.gnu.org/software/make/manual/make.html#Recursion" rel=up>Recursion</A> </DIV>
<H4 class=subsection><FONT class=extract>5.7.3 Communicating Options to a Sub-<CODE>make</CODE></FONT></H4>
<P><A name=index-options_002c-and-recursion-412></A><A name=index-recursion_002c-and-options-413></A><A name=index-MAKEFLAGS-414></A><FONT class=extract>Flags such as &#8216;<SAMP><SPAN class=samp>-s</SPAN></SAMP>&#8217; and &#8216;<SAMP><SPAN class=samp>-k</SPAN></SAMP>&#8217; are passed automatically to the sub-<CODE>make</CODE> through the variable <CODE>MAKEFLAGS</CODE>. This variable is set up automatically by <CODE>make</CODE> to contain the flag letters that <CODE>make</CODE> received. Thus, if you do &#8216;<SAMP><SPAN class=samp>make&nbsp;-ks</SPAN></SAMP>&#8217;<!-- /@w --> then <CODE>MAKEFLAGS</CODE> gets the value &#8216;<SAMP><SPAN class=samp>ks</SPAN></SAMP>&#8217;. </FONT>
<P><FONT class=extract>As a consequence, every sub-<CODE>make</CODE> gets a value for <CODE>MAKEFLAGS</CODE> in its environment. In response, it takes the flags from that value and processes them as if they had been given as arguments. See </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Options-Summary"><FONT class=extract>Summary of Options</FONT></A><FONT class=extract>. </FONT>
<P><A name=index-command-line-variable-definitions_002c-and-recursion-415></A><A name=index-variables_002c-command-line_002c-and-recursion-416></A><A name=index-recursion_002c-and-command-line-variable-definitions-417></A><FONT class=extract>Likewise variables defined on the command line are passed to the sub-<CODE>make</CODE> through <CODE>MAKEFLAGS</CODE>. Words in the value of <CODE>MAKEFLAGS</CODE> that contain &#8216;<SAMP><SPAN class=samp>=</SPAN></SAMP>&#8217;, <CODE>make</CODE> treats as variable definitions just as if they appeared on the command line. See </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Overriding"><FONT class=extract>Overriding Variables</FONT></A><FONT class=extract>. </FONT>
<P><A name=index-g_t_0040code_007b_002dC_007d_002c-and-recursion-418></A><A name=index-g_t_0040code_007b_002df_007d_002c-and-recursion-419></A><A name=index-g_t_0040code_007b_002do_007d_002c-and-recursion-420></A><A name=index-g_t_0040code_007b_002dW_007d_002c-and-recursion-421></A><A name=index-g_t_0040code_007b_002d_002ddirectory_007d_002c-and-recursion-422></A><A name=index-g_t_0040code_007b_002d_002dfile_007d_002c-and-recursion-423></A><A name=index-g_t_0040code_007b_002d_002dold_002dfile_007d_002c-and-recursion-424></A><A name=index-g_t_0040code_007b_002d_002dassume_002dold_007d_002c-and-recursion-425></A><A name=index-g_t_0040code_007b_002d_002dassume_002dnew_007d_002c-and-recursion-426></A><A name=index-g_t_0040code_007b_002d_002dnew_002dfile_007d_002c-and-recursion-427></A><A name=index-recursion_002c-and-_0040code_007b_002dC_007d-428></A><A name=index-recursion_002c-and-_0040code_007b_002df_007d-429></A><A name=index-recursion_002c-and-_0040code_007b_002do_007d-430></A><A name=index-recursion_002c-and-_0040code_007b_002dW_007d-431></A><FONT class=extract>The options &#8216;<SAMP><SPAN class=samp>-C</SPAN></SAMP>&#8217;, &#8216;<SAMP><SPAN class=samp>-f</SPAN></SAMP>&#8217;, &#8216;<SAMP><SPAN class=samp>-o</SPAN></SAMP>&#8217;, and &#8216;<SAMP><SPAN class=samp>-W</SPAN></SAMP>&#8217; are not put into <CODE>MAKEFLAGS</CODE>; these options are not passed down. </FONT>
<P><A name=index-g_t_0040code_007b_002dj_007d_002c-and-recursion-432></A><A name=index-g_t_0040code_007b_002d_002djobs_007d_002c-and-recursion-433></A><A name=index-recursion_002c-and-_0040code_007b_002dj_007d-434></A><A name=index-job-slots_002c-and-recursion-435></A><FONT class=extract>The &#8216;<SAMP><SPAN class=samp>-j</SPAN></SAMP>&#8217; option is a special case (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Parallel"><FONT class=extract>Parallel Execution</FONT></A><FONT class=extract>). If you set it to some numeric value &#8216;<SAMP><SPAN class=samp>N</SPAN></SAMP>&#8217; and your operating system supports it (most any UNIX system will; others typically won't), the parent <CODE>make</CODE> and all the sub-<CODE>make</CODE>s will communicate to ensure that there are only &#8216;<SAMP><SPAN class=samp>N</SPAN></SAMP>&#8217; jobs running at the same time between them all. Note that any job that is marked recursive (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Instead-of-Execution"><FONT class=extract>Instead of Executing Recipes</FONT></A><FONT class=extract>) doesn't count against the total jobs (otherwise we could get &#8216;<SAMP><SPAN class=samp>N</SPAN></SAMP>&#8217; sub-<CODE>make</CODE>s running and have no slots left over for any real work!) </FONT>
<P><FONT class=extract>If your operating system doesn't support the above communication, then &#8216;<SAMP><SPAN class=samp>-j 1</SPAN></SAMP>&#8217; is always put into <CODE>MAKEFLAGS</CODE> instead of the value you specified. This is because if the &#8216;<SAMP><SPAN class=samp>-j</SPAN></SAMP>&#8217;<!-- /@w --> option were passed down to sub-<CODE>make</CODE>s, you would get many more jobs running in parallel than you asked for. If you give &#8216;<SAMP><SPAN class=samp>-j</SPAN></SAMP>&#8217; with no numeric argument, meaning to run as many jobs as possible in parallel, this is passed down, since multiple infinities are no more than one. </FONT>
<P><FONT class=extract>If you do not want to pass the other flags down, you must change the value of <CODE>MAKEFLAGS</CODE>, like this: </FONT><PRE class=example><FONT class=extract>     subsystem:
             cd subdir &amp;&amp; $(MAKE) MAKEFLAGS=
</FONT></PRE>
<P><A name=index-MAKEOVERRIDES-436></A><FONT class=extract>The command line variable definitions really appear in the variable <CODE>MAKEOVERRIDES</CODE>, and <CODE>MAKEFLAGS</CODE> contains a reference to this variable. If you do want to pass flags down normally, but don't want to pass down the command line variable definitions, you can reset <CODE>MAKEOVERRIDES</CODE> to empty, like this: </FONT><PRE class=example><FONT class=extract>     MAKEOVERRIDES =
</FONT></PRE>
<P class=noindent><A name=index-Arg-list-too-long-437></A><A name=index-E2BIG-438></A><FONT class=extract>This is not usually useful to do. However, some systems have a small fixed limit on the size of the environment, and putting so much information into the value of <CODE>MAKEFLAGS</CODE> can exceed it. If you see the error message &#8216;<SAMP><SPAN class=samp>Arg list too long</SPAN></SAMP>&#8217;, this may be the problem. </FONT><A name=index-g_t_002ePOSIX-439></A><A name=index-POSIX-440></A><FONT class=extract>(For strict compliance with POSIX.2, changing <CODE>MAKEOVERRIDES</CODE> does not affect <CODE>MAKEFLAGS</CODE> if the special target &#8216;<SAMP><SPAN class=samp>.POSIX</SPAN></SAMP>&#8217; appears in the makefile. You probably do not care about this.) </FONT>
<P><A name=index-MFLAGS-441></A><FONT class=extract>A similar variable <CODE>MFLAGS</CODE> exists also, for historical compatibility. It has the same value as <CODE>MAKEFLAGS</CODE> except that it does not contain the command line variable definitions, and it always begins with a hyphen unless it is empty (<CODE>MAKEFLAGS</CODE> begins with a hyphen only when it begins with an option that has no single-letter version, such as &#8216;<SAMP><SPAN class=samp>--warn-undefined-variables</SPAN></SAMP>&#8217;). <CODE>MFLAGS</CODE> was traditionally used explicitly in the recursive <CODE>make</CODE> command, like this: </FONT><PRE class=example><FONT class=extract>     subsystem:
             cd subdir &amp;&amp; $(MAKE) $(MFLAGS)
</FONT></PRE>
<P class=noindent><FONT class=extract>but now <CODE>MAKEFLAGS</CODE> makes this usage redundant. If you want your makefiles to be compatible with old <CODE>make</CODE> programs, use this technique; it will work fine with more modern <CODE>make</CODE> versions too. </FONT>
<P><A name=index-setting-options-from-environment-442></A><A name=index-options_002c-setting-from-environment-443></A><A name=index-setting-options-in-makefiles-444></A><A name=index-options_002c-setting-in-makefiles-445></A><FONT class=extract>The <CODE>MAKEFLAGS</CODE> variable can also be useful if you want to have certain options, such as &#8216;<SAMP><SPAN class=samp>-k</SPAN></SAMP>&#8217; (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Options-Summary"><FONT class=extract>Summary of Options</FONT></A><FONT class=extract>), set each time you run <CODE>make</CODE>. You simply put a value for <CODE>MAKEFLAGS</CODE> in your environment. You can also set <CODE>MAKEFLAGS</CODE> in a makefile, to specify additional flags that should also be in effect for that makefile. (Note that you cannot use <CODE>MFLAGS</CODE> this way. That variable is set only for compatibility; <CODE>make</CODE> does not interpret a value you set for it in any way.) </FONT>
<P><FONT class=extract>When <CODE>make</CODE> interprets the value of <CODE>MAKEFLAGS</CODE> (either from the environment or from a makefile), it first prepends a hyphen if the value does not already begin with one. Then it chops the value into words separated by blanks, and parses these words as if they were options given on the command line (except that &#8216;<SAMP><SPAN class=samp>-C</SPAN></SAMP>&#8217;, &#8216;<SAMP><SPAN class=samp>-f</SPAN></SAMP>&#8217;, &#8216;<SAMP><SPAN class=samp>-h</SPAN></SAMP>&#8217;, &#8216;<SAMP><SPAN class=samp>-o</SPAN></SAMP>&#8217;, &#8216;<SAMP><SPAN class=samp>-W</SPAN></SAMP>&#8217;, and their long-named versions are ignored; and there is no error for an invalid option). </FONT>
<P><FONT class=extract>If you do put <CODE>MAKEFLAGS</CODE> in your environment, you should be sure not to include any options that will drastically affect the actions of <CODE>make</CODE> and undermine the purpose of makefiles and of <CODE>make</CODE> itself. For instance, the &#8216;<SAMP><SPAN class=samp>-t</SPAN></SAMP>&#8217;, &#8216;<SAMP><SPAN class=samp>-n</SPAN></SAMP>&#8217;, and &#8216;<SAMP><SPAN class=samp>-q</SPAN></SAMP>&#8217; options, if put in one of these variables, could have disastrous consequences and would certainly have at least surprising and probably annoying effects. </FONT>
<P><FONT class=extract>If you'd like to run other implementations of <CODE>make</CODE> in addition to GNU <CODE>make</CODE>, and hence do not want to add GNU <CODE>make</CODE>-specific flags to the <CODE>MAKEFLAGS</CODE> variable, you can add them to the <CODE>GNUMAKEFLAGS</CODE> variable instead. This variable is parsed just before <CODE>MAKEFLAGS</CODE>, in the same way as <CODE>MAKEFLAGS</CODE>. When <CODE>make</CODE> constructs <CODE>MAKEFLAGS</CODE> to pass to a recursive <CODE>make</CODE> it will include all flags, even those taken from <CODE>GNUMAKEFLAGS</CODE>. As a result, after parsing <CODE>GNUMAKEFLAGS</CODE> GNU <CODE>make</CODE> sets this variable to the empty string to avoid duplicating flags during recursion. </FONT>
<P><FONT class=extract>It's best to use <CODE>GNUMAKEFLAGS</CODE> only with flags which won't materially change the behavior of your makefiles. If your makefiles require GNU make anyway then simply use <CODE>MAKEFLAGS</CODE>. Flags such as &#8216;<SAMP><SPAN class=samp>--no-print-directory</SPAN></SAMP>&#8217; or &#8216;<SAMP><SPAN class=samp>--output-sync</SPAN></SAMP>&#8217; may be appropriate for <CODE>GNUMAKEFLAGS</CODE>. </FONT>
<DIV class=node><A name=-w-Option></A><A name=g_t_002dw-Option></A>
<P>
<HR>
Previous:&nbsp;<A accessKey=p href="https://www.gnu.org/software/make/manual/make.html#Options_002fRecursion" rel=previous>Options/Recursion</A>, Up:&nbsp;<A accessKey=u href="https://www.gnu.org/software/make/manual/make.html#Recursion" rel=up>Recursion</A> </DIV>
<H4 class=subsection><FONT class=extract>5.7.4 The &#8216;<SAMP><SPAN class=samp>--print-directory</SPAN></SAMP>&#8217; Option</FONT></H4>
<P><A name=index-directories_002c-printing-them-446></A><A name=index-printing-directories-447></A><A name=index-recursion_002c-and-printing-directories-448></A><FONT class=extract>If you use several levels of recursive <CODE>make</CODE> invocations, the &#8216;<SAMP><SPAN class=samp>-w</SPAN></SAMP>&#8217; or &#8216;<SAMP><SPAN class=samp>--print-directory</SPAN></SAMP>&#8217;<!-- /@w --> option can make the output a lot easier to understand by showing each directory as <CODE>make</CODE> starts processing it and as <CODE>make</CODE> finishes processing it. For example, if &#8216;<SAMP><SPAN class=samp>make -w</SPAN></SAMP>&#8217; is run in the directory <SAMP><SPAN class=file>/u/gnu/make</SPAN></SAMP>, <CODE>make</CODE> will print a line of the form: </FONT><PRE class=example><FONT class=extract>     make: Entering directory `/u/gnu/make'.
</FONT></PRE>
<P class=noindent><FONT class=extract>before doing anything else, and a line of the form: </FONT><PRE class=example><FONT class=extract>     make: Leaving directory `/u/gnu/make'.
</FONT></PRE>
<P class=noindent><FONT class=extract>when processing is completed. </FONT>
<P><A name=index-g_t_0040code_007b_002dC_007d_002c-and-_0040code_007b_002dw_007d-449></A><A name=index-g_t_0040code_007b_002d_002ddirectory_007d_002c-and-_0040code_007b_002d_002dprint_002ddirectory_007d-450></A><A name=index-recursion_002c-and-_0040code_007b_002dw_007d-451></A><A name=index-g_t_0040code_007b_002dw_007d_002c-and-_0040code_007b_002dC_007d-452></A><A name=index-g_t_0040code_007b_002dw_007d_002c-and-recursion-453></A><A name=index-g_t_0040code_007b_002d_002dprint_002ddirectory_007d_002c-and-_0040code_007b_002d_002ddirectory_007d-454></A><A name=index-g_t_0040code_007b_002d_002dprint_002ddirectory_007d_002c-and-recursion-455></A><A name=index-g_t_0040code_007b_002d_002dno_002dprint_002ddirectory_007d-456></A><A name=index-g_t_0040code_007b_002d_002dprint_002ddirectory_007d_002c-disabling-457></A><A name=index-g_t_0040code_007b_002dw_007d_002c-disabling-458></A><FONT class=extract>Normally, you do not need to specify this option because &#8216;<SAMP><SPAN class=samp>make</SPAN></SAMP>&#8217; does it for you: &#8216;<SAMP><SPAN class=samp>-w</SPAN></SAMP>&#8217; is turned on automatically when you use the &#8216;<SAMP><SPAN class=samp>-C</SPAN></SAMP>&#8217; option, and in sub-<CODE>make</CODE>s. <CODE>make</CODE> will not automatically turn on &#8216;<SAMP><SPAN class=samp>-w</SPAN></SAMP>&#8217; if you also use &#8216;<SAMP><SPAN class=samp>-s</SPAN></SAMP>&#8217;, which says to be silent, or if you use &#8216;<SAMP><SPAN class=samp>--no-print-directory</SPAN></SAMP>&#8217; to explicitly disable it. </FONT>
<DIV class=node><A name=Canned-Recipes></A>
<P>
<HR>
Next:&nbsp;<A accessKey=n href="https://www.gnu.org/software/make/manual/make.html#Empty-Recipes" rel=next>Empty Recipes</A>, Previous:&nbsp;<A accessKey=p href="https://www.gnu.org/software/make/manual/make.html#Recursion" rel=previous>Recursion</A>, Up:&nbsp;<A accessKey=u href="https://www.gnu.org/software/make/manual/make.html#Recipes" rel=up>Recipes</A> </DIV>
<H3 class=section><FONT class=extract>5.8 Defining Canned Recipes</FONT></H3>
<P><A name=index-canned-recipes-459></A><A name=index-recipes_002c-canned-460></A><A name=index-sequences-of-commands-461></A><A name=index-commands_002c-sequences-of-462></A><FONT class=extract>When the same sequence of commands is useful in making various targets, you can define it as a canned sequence with the <CODE>define</CODE> directive, and refer to the canned sequence from the recipes for those targets. The canned sequence is actually a variable, so the name must not conflict with other variable names. </FONT>
<P><FONT class=extract>Here is an example of defining a canned recipe: </FONT><PRE class=example><FONT class=extract>     define run-yacc =
     yacc $(firstword $^)
     mv y.tab.c $@
     endef
</FONT></PRE>
<P><A name=index-g_t_0040code_007byacc_007d-463></A><FONT class=extract>Here <CODE>run-yacc</CODE> is the name of the variable being defined; <CODE>endef</CODE> marks the end of the definition; the lines in between are the commands. The <CODE>define</CODE> directive does not expand variable references and function calls in the canned sequence; the &#8216;<SAMP><SPAN class=samp>$</SPAN></SAMP>&#8217; characters, parentheses, variable names, and so on, all become part of the value of the variable you are defining. See </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Multi_002dLine"><FONT class=extract>Defining Multi-Line Variables</FONT></A><FONT class=extract>, for a complete explanation of <CODE>define</CODE>. </FONT>
<P><FONT class=extract>The first command in this example runs Yacc on the first prerequisite of whichever rule uses the canned sequence. The output file from Yacc is always named <SAMP><SPAN class=file>y.tab.c</SPAN></SAMP>. The second command moves the output to the rule's target file name. </FONT>
<P><FONT class=extract>To use the canned sequence, substitute the variable into the recipe of a rule. You can substitute it like any other variable (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Reference"><FONT class=extract>Basics of Variable References</FONT></A><FONT class=extract>). Because variables defined by <CODE>define</CODE> are recursively expanded variables, all the variable references you wrote inside the <CODE>define</CODE> are expanded now. For example: </FONT><PRE class=example><FONT class=extract>     foo.c : foo.y
             $(run-yacc)
</FONT></PRE>
<P class=noindent><FONT class=extract>&#8216;<SAMP><SPAN class=samp>foo.y</SPAN></SAMP>&#8217; will be substituted for the variable &#8216;<SAMP><SPAN class=samp>$^</SPAN></SAMP>&#8217; when it occurs in <CODE>run-yacc</CODE>'s value, and &#8216;<SAMP><SPAN class=samp>foo.c</SPAN></SAMP>&#8217; for &#8216;<SAMP><SPAN class=samp>$@</SPAN></SAMP>&#8217;. </FONT>
<P><FONT class=extract>This is a realistic example, but this particular one is not needed in practice because <CODE>make</CODE> has an implicit rule to figure out these commands based on the file names involved (see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Implicit-Rules"><FONT class=extract>Using Implicit Rules</FONT></A><FONT class=extract>). </FONT>
<P><A name=index-g_t_0040_0040_002c-and-_0040code_007bdefine_007d-464></A><A name=index-g_t_002d_002c-and-_0040code_007bdefine_007d-465></A><A name=index-g_t_002b_002c-and-_0040code_007bdefine_007d-466></A><FONT class=extract>In recipe execution, each line of a canned sequence is treated just as if the line appeared on its own in the rule, preceded by a tab. In particular, <CODE>make</CODE> invokes a separate sub-shell for each line. You can use the special prefix characters that affect command lines (&#8216;<SAMP><SPAN class=samp>@</SPAN></SAMP>&#8217;, &#8216;<SAMP><SPAN class=samp>-</SPAN></SAMP>&#8217;, and &#8216;<SAMP><SPAN class=samp>+</SPAN></SAMP>&#8217;) on each line of a canned sequence. See </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Recipes"><FONT class=extract>Writing Recipes in Rules</FONT></A><FONT class=extract>. For example, using this canned sequence: </FONT><PRE class=example><FONT class=extract>     define frobnicate =
     @echo "frobnicating target $@"
     frob-step-1 $&lt; -o $@-step-1
     frob-step-2 $@-step-1 -o $@
     endef
</FONT></PRE>
<P class=noindent><FONT class=extract><CODE>make</CODE> will not echo the first line, the <CODE>echo</CODE> command. But it <EM>will</EM> echo the following two recipe lines. </FONT>
<P><FONT class=extract>On the other hand, prefix characters on the recipe line that refers to a canned sequence apply to every line in the sequence. So the rule: </FONT><PRE class=example><FONT class=extract>     frob.out: frob.in
             @$(frobnicate)
</FONT></PRE>
<P class=noindent><FONT class=extract>does not echo <EM>any</EM> recipe lines. (See </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Echoing"><FONT class=extract>Recipe Echoing</FONT></A><FONT class=extract>, for a full explanation of &#8216;<SAMP><SPAN class=samp>@</SPAN></SAMP>&#8217;.) </FONT>
<DIV class=node><A name=Empty-Recipes></A>
<P>
<HR>
Previous:&nbsp;<A accessKey=p href="https://www.gnu.org/software/make/manual/make.html#Canned-Recipes" rel=previous>Canned Recipes</A>, Up:&nbsp;<A accessKey=u href="https://www.gnu.org/software/make/manual/make.html#Recipes" rel=up>Recipes</A> </DIV>
<H3 class=section><FONT class=extract>5.9 Using Empty Recipes</FONT></H3>
<P><A name=index-empty-recipes-467></A><A name=index-recipes_002c-empty-468></A><FONT class=extract>It is sometimes useful to define recipes which do nothing. This is done simply by giving a recipe that consists of nothing but whitespace. For example: </FONT><PRE class=example><FONT class=extract>     target: ;
</FONT></PRE>
<P class=noindent><FONT class=extract>defines an empty recipe for <SAMP><SPAN class=file>target</SPAN></SAMP>. You could also use a line beginning with a recipe prefix character to define an empty recipe, but this would be confusing because such a line looks empty. </FONT>
<P><A name=index-g_t_002eDEFAULT_0040r_007b_002c-and-empty-recipes_007d-469></A><FONT class=extract>You may be wondering why you would want to define a recipe that does nothing. The only reason this is useful is to prevent a target from getting implicit recipes (from implicit rules or the <CODE>.DEFAULT</CODE> special target; see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Implicit-Rules"><FONT class=extract>Implicit Rules</FONT></A><FONT class=extract> and see </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Last-Resort"><FONT class=extract>Defining Last-Resort Default Rules</FONT></A><FONT class=extract>). <!-- !!! another reason is for canonical stamp files: --></FONT>
<P><FONT class=extract>You may be inclined to define empty recipes for targets that are not actual files, but only exist so that their prerequisites can be remade. However, this is not the best way to do that, because the prerequisites may not be remade properly if the target file actually does exist. See </FONT><A href="https://www.gnu.org/software/make/manual/make.html#Phony-Targets"><FONT class=extract>Phony Targets</FONT></A><FONT class=extract>, for a better way to do this.</FONT>