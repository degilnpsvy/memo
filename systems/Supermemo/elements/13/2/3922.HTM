When a DMA device puts data into memory, for example, on receipt of network data, most MIPS systems don&#8217;t update the caches&#8212;even though some cache lines may currently be holding addresses within the region just updated by the DMA transfer. If the CPU subsequently reads the information in those cache lines, it&#8217;ll pick up the old, stale version in the cache; as far as the CPU can tell, that&#8217;s still marked valid, and there&#8217;s no indication that the memory has a newer version. 
<P></P>
<P>To avoid this, <FONT class=clozed>your software must actively invalidate any caches&#8217; lines that fall within the address range covered by your DMA buffer, before there&#8217;s any chance that the CPU will try to refer to them again. This is much easier to manage if you round out all your DMA buffers so they start and end exactly at cache line boundaries.</FONT></P>
<P><FONT class=clozed></FONT></P>
<P><FONT class=clozed>For outbound transfers, before you allow a DMA device to transfer data from memory&#8212;such as a packet that you&#8217;re sending out via a network interface&#8212;you must make absolutely sure that none of the data to be sent is still just sitting in the cache. After your software has finished writing out the information to be transferred by DMA, it must force the write-back of all cache lines currently holding information within the address range that the DMA controller will use for the transfer. Only then can you safely initiate the DMA transfer.</FONT>