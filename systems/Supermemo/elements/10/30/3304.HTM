<B><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Bold-0-1000-23; mso-bidi-font-family: Minion-Bold-0-1000-23; mso-font-kerning: 0pt">8.5.10 </SPAN></B><B><I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-BoldItalic-0-1000-21; mso-bidi-font-family: Minion-BoldItalic-0-1000-21; mso-font-kerning: 0pt">Hazard Barrier Instructions</SPAN></I></B> 
<P></P>
<P><FONT class=extract><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">It</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt; mso-fareast-font-family: Minion-Regular-0-1000-18; mso-ascii-font-family: Minion-Regular-0-1000-18">&#8217;</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">s commonplace for one instruction to use a result obtained by its immediate predecessor. In a pipelined processor you</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt; mso-fareast-font-family: Minion-Regular-0-1000-18; mso-ascii-font-family: Minion-Regular-0-1000-18">&#8217;</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">d normally read the second instruction</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt; mso-fareast-font-family: Minion-Regular-0-1000-18; mso-ascii-font-family: Minion-Regular-0-1000-18">&#8217;</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">s operand from the register file before its predecessor</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt; mso-fareast-font-family: Minion-Regular-0-1000-18; mso-ascii-font-family: Minion-Regular-0-1000-18">&#8217;</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">s value had been written back. That</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt; mso-fareast-font-family: Minion-Regular-0-1000-18; mso-ascii-font-family: Minion-Regular-0-1000-18">&#8217;</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">s not a problem, because MIPS instructions only pass data in registers, and data going to and from the general-purpose and floating-point registers is extensively bypassed</SPAN><SPAN style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">&#8212;<SPAN lang=EN-US>that is, the hardware detects the dependency and arranges to forward the data directly to the second instruction, just as it needs it.</SPAN></SPAN></FONT></P>
<P><FONT class=extract><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">However, this isn</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt; mso-fareast-font-family: Minion-Regular-0-1000-18; mso-ascii-font-family: Minion-Regular-0-1000-18">&#8217;</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">t done (in general) for CP0 registers. If you write a field of a CP0 register, it may affect subsequent instructions, and the MIPS rules do not guarantee how long that might take.</SPAN></FONT></P>
<P><FONT class=extract><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">There are two kinds of hazards. The most obvious is where the dependent instruction uses the value provided by the first: That</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt; mso-fareast-font-family: Minion-Regular-0-1000-18; mso-ascii-font-family: Minion-Regular-0-1000-18">&#8217;</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">s called an </SPAN><I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Italic-0-1000-19; mso-bidi-font-family: Minion-Italic-0-1000-19; mso-font-kerning: 0pt">exception hazard</SPAN></I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">. But a more troublesome case is where the write changes some CPU state so as to affect even the fetch of subsequent instructions: That</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt; mso-fareast-font-family: Minion-Regular-0-1000-18; mso-ascii-font-family: Minion-Regular-0-1000-18">&#8217;</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">s the case, for example, with a CP0 write that changes the memory translation setup. Those are called </SPAN><I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Italic-0-1000-19; mso-bidi-font-family: Minion-Italic-0-1000-19; mso-font-kerning: 0pt">instruction hazards</SPAN></I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">.</SPAN></FONT></P>
<P><FONT class=extract><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">Traditionally, MIPS CPUs left the kernel/low-level software engineer with the job of designing sequences that are guaranteed to run correctly, usually by adding a sufficient number of </SPAN><B><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Courier-Bold-8r-0-1000-30; mso-bidi-font-family: Courier-Bold-8r-0-1000-30; mso-font-kerning: 0pt">nop </SPAN></B><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">or </SPAN><B><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Courier-Bold-8r-0-1000-30; mso-bidi-font-family: Courier-Bold-8r-0-1000-30; mso-font-kerning: 0pt">ssnop</SPAN></B><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">3 instructions between the write and the dependent instruction.</SPAN></FONT></P>
<P><FONT class=extract><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">From Release 2 of the MIPS32 specification, though, this is replaced by </SPAN><I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Italic-0-1000-19; mso-bidi-font-family: Minion-Italic-0-1000-19; mso-font-kerning: 0pt">hazard barrier </SPAN></I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">instructions. </SPAN><B><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Courier-Bold-8r-0-1000-30; mso-bidi-font-family: Courier-Bold-8r-0-1000-30; mso-font-kerning: 0pt">eret</SPAN></B><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">, </SPAN><B><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Courier-Bold-8r-0-1000-30; mso-bidi-font-family: Courier-Bold-8r-0-1000-30; mso-font-kerning: 0pt">jr.hb</SPAN></B><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">, and </SPAN><B><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Courier-Bold-8r-0-1000-30; mso-bidi-font-family: Courier-Bold-8r-0-1000-30; mso-font-kerning: 0pt">jalr.hb </SPAN></B><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">are barriers to all side effects, including execution hazards, while </SPAN><B><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Courier-Bold-8r-0-1000-30; mso-bidi-font-family: Courier-Bold-8r-0-1000-30; mso-font-kerning: 0pt">ehb </SPAN></B><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">(a kind of no-op on steroids) deals, with less overhead, with exception hazards.</SPAN></FONT></P>
<P><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">For a longer discussion of hazards and barriers, see section 3.4.</SPAN></P>
<P><B><I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-BoldItalic-0-1000-21; mso-bidi-font-family: Minion-BoldItalic-0-1000-21; mso-font-kerning: 0pt">Porting Software to Use the New Instructions</SPAN></I></B></P>
<P><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">If you know your software will only ever run on a MIPS32 Release 2 or higher CPU, then that</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt; mso-fareast-font-family: Minion-Regular-0-1000-18; mso-ascii-font-family: Minion-Regular-0-1000-18">&#8217;</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">s great. But to maintain software that has to continue running on older CPUs, you</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt; mso-fareast-font-family: Minion-Regular-0-1000-18; mso-ascii-font-family: Minion-Regular-0-1000-18">&#8217;</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">re guaranteed that:</SPAN></P>
<P><I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Italic-0-1000-19; mso-bidi-font-family: Minion-Italic-0-1000-19; mso-font-kerning: 0pt">ehb is a no-op</SPAN></I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">: On all previous CPUs. You can create software that continues to work on old CPUs but is also safe on all future MIPS32/64- compliant CPUs: Just substitute an </SPAN><B><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Courier-Bold-8r-0-1000-30; mso-bidi-font-family: Courier-Bold-8r-0-1000-30; mso-font-kerning: 0pt">ehb </SPAN></B><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">for the last no-op in your sequence of </SPAN><SPAN style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">&#8220;<SPAN lang=EN-US>enough no-ops.</SPAN>&#8221;<SPAN lang=EN-US></SPAN></SPAN></P>
<P><I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Italic-0-1000-19; mso-bidi-font-family: Minion-Italic-0-1000-19; mso-font-kerning: 0pt">jr.hb and jalr.hb</SPAN></I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">: Are decoded as plain jump-register and call-by-register instructions on earlier CPUs. Again, provided you already had enough no-ops for your worst-case older CPU, your system should now be safe on MIPS32/64 Release 2 CPUs.</SPAN></P>
<P><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">3. </SPAN><B><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Courier-Bold-8r-0-1000-30; mso-bidi-font-family: Courier-Bold-8r-0-1000-30; mso-font-kerning: 0pt">ssnop </SPAN></B><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Minion-Regular-0-1000-18; mso-bidi-font-family: Minion-Regular-0-1000-18; mso-font-kerning: 0pt">is a special sort of no-op that is guaranteed to occupy a whole issue cycle by itself on a CPU that is capable of issuing more than one instruction per clock cycle.</SPAN>