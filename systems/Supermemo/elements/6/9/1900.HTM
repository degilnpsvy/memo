<H3 class=docSection1Title>6.1. Defining a Macro</H3>
<P class=docText><FONT class=extract>To start defining a </FONT><A name=gnu3-CHP-6-ITERM-2258></A><A name=gnu3-CHP-6-ITERM-2259></A><FONT class=extract>macro, press <SPAN class=docEmphBold>F3</SPAN> or <SPAN class=docEmphBold>C-x (</SPAN>.</FONT><SUP class=docFootnote><A class=docLink href="file:///D:/&#25105;&#30340;&#37239;&#30424;/&#24037;&#20316;&#30446;&#24405;/Now/learning-gnu-emacs-3rd/0596006489/gnu3-chp-6-sect-1.html#gnu3-chp-6-fnote-2"><FONT class=extract>[</FONT>2]</A></SUP> The abbreviation <TT>Def</TT> appears on the mode line, showing that you are in macro definition mode. In this mode, Emacs records all the keystrokes that you type, whether they are commands or literal text, so that you can replay them later. <FONT class=extract>To end the macro, press <SPAN class=docEmphBold>F4</SPAN> or <SPAN class=docEmphBold>C-x )</SPAN>;</FONT> you leave macro definition mode, and Emacs stops recording your keystrokes. Emacs also stops recording your keystrokes automatically if an error occurs or if you press <SPAN class=docEmphBold>C-g</SPAN>.</P>
<BLOCKQUOTE>
<P class=docFootnote><SUP><A name=gnu3-CHP-6-FNOTE-2>[2]</A></SUP> Mac OS X users may have bound <SPAN class=docEmphBold>F3</SPAN> and <SPAN class=docEmphBold>F4</SPAN>, used in defining and executing macros, to another key. These users should press <SPAN class=docEmphBold>Option-F3</SPAN> and <SPAN class=docEmphBold>Option-F4</SPAN> to get the same functionality.</P></BLOCKQUOTE>
<P class=docText>While you're defining a macro, Emacs acts on <A name=gnu3-CHP-6-ITERM-2260></A>your keystrokes as well as recording them: that is, anything you type while in macro definition mode is treated as a regular command and executed. While you're defining a macro, you're doing completely normal editing. That way you can see that the macro does exactly what you want it to, and you can cancel it (with <SPAN class=docEmphBold>C-g</SPAN>) if you notice that the macro isn't really quite what you want.</P>
<P class=docText><FONT class=extract>To execute your </FONT><A name=gnu3-CHP-6-ITERM-2261></A><A name=gnu3-CHP-6-ITERM-2262></A><FONT class=extract>macro, press <SPAN class=docEmphBold>F4</SPAN> or <SPAN class=docEmphBold>C-x e</SPAN>.</FONT> Emacs then replays your keystrokes exactly. (<FONT class=extract>You can see that <SPAN class=docEmphBold>F4</SPAN> has two different functions relating to macros: to end a macro definition and, after it's defined, to execute the macro</FONT>.)</P>
<P class=docText>This macro is referred to as the "last" keyboard macro, with last here meaning most recent. <FONT class=extract>Only one macro is the last keyboard macro. A macro ring, much like the kill ring, allows you to access a number of macros during an Emacs session.</FONT></P>
<P class=docText><A class=docLink href="file:///D:/&#25105;&#30340;&#37239;&#30424;/&#24037;&#20316;&#30446;&#24405;/Now/learning-gnu-emacs-3rd/0596006489/gnu3-chp-6-sect-1.html#gnu3-chp-6-table-1">Table 6-1</A> shows the steps required to define and execute a macro. This macro takes a list of names in the ordinary First Name Last Name order and changes it to the frequently needed Last Name, First <A name=gnu3-CHP-6-ITERM-2263></A>Name order.</P><A name=gnu3-CHP-6-TABLE-1></A>
<H5 class=docTableTitle>Table 6-1. Steps for creating name transposition macro</H5>
<TABLE cellSpacing=0 cellPadding=4 rules=all width="100%" border=1>
<COLGROUP>
<COL>
<COL></COLGROUP>
<THEAD>
<TR>
<TH class=thead scope=col>
<P class=docText>Keystrokes</P></TH>
<TH class=thead scope=col>
<P class=docText>Action</P></TH></TR></THEAD>
<TBODY>
<TR>
<TD class=docTableCell>
<P class=docText><SPAN class=docEmphBold>F3</SPAN> <SPAN class=docEmphasis>or</SPAN> <SPAN class=docEmphBold>C-x (</SPAN></P></TD>
<TD class=docTableCell>
<P class=docText>Start the macro; <TT>Def</TT> appears on the mode line.</P></TD></TR>
<TR>
<TD class=docTableCell>
<P class=docText><SPAN class=docEmphBold>C-a</SPAN> </P></TD>
<TD class=docTableCell>
<P class=docText>Move to the beginning of the current line.</P></TD></TR>
<TR>
<TD class=docTableCell>
<P class=docText><SPAN class=docEmphBold>M-f</SPAN> </P></TD>
<TD class=docTableCell>
<P class=docText>Move forward a word.</P></TD></TR>
<TR>
<TD class=docTableCell>
<P class=docText>,</P></TD>
<TD class=docTableCell>
<P class=docText>Type a comma.</P></TD></TR>
<TR>
<TD class=docTableCell>
<P class=docText><SPAN class=docEmphBold>M-t</SPAN> </P></TD>
<TD class=docTableCell>
<P class=docText>Transpose first and last.</P></TD></TR>
<TR>
<TD class=docTableCell>
<P class=docText><SPAN class=docEmphBold>C-n</SPAN> </P></TD>
<TD class=docTableCell>
<P class=docText>Move to the next line.</P></TD></TR>
<TR>
<TD class=docTableCell>
<P class=docText><SPAN class=docEmphBold>F4</SPAN> <SPAN class=docEmphasis>or</SPAN> <SPAN class=docEmphBold>C-x )</SPAN></P></TD>
<TD class=docTableCell>
<P class=docText>End the macro definition.</P></TD></TR></TBODY></TABLE><BR><A name=ch06-3-fm2xml></A>
<TABLE cellSpacing=0 cellPadding=4 rules=all width="100%" border=1>
<COLGROUP>
<COL></COLGROUP>
<TBODY>
<TR>
<TD class=docTableCell>
<P class=docText>Define the macro using the keystrokes given in <A class=docLink href="file:///D:/&#25105;&#30340;&#37239;&#30424;/&#24037;&#20316;&#30446;&#24405;/Now/learning-gnu-emacs-3rd/0596006489/gnu3-chp-6-sect-1.html#gnu3-chp-6-table-1">Table 6-1</A>.</P></TD></TR>
<TR>
<TD class=docTableCell>
<P class=docText><IMG height=206 alt="" src="file:///D:/&#25105;&#30340;&#37239;&#30424;/&#24037;&#20316;&#30446;&#24405;/Now/learning-gnu-emacs-3rd/0596006489/images/0596006489/figs/ge3_ch06scrn01.gif" width=425 border=0> </P></TD></TR>
<TR>
<TD class=docTableCell>
<P class=docText>In defining the macro, you transposed the names on the first line, leaving the cursor on the second line.</P></TD></TR></TBODY></TABLE><BR>
<P class=docText>Now let's be brave and assume the macro works; we'll try repeating it five times by prefacing the command to execute a macro with <SPAN class=docEmphBold>M-5</SPAN>. Of course, in real life, you'd be better off trying it once before doing anything so bold.</P><A name=ch06-4-fm2xml></A>
<TABLE cellSpacing=0 cellPadding=4 rules=all width="100%" border=1>
<COLGROUP>
<COL></COLGROUP>
<TBODY>
<TR>
<TD class=docTableCell>
<P class=docText>Type <SPAN class=docEmphBold>M-5 F4</SPAN> or <SPAN class=docEmphBold>M-5 C-x e</SPAN></P></TD></TR>
<TR>
<TD class=docTableCell>
<P class=docText><IMG height=206 alt="" src="file:///D:/&#25105;&#30340;&#37239;&#30424;/&#24037;&#20316;&#30446;&#24405;/Now/learning-gnu-emacs-3rd/0596006489/images/0596006489/figs/ge3_ch06scrn02.gif" width=425 border=0> </P></TD></TR>
<TR>
<TD class=docTableCell>
<P class=docText>Now we've done the first six lines: one by defining the macro and five more by executing it.</P></TD></TR></TBODY></TABLE><BR>
<P class=docText>The macro works well, so we can finish the rest of the buffer with confidence: type <SPAN class=docEmphBold>M-100</SPAN>, then <SPAN class=docEmphBold>C-x e</SPAN> or <SPAN class=docEmphBold>F4</SPAN>. Emacs stops automatically when you reach the end of the buffer, so it doesn't matter if you repeat the <A name=gnu3-CHP-6-ITERM-2264></A><A name=gnu3-CHP-6-ITERM-2265></A>macro more times than necessary.</P>
<P class=docText><FONT class=extract>Here are a few points to remember:</FONT></P>
<UL>
<LI>
<P class=docList><FONT class=extract>Don't forget to press <SPAN class=docEmphBold>F4</SPAN> or <SPAN class=docEmphBold>C-x )</SPAN> when you've finished the macro. If you try to execute a macro before it has been defined, Emacs complains and forgets the macro's definition.</FONT></P>
<LI>
<P class=docList><FONT class=extract><SPAN class=docEmphBold>C-g</SPAN> terminates a macro, causing Emacs to forget its definition.</FONT></P>
<LI>
<P class=docList><FONT class=extract>Virtually any error automatically terminates a macro. If Emacs beeps at you, you have to start over.</FONT></P>
<LI>
<P class=docList><FONT class=extract>Emacs executes the keystrokes <SPAN class=docEmphasis>exactly</SPAN> as you type them, with no intelligence whatsoever. Avoid making assumptions like, "Of course I'll be at the beginning (or end) of the line when I execute the macro."</FONT></P></LI></UL>
<P class=docText><FONT class=extract>If you invoke a macro and it does the wrong thing, you can use <SPAN class=docEmphBold>C-_</SPAN> to undo it. Emacs is smart enough to realize that "undo the last command" means "undo the entire macro" rather than "undo the last command within the macro." However, if you repeat a macro multiple times using <SPAN class=docEmphBold>M-</SPAN><SPAN class=docEmphasis>n</SPAN>, <SPAN class=docEmphBold>C-_</SPAN> undoes only the last instance of the macro, not all the instances</FONT>