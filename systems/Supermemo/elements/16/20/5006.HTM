<H3 class=section style="FONT-FAMILY: 'Droid Serif', 'Lucida Grande', 'Lucida Sans Unicode', 'DejaVu Sans', Verdana, sans-serif; FONT-VARIANT: normal; WHITE-SPACE: normal; TEXT-TRANSFORM: none; WORD-SPACING: 0px; COLOR: rgb(0,0,0); FONT-STYLE: normal; LETTER-SPACING: normal; TEXT-INDENT: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px">A.8 Special agenda views</H3>
<P style="WHITE-SPACE: normal; TEXT-TRANSFORM: none; WORD-SPACING: 0px; COLOR: rgb(0,0,0); TEXT-ALIGN: justify; FONT: 15px/19px 'Droid Serif', 'Lucida Grande', 'Lucida Sans Unicode', 'DejaVu Sans', Verdana, sans-serif; MARGIN-TOP: 0px; LETTER-SPACING: normal; TEXT-INDENT: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px"><A name=index-agenda-views_002c-user_002ddefined-2165></A><A name=index-org_002dagenda_002dskip_002dfunction-2166></A><A name=index-org_002dagenda_002dskip_002dfunction_002dglobal-2167></A>Org provides a special hook that can be used to narrow down the selection made by these agenda views:<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>agenda</CODE>,<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>agenda*</CODE><A style="FONT-WEIGHT: normal; TEXT-DECORATION: none" href="http://orgmode.org/org.html#fn-178" name=fnd-178 rel=footnote><SUP>178</SUP></A>,<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>todo</CODE>,<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>alltodo</CODE>,<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>tags</CODE>,<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>tags-todo</CODE>,<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>tags-tree</CODE>. You may specify a function that is used at each match to verify if the match should indeed be part of the agenda view, and if not, how much should be skipped. You can specify a global condition that will be applied to all agenda views, this condition would be stored in the variable<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>org-agenda-skip-function-global</CODE>. More commonly, such a definition is applied only to specific custom searches, using<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>org-agenda-skip-function</CODE>.</P>
<P style="WHITE-SPACE: normal; TEXT-TRANSFORM: none; WORD-SPACING: 0px; COLOR: rgb(0,0,0); TEXT-ALIGN: justify; FONT: 15px/19px 'Droid Serif', 'Lucida Grande', 'Lucida Sans Unicode', 'DejaVu Sans', Verdana, sans-serif; MARGIN-TOP: 0px; LETTER-SPACING: normal; TEXT-INDENT: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px">Let's say you want to produce a list of projects that contain a WAITING tag anywhere in the project tree. Let's further assume that you have marked all tree headings that define a project with the TODO keyword PROJECT. In this case you would run a TODO search for the keyword PROJECT, but skip the match unless there is a WAITING tag anywhere in the subtree belonging to the project line.</P>
<P style="WHITE-SPACE: normal; TEXT-TRANSFORM: none; WORD-SPACING: 0px; COLOR: rgb(0,0,0); TEXT-ALIGN: justify; FONT: 15px/19px 'Droid Serif', 'Lucida Grande', 'Lucida Sans Unicode', 'DejaVu Sans', Verdana, sans-serif; MARGIN-TOP: 0px; LETTER-SPACING: normal; TEXT-INDENT: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px">To achieve this, you must write a function that searches the subtree for the tag. If the tag is found, the function must return<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>nil</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>to indicate that this match should not be skipped. If there is no such tag, return the location of the end of the subtree, to indicate that search should continue from there.</P><PRE class=lisp style="OVERFLOW: auto; MARGIN-BOTTOM: 14pt; FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: 'Courier New'; BORDER-RIGHT: medium none; FONT-VARIANT: normal; BORDER-BOTTOM: medium none; TEXT-TRANSFORM: none; WORD-SPACING: 0px; FONT-WEIGHT: normal; COLOR: rgb(0,0,0); PADDING-BOTTOM: 12pt; FONT-STYLE: normal; PADDING-TOP: 12pt; PADDING-LEFT: 12pt; BORDER-LEFT: medium none; LETTER-SPACING: normal; PADDING-RIGHT: 12pt; BACKGROUND-COLOR: rgb(238,238,238); TEXT-INDENT: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; box-shadow: rgb(136, 136, 136) 5px 5px 5px">     (defun my-skip-unless-waiting ()
       "Skip trees that are not waiting"
       (let ((subtree-end (save-excursion (org-end-of-subtree t))))
         (if (re-search-forward ":waiting:" subtree-end t)
             nil          ; tag found, do not skip
           subtree-end))) ; tag not found, continue after end of subtree
</PRE>
<P style="WHITE-SPACE: normal; TEXT-TRANSFORM: none; WORD-SPACING: 0px; COLOR: rgb(0,0,0); TEXT-ALIGN: justify; FONT: 15px/19px 'Droid Serif', 'Lucida Grande', 'Lucida Sans Unicode', 'DejaVu Sans', Verdana, sans-serif; MARGIN-TOP: 0px; LETTER-SPACING: normal; TEXT-INDENT: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px">Now you may use this function in an agenda custom command, for example like this:</P><PRE class=lisp style="OVERFLOW: auto; MARGIN-BOTTOM: 14pt; FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: 'Courier New'; BORDER-RIGHT: medium none; FONT-VARIANT: normal; BORDER-BOTTOM: medium none; TEXT-TRANSFORM: none; WORD-SPACING: 0px; FONT-WEIGHT: normal; COLOR: rgb(0,0,0); PADDING-BOTTOM: 12pt; FONT-STYLE: normal; PADDING-TOP: 12pt; PADDING-LEFT: 12pt; BORDER-LEFT: medium none; LETTER-SPACING: normal; PADDING-RIGHT: 12pt; BACKGROUND-COLOR: rgb(238,238,238); TEXT-INDENT: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; box-shadow: rgb(136, 136, 136) 5px 5px 5px">     (org-add-agenda-custom-command
      '("b" todo "PROJECT"
        ((org-agenda-skip-function 'my-skip-unless-waiting)
         (org-agenda-overriding-header "Projects waiting for something: "))))
</PRE>
<P style="WHITE-SPACE: normal; TEXT-TRANSFORM: none; WORD-SPACING: 0px; COLOR: rgb(0,0,0); TEXT-ALIGN: justify; FONT: 15px/19px 'Droid Serif', 'Lucida Grande', 'Lucida Sans Unicode', 'DejaVu Sans', Verdana, sans-serif; MARGIN-TOP: 0px; LETTER-SPACING: normal; TEXT-INDENT: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px"><A name=index-org_002dagenda_002doverriding_002dheader-2168></A>Note that this also binds<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>org-agenda-overriding-header</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>to get a meaningful header in the agenda view.</P>
<P style="WHITE-SPACE: normal; TEXT-TRANSFORM: none; WORD-SPACING: 0px; COLOR: rgb(0,0,0); TEXT-ALIGN: justify; FONT: 15px/19px 'Droid Serif', 'Lucida Grande', 'Lucida Sans Unicode', 'DejaVu Sans', Verdana, sans-serif; MARGIN-TOP: 0px; LETTER-SPACING: normal; TEXT-INDENT: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px"><A name=index-org_002dodd_002dlevels_002donly-2169></A><A name=index-org_002dagenda_002dskip_002dfunction-2170></A>A general way to create custom searches is to base them on a search for entries with a certain level limit. If you want to study all entries with your custom search function, simply do a search for &#8216;<SAMP><SPAN class=samp>LEVEL&gt;0</SPAN></SAMP>&#8217;<A style="FONT-WEIGHT: normal; TEXT-DECORATION: none" href="http://orgmode.org/org.html#fn-179" name=fnd-179 rel=footnote><SUP>179</SUP></A>, and then use<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>org-agenda-skip-function</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>to select the entries you really want to have.</P>
<P style="WHITE-SPACE: normal; TEXT-TRANSFORM: none; WORD-SPACING: 0px; COLOR: rgb(0,0,0); TEXT-ALIGN: justify; FONT: 15px/19px 'Droid Serif', 'Lucida Grande', 'Lucida Sans Unicode', 'DejaVu Sans', Verdana, sans-serif; MARGIN-TOP: 0px; LETTER-SPACING: normal; TEXT-INDENT: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px">You may also put a Lisp form into<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>org-agenda-skip-function</CODE>. In particular, you may use the functions<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>org-agenda-skip-entry-if</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>and<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>org-agenda-skip-subtree-if</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>in this form, for example:</P>
<DL style="WHITE-SPACE: normal; TEXT-TRANSFORM: none; WORD-SPACING: 0px; COLOR: rgb(0,0,0); FONT: 15px/19px 'Droid Serif', 'Lucida Grande', 'Lucida Sans Unicode', 'DejaVu Sans', Verdana, sans-serif; LETTER-SPACING: normal; TEXT-INDENT: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px">
<DT style="MARGIN-BOTTOM: 3px; FONT-SIZE: 16px; FONT-FAMILY: 'Courier New'; COLOR: rgb(28,48,48); PADDING-BOTTOM: 3px; PADDING-TOP: 3px; PADDING-LEFT: 3px; PADDING-RIGHT: 3px"><CODE>(org-agenda-skip-entry-if 'scheduled)</CODE></DT>
<DD style="MARGIN-BOTTOM: 14pt; TEXT-ALIGN: justify">Skip current entry if it has been scheduled.<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR></DD>
<DT style="MARGIN-BOTTOM: 3px; FONT-SIZE: 16px; FONT-FAMILY: 'Courier New'; COLOR: rgb(28,48,48); PADDING-BOTTOM: 3px; PADDING-TOP: 3px; PADDING-LEFT: 3px; PADDING-RIGHT: 3px"><CODE>(org-agenda-skip-entry-if 'notscheduled)</CODE></DT>
<DD style="MARGIN-BOTTOM: 14pt; TEXT-ALIGN: justify">Skip current entry if it has not been scheduled.<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR></DD>
<DT style="MARGIN-BOTTOM: 3px; FONT-SIZE: 16px; FONT-FAMILY: 'Courier New'; COLOR: rgb(28,48,48); PADDING-BOTTOM: 3px; PADDING-TOP: 3px; PADDING-LEFT: 3px; PADDING-RIGHT: 3px"><CODE>(org-agenda-skip-entry-if 'deadline)</CODE></DT>
<DD style="MARGIN-BOTTOM: 14pt; TEXT-ALIGN: justify">Skip current entry if it has a deadline.<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR></DD>
<DT style="MARGIN-BOTTOM: 3px; FONT-SIZE: 16px; FONT-FAMILY: 'Courier New'; COLOR: rgb(28,48,48); PADDING-BOTTOM: 3px; PADDING-TOP: 3px; PADDING-LEFT: 3px; PADDING-RIGHT: 3px"><CODE>(org-agenda-skip-entry-if 'scheduled 'deadline)</CODE></DT>
<DD style="MARGIN-BOTTOM: 14pt; TEXT-ALIGN: justify">Skip current entry if it has a deadline, or if it is scheduled.<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR></DD>
<DT style="MARGIN-BOTTOM: 3px; FONT-SIZE: 16px; FONT-FAMILY: 'Courier New'; COLOR: rgb(28,48,48); PADDING-BOTTOM: 3px; PADDING-TOP: 3px; PADDING-LEFT: 3px; PADDING-RIGHT: 3px"><CODE>(org-agenda-skip-entry-if 'todo '("TODO" "WAITING"))</CODE></DT>
<DD style="MARGIN-BOTTOM: 14pt; TEXT-ALIGN: justify">Skip current entry if the TODO keyword is TODO or WAITING.<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR></DD>
<DT style="MARGIN-BOTTOM: 3px; FONT-SIZE: 16px; FONT-FAMILY: 'Courier New'; COLOR: rgb(28,48,48); PADDING-BOTTOM: 3px; PADDING-TOP: 3px; PADDING-LEFT: 3px; PADDING-RIGHT: 3px"><CODE>(org-agenda-skip-entry-if 'todo 'done)</CODE></DT>
<DD style="MARGIN-BOTTOM: 14pt; TEXT-ALIGN: justify">Skip current entry if the TODO keyword marks a DONE state.<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR></DD>
<DT style="MARGIN-BOTTOM: 3px; FONT-SIZE: 16px; FONT-FAMILY: 'Courier New'; COLOR: rgb(28,48,48); PADDING-BOTTOM: 3px; PADDING-TOP: 3px; PADDING-LEFT: 3px; PADDING-RIGHT: 3px"><CODE>(org-agenda-skip-entry-if 'timestamp)</CODE></DT>
<DD style="MARGIN-BOTTOM: 14pt; TEXT-ALIGN: justify">Skip current entry if it has any timestamp, may also be deadline or scheduled.<SPAN class=Apple-converted-space>&nbsp;</SPAN><A name=x_002dagenda_002dskip_002dentry_002dregexp></A><BR></DD>
<DT style="MARGIN-BOTTOM: 3px; FONT-SIZE: 16px; FONT-FAMILY: 'Courier New'; COLOR: rgb(28,48,48); PADDING-BOTTOM: 3px; PADDING-TOP: 3px; PADDING-LEFT: 3px; PADDING-RIGHT: 3px"><CODE>(org-agenda-skip-entry-if 'regexp "regular expression")</CODE></DT>
<DD style="MARGIN-BOTTOM: 14pt; TEXT-ALIGN: justify">Skip current entry if the regular expression matches in the entry.<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR></DD>
<DT style="MARGIN-BOTTOM: 3px; FONT-SIZE: 16px; FONT-FAMILY: 'Courier New'; COLOR: rgb(28,48,48); PADDING-BOTTOM: 3px; PADDING-TOP: 3px; PADDING-LEFT: 3px; PADDING-RIGHT: 3px"><CODE>(org-agenda-skip-entry-if 'notregexp "regular expression")</CODE></DT>
<DD style="MARGIN-BOTTOM: 14pt; TEXT-ALIGN: justify">Skip current entry unless the regular expression matches.<SPAN class=Apple-converted-space>&nbsp;</SPAN><BR></DD>
<DT style="MARGIN-BOTTOM: 3px; FONT-SIZE: 16px; FONT-FAMILY: 'Courier New'; COLOR: rgb(28,48,48); PADDING-BOTTOM: 3px; PADDING-TOP: 3px; PADDING-LEFT: 3px; PADDING-RIGHT: 3px"><CODE>(org-agenda-skip-subtree-if 'regexp "regular expression")</CODE></DT>
<DD style="MARGIN-BOTTOM: 14pt; TEXT-ALIGN: justify">Same as above, but check and skip the entire subtree.</DD></DL>
<P style="WHITE-SPACE: normal; TEXT-TRANSFORM: none; WORD-SPACING: 0px; COLOR: rgb(0,0,0); TEXT-ALIGN: justify; FONT: 15px/19px 'Droid Serif', 'Lucida Grande', 'Lucida Sans Unicode', 'DejaVu Sans', Verdana, sans-serif; MARGIN-TOP: 0px; LETTER-SPACING: normal; TEXT-INDENT: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px">Therefore we could also have written the search for WAITING projects like this, even without defining a special function:</P><PRE class=lisp style="OVERFLOW: auto; MARGIN-BOTTOM: 14pt; FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: 'Courier New'; BORDER-RIGHT: medium none; FONT-VARIANT: normal; BORDER-BOTTOM: medium none; TEXT-TRANSFORM: none; WORD-SPACING: 0px; FONT-WEIGHT: normal; COLOR: rgb(0,0,0); PADDING-BOTTOM: 12pt; FONT-STYLE: normal; PADDING-TOP: 12pt; PADDING-LEFT: 12pt; BORDER-LEFT: medium none; LETTER-SPACING: normal; PADDING-RIGHT: 12pt; BACKGROUND-COLOR: rgb(238,238,238); TEXT-INDENT: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; box-shadow: rgb(136, 136, 136) 5px 5px 5px">     (org-add-agenda-custom-command
      '("b" todo "PROJECT"
        ((org-agenda-skip-function '(org-agenda-skip-subtree-if
                                     'regexp ":waiting:"))
         (org-agenda-overriding-header "Projects waiting for something: "))))</PRE>