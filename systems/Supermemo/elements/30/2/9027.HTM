<H5 class=subsubsection style="WORD-SPACING: 0px; TEXT-TRANSFORM: none; COLOR: rgb(0,0,0); TEXT-INDENT: 0px; LINE-HEIGHT: normal; FONT-STYLE: normal; FONT-FAMILY: Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; FONT-VARIANT: normal; orphans: auto; widows: auto; -webkit-text-stroke-width: 0px">2.17.2.2 Adding symbols from an object file</H5>
<P style="WORD-SPACING: 0px; FONT: medium Simsun; TEXT-TRANSFORM: none; COLOR: rgb(0,0,0); TEXT-INDENT: 0px; WHITE-SPACE: normal; LETTER-SPACING: normal; orphans: auto; widows: auto; -webkit-text-stroke-width: 0px">When the<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>_bfd_link_add_symbols</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>routine is passed an object file, it must add all externally visible symbols in that object file to the hash table. The actual work of adding the symbol to the hash table is normally handled by the function<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>_bfd_generic_link_add_one_symbol</CODE>. The<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>_bfd_link_add_symbols</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>routine is responsible for reading all the symbols from the object file and passing the correct information to<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>_bfd_generic_link_add_one_symbol</CODE>.</P>
<P style="WORD-SPACING: 0px; FONT: medium Simsun; TEXT-TRANSFORM: none; COLOR: rgb(0,0,0); TEXT-INDENT: 0px; WHITE-SPACE: normal; LETTER-SPACING: normal; orphans: auto; widows: auto; -webkit-text-stroke-width: 0px">The<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>_bfd_link_add_symbols</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>routine should not use<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>bfd_canonicalize_symtab</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>to read the symbols. The point of providing this routine is to avoid the overhead of converting the symbols into generic<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>asymbol</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>structures.</P>
<P style="WORD-SPACING: 0px; FONT: medium Simsun; TEXT-TRANSFORM: none; COLOR: rgb(0,0,0); TEXT-INDENT: 0px; WHITE-SPACE: normal; LETTER-SPACING: normal; orphans: auto; widows: auto; -webkit-text-stroke-width: 0px"><A name=index-g_t_005fbfd_005fgeneric_005flink_005fadd_005fone_005fsymbol-1914></A><CODE>_bfd_generic_link_add_one_symbol</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>handles the details of combining common symbols, warning about multiple definitions, and so forth. It takes arguments which describe the symbol to add, notably symbol flags, a section, and an offset. The symbol flags include such things as<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>BSF_WEAK</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>or<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>BSF_INDIRECT</CODE>. The section is a section in the object file, or something like<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>bfd_und_section_ptr</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>for an undefined symbol or<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>bfd_com_section_ptr</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>for a common symbol.</P>
<P style="WORD-SPACING: 0px; FONT: medium Simsun; TEXT-TRANSFORM: none; COLOR: rgb(0,0,0); TEXT-INDENT: 0px; WHITE-SPACE: normal; LETTER-SPACING: normal; orphans: auto; widows: auto; -webkit-text-stroke-width: 0px">If the<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>_bfd_final_link</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>routine is also going to need to read the symbol information, the<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>_bfd_link_add_symbols</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>routine should save it somewhere attached to the object file BFD. However, the information should only be saved if the<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>keep_memory</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>field of the<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>info</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>argument is TRUE, so that the<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>-no-keep-memory</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>linker switch is effective.</P>
<P style="WORD-SPACING: 0px; FONT: medium Simsun; TEXT-TRANSFORM: none; COLOR: rgb(0,0,0); TEXT-INDENT: 0px; WHITE-SPACE: normal; LETTER-SPACING: normal; orphans: auto; widows: auto; -webkit-text-stroke-width: 0px">The a.out function which adds symbols from an object file is<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>aout_link_add_object_symbols</CODE>, and most of the interesting work is in<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>aout_link_add_symbols</CODE>. The latter saves pointers to the hash tables entries created by<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>_bfd_generic_link_add_one_symbol</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>indexed by symbol number, so that the<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>_bfd_final_link</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>routine does not have to call the hash table lookup routine to locate the entry.