add_timer 
<P></P><PRE><A class=hl href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#950" name=950>950</A><SPAN class=c>/**
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#951" name=951>951</A> * add_timer - start a timer
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#952" name=952>952</A> * @timer: the timer to be added
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#953" name=953>953</A> *
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#954" name=954>954</A> * The kernel will do a -&gt;function(-&gt;data) callback from the
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#955" name=955>955</A> * timer interrupt at the -&gt;expires point in the future. The
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#956" name=956>956</A> * current time is 'jiffies'.
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#957" name=957>957</A> *
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#958" name=958>958</A> * The timer's -&gt;expires, -&gt;function (and if the handler uses it, -&gt;data)
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#959" name=959>959</A> * fields must be set prior calling this function.
<A class=hl href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#960" name=960>960</A> *
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#961" name=961>961</A> * Timers with an -&gt;expires field in the past will be executed in the next
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#962" name=962>962</A> * timer tick.
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#963" name=963>963</A> */</SPAN>
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#964" name=964>964</A><B>void</B> <A class=xf name=add_timer></A><A class=xf href="http://172.21.12.145:8080/source/s?refs=add_timer&amp;project=linux-4.5">add_timer</A>(<B>struct</B> <A href="http://172.21.12.145:8080/source/s?defs=timer_list&amp;project=linux-4.5">timer_list</A> *<A class=xa name=timer></A><A class=xa href="http://172.21.12.145:8080/source/s?refs=timer&amp;project=linux-4.5">timer</A>)
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#965" name=965>965</A>{
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#966" name=966>966</A>	<A href="http://172.21.12.145:8080/source/s?defs=BUG_ON&amp;project=linux-4.5">BUG_ON</A>(<A href="http://172.21.12.145:8080/source/s?defs=timer_pending&amp;project=linux-4.5">timer_pending</A>(<A href="http://172.21.12.145:8080/source/s?defs=timer&amp;project=linux-4.5">timer</A>));
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#967" name=967>967</A>	<A href="http://172.21.12.145:8080/source/s?defs=mod_timer&amp;project=linux-4.5">mod_timer</A>(<A href="http://172.21.12.145:8080/source/s?defs=timer&amp;project=linux-4.5">timer</A>, <A href="http://172.21.12.145:8080/source/s?defs=timer&amp;project=linux-4.5">timer</A>-&gt;<A href="http://172.21.12.145:8080/source/s?defs=expires&amp;project=linux-4.5">expires</A>);
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#968" name=968>968</A>}
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#969" name=969>969</A><A href="http://172.21.12.145:8080/source/s?defs=EXPORT_SYMBOL&amp;project=linux-4.5">EXPORT_SYMBOL</A>(<A class=xv name=add_timer></A><A class=xv href="http://172.21.12.145:8080/source/s?refs=add_timer&amp;project=linux-4.5">add_timer</A>);</PRE><PRE><PRE><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#886" name=886>886</A><SPAN class=c>/**
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#887" name=887>887</A> * mod_timer - modify a timer's timeout
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#888" name=888>888</A> * @timer: the timer to be modified
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#889" name=889>889</A> * @expires: new timeout in jiffies
<A class=hl href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#890" name=890>890</A> *
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#891" name=891>891</A> * mod_timer() is a more efficient way to update the expire field of an
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#892" name=892>892</A> * active timer (if the timer is inactive it will be activated)
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#893" name=893>893</A> *
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#894" name=894>894</A> * mod_timer(timer, expires) is equivalent to:
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#895" name=895>895</A> *
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#896" name=896>896</A> *     del_timer(timer); timer-&gt;expires = expires; add_timer(timer);
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#897" name=897>897</A> *
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#898" name=898>898</A> * Note that if there are multiple unserialized concurrent users of the
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#899" name=899>899</A> * same timer, then mod_timer() is the only safe way to modify the timeout,
<A class=hl href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#900" name=900>900</A> * since add_timer() cannot modify an already running timer.
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#901" name=901>901</A> *
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#902" name=902>902</A> * The function returns whether it has modified a pending timer or not.
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#903" name=903>903</A> * (ie. mod_timer() of an inactive timer returns 0, mod_timer() of an
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#904" name=904>904</A> * active timer returns 1.)
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#905" name=905>905</A> */</SPAN>
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#906" name=906>906</A><B>int</B> <A class=xf name=mod_timer></A><A class=xf href="http://172.21.12.145:8080/source/s?refs=mod_timer&amp;project=linux-4.5">mod_timer</A>(<B>struct</B> <A href="http://172.21.12.145:8080/source/s?defs=timer_list&amp;project=linux-4.5">timer_list</A> *<A class=xa name=timer></A><A class=xa href="http://172.21.12.145:8080/source/s?refs=timer&amp;project=linux-4.5">timer</A>, <B>unsigned</B> <B>long</B> <A class=xa name=expires></A><A class=xa href="http://172.21.12.145:8080/source/s?refs=expires&amp;project=linux-4.5">expires</A>)
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#907" name=907>907</A>{
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#908" name=908>908</A>	<A href="http://172.21.12.145:8080/source/s?defs=expires&amp;project=linux-4.5">expires</A> = <A class=d href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#apply_slack">apply_slack</A>(<A href="http://172.21.12.145:8080/source/s?defs=timer&amp;project=linux-4.5">timer</A>, <A href="http://172.21.12.145:8080/source/s?defs=expires&amp;project=linux-4.5">expires</A>);
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#909" name=909>909</A>
<A class=hl href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#910" name=910>910</A>	<SPAN class=c>/*
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#911" name=911>911</A>	 * This is a common optimization triggered by the
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#912" name=912>912</A>	 * networking code - if the timer is re-modified
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#913" name=913>913</A>	 * to be the same thing then just return:
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#914" name=914>914</A>	 */</SPAN>
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#915" name=915>915</A>	<B>if</B> (<A href="http://172.21.12.145:8080/source/s?defs=timer_pending&amp;project=linux-4.5">timer_pending</A>(<A href="http://172.21.12.145:8080/source/s?defs=timer&amp;project=linux-4.5">timer</A>) &amp;&amp; <A href="http://172.21.12.145:8080/source/s?defs=timer&amp;project=linux-4.5">timer</A>-&gt;<A href="http://172.21.12.145:8080/source/s?defs=expires&amp;project=linux-4.5">expires</A> == <A href="http://172.21.12.145:8080/source/s?defs=expires&amp;project=linux-4.5">expires</A>)
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#916" name=916>916</A>		<B>return</B> <SPAN class=n>1</SPAN>;
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#917" name=917>917</A>
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#918" name=918>918</A>	<B>return</B> <A class=d href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#__mod_timer">__mod_timer</A>(<A href="http://172.21.12.145:8080/source/s?defs=timer&amp;project=linux-4.5">timer</A>, <A href="http://172.21.12.145:8080/source/s?defs=expires&amp;project=linux-4.5">expires</A>, <B>false</B>, <A href="http://172.21.12.145:8080/source/s?defs=TIMER_NOT_PINNED&amp;project=linux-4.5">TIMER_NOT_PINNED</A>);
<A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#919" name=919>919</A>}
<A class=hl href="http://172.21.12.145:8080/source/xref/linux-4.5/kernel/time/timer.c#920" name=920>920</A><A href="http://172.21.12.145:8080/source/s?defs=EXPORT_SYMBOL&amp;project=linux-4.5">EXPORT_SYMBOL</A>(<A class=xv name=mod_timer></A><A class=xv href="http://172.21.12.145:8080/source/s?refs=mod_timer&amp;project=linux-4.5">mod_timer</A>);</PRE></PRE></TT>