<SPAN class=docEmphasis>kernel/locking/semaphore.c 4.1</SPAN>
<P></P>
<P><SPAN class=docEmphasis></SPAN><SPAN class=docEmphasis><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#42" name=42>42</A><SPAN class=c>/**<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#43" name=43>43</A> * down - acquire the semaphore<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#44" name=44>44</A> * @sem: the semaphore to be acquired<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#45" name=45>45</A> *<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#46" name=46>46</A> * Acquires the semaphore.&nbsp; If no more tasks are allowed to acquire the<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#47" name=47>47</A> * semaphore, calling this function will put the task to sleep until the</P>
<P><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#48" name=48>48</A> * semaphore is released.<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#49" name=49>49</A> *<BR><A class=hl href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#50" name=50>50</A> * Use of this function is deprecated, please use down_interruptible() or<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#51" name=51>51</A> * down_killable() instead.<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#52" name=52>52</A> */</SPAN><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#53" name=53>53</A><B>void</B> <A class=xf name=down></A><A class=xf href="http://172.29.26.110:8080/source/s?refs=down&amp;project=Linux-v4.6">down</A>(<B>struct</B> <A href="http://172.29.26.110:8080/source/s?defs=semaphore&amp;project=Linux-v4.6">semaphore</A> *<A class=xa name=sem></A><A class=xa href="http://172.29.26.110:8080/source/s?refs=sem&amp;project=Linux-v4.6">sem</A>)<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#54" name=54>54</A>{<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#55" name=55>55</A> <B>unsigned</B> <B>long</B> <A class=xl name=flags></A><A class=xl href="http://172.29.26.110:8080/source/s?refs=flags&amp;project=Linux-v4.6">flags</A>;<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#56" name=56>56</A><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#57" name=57>57</A> <A href="http://172.29.26.110:8080/source/s?defs=raw_spin_lock_irqsave&amp;project=Linux-v4.6">raw_spin_lock_irqsave</A>(&amp;<A href="http://172.29.26.110:8080/source/s?defs=sem&amp;project=Linux-v4.6">sem</A>-&gt;<A href="http://172.29.26.110:8080/source/s?defs=lock&amp;project=Linux-v4.6">lock</A>, <A href="http://172.29.26.110:8080/source/s?defs=flags&amp;project=Linux-v4.6">flags</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#58" name=58>58</A> <B>if</B> (<A href="http://172.29.26.110:8080/source/s?defs=likely&amp;project=Linux-v4.6">likely</A>(<A href="http://172.29.26.110:8080/source/s?defs=sem&amp;project=Linux-v4.6">sem</A>-&gt;<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#count">count</A> &gt; 0))<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#59" name=59>59</A> <A href="http://172.29.26.110:8080/source/s?defs=sem&amp;project=Linux-v4.6">sem</A>-&gt;<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#count">count</A>--;<BR><A class=hl href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#60" name=60>60</A> <B>else</B><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#61" name=61>61</A> <A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#__down">__down</A>(<A href="http://172.29.26.110:8080/source/s?defs=sem&amp;project=Linux-v4.6">sem</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#62" name=62>62</A> <A href="http://172.29.26.110:8080/source/s?defs=raw_spin_unlock_irqrestore&amp;project=Linux-v4.6">raw_spin_unlock_irqrestore</A>(&amp;<A href="http://172.29.26.110:8080/source/s?defs=sem&amp;project=Linux-v4.6">sem</A>-&gt;<A href="http://172.29.26.110:8080/source/s?defs=lock&amp;project=Linux-v4.6">lock</A>, <A href="http://172.29.26.110:8080/source/s?defs=flags&amp;project=Linux-v4.6">flags</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#63" name=63>63</A>}<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#64" name=64>64</A><A href="http://172.29.26.110:8080/source/s?defs=EXPORT_SYMBOL&amp;project=Linux-v4.6">EXPORT_SYMBOL</A>(<A class=xv name=down></A><A class=xv href="http://172.29.26.110:8080/source/s?refs=down&amp;project=Linux-v4.6">down</A>);</P>
<P><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#171" name=171>171</A><SPAN class=c>/** <A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#172" name=172>172</A> * up - release the semaphore<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#173" name=173>173</A> * @sem: the semaphore to release<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#174" name=174>174</A> *<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#175" name=175>175</A> * Release the semaphore.&nbsp; Unlike mutexes, up() may be called from any<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#176" name=176>176</A> * context and even by tasks which have never called down().<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#177" name=177>177</A> */</SPAN><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#178" name=178>178</A><B>void</B> <A class=xf name=up></A><A class=xf href="http://172.29.26.110:8080/source/s?refs=up&amp;project=Linux-v4.6">up</A>(<B>struct</B> <A href="http://172.29.26.110:8080/source/s?defs=semaphore&amp;project=Linux-v4.6">semaphore</A> *<A class=xa name=sem></A><A class=xa href="http://172.29.26.110:8080/source/s?refs=sem&amp;project=Linux-v4.6">sem</A>)<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#179" name=179>179</A>{<BR><A class=hl href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#180" name=180>180</A> <B>unsigned</B> <B>long</B> <A class=xl name=flags></A><A class=xl href="http://172.29.26.110:8080/source/s?refs=flags&amp;project=Linux-v4.6">flags</A>;<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#181" name=181>181</A><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#182" name=182>182</A> <A href="http://172.29.26.110:8080/source/s?defs=raw_spin_lock_irqsave&amp;project=Linux-v4.6">raw_spin_lock_irqsave</A>(&amp;<A href="http://172.29.26.110:8080/source/s?defs=sem&amp;project=Linux-v4.6">sem</A>-&gt;<A href="http://172.29.26.110:8080/source/s?defs=lock&amp;project=Linux-v4.6">lock</A>, <A href="http://172.29.26.110:8080/source/s?defs=flags&amp;project=Linux-v4.6">flags</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#183" name=183>183</A> <B>if</B> (<A href="http://172.29.26.110:8080/source/s?defs=likely&amp;project=Linux-v4.6">likely</A>(<A href="http://172.29.26.110:8080/source/s?defs=list_empty&amp;project=Linux-v4.6">list_empty</A>(&amp;<A href="http://172.29.26.110:8080/source/s?defs=sem&amp;project=Linux-v4.6">sem</A>-&gt;<A href="http://172.29.26.110:8080/source/s?defs=wait_list&amp;project=Linux-v4.6">wait_list</A>)))<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#184" name=184>184</A> <A href="http://172.29.26.110:8080/source/s?defs=sem&amp;project=Linux-v4.6">sem</A>-&gt;<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#count">count</A>++;<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#185" name=185>185</A> <B>else</B><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#186" name=186>186</A> <A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#__up">__up</A>(<A href="http://172.29.26.110:8080/source/s?defs=sem&amp;project=Linux-v4.6">sem</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#187" name=187>187</A> <A href="http://172.29.26.110:8080/source/s?defs=raw_spin_unlock_irqrestore&amp;project=Linux-v4.6">raw_spin_unlock_irqrestore</A>(&amp;<A href="http://172.29.26.110:8080/source/s?defs=sem&amp;project=Linux-v4.6">sem</A>-&gt;<A href="http://172.29.26.110:8080/source/s?defs=lock&amp;project=Linux-v4.6">lock</A>, <A href="http://172.29.26.110:8080/source/s?defs=flags&amp;project=Linux-v4.6">flags</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#188" name=188>188</A>}<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/kernel/locking/semaphore.c#189" name=189>189</A><A href="http://172.29.26.110:8080/source/s?defs=EXPORT_SYMBOL&amp;project=Linux-v4.6">EXPORT_SYMBOL</A>(<A class=xv name=up></A><A class=xv href="http://172.29.26.110:8080/source/s?refs=up&amp;project=Linux-v4.6">up</A>);</P></SPAN>