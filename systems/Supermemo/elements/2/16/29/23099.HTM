<H3 id=-100000 class=docSection1Title>Linux-Sound Subsystem</H3>
<P class=docText><SPAN class=docEmphasis><A name="Advanced Linux"></A>Advanced Linux Sound Architecture</SPAN><A name="sound subsystem"></A> (ALSA) is the sound subsystem of choice in the 2.6 kernel. <SPAN class=docEmphasis><A name="Sound System"></A>Open Sound System</SPAN><A name="To help"></A> (OSS), the sound layer in the 2.4 kernel, is now obsolete and depreciated. To help the transition from OSS to ALSA, the latter provides OSS emulation that allows applications conforming to the OSS API to run unchanged over ALSA. Linux-Sound frameworks such as ALSA and OSS render audio applications independent of the underlying hardware, just as codec standards such as AC'97 and I<SUP>2</SUP><A name="need of"></A>S do away with the need of writing separate audio drivers for each sound card.</P>
<P class=docText>Take a look at <A class=docLink href="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/ch13lev1sec2.html#ch13fig03">Figure 13.3</A><A name="of the"></A> to understand the architecture of the Linux-Sound subsystem. The constituent pieces of the subsystem are as follows:</P>
<UL>
<LI>
<P class=docList><A name="consisting of"></A>The sound core, which is a code base consisting of routines and structures available to other components of the Linux-Sound layer. Like the core layers belonging to other driver subsystems, the sound core provides a level of indirection that renders each component in the sound subsystem independent of the others. The core also plays an important role in exporting the ALSA API to higher applications. The following <SPAN class=docEmphasis>/dev/snd/*</SPAN> device nodes shown in <A class=docLink href="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/ch13lev1sec2.html#ch13fig03">Figure 13.3</A> are created and managed by the ALSA core: <SPAN class=docEmphasis>/dev/snd/controlC0</SPAN><A name="and such"></A> is a control node (that applications use for controlling volume gain and such), <SPAN class=docEmphasis>/dev/snd/pcmC0D0p</SPAN><A name="device "></A> is a playback device (<SPAN class=docEmphasis>p</SPAN><A name="end of"></A> at the end of the device name stands for playback), and <SPAN class=docEmphasis>/dev/snd/pcmC0D0c</SPAN><A name="is a"></A> is a recording device (<SPAN class=docEmphasis>c</SPAN><A name="end of"></A> at the end of the device name stands for capture). In these device names, the integer following <SPAN class=docEmphasis>C</SPAN><A name="the card"></A> is the card number, and that after <SPAN class=docEmphasis>D</SPAN><A name="that has"></A> is the device number. An ALSA driver for a card that has a voice codec for telephony and a stereo codec for music might export <SPAN class=docEmphasis>/dev/snd/pcmC0D0p</SPAN><A name="for the"></A> to read audio streams destined for the former and <SPAN class=docEmphasis>/dev/snd/pcmC0D1p</SPAN> to channel music bound for the latter.</P></LI>
<LI>
<P class=docList><A name=iddle1012></A><A name=iddle1099></A><A name=iddle1100></A><A name=iddle1101></A><A name=iddle1102></A><A name=iddle1105></A><A name=iddle1111></A><A name=iddle2737></A><A name=iddle3362></A><A name=iddle4035></A><A name=iddle4055></A><A name="audio controller"></A>Audio controller drivers specific to controller hardware. To drive the audio controller present in the Intel ICH South Bridge chipsets, for example, use the <SPAN class=docEmphasis>snd_intel8x0</SPAN> driver.</P></LI>
<LI>
<P class=docList><A name="controllers and"></A>Audio codec interfaces that assist communication between controllers and codecs. For AC'97 codecs, use the <SPAN class=docEmphasis>snd_ac97_codec</SPAN> and <SPAN class=docEmphasis>ac97_bus</SPAN> modules.</P></LI>
<LI>
<P class=docList><A name="applications and"></A>An OSS emulation layer that acts as a conduit between OSS-aware applications and the ALSA-enabled kernel. This layer exports <SPAN class=docEmphasis>/dev</SPAN><A name="what the"></A> nodes that mirror what the OSS layer offered in the 2.4 kernels. These nodes, such as <SPAN class=docEmphasis>/dev/dsp</SPAN>, <SPAN class=docEmphasis>/dev/adsp</SPAN>, and <SPAN class=docEmphasis>/dev/mixer</SPAN><A name="applications to"></A>, allow OSS applications to run unchanged over ALSA. The OSS <SPAN class=docEmphasis>/dev/dsp</SPAN><A name="node maps"></A> node maps to the ALSA nodes <SPAN class=docEmphasis>/dev/snd/pcmC0D0*</SPAN>, <SPAN class=docEmphasis>/dev/adsp</SPAN> corresponds to <SPAN class=docEmphasis>/dev/snd/pcmC0D1*</SPAN>, and <SPAN class=docEmphasis>/dev/mixer</SPAN> associates with <SPAN class=docEmphasis>/dev/snd/controlC0</SPAN>.</P></LI>
<LI>
<P class=docList><A name="sysfs interface"></A>Procfs and sysfs interface implementations for accessing information via <SPAN class=docEmphasis>/proc/asound/</SPAN> and <SPAN class=docEmphasis>/sys/class/sound/</SPAN>.</P></LI>
<LI>
<P class=docList><A name="ALSA library"></A>The user-space ALSA library, <SPAN class=docEmphasis>alsa-lib</SPAN>, which provides the <SPAN class=docEmphasis>libasound.so</SPAN><A name="programmer by"></A> object. This library eases the job of the ALSA application programmer by offering several canned routines to access ALSA drivers.</P></LI>
<LI>
<P class=docList>The <SPAN class=docEmphasis>alsa-utils</SPAN><A name=as></A> package that includes utilities such as <SPAN class=docEmphasis>alsamixer</SPAN>, <SPAN class=docEmphasis>amixer</SPAN>, <SPAN class=docEmphasis>alsactl</SPAN>, and <SPAN class=docEmphasis>aplay</SPAN><A name="audio signals"></A>. Use alsamixer or amixer to change volume levels of audio signals such as line-in, line-out, or microphone, and alsactl to control settings for ALSA drivers. To play audio over ALSA, use aplay.</P></LI></UL><A name=ch13fig03></A>
<P>
<CENTER>
<H5 class=docFigureTitle>Figure 13.3. Linux-Sound (ALSA) subsystem.</H5>
<P class=docText>
<DIV class=st1><A href="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/images/ZTVyMWQ5OHB0Z2lzMC8vbWMzNWE5NC9yMzZnMjdhZy5wX2xjc2kwMXQvMzNoZmlnaWFm.jpg" target=_blank>[View full size image]</A></DIV><IMG border=0 alt="" src="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/images/ZTVyMWQ5OHB0Z2lzMC8vbWMzNWE5NC9yMzZnMjdhZ3AuaWNzaTAxLzNmM2hpZ2Y-.jpg" width=500 height=647>
<P></P></CENTER>
<P></P><BR>
<P class=docText><A name="architecture of"></A>To obtain a better understanding of the architecture of the Linux-Sound layer, let's look at the ALSA driver modules running on a laptop in tandem with <A class=docLink href="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/ch13lev1sec2.html#ch13fig03">Figure 13.3</A> (<IMG alt="rightwards double arrow" src="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/images/U2192.GIF"> is used to attach comments):</P>
<DIV class=docText>
<DIV class=codeSegmentsExpansionLinks>Code View:</DIV><PRE><SPAN class=docEmphStrong>bash&gt; lsmod|grep snd</SPAN>
snd_intel8x0       33148  0                               <IMG alt="rightwards double arrow" src="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/images/U2192.GIF"> Audio Controller Driver
snd_ac97_codec     92000  1 snd_intel8x0                  <IMG alt="rightwards double arrow" src="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/images/U2192.GIF"> Audio Codec Interface
ac97_bus           3104   1 snd_ac97_codec                <IMG alt="rightwards double arrow" src="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/images/U2192.GIF"> Audio Codec Bus
snd_pcm_oss        40512  0                               <IMG alt="rightwards double arrow" src="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/images/U2192.GIF"> OSS Emulation
snd_mixer_oss      16640  1 snd_pcm_oss                   <IMG alt="rightwards double arrow" src="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/images/U2192.GIF"> OSS Volume Control
snd_pcm            73316  3 snd_intel8x0,snd_ac97_codec,snd_pcm_oss
                                                          <IMG alt="rightwards double arrow" src="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/images/U2192.GIF"> Core layer
snd_timer          22148  1 snd_pcm                       <IMG alt="rightwards double arrow" src="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/images/U2192.GIF"> Core layer
snd                50820  6 snd_intel8x0,snd_ac97_codec,snd_pcm_oss,
                            snd_mixer_oss,snd_pcm,snd_timer
                                                          <IMG alt="rightwards double arrow" src="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/images/U2192.GIF"> Core layer
soundcore          8960   1 snd                           <IMG alt="rightwards double arrow" src="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/images/U2192.GIF"> Core layer
snd_page_alloc     10344  2 snd_intel8x0,snd_pcm          <IMG alt="rightwards double arrow" src="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/images/U2192.GIF"> Core layer

					  </PRE></DIV>