<H3 id=-100000 class=docSection1Title>Looking at the Sources</H3>
<P class=docText><A name="The USB"></A>The USB core layer lives in <SPAN class=docEmphasis>drivers/usb/core/.</SPAN><A name="also contains"></A> This directory also contains URB manipulation routines and the usbfs implementation. The hub driver and khubd are part of <SPAN class=docEmphasis>drivers/usb/core/hub.c.</SPAN> The <SPAN class=docEmphasis>drivers/usb/host/</SPAN><A name="contains host"></A> directory contains host controller device drivers. USB-related header definitions reside in <SPAN class=docEmphasis>include/linux/usb*.h.</SPAN> The usbmon tracer is in <SPAN class=docEmphasis>drivers/usb/mon/.</SPAN> Look inside <SPAN class=docEmphasis>Documentation/usb/</SPAN> for Linux-USB documentation.</P>
<P class=docText>USB class drivers stay in various subdirectories under <SPAN class=docEmphasis>drivers/usb/.</SPAN> The mass storage driver <SPAN class=docEmphasis>drivers/usb/storage/</SPAN>, in tandem with the SCSI subsystem <SPAN class=docEmphasis>drivers/scsi/</SPAN>, implements the USB mass storage protocol. The <SPAN class=docEmphasis>drivers/input/</SPAN><SUP class=docFootnote><A class=docLink href="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/ch11lev1sec9.html#ch11fn04">[4]</A></SUP><A name="as keyboards"></A> directory tree includes drivers for USB input devices such as keyboards and mice; <SPAN class=docEmphasis>drivers/usb/serial/</SPAN> has drivers for USB-to-serial converters; <SPAN class=docEmphasis>drivers/usb/media/</SPAN> supports USB multimedia devices; <SPAN class=docEmphasis>drivers/net/usb/</SPAN><SUP class=docFootnote><A class=docLink href="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/ch11lev1sec9.html#ch11fn05">[5]</A></SUP><A name=and></A> has drivers for USB Ethernet dongles; and <SPAN class=docEmphasis>drivers/usb/misc/</SPAN><A name="fingerprint sensors"></A> contains drivers for miscellaneous USB devices such as LEDs, LCDs, and fingerprint sensors. Look at <SPAN class=docEmphasis>drivers/usb/usb-skeleton.c</SPAN><A name="you can"></A> for a starting point driver template if you can't zero in on a closer match.</P>
<BLOCKQUOTE>
<P class=docFootnote><SUP><A name=ch11fn04>[4]</A></SUP><A name=in></A> Before the 2.6.22 kernel release, USB input device drivers used to reside in <SPAN class=docEmphasis>drivers/usb/input/</SPAN>.</P></BLOCKQUOTE>
<BLOCKQUOTE>
<P class=docFootnote><SUP><A name=ch11fn05>[5]</A></SUP><A name="USB network"></A> Before the 2.6.22 kernel release, USB network device drivers used to reside in <SPAN class=docEmphasis>drivers/usb/net/</SPAN>.</P></BLOCKQUOTE>
<P class=docText><A name=iddle3571></A><A name=iddle4408></A><A name=iddle4421></A><A name=iddle4431></A><A name=iddle4463></A><A name=iddle4468></A><A name=iddle4469></A><A name=iddle4473></A><A name=iddle4474></A><A name=iddle4476></A><A name=iddle4478></A><A name=iddle4480></A><A name=iddle4494></A><A name=iddle4498></A><A name=iddle4501></A><A name=iddle4504></A><A name=iddle4505></A><A name=iddle4511></A><A name="gadget subsystem"></A>The USB gadget subsystem is in <SPAN class=docEmphasis>drivers/usb/gadget/.</SPAN><A name="This directory"></A> This directory contains USB device controller drivers, and gadget drivers for mass storage (<SPAN class=docEmphasis>file_storage.c</SPAN>), serial converters (<SPAN class=docEmphasis>serial.c</SPAN><A name="networking "></A>), and Ethernet networking (<SPAN class=docEmphasis>ether.c</SPAN>).</P>
<P class=docText><A class=docLink href="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/ch11lev1sec9.html#ch11tab03">Table 11.3</A><A name="the main"></A> contains the main data structures used in this chapter and their location in the source tree. <A class=docLink href="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/ch11lev1sec9.html#ch11tab04">Table 11.4</A><A name="in this"></A> lists the main kernel programming interfaces that you used in this chapter along with the location of their definitions.</P><A name=ch11tab03></A>
<P>
<TABLE cellSpacing=0 cellPadding=5 rules=groups frame=hsides>
<CAPTION>
<H5 class=docTableTitle>Table 11.3. Summary of Data Structures</H5></CAPTION>
<COLGROUP span=3 align=left>
<COL width=150>
<COL width=150>
<COL width=250></COLGROUP>
<THEAD>
<TR>
<TH class="docTableCell bottomBorder thead" style="TEXT-ALIGN: left" vAlign=top scope=col align=left>Data Structure</TH>
<TH class="docTableCell bottomBorder thead" style="TEXT-ALIGN: left" vAlign=top scope=col align=left>Location</TH>
<TH class="docTableCell bottomBorder thead" style="TEXT-ALIGN: left" vAlign=top scope=col align=left>Description</TH></TR></THEAD>
<TBODY>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>urb</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>include/linux/usb.h</SPAN></TD>
<TD class=docTableCell vAlign=top align=left><A name="transfer mechanism"></A>Centerpiece of the USB data transfer mechanism</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>pipe</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>include/linux/usb.h</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Address element of a URB</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left>
<DIV class=docText><PRE>usb_device_descriptor
usb_config_descriptor
usb_interface_descriptor
usb_endpoint_descriptor</PRE></DIV><BR></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>include/linux/usb/ch9.h</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Descriptors that hold information about a USB device</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_device</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>include/linux/usb.h</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Representation of a USB device</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_device_id</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>include/linux/mod_devicetable.h</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Identity of a USB device</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_driver</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>include/linux/usb.h</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Representation of a USB client driver</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_gadget_driver</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>include/linux/usb_gadget.h</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Representation of a USB gadget driver</TD></TR></TBODY></TABLE></P><BR><A name=ch11tab04></A>
<P>
<TABLE cellSpacing=0 cellPadding=5 rules=groups frame=hsides>
<CAPTION>
<H5 class=docTableTitle>Table 11.4. Summary of Kernel Programming Interfaces</H5></CAPTION>
<COLGROUP span=3 align=left>
<COL width=150>
<COL width=150>
<COL width=250></COLGROUP>
<THEAD>
<TR>
<TH class="docTableCell bottomBorder thead" style="TEXT-ALIGN: left" vAlign=top scope=col align=left>Kernel Interface</TH>
<TH class="docTableCell bottomBorder thead" style="TEXT-ALIGN: left" vAlign=top scope=col align=left>Location</TH>
<TH class="docTableCell bottomBorder thead" style="TEXT-ALIGN: left" vAlign=top scope=col align=left>Description</TH></TR></THEAD>
<TBODY>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_register()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>include/linux/usb.h</SPAN> <SPAN class=docEmphasis>drivers/usb/core/driver.c</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Registers a <TT>usb_driver</TT> with the USB core</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_deregister()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>drivers/usb/core/driver.c</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Unregisters a <TT>usb_driver</TT> from the USB core</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_set_intfdata()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>include/linux/usb.h</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Attaches device-specific data to a <TT>usb_interface</TT></TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_get_intfdata()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>include/linux/usb.h</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Detaches device-specific data from a <TT>usb_interface</TT></TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_register_dev()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>drivers/usb/core/file.c</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Associates a character interface with a USB client driver</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_deregister_dev()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>drivers/usb/core/file.c</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Dissociates a character interface from a USB client driver</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_alloc_urb()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>drivers/usb/core/urb.c</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Allocates a URB</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_fill_[control|int|bulk]_urb()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>include/linux/usb.h</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Populates a URB</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_[control|interrupt|bulk]_msg()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>drivers/usb/core/message.c</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Wrappers for synchronous URB submission</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_submit_urb()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>drivers/usb/core/urb.c</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Submits a URB to the USB core</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_free_urb()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>drivers/usb/core/urb.c</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Frees references to a completed URB</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_unlink_urb()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>drivers/usb/core/urb.c</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Frees references to a pending URB</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_[rcv|snd][ctrl|int|bulk|isoc]pipe()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>include/linux/usb.h</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Creates a USB pipe</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_find_interface()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>drivers/usb/core/usb.c</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Gets the <TT>usb_interface</TT> associated with a USB client driver</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_buffer_alloc()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>drivers/usb/core/usb.c</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Allocates a consistent DMA transfer buffer</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_buffer_free()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>drivers/usb/core/usb.c</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Frees a buffer that was allocated using <TT>usb_buffer_alloc()</TT></TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_serial_register()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>drivers/usb/serial/usb-serial.c</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Registers a driver with the USB-Serial core</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_serial_deregister()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>drivers/usb/serial/usb-serial.c</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Unregisters a driver from the USB-Serial core</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>usb_gadget_register_driver()</TT></TD>
<TD class=docTableCell vAlign=top align=left>Device controller drivers in <SPAN class=docEmphasis>drivers/usb/gadget/</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Registers a gadget with a device controller driver</TD></TR></TBODY></TABLE>