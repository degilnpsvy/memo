#/Documentation/serial/moxa-smartio.txt
<P></P>
<P>=============================================================================<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOXA Smartio/Industio Family Device Driver Installation Guide<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for Linux Kernel 2.4.x, 2.6.x<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Copyright (C) 2008, Moxa Inc.<BR>=============================================================================<BR>Date: 01/21/2008</P>
<P></P>
<P>Content</P>
<P>1. Introduction<BR>2. System Requirement<BR>3. Installation<BR>&nbsp;&nbsp; 3.1 Hardware installation<BR>&nbsp;&nbsp; 3.2 Driver files<BR>&nbsp;&nbsp; 3.3 Device naming convention<BR>&nbsp;&nbsp; 3.4 Module driver configuration<BR>&nbsp;&nbsp; 3.5 Static driver configuration for Linux kernel 2.4.x and 2.6.x.<BR>&nbsp;&nbsp; 3.6 Custom configuration<BR>&nbsp;&nbsp; 3.7 Verify driver installation<BR>4. Utilities<BR>5. Setserial<BR>6. Troubleshooting</P>
<P>-----------------------------------------------------------------------------<BR>1. Introduction</P>
<P>&nbsp;&nbsp; The Smartio/Industio/UPCI family Linux driver supports following multiport<BR>&nbsp;&nbsp; boards.</P>
<P>&nbsp;&nbsp;&nbsp; - 2 ports multiport board<BR>&nbsp;CP-102U, CP-102UL, CP-102UF<BR>&nbsp;CP-132U-I, CP-132UL,<BR>&nbsp;CP-132, CP-132I, CP132S, CP-132IS,<BR>&nbsp;CI-132, CI-132I, CI-132IS,<BR>&nbsp;(C102H, C102HI, C102HIS, C102P, CP-102, CP-102S)</P>
<P>&nbsp;&nbsp;&nbsp; - 4 ports multiport board<BR>&nbsp;CP-104EL,<BR>&nbsp;CP-104UL, CP-104JU,<BR>&nbsp;CP-134U, CP-134U-I,<BR>&nbsp;C104H/PCI, C104HS/PCI,<BR>&nbsp;CP-114, CP-114I, CP-114S, CP-114IS, CP-114UL,<BR>&nbsp;C104H, C104HS,<BR>&nbsp;CI-104J, CI-104JS,<BR>&nbsp;CI-134, CI-134I, CI-134IS,<BR>&nbsp;(C114HI, CT-114I, C104P)<BR>&nbsp;POS-104UL,<BR>&nbsp;CB-114,<BR>&nbsp;CB-134I</P>
<P>&nbsp;&nbsp;&nbsp; - 8 ports multiport board<BR>&nbsp;CP-118EL, CP-168EL,<BR>&nbsp;CP-118U, CP-168U,<BR>&nbsp;C168H/PCI,<BR>&nbsp;C168H, C168HS,<BR>&nbsp;(C168P),<BR>&nbsp;CB-108</P>
<P>&nbsp;&nbsp; This driver and installation procedure have been developed upon Linux Kernel<BR>&nbsp;&nbsp; 2.4.x and 2.6.x. This driver supports Intel x86 hardware platform. In order<BR>&nbsp;&nbsp; to maintain compatibility, this version has also been properly tested with<BR>&nbsp;&nbsp; RedHat, Mandrake, Fedora and S.u.S.E Linux. However, if compatibility problem<BR>&nbsp;&nbsp; occurs, please contact Moxa at <A href="mailto:support@moxa.com.tw">support@moxa.com.tw</A>.</P>
<P>&nbsp;&nbsp; In addition to device driver, useful utilities are also provided in this<BR>&nbsp;&nbsp; version. They are<BR>&nbsp;&nbsp;&nbsp; - msdiag&nbsp;&nbsp;&nbsp;&nbsp; Diagnostic program for displaying installed Moxa<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Smartio/Industio boards.<BR>&nbsp;&nbsp;&nbsp; - msmon&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Monitor program to observe data count and line status signals.<BR>&nbsp;&nbsp;&nbsp; - msterm&nbsp;&nbsp;&nbsp;&nbsp; A simple terminal program which is useful in testing serial<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ports.<BR>&nbsp;&nbsp;&nbsp; - io-irq.exe Configuration program to setup ISA boards. Please note that<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this program can only be executed under DOS.</P>
<P>&nbsp;&nbsp; All the drivers and utilities are published in form of source code under<BR>&nbsp;&nbsp; GNU General Public License in this version. Please refer to GNU General<BR>&nbsp;&nbsp; Public License announcement in each source code file for more detail.</P>
<P>&nbsp;&nbsp; In Moxa's Web sites, you may always find latest driver at <A href="http://www.moxa.com/">http://www.moxa.com/</A>.</P>
<P>&nbsp;&nbsp; This version of driver can be installed as Loadable Module (Module driver)<BR>&nbsp;&nbsp; or built-in into kernel (Static driver). You may refer to following<BR>&nbsp;&nbsp; installation procedure for suitable one. Before you install the driver,<BR>&nbsp;&nbsp; please refer to hardware installation procedure in the User's Manual.</P>
<P>&nbsp;&nbsp; We assume the user should be familiar with following documents.<BR>&nbsp;&nbsp; - Serial-HOWTO<BR>&nbsp;&nbsp; - Kernel-HOWTO</P>
<P>-----------------------------------------------------------------------------<BR>2. System Requirement<BR>&nbsp;&nbsp; - Hardware platform: Intel x86 machine<BR>&nbsp;&nbsp; - Kernel version: 2.4.x or 2.6.x<BR>&nbsp;&nbsp; - gcc version 2.72 or later<BR>&nbsp;&nbsp; - Maximum 4 boards can be installed in combination</P>
<P>-----------------------------------------------------------------------------<BR>3. Installation</P>
<P>&nbsp;&nbsp; 3.1 Hardware installation<BR>&nbsp;&nbsp; 3.2 Driver files<BR>&nbsp;&nbsp; 3.3 Device naming convention<BR>&nbsp;&nbsp; 3.4 Module driver configuration<BR>&nbsp;&nbsp; 3.5 Static driver configuration for Linux kernel 2.4.x, 2.6.x.<BR>&nbsp;&nbsp; 3.6 Custom configuration<BR>&nbsp;&nbsp; 3.7 Verify driver installation</P>
<P><BR>&nbsp;&nbsp; 3.1 Hardware installation</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; There are two types of buses, ISA and PCI, for Smartio/Industio<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; family multiport board.</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ISA board<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ---------<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; You'll have to configure CAP address, I/O address, Interrupt Vector<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; as well as IRQ before installing this driver. Please refer to hardware<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; installation procedure in User's Manual before proceed any further.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Please make sure the JP1 is open after the ISA board is set properly.</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PCI/UPCI board<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --------------<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; You may need to adjust IRQ usage in BIOS to avoid from IRQ conflict<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; with other ISA devices. Please refer to hardware installation<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; procedure in User's Manual in advance.</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PCI IRQ Sharing<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -----------<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Each port within the same multiport board shares the same IRQ. Up to<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 Moxa Smartio/Industio PCI Family multiport boards can be installed<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; together on one system and they can share the same IRQ.</P>
<P><BR>&nbsp;&nbsp; 3.2 Driver files</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The driver file may be obtained from ftp, CD-ROM or floppy disk. The<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; first step, anyway, is to copy driver file "mxser.tgz" into specified<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; directory. e.g. /moxa. The execute commands as below.</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # cd /<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # mkdir moxa<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # cd /moxa<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # tar xvf /dev/fd0</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; or</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # cd /<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # mkdir moxa<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # cd /moxa<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # cp /mnt/cdrom/&lt;driver directory&gt;/mxser.tgz .<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # tar xvfz mxser.tgz</P>
<P><BR>&nbsp;&nbsp; 3.3 Device naming convention</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; You may find all the driver and utilities files in /moxa/mxser.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Following installation procedure depends on the model you'd like to<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; run the driver. If you prefer module driver, please refer to 3.4.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If static driver is required, please refer to 3.5.</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dialin and callout port<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -----------------------<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; This driver remains traditional serial device properties. There are<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; two special file name for each serial port. One is dial-in port<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; which is named "ttyMxx". For callout port, the naming convention<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; is "cumxx".</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Device naming when more than 2 boards installed<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -----------------------------------------------<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Naming convention for each Smartio/Industio multiport board is<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pre-defined as below.</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Board Num.&nbsp; Dial-in Port&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Callout port<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1st board&nbsp;ttyM0&nbsp; - ttyM7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cum0&nbsp; - cum7<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2nd board&nbsp;ttyM8&nbsp; - ttyM15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cum8&nbsp; - cum15<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3rd board&nbsp;ttyM16 - ttyM23&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cum16 - cum23<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4th board&nbsp;ttyM24 - ttym31&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cum24 - cum31</P>
<P><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; !!!!!!!!!!!!!!!!!!!! NOTE !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Under Kernel 2.6 the cum Device is Obsolete. So use ttyM*<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; device instead.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; !!!!!!!!!!!!!!!!!!!! NOTE !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Board sequence<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --------------<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; This driver will activate ISA boards according to the parameter set<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in the driver. After all specified ISA board activated, PCI board<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; will be installed in the system automatically driven.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Therefore the board number is sorted by the CAP address of ISA boards.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For PCI boards, their sequence will be after ISA boards and C168H/PCI<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; has higher priority than C104H/PCI boards.</P>
<P>&nbsp;&nbsp; 3.4 Module driver configuration<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Module driver is easiest way to install. If you prefer static driver<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; installation, please skip this paragraph.</P>
<P><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ------------- Prepare to use the MOXA driver--------------------<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.4.1 Create tty device with correct major number<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Before using MOXA driver, your system must have the tty devices<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; which are created with driver's major number. We offer one shell<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; script "msmknod" to simplify the procedure.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; This step is only needed to be executed once. But you still<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; need to do this procedure when:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a. You change the driver's major number. Please refer the "3.7"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; section.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; b. Your total installed MOXA boards number is changed. Maybe you<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; add/delete one MOXA board.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; c. You want to change the tty name. This needs to modify the<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; shell script "msmknod"</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The procedure is:<BR>&nbsp;&nbsp; # cd /moxa/mxser/driver<BR>&nbsp;&nbsp; # ./msmknod</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; This shell script will require the major number for dial-in<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; device and callout device to create tty device. You also need<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; to specify the total installed MOXA board number. Default major<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; numbers for dial-in device and callout device are 30, 35. If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; you need to change to other number, please refer section "3.7"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for more detailed procedure.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Msmknod will delete any special files occupying the same device<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; naming.</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.4.2 Build the MOXA driver and utilities<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Before using the MOXA driver and utilities, you need compile the<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; all the source code. This step is only need to be executed once.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; But you still re-compile the source code if you modify the source<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; code. For example, if you change the driver's major number (see<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "3.7" section), then you need to do this step again.</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Find "Makefile" in /moxa/mxser, then run</P>
<P>&nbsp;&nbsp; # make clean; make install</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; !!!!!!!!!! NOTE !!!!!!!!!!!!!!!!!<BR>&nbsp;&nbsp; For Red Hat 9, Red Hat Enterprise Linux AS3/ES3/WS3 &amp; Fedora Core1:<BR>&nbsp;&nbsp; # make clean; make installsp1</P>
<P>&nbsp;&nbsp; For Red Hat Enterprise Linux AS4/ES4/WS4:<BR>&nbsp;&nbsp; # make clean; make installsp2<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; !!!!!!!!!! NOTE !!!!!!!!!!!!!!!!!</P>
<P>&nbsp;&nbsp; The driver files "mxser.o" and utilities will be properly compiled<BR>&nbsp;&nbsp; and copied to system directories respectively.</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ------------- Load MOXA driver--------------------<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.4.3 Load the MOXA driver</P>
<P>&nbsp;&nbsp; # modprobe mxser &lt;argument&gt;</P>
<P>&nbsp;&nbsp; will activate the module driver. You may run "lsmod" to check<BR>&nbsp;&nbsp; if "mxser" is activated. If the MOXA board is ISA board, the<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;argument&gt; is needed. Please refer to section "3.4.5" for more<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; information.</P>
<P><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ------------- Load MOXA driver on boot --------------------<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.4.4 For the above description, you may manually execute<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "modprobe mxser" to activate this driver and run<BR>&nbsp;&nbsp; "rmmod mxser" to remove it.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; However, it's better to have a boot time configuration to<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eliminate manual operation. Boot time configuration can be<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; achieved by rc file. We offer one "rc.mxser" file to simplify<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; the procedure under "moxa/mxser/driver".</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; But if you use ISA board, please modify the "modprobe ..." command<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; to add the argument (see "3.4.5" section). After modifying the<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rc.mxser, please try to execute "/moxa/mxser/driver/rc.mxser"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; manually to make sure the modification is ok. If any error<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; encountered, please try to modify again. If the modification is<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; completed, follow the below step.</P>
<P>&nbsp;&nbsp; Run following command for setting rc files.</P>
<P>&nbsp;&nbsp; # cd /moxa/mxser/driver<BR>&nbsp;&nbsp; # cp ./rc.mxser /etc/rc.d<BR>&nbsp;&nbsp; # cd /etc/rc.d</P>
<P>&nbsp;&nbsp; Check "rc.serial" is existed or not. If "rc.serial" doesn't exist,<BR>&nbsp;&nbsp; create it by vi, run "chmod 755 rc.serial" to change the permission.<BR>&nbsp;&nbsp; Add "/etc/rc.d/rc.mxser" in last line,</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Reboot and check if moxa.o activated by "lsmod" command.</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.4.5. If you'd like to drive Smartio/Industio ISA boards in the system,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; you'll have to add parameter to specify CAP address of given<BR>&nbsp;&nbsp; board while activating "mxser.o". The format for parameters are<BR>&nbsp;&nbsp; as follows.</P>
<P>&nbsp;&nbsp; modprobe mxser ioaddr=0x???,0x???,0x???,0x???<BR>&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; |<BR>&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; +- 4th ISA board<BR>&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; +------ 3rd ISA board<BR>&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +------------ 2nd ISA board<BR>&nbsp;&nbsp;&nbsp;&nbsp;+------------------- 1st ISA board</P>
<P>&nbsp;&nbsp; 3.5 Static driver configuration for Linux kernel 2.4.x and 2.6.x</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Note: To use static driver, you must install the linux kernel<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; source package.</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.5.1 Backup the built-in driver in the kernel.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # cd /usr/src/linux/drivers/char<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # mv mxser.c mxser.c.old</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For Red Hat 7.x user, you need to create link:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # cd /usr/src<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # ln -s linux-2.4 linux</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.5.2 Create link<BR>&nbsp;&nbsp; # cd /usr/src/linux/drivers/char<BR>&nbsp;&nbsp; # ln -s /moxa/mxser/driver/mxser.c mxser.c</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.5.3 Add CAP address list for ISA boards. For PCI boards user,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; please skip this step.</P>
<P>&nbsp;&nbsp; In module mode, the CAP address for ISA board is given by<BR>&nbsp;&nbsp; parameter. In static driver configuration, you'll have to<BR>&nbsp;&nbsp; assign it within driver's source code. If you will not<BR>&nbsp;&nbsp; install any ISA boards, you may skip to next portion.<BR>&nbsp;&nbsp; The instructions to modify driver source code are as<BR>&nbsp;&nbsp; below.<BR>&nbsp;&nbsp; a. # cd /moxa/mxser/driver<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # vi mxser.c<BR>&nbsp;&nbsp; b. Find the array mxserBoardCAP[] as below.</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; static int mxserBoardCAP[]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = {0x00, 0x00, 0x00, 0x00};</P>
<P>&nbsp;&nbsp; c. Change the address within this array using vi. For<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; example, to driver 2 ISA boards with CAP address<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x280 and 0x180 as 1st and 2nd board. Just to change<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; the source code as follows.</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; static int mxserBoardCAP[]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = {0x280, 0x180, 0x00, 0x00};</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.5.4 Setup kernel configuration</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Configure the kernel:</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # cd /usr/src/linux<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # make menuconfig</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; You will go into a menu-driven system. Please select [Character<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; devices][Non-standard serial port support], enable the [Moxa<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartIO support] driver with "[*]" for built-in (not "[M]"), then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select [Exit] to exit this program.</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.5.5 Rebuild kernel<BR>&nbsp;&nbsp; The following are for Linux kernel rebuilding, for your<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reference only.<BR>&nbsp;&nbsp; For appropriate details, please refer to the Linux document.</P>
<P>&nbsp;&nbsp;&nbsp; a. cd /usr/src/linux<BR>&nbsp;&nbsp;&nbsp; b. make clean&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* take a few minutes */<BR>&nbsp;&nbsp;&nbsp; c. make dep&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* take a few minutes */<BR>&nbsp;&nbsp;&nbsp; d. make bzImage&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* take probably 10-20 minutes */<BR>&nbsp;&nbsp;&nbsp; e. make install&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* copy boot image to correct position */<BR>&nbsp;&nbsp;&nbsp; f. Please make sure the boot kernel (vmlinuz) is in the<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; correct position.<BR>&nbsp;&nbsp;&nbsp; g. If you use 'lilo' utility, you should check /etc/lilo.conf<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'image' item specified the path which is the 'vmlinuz' path,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; or you will load wrong (or old) boot kernel image (vmlinuz).<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; After checking /etc/lilo.conf, please run "lilo".</P>
<P>&nbsp;&nbsp; Note that if the result of "make bzImage" is ERROR, then you have to<BR>&nbsp;&nbsp; go back to Linux configuration Setup. Type "make menuconfig" in<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; directory /usr/src/linux.</P>
<P><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.5.6 Make tty device and special file<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # cd /moxa/mxser/driver<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # ./msmknod</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.5.7 Make utility<BR>&nbsp;&nbsp; # cd /moxa/mxser/utility<BR>&nbsp;&nbsp; # make clean; make install</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.5.8 Reboot</P>
<P>&nbsp;</P>
<P>&nbsp;&nbsp; 3.6 Custom configuration<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Although this driver already provides you default configuration, you<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; still can change the device name and major number. The instruction to<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; change these parameters are shown as below.</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Change Device name<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ------------------<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If you'd like to use other device names instead of default naming<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; convention, all you have to do is to modify the internal code<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; within the shell script "msmknod". First, you have to open "msmknod"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; by vi. Locate each line contains "ttyM" and "cum" and change them<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; to the device name you desired. "msmknod" creates the device names<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; you need next time executed.</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Change Major number<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -------------------<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If major number 30 and 35 had been occupied, you may have to select<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 free major numbers for this driver. There are 3 steps to change<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; major numbers.</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.6.1 Find free major numbers<BR>&nbsp;&nbsp; In /proc/devices, you may find all the major numbers occupied<BR>&nbsp;&nbsp; in the system. Please select 2 major numbers that are available.<BR>&nbsp;&nbsp; e.g. 40, 45.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.6.2 Create special files<BR>&nbsp;&nbsp; Run /moxa/mxser/driver/msmknod to create special files with<BR>&nbsp;&nbsp; specified major numbers.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.6.3 Modify driver with new major number<BR>&nbsp;&nbsp; Run vi to open /moxa/mxser/driver/mxser.c. Locate the line<BR>&nbsp;&nbsp; contains "MXSERMAJOR". Change the content as below.<BR>&nbsp;&nbsp; #define&nbsp;&nbsp; MXSERMAJOR&nbsp;&nbsp;&nbsp; 40<BR>&nbsp;&nbsp; #define&nbsp;&nbsp; MXSERCUMAJOR&nbsp;&nbsp;&nbsp; 45<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.6.4 Run "make clean; make install" in /moxa/mxser/driver.</P>
<P>&nbsp;&nbsp; 3.7 Verify driver installation<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; You may refer to /var/log/messages to check the latest status<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log reported by this driver whenever it's activated.</P>
<P>-----------------------------------------------------------------------------<BR>4. Utilities<BR>&nbsp;&nbsp; There are 3 utilities contained in this driver. They are msdiag, msmon and<BR>&nbsp;&nbsp; msterm. These 3 utilities are released in form of source code. They should<BR>&nbsp;&nbsp; be compiled into executable file and copied into /usr/bin.</P>
<P>&nbsp;&nbsp; Before using these utilities, please load driver (refer 3.4 &amp; 3.5) and<BR>&nbsp;&nbsp; make sure you had run the "msmknod" utility.</P>
<P>&nbsp;&nbsp; msdiag - Diagnostic<BR>&nbsp;&nbsp; --------------------<BR>&nbsp;&nbsp; This utility provides the function to display what Moxa Smartio/Industio<BR>&nbsp;&nbsp; board found by driver in the system.</P>
<P>&nbsp;&nbsp; msmon - Port Monitoring<BR>&nbsp;&nbsp; -----------------------<BR>&nbsp;&nbsp; This utility gives the user a quick view about all the MOXA ports'<BR>&nbsp;&nbsp; activities. One can easily learn each port's total received/transmitted<BR>&nbsp;&nbsp; (Rx/Tx) character count since the time when the monitoring is started.<BR>&nbsp;&nbsp; Rx/Tx throughputs per second are also reported in interval basis (e.g.<BR>&nbsp;&nbsp; the last 5 seconds) and in average basis (since the time the monitoring<BR>&nbsp;&nbsp; is started). You can reset all ports' count by &lt;HOME&gt; key. &lt;+&gt; &lt;-&gt;<BR>&nbsp;&nbsp; (plus/minus) keys to change the displaying time interval. Press &lt;ENTER&gt;<BR>&nbsp;&nbsp; on the port, that cursor stay, to view the port's communication<BR>&nbsp;&nbsp; parameters, signal status, and input/output queue.</P>
<P>&nbsp;&nbsp; msterm - Terminal Emulation<BR>&nbsp;&nbsp; ---------------------------<BR>&nbsp;&nbsp; This utility provides data sending and receiving ability of all tty ports,<BR>&nbsp;&nbsp; especially for MOXA ports. It is quite useful for testing simple<BR>&nbsp;&nbsp; application, for example, sending AT command to a modem connected to the<BR>&nbsp;&nbsp; port or used as a terminal for login purpose. Note that this is only a<BR>&nbsp;&nbsp; dumb terminal emulation without handling full screen operation.</P>
<P>-----------------------------------------------------------------------------<BR>5. Setserial</P>
<P>&nbsp;&nbsp; Supported Setserial parameters are listed as below.</P>
<P>&nbsp;&nbsp; uart&nbsp;&nbsp;&nbsp; set UART type(16450--&gt;disable FIFO, 16550A--&gt;enable FIFO)<BR>&nbsp;&nbsp; close_delay&nbsp;&nbsp; set the amount of time(in 1/100 of a second) that DTR<BR>&nbsp;&nbsp;&nbsp; should be kept low while being closed.<BR>&nbsp;&nbsp; closing_wait&nbsp;&nbsp; set the amount of time(in 1/100 of a second) that the<BR>&nbsp;&nbsp;&nbsp; serial port should wait for data to be drained while<BR>&nbsp;&nbsp;&nbsp; being closed, before the receiver is disable.<BR>&nbsp;&nbsp; spd_hi&nbsp;&nbsp; Use&nbsp; 57.6kb&nbsp; when&nbsp; the application requests 38.4kb.<BR>&nbsp;&nbsp; spd_vhi&nbsp;&nbsp; Use&nbsp; 115.2kb&nbsp;when&nbsp; the application requests 38.4kb.<BR>&nbsp;&nbsp; spd_shi&nbsp;&nbsp; Use&nbsp; 230.4kb&nbsp;when&nbsp; the application requests 38.4kb.<BR>&nbsp;&nbsp; spd_warp&nbsp;&nbsp; Use&nbsp; 460.8kb&nbsp;when&nbsp; the application requests 38.4kb.<BR>&nbsp;&nbsp; spd_normal&nbsp;&nbsp; Use&nbsp; 38.4kb&nbsp; when&nbsp; the application requests 38.4kb.<BR>&nbsp;&nbsp; spd_cust&nbsp;&nbsp; Use&nbsp; the custom divisor to set the speed when&nbsp; the<BR>&nbsp;&nbsp;&nbsp; application requests 38.4kb.<BR>&nbsp;&nbsp; divisor&nbsp;&nbsp; This option set the custom division.<BR>&nbsp;&nbsp; baud_base&nbsp;&nbsp; This option set the base baud rate.</P>
<P>-----------------------------------------------------------------------------<BR>6. Troubleshooting</P>
<P>&nbsp;&nbsp; The boot time error messages and solutions are stated as clearly as<BR>&nbsp;&nbsp; possible. If all the possible solutions fail, please contact our technical<BR>&nbsp;&nbsp; support team to get more help.</P>
<P><BR>&nbsp;&nbsp; Error msg: More than 4 Moxa Smartio/Industio family boards found. Fifth board<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; and after are ignored.<BR>&nbsp;&nbsp; Solution:<BR>&nbsp;&nbsp; To avoid this problem, please unplug fifth and after board, because Moxa<BR>&nbsp;&nbsp; driver supports up to 4 boards.</P>
<P>&nbsp;&nbsp; Error msg: Request_irq fail, IRQ(?) may be conflict with another device.<BR>&nbsp;&nbsp; Solution:<BR>&nbsp;&nbsp; Other PCI or ISA devices occupy the assigned IRQ. If you are not sure<BR>&nbsp;&nbsp; which device causes the situation, please check /proc/interrupts to find<BR>&nbsp;&nbsp; free IRQ and simply change another free IRQ for Moxa board.</P>
<P>&nbsp;&nbsp; Error msg: Board #: C1xx Series(CAP=xxx) interrupt number invalid.<BR>&nbsp;&nbsp; Solution:<BR>&nbsp;&nbsp; Each port within the same multiport board shares the same IRQ. Please set<BR>&nbsp;&nbsp; one IRQ (IRQ doesn't equal to zero) for one Moxa board.</P>
<P>&nbsp;&nbsp; Error msg: No interrupt vector be set for Moxa ISA board(CAP=xxx).<BR>&nbsp;&nbsp; Solution:<BR>&nbsp;&nbsp; Moxa ISA board needs an interrupt vector.Please refer to user's manual<BR>&nbsp;&nbsp; "Hardware Installation" chapter to set interrupt vector.</P>
<P>&nbsp;&nbsp; Error msg: Couldn't install MOXA Smartio/Industio family driver!<BR>&nbsp;&nbsp; Solution:<BR>&nbsp;&nbsp; Load Moxa driver fail, the major number may conflict with other devices.<BR>&nbsp;&nbsp; Please refer to previous section 3.7 to change a free major number for<BR>&nbsp;&nbsp; Moxa driver.</P>
<P>&nbsp;&nbsp; Error msg: Couldn't install MOXA Smartio/Industio family callout driver!<BR>&nbsp;&nbsp; Solution:<BR>&nbsp;&nbsp; Load Moxa callout driver fail, the callout device major number may<BR>&nbsp;&nbsp; conflict with other devices. Please refer to previous section 3.7 to<BR>&nbsp;&nbsp; change a free callout device major number for Moxa driver.</P>
<P><BR>-----------------------------------------------------------------------------</P>
<P>&nbsp;