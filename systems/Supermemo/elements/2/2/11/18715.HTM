<H3 style="LINE-HEIGHT: normal; TEXT-TRANSFORM: none; FONT-VARIANT: normal; FONT-STYLE: normal; TEXT-INDENT: 0px; FONT-FAMILY: Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px" class=section>11.2 Interoperation</H3>
<P style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">This section lists various difficulties encountered in using GCC together with other compilers or with the assemblers, linkers, libraries and debuggers on certain systems.</P>
<UL style="TEXT-TRANSFORM: none; TEXT-INDENT: 0px; FONT: medium Simsun; WHITE-SPACE: normal; LETTER-SPACING: normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; -webkit-text-stroke-width: 0px">
<LI>On many platforms, GCC supports a different ABI for C++ than do other compilers, so the object files compiled by GCC cannot be used with object files generated by another C++ compiler.
<P>An area where the difference is most apparent is name mangling. The use of different name mangling is intentional, to protect you from more subtle problems. Compilers differ as to many internal details of C++ implementation, including: how class instances are laid out, how multiple inheritance is implemented, and how virtual function calls are handled. If the name encoding were made the same, your programs would link against libraries provided from other compilers&#8212;but the programs would then crash when run. Incompatible libraries are then detected at link time, rather than at run time.</P></LI>
<LI>On some BSD systems, including some versions of Ultrix, use of profiling causes static variable destructors (currently used only in C++) not to be run.</LI>
<LI>On a SPARC, GCC aligns all values of type<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>double</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>on an 8-byte boundary, and it expects every<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>double</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>to be so aligned. The Sun compiler usually gives<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>double</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>values 8-byte alignment, with one exception: function arguments of type<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>double</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>may not be aligned.
<P>As a result, if a function compiled with Sun CC takes the address of an argument of type<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>double</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>and passes this pointer of type<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>double *</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>to a function compiled with GCC, dereferencing the pointer may cause a fatal signal.</P>
<P>One way to solve this problem is to compile your entire program with GCC. Another solution is to modify the function that is compiled with Sun CC to copy the argument into a local variable; local variables are always properly aligned. A third solution is to modify the function that uses the pointer to dereference it via the following function<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>access_double</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>instead of directly with &#8216;<SAMP><SPAN class=samp>*</SPAN></SAMP>&#8217;:</P><PRE style="FONT-SIZE: smaller" class=smallexample>          inline double
          access_double (double *unaligned_ptr)
          {
            union d2i { double d; int i[2]; };
          
            union d2i *p = (union d2i *) unaligned_ptr;
            union d2i u;
          
            u.i[0] = p-&gt;i[0];
            u.i[1] = p-&gt;i[1];
          
            return u.d;
          }
</PRE>
<P class=noindent>Storing into the pointer can be done likewise with the same union.</P></LI>
<LI>On Solaris, the<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>malloc</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>function in the<SPAN class=Apple-converted-space>&nbsp;</SPAN><SAMP><SPAN class=file>libmalloc.a</SPAN></SAMP><SPAN class=Apple-converted-space>&nbsp;</SPAN>library may allocate memory that is only 4 byte aligned. Since GCC on the SPARC assumes that doubles are 8 byte aligned, this may result in a fatal signal if doubles are stored in memory allocated by the<SPAN class=Apple-converted-space>&nbsp;</SPAN><SAMP><SPAN class=file>libmalloc.a</SPAN></SAMP><SPAN class=Apple-converted-space>&nbsp;</SPAN>library.
<P>The solution is to not use the<SPAN class=Apple-converted-space>&nbsp;</SPAN><SAMP><SPAN class=file>libmalloc.a</SPAN></SAMP><SPAN class=Apple-converted-space>&nbsp;</SPAN>library. Use instead<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE>malloc</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>and related functions from<SPAN class=Apple-converted-space>&nbsp;</SPAN><SAMP><SPAN class=file>libc.a</SPAN></SAMP>; they do not have this problem.</P></LI>
<LI>On the HP PA machine, ADB sometimes fails to work on functions compiled with GCC. Specifically, it fails to work on functions that use<CODE>alloca</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>or variable-size arrays. This is because GCC doesn't generate HP-UX unwind descriptors for such functions. It may even be impossible to generate them.</LI>
<LI>Debugging (<SAMP><SPAN class=option>-g</SPAN></SAMP>) is not supported on the HP PA machine, unless you use the preliminary GNU tools.</LI>
<LI>Taking the address of a label may generate errors from the HP-UX PA assembler. GAS for the PA does not have this problem.</LI>
<LI>Using floating point parameters for indirect calls to static functions will not work when using the HP assembler. There simply is no way for GCC to specify what registers hold arguments for static functions when using the HP assembler. GAS for the PA does not have this problem.</LI>
<LI>In extremely rare cases involving some very large functions you may receive errors from the HP linker complaining about an out of bounds unconditional branch offset. This used to occur more often in previous versions of GCC, but is now exceptionally rare. If you should run into it, you can work around by making your function smaller.</LI>
<LI>GCC compiled code sometimes emits warnings from the HP-UX assembler of the form:<PRE style="FONT-SIZE: smaller" class=smallexample>          (warning) Use of GR3 when
            frame &gt;= 8192 may cause conflict.
</PRE>
<P>These warnings are harmless and can be safely ignored.</P></LI>
<LI>In extremely rare cases involving some very large functions you may receive errors from the AIX Assembler complaining about a displacement that is too large. If you should run into it, you can work around by making your function smaller.</LI>
<LI>The<SPAN class=Apple-converted-space>&nbsp;</SPAN><SAMP><SPAN class=file>libstdc++.a</SPAN></SAMP><SPAN class=Apple-converted-space>&nbsp;</SPAN>library in GCC relies on the SVR4 dynamic linker semantics which merges global symbols between libraries and applications, especially necessary for C++ streams functionality. This is not the default behavior of AIX shared libraries and dynamic linking.<SPAN class=Apple-converted-space>&nbsp;</SPAN><SAMP><SPAN class=file>libstdc++.a</SPAN></SAMP>is built on AIX with &#8220;runtime-linking&#8221; enabled so that symbol merging can occur. To utilize this feature, the application linked with<SAMP><SPAN class=file>libstdc++.a</SPAN></SAMP><SPAN class=Apple-converted-space>&nbsp;</SPAN>must include the<SPAN class=Apple-converted-space>&nbsp;</SPAN><SAMP><SPAN class=option>-Wl,-brtl</SPAN></SAMP><SPAN class=Apple-converted-space>&nbsp;</SPAN>flag on the link line. G++ cannot impose this because this option may interfere with the semantics of the user program and users may not always use &#8216;<SAMP><SPAN class=samp>g++</SPAN></SAMP>&#8217; to link his or her application. Applications are not required to use the<SPAN class=Apple-converted-space>&nbsp;</SPAN><SAMP><SPAN class=option>-Wl,-brtl</SPAN></SAMP><SPAN class=Apple-converted-space>&nbsp;</SPAN>flag on the link line&#8212;the rest of the<SPAN class=Apple-converted-space>&nbsp;</SPAN><SAMP><SPAN class=file>libstdc++.a</SPAN></SAMP><SPAN class=Apple-converted-space>&nbsp;</SPAN>library which is not dependent on the symbol merging semantics will continue to function correctly.</LI>
<LI>An application can interpose its own definition of functions for functions invoked by<SPAN class=Apple-converted-space>&nbsp;</SPAN><SAMP><SPAN class=file>libstdc++.a</SPAN></SAMP><SPAN class=Apple-converted-space>&nbsp;</SPAN>with &#8220;runtime-linking&#8221; enabled on AIX. To accomplish this the application must be linked with &#8220;runtime-linking&#8221; option and the functions explicitly must be exported by the application (<SAMP><SPAN class=option>-Wl,-brtl,-bE:exportfile</SPAN></SAMP>).</LI>
<LI>AIX on the RS/6000 provides support (NLS) for environments outside of the United States. Compilers and assemblers use NLS to support locale-specific representations of various objects including floating-point numbers (&#8216;<SAMP><SPAN class=samp>.</SPAN></SAMP>&#8217; vs &#8216;<SAMP><SPAN class=samp>,</SPAN></SAMP>&#8217; for separating decimal fractions). There have been problems reported where the library linked with GCC does not produce the same floating-point formats that the assembler accepts. If you have this problem, set the<SPAN class=Apple-converted-space>&nbsp;</SPAN><SAMP><SPAN class=env>LANG</SPAN></SAMP><SPAN class=Apple-converted-space>&nbsp;</SPAN>environment variable to &#8216;<SAMP><SPAN class=samp>C</SPAN></SAMP>&#8217; or &#8216;<SAMP><SPAN class=samp>En_US</SPAN></SAMP>&#8217;.</LI>
<LI><A name=index-fdollars-in-identifiers-3835></A>Even if you specify<SPAN class=Apple-converted-space>&nbsp;</SPAN><SAMP><SPAN class=option>-fdollars-in-identifiers</SPAN></SAMP>, you cannot successfully use &#8216;<SAMP><SPAN class=samp>$</SPAN></SAMP>&#8217; in identifiers on the RS/6000 due to a restriction in the IBM assembler. GAS supports these identifiers.</LI></UL>