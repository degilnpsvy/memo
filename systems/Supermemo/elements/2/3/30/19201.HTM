<HEAD></HEAD>
<BODY>
<H1 style="BACKGROUND: #000044; TEXT-ALIGN: center; MARGIN: 15pt 0cm 7.5pt" align=center><SPAN lang=EN-US style="FONT-FAMILY: 'Courier New'; COLOR: white">Optimized Surface Loading and Soft Stretching</SPAN></H1>
<P class=MsoNormal style="BACKGROUND: #000044; TEXT-ALIGN: center; MARGIN: 0cm 0cm 0pt" align=center><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #aaaaaa; mso-no-proof: yes"><?xml:namespace prefix = "v" /><v:shapetype id=_x0000_t75 coordsize="21600,21600" o:spt="75" o:preferrelative="t" path="m@4@5l@4@11@9@11@9@5xe" filled="f" stroked="f"><v:stroke joinstyle="miter"></v:stroke><v:formulas><v:f eqn="if lineDrawn pixelLineWidth 0"></v:f><v:f eqn="sum @0 1 0"></v:f><v:f eqn="sum 0 0 @1"></v:f><v:f eqn="prod @2 1 2"></v:f><v:f eqn="prod @3 21600 pixelWidth"></v:f><v:f eqn="prod @3 21600 pixelHeight"></v:f><v:f eqn="sum @0 0 1"></v:f><v:f eqn="prod @6 1 2"></v:f><v:f eqn="prod @7 21600 pixelWidth"></v:f><v:f eqn="sum @8 21600 0"></v:f><v:f eqn="prod @7 21600 pixelHeight"></v:f><v:f eqn="sum @10 21600 0"></v:f></v:formulas><v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"></v:path><?xml:namespace prefix = "o" /><o:lock v:ext="edit" aspectratio="t"></o:lock></v:shapetype><IMG style="WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; COLOR: rgb(170,170,170); TEXT-ALIGN: center; FONT: medium monospace; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(0,0,68); TEXT-INDENT: 0px; -webkit-text-stroke-width: 0px" src="http://lazyfoo.net/tutorials/SDL/05_optimized_surface_loading_and_soft_stretching/preview.png"></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; TEXT-ALIGN: center; MARGIN: 0cm 0cm 0pt" align=center><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #aaaaaa; mso-no-proof: yes"></SPAN><FONT size=3><SPAN lang=EN-US style="FONT-FAMILY: 'Courier New'; COLOR: white">Last Updated 7/13/14</SPAN><SPAN lang=EN-US style="FONT-SIZE: 7.5pt; FONT-FAMILY: 'Courier New'; COLOR: white; LINE-HEIGHT: 133%"></SPAN></FONT></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #aaaaaa"><FONT class=extract>Up until now we've been blitting our images raw. Since we were only showing one image, it didn't matter. When you're making a game, blitting images raw causes needless slow down. We'll be converting them to an optimized format to speed them up.<BR></FONT><BR><FONT class=extract>SDL 2 also has a new feature for SDL surfaces called soft stretching, which allows you to blit an image scaled to a different size. In this tutorial we'll take an image half the size of the screen and stretch it to the full size.</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract>SDL_Surface* loadSurface( std::string path )</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract>{</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 1">&nbsp;&nbsp; </SPAN>//The final optimized image</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 1">&nbsp;&nbsp; </SPAN>SDL_Surface* optimizedSurface = NULL;</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract>&nbsp;</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 1">&nbsp;&nbsp; </SPAN>//Load image at specified path</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 1">&nbsp;&nbsp; </SPAN>SDL_Surface* loadedSurface = SDL_LoadBMP( path.c_str() );</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 1">&nbsp;&nbsp; </SPAN>if( loadedSurface == NULL )</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 1">&nbsp;&nbsp; </SPAN>{</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>printf( "Unable to load image %s! SDL Error: %s\n", path.c_str(), SDL_GetError() );</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 1">&nbsp;&nbsp; </SPAN>}</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000022; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #aaaaaa"><FONT class=extract>Back in our image loading function, we're going to make some modifications so the surface is converted on load. At the top of the function we pretty much</FONT><A href="http://lazyfoo.net/tutorials/SDL/04_key_presses/index.php"><SPAN style="COLOR: #8888ff"><FONT class=extract>load images like we did in previous tutorials</FONT></SPAN></A><FONT class=extract>, but we also declare a pointer to the final optimized image.</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 1">&nbsp;&nbsp; </SPAN>else</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 1">&nbsp;&nbsp; </SPAN>{</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>//Convert surface to screen format</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>optimizedSurface = SDL_ConvertSurface( loadedSurface, gScreenSurface-&gt;format, NULL );</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>if( optimizedSurface == NULL )</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>{</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>printf( "Unable to optimize image %s! SDL Error: %s\n", path.c_str(), SDL_GetError() );</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>}</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract>&nbsp;</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>//Get rid of old loaded surface</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>SDL_FreeSurface( loadedSurface );</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 1">&nbsp;&nbsp; </SPAN>}</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract>&nbsp;</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 1">&nbsp;&nbsp; </SPAN>return optimizedSurface;</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract>}</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000022; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #aaaaaa"><FONT class=extract>If the image loaded successfully in the previous lines of code, we optimize the surface we loaded.<BR></FONT><BR>See when you load a bitmap, it's typically loaded in a 24bit format since most bitmaps are 24bit. Most, if not all, modern displays are not 24bit by default. If we blit an image that's 24bit onto a 32bit image, SDL will convert it every single time the image is blitted.<SPAN class=apple-converted-space>&nbsp;</SPAN><BR><BR>So what we're going to do when an image is loaded is convert it to the same format as the screen so no conversion needs to be done on blit. This can be done easily with<SPAN class=apple-converted-space>&nbsp;</SPAN><A href="http://wiki.libsdl.org/SDL_ConvertSurface"><SPAN style="COLOR: #8888ff">SDL_ConvertSurface</SPAN></A>. All we have to do is pass in the surface want to convert with the format of the screen.<BR><BR>It's important to note that SDL_ConvertSurface returns a copy of the original in a new format. The original loaded image is still in memory after this call. This means we have to free the original loaded surface or we'll have two copies of the same image in memory.<BR><BR><FONT class=extract>After the image is loaded and converted, we return the final optimized image.</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>//Apply the image stretched</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>SDL_Rect stretchRect;</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>stretchRect.x = 0;</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>stretchRect.y = 0;</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>stretchRect.w = SCREEN_WIDTH;</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>stretchRect.h = SCREEN_HEIGHT;</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #ddddff"><FONT class=extract><SPAN style="mso-tab-count: 4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>SDL_BlitScaled( gStretchedSurface, NULL, gScreenSurface, &amp;stretchRect );</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000022; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #aaaaaa"><FONT class=extract>SDL 2 has a new dedicated function to blit images to a different size:<SPAN class=apple-converted-space>&nbsp;</SPAN></FONT><A href="http://wiki.libsdl.org/SDL_BlitScaled"><SPAN style="COLOR: #8888ff"><FONT class=extract>SDL_BlitScaled</FONT></SPAN></A><FONT class=extract>. Like<SPAN class=apple-converted-space>&nbsp;</SPAN></FONT><A href="http://lazyfoo.net/tutorials/SDL/02_getting_an_image_on_the_screen/index.php"><SPAN style="COLOR: #8888ff"><FONT class=extract>blitting images</FONT></SPAN></A><FONT class=extract><SPAN class=apple-converted-space>&nbsp;</SPAN>before, SDL_BlitScaled takes in a source surface to blit onto the destination surface. It also takes in a destination<SPAN class=apple-converted-space>&nbsp;</SPAN></FONT><A href="http://wiki.libsdl.org/SDL_Rect"><SPAN style="COLOR: #8888ff"><FONT class=extract>SDL_Rect</FONT></SPAN></A><FONT class=extract><SPAN class=apple-converted-space>&nbsp;</SPAN>which defines the position and size of the image you are blitting.<BR><BR>So if we want to take an image that's smaller than the screen and make it the size of the screen, you make the destination width/height to be the width/height of the screen.</FONT></SPAN></P>
<P class=MsoNormal style="BACKGROUND: #000044; MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US style="FONT-SIZE: 13.5pt; FONT-FAMILY: 'Courier New'; COLOR: #aaaaaa">Download the media and source code for tutorial<SPAN class=apple-converted-space>&nbsp;</SPAN><A href="http://lazyfoo.net/tutorials/SDL/05_optimized_surface_loading_and_soft_stretching/05_optimized_surface_loading_and_soft_stretching.zip"><SPAN style="COLOR: #8888ff">here</SPAN></A>.</SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-US><FONT size=3 face=Calibri>&nbsp;</FONT></SPAN></P></BODY>