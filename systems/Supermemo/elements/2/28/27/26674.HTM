<HEADER class=entry-header>&nbsp;
<H1 class=entry-title>e1000e &#39537;&#21160;&#28304;&#30721;&#20998;&#26512;</H1>
<DIV class=entry-meta><SPAN class=sep>&#21457;&#34920;&#20110; </SPAN><A title="&#19979;&#21320; 10:00" href="http://mnstory.net/2014/12/e1000e-driver-source-analysis/" rel=bookmark><TIME class=entry-date datetime="2014-12-14T22:00:27+00:00">2014 &#24180; 12 &#26376; 14 &#26085;</TIME></A> </DIV></HEADER>
<DIV class=entry-content>
<H2>&#39537;&#21160;&#21021;&#22987;&#21270;&#19982;&#21024;&#38500;</H2>
<P>&#25105;&#20204;&#20174;&#20837;&#21475;&#20989;&#25968;module_init(e1000_init_module)&#24320;&#22987;&#30475;&#65292;&#19981;&#36807;&#36825;&#20010;e1000_init_module&#31616;&#27905;&#24471;&#21482;&#21097;&#19968;&#21477;&#35805;pci_register_driver(&amp;e1000_driver)&#65292;&#30475;&#30475;e1000_driver&#22914;&#20309;&#23450;&#20041;&#65306;</P>
<DIV id=crayon-569898aadbe56118442605 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbe56118442605-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe56118442605-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe56118442605-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe56118442605-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe56118442605-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe56118442605-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe56118442605-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe56118442605-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe56118442605-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe56118442605-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe56118442605-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe56118442605-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe56118442605-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe56118442605-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe56118442605-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe56118442605-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe56118442605-17">17</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbe56118442605-1 class=crayon-line><SPAN class=crayon-c>/* PCI Device API Driver */</SPAN></DIV>
<DIV id=crayon-569898aadbe56118442605-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>pci_driver </SPAN><SPAN class=crayon-v>e1000_driver</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbe56118442605-3 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#23601;&#20687;&#20320;&#19968;&#26679;&#65292;&#26159;&#20010;&#19996;&#35199;&#37117;&#24471;&#26377;&#21517;&#23383;&#65292;&#23427;&#30340;&#21517;&#23383;&#26159;</SPAN></DIV>
<DIV id=crayon-569898aadbe56118442605-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>//char e1000e_driver_name[] = "e1000e"</SPAN></DIV>
<DIV id=crayon-569898aadbe56118442605-5 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>name</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000e_driver_name</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe56118442605-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>id_table</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_pci_tbl</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe56118442605-7 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>probe</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_probe</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe56118442605-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>remove</SPAN><SPAN class=crayon-h>&nbsp;&nbsp; </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_remove</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe56118442605-9 class=crayon-line><SPAN class=crayon-p>#ifdef CONFIG_PM</SPAN></DIV>
<DIV id=crayon-569898aadbe56118442605-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#25903;&#25345;&#30005;&#28304;&#31649;&#29702;</SPAN></DIV>
<DIV id=crayon-569898aadbe56118442605-11 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>driver</SPAN><SPAN class=crayon-h>&nbsp;&nbsp; </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbe56118442605-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>pm</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>e1000_pm_ops</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe56118442605-13 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe56118442605-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-p>#endif</SPAN></DIV>
<DIV id=crayon-569898aadbe56118442605-15 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>shutdown</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_shutdown</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe56118442605-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>err_handler</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>e1000_err</SPAN><SPAN class=crayon-sy>_</SPAN>handler</DIV>
<DIV id=crayon-569898aadbe56118442605-17 class=crayon-line><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-sy>;</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<P>&#23450;&#20041;&#19968;&#20010;PCI&#39537;&#21160;&#65292;&#21738;&#20123;PCI&#35774;&#22791;&#21487;&#20197;&#20351;&#29992;&#27492;&#39537;&#21160;&#65311;<BR>&#31995;&#32479;&#24456;&#28909;&#24515;&#65292;&#24110;&#20320;&#25226;&#21028;&#26029;&#30340;&#20195;&#30721;&#20889;&#20102;&#65292;&#20320;&#21482;&#38656;&#25552;&#20379;&#21305;&#37197;&#34920;&#21363;&#21487;&#65292;&#32780;.id_table&#23601;&#26159;&#21305;&#37197;&#34920;&#12290;<BR>&#20320;&#36896;&#21527;&#65311;PCI&#26377;3&#31181;&#22320;&#22336;&#31354;&#38388;&#65306;I/O&#31354;&#38388;&#65292;&#20869;&#23384;&#22320;&#22336;&#31354;&#38388;&#65292;&#37197;&#32622;&#31354;&#38388;&#12290;&#32780;&#37197;&#32622;&#31354;&#38388;&#19968;&#20010;PCI&#30340;&#37197;&#32622;&#31354;&#38388;&#33267;&#23569;&#26377;256&#23383;&#33410;&#65292;&#24067;&#23616;&#22914;&#65306;<BR><A title="pic config" class=fancybox href="http://mnstory.net/wp-content/uploads/2014/12/e1000e-driver-source-analysis/pic-config.png" rel=fancybox><IMG class=size-full src="http://mnstory.net/wp-content/uploads/2014/12/e1000e-driver-source-analysis/pic-config.png"></A><BR>&#22270;&#29255;&#26469;&#28304;&#65306;<A href="http://blog.csdn.net/lamdoc/article/details/7698709">http://blog.csdn.net/lamdoc/article/details/7698709</A><BR><SPAN id=more-344></SPAN><BR>id_table&#26159;struct pci_device_id&#31867;&#22411;&#30340;&#19968;&#20010;&#25968;&#32452;&#65292;&#27599;&#19968;&#26465;pci_device_id&#65292;&#23601;&#26159;&#19968;&#26465;&#20351;&#29992;&#30340;PCI&#30828;&#20214;&#20449;&#24687;&#65292;match&#19978;&#20102;&#65292;&#23601;&#21487;&#20197;&#20351;&#29992;&#36825;&#20010;&#39537;&#21160;&#65292;&#20363;&#22914;&#25105;&#30340;&#32593;&#21345;&#65292;&#20854;&#31867;&#22411;&#20026;&#65306;</P>
<DIV id=crayon-569898aadbe69566414829 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbe69566414829-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe69566414829-2">2</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbe69566414829-1 class=crayon-line><SPAN class=crayon-c>#lspci -nn | grep -E 'Ethernet controller.*Intel'</SPAN></DIV>
<DIV id=crayon-569898aadbe69566414829-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-cn>04</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-cn>00.0</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>Ethernet </SPAN><SPAN class=crayon-i>controller</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-cn>0200</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>Intel </SPAN><SPAN class=crayon-i>Corporation</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>82574L</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>Gigabit </SPAN><SPAN class=crayon-e>Network </SPAN><SPAN class=crayon-i>Connection</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-cn>8086</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-cn>10d3</SPAN><SPAN class=crayon-sy>]</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P>&#37027;&#23601;&#21305;&#37197;&#19978;&#36825;&#26465; { PCI_VDEVICE(INTEL, E1000_DEV_ID_82574L), board_82574 }</P>
<P>e1000_driver&#37324;&#65292;&#25105;&#20204;&#20851;&#27880;&#20004;&#20010;&#20989;&#25968;&#65292;&#19968;&#20010;&#21021;&#22987;&#21270;(.probe=e1000_probe)&#65292;&#19968;&#20010;&#26512;&#26500;(.remove=e1000_remove)&#12290;&#21021;&#22987;&#21270;&#35828;&#23436;&#20102;&#65292;&#26512;&#26500;&#20063;&#31616;&#21333;&#65292;&#19968;&#21477;&#35805;&#65292;&#21453;&#27880;&#20876;pci&#65306;</P>
<DIV id=crayon-569898aadbe70047112147 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbe70047112147-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe70047112147-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe70047112147-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe70047112147-4">4</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbe70047112147-1 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__exit </SPAN><SPAN class=crayon-e>e1000_exit_module</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe70047112147-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbe70047112147-3 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>pci_unregister_driver</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>e1000_driver</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe70047112147-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H2>&#32593;&#21475;&#21021;&#22987;&#21270;&#19982;&#21024;&#38500;</H2>
<P></P>
<DIV id=crayon-569898aadbe77432500845 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-57">57</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-58">58</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-59">59</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-60">60</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-61">61</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-62">62</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-63">63</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-64">64</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-65">65</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-66">66</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-67">67</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-68">68</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-69">69</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-70">70</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-71">71</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-72">72</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-73">73</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-74">74</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-75">75</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-76">76</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-77">77</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-78">78</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-79">79</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-80">80</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-81">81</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-82">82</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-83">83</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-84">84</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-85">85</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-86">86</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-87">87</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-88">88</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-89">89</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-90">90</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-91">91</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-92">92</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-93">93</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-94">94</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-95">95</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-96">96</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-97">97</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-98">98</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-99">99</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-100">100</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-101">101</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-102">102</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-103">103</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-104">104</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-105">105</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-106">106</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-107">107</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-108">108</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-109">109</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-110">110</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-111">111</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-112">112</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-113">113</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-114">114</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-115">115</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-116">116</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-117">117</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-118">118</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-119">119</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-120">120</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-121">121</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-122">122</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-123">123</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-124">124</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-125">125</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-126">126</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-127">127</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-128">128</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-129">129</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-130">130</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-131">131</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-132">132</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-133">133</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-134">134</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-135">135</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-136">136</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-137">137</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-138">138</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-139">139</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-140">140</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-141">141</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-142">142</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-143">143</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-144">144</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-145">145</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-146">146</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-147">147</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-148">148</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-149">149</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-150">150</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-151">151</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-152">152</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-153">153</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-154">154</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-155">155</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-156">156</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-157">157</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-158">158</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-159">159</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-160">160</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-161">161</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-162">162</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-163">163</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-164">164</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-165">165</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-166">166</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-167">167</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-168">168</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-169">169</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-170">170</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-171">171</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-172">172</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-173">173</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-174">174</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-175">175</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-176">176</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-177">177</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-178">178</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-179">179</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-180">180</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-181">181</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-182">182</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-183">183</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-184">184</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-185">185</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-186">186</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-187">187</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-188">188</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-189">189</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-190">190</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-191">191</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-192">192</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-193">193</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-194">194</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-195">195</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-196">196</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-197">197</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-198">198</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-199">199</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-200">200</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-201">201</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-202">202</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-203">203</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-204">204</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-205">205</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-206">206</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-207">207</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-208">208</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-209">209</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-210">210</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-211">211</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-212">212</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-213">213</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-214">214</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-215">215</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-216">216</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-217">217</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-218">218</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-219">219</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-220">220</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-221">221</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-222">222</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-223">223</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-224">224</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-225">225</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-226">226</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-227">227</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-228">228</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-229">229</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-230">230</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-231">231</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-232">232</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-233">233</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-234">234</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-235">235</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-236">236</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-237">237</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-238">238</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-239">239</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-240">240</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-241">241</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-242">242</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-243">243</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-244">244</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-245">245</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-246">246</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-247">247</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-248">248</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-249">249</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-250">250</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-251">251</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-252">252</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-253">253</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-254">254</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-255">255</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-256">256</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-257">257</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-258">258</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-259">259</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-260">260</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-261">261</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-262">262</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-263">263</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-264">264</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-265">265</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-266">266</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-267">267</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-268">268</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-269">269</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-270">270</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-271">271</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-272">272</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-273">273</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-274">274</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-275">275</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-276">276</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-277">277</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-278">278</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-279">279</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-280">280</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-281">281</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-282">282</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-283">283</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-284">284</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-285">285</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-286">286</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-287">287</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-288">288</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-289">289</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-290">290</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-291">291</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-292">292</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe77432500845-293">293</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe77432500845-294">294</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbe77432500845-1 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_probe</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pci_dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-r>const</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pci_device_id</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>ent</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-3 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>net_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-5 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_hw</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>//ent-&gt;driver_data&#30456;&#24403;&#20110;&#25903;&#25345;e1000e&#39537;&#21160;&#30340;&#30828;&#20214;&#29256;&#26412;&#21495;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-7 class=crayon-line><SPAN class=crayon-c>//&#36890;&#36807;lspci&#21487;&#20197;&#30475;&#20986;&#32593;&#21345;&#22411;&#21495;&#65292;&#20363;&#22914;&#25105;&#30340;Intel Corporation 82574L Gigabit Network Connection&#65292;&#25152;&#20197;ei&#20026;e1000_82574_info</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-r>const</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_info</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>ei</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_info_tbl</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>ent</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>driver_data</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>resource_size_t </SPAN><SPAN class=crayon-v>mmio_start</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>mmio_len</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>resource_size_t </SPAN><SPAN class=crayon-v>flash_start</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>flash_len</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-11 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cards_found</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>u16 </SPAN><SPAN class=crayon-v>aspm_disable_flag</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-13 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>bars</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pci_using_dac</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//EEPROM, Electrically Erasable Programmable Read-Only Memory</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-15 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//APME, ACPI Magic Packet filter</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#36825;&#20040;&#30475;&#26469;&#65292;&#21482;&#21487;&#20197;&#23545;ACPI&#21253;&#36807;&#28388;&#36827;&#34892;&#35774;&#32622;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-17 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>u16 </SPAN><SPAN class=crayon-v>eeprom_data</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>u16 </SPAN><SPAN class=crayon-v>eeprom_apme_mask</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_EEPROM_APME</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-19 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//ASPM&#65292;Active State Power Management</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-21 class=crayon-line><SPAN class=crayon-c>//&#36890;&#36807;lspci -vvvv -s 04:00.0 | grep -E --color 'ASPM|^'</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>//&#26597;&#30475;&#25105;&#30340;&#32593;&#21345;&#30340;ASPM&#23646;&#24615;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-23 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>// LnkCap: Port #0, Speed 2.5GT/s, Width x1, ASPM L0s L1, Latency L0 &lt;128ns, L1 &lt;64us ClockPM- Surprise- LLActRep- BwNot-</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>// LnkCtl: ASPM Disabled; RCB 64 bytes Disabled- Retrain- CommClk+ ExtSynch- ClockPM- AutWidDis- BWInt- AutBWInt-</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-25 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>ei</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags2</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>FLAG2_DISABLE_ASPM_L0S</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>aspm_disable_flag</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>PCIE_LINK_STATE_L0S</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-27 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>ei</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags2</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>FLAG2_DISABLE_ASPM_L1</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-28 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>aspm_disable_flag</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>PCIE_LINK_STATE_L1</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-29 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>aspm_disable_flag</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000e_disable_aspm</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>aspm_disable_flag</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-31 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#21021;&#22987;&#21270;&#35774;&#22791;&#20869;&#23384;&#24182;&#36890;&#30693;PCI BIOS&#20351;&#33021;&#27492;&#35774;&#22791;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-33 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>pci_enable_device_mem</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-35 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-36 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-37 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>pci_using_dac</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#36890;&#30693;&#20869;&#26680;&#65292;&#27492;PCI&#35774;&#22791;&#26159;DMA 64&#20301;&#23547;&#22336;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-39 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>dma_set_mask</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>DMA_BIT_MASK</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-cn>64</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-41 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>dma_set_coherent_mask</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>DMA_BIT_MASK</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-cn>64</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-43 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>pci_using_dac</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-44 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>else</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-45 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-c>//&#24178;&#19981;&#20102;&#65292;&#21482;&#33021;&#36864;&#32780;&#27714;&#20854;&#27425;&#65292;&#29992;&#20301;&#23547;&#22336;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-46 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>dma_set_mask</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>DMA_BIT_MASK</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-cn>32</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-47 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>dma_set_coherent_mask</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-49 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>DMA_BIT_MASK</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-cn>32</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-50 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-51 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//oh shit, &#37117;&#19981;&#34892;&#65292;&#27515;&#21435;&#21543;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>dev_err</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-53 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-s>"No usable DMA configuration, abortingn"</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-54 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err_dma</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-55 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-56 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-57 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-58 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#33719;&#21462;IO&#36164;&#28304;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-59 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>bars</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>pci_select_bars</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>IORESOURCE_MEM</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-60 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>pci_request_selected_regions_exclusive</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>bars</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-61 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-v>e1000e_driver_name</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-62 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-63 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err_pci_reg</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-64 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-65 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* AER (Advanced Error Reporting) hooks */</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-66 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>pci_enable_pcie_error_reporting</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-67 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-68 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#35753;PCI&#33719;&#24471;&#20351;&#29992;&#24635;&#32447;&#30340;&#26435;&#38480;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-69 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>pci_set_master</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-70 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* PCI config space info */</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-71 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>pci_save_state</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-72 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-73 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err_alloc_etherdev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-74 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-75 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-v>ENOMEM</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-76 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#20998;&#37197;net_device&#32467;&#26500;&#65292;&#37324;&#38754;&#20250;&#39044;&#30041;&#31354;&#38388;&#26469;&#25918;e1000_adapter</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-77 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>alloc_etherdev</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-r>sizeof</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-78 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-79 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err_alloc_etherdev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-80 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-81 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>SET_NETDEV_DEV</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-82 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-83 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>irq</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>irq</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-84 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-85 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>pci_set_drvdata</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#23558;net_device&#21644;pci&#20851;&#32852;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-86 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>netdev_priv</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//netdev&#37324;&#38754;&#39044;&#30041;&#30340;&#20869;&#23384;&#65292;&#23601;&#26159;e1000_adapter,&#29992;&#26469;&#23384;&#20648;&#21644;&#27492;PCI&#35774;&#22791;&#30456;&#20851;&#30340;&#25968;&#25454;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-87 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#25509;&#19979;&#26469;&#23601;&#26159;&#23545;adapter&#30340;&#21021;&#22987;&#21270;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-88 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-89 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-90 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-91 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>ei</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ei</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-92 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>pba</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ei</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>pba</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-93 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ei</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-94 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags2</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ei</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags2</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-95 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-96 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>mac</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>type</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ei</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>mac</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-97 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>max_hw_frame_size</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ei</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>max_hw_frame_size</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-98 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#24320;&#21551;&#28040;&#24687;&#31867;&#22411;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-99 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>msg_enable</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>netif_msg_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>debug</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>DEFAULT_MSG_ENABLE</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-100 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-101 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#36825;&#37324;&#33719;&#21462;&#30340;&#26159;PCI bar 0&#23545;&#24212;&#30340;&#29289;&#29702;&#22320;&#22336;&#33539;&#22260;&#65292;&#36825;&#20010;&#29289;&#29702;&#22320;&#22336;&#26159;&#30001;&#30828;&#20214;&#20915;&#23450;&#30340;&#65292;BIOS&#26159;&#21542;&#21442;&#19982;&#65311;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-102 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>mmio_start</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>pci_resource_start</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-103 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>mmio_len</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>pci_resource_len</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-104 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-105 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-v>EIO</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-106 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#29289;&#29702;&#22320;&#22336;&#24517;&#39035;&#36890;&#36807;ioremap&#26144;&#23556;&#20026;&#34394;&#25311;&#22320;&#22336;&#65292;&#20869;&#26680;&#25165;&#33021;&#35775;&#38382;&#65292;&#22914;&#26524;&#24212;&#29992;&#23618;&#24819;&#35775;&#38382;&#65292;&#38656;&#35201;&#29992;remap_page_range</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-107 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>hw_addr</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ioremap</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>mmio_start</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>mmio_len</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-108 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>hw_addr</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-109 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err_ioremap</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-110 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-111 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#20174;&#27969;&#31243;&#30475;&#65292;&#23545;&#24212;&#25105;&#30340;&#30828;&#20214;&#65292;&#36825;&#20010;flags&#23601;&#26159;e1000_82574_info.flags&#65292;&#27969;&#31243;&#36208;&#19981;&#36827;&#26469;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-112 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>FLAG_HAS_FLASH</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-113 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>pci_resource_flags</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>IORESOURCE_MEM</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-114 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#22914;&#26524;&#26377;flash&#26631;&#35760;&#65292;&#21462;bar 1&#30340;&#29289;&#29702;&#22320;&#22336;&#26144;&#23556;&#20026;flash_address</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-115 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>flash_start</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>pci_resource_start</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-116 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>flash_len</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>pci_resource_len</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-117 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>flash_address</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ioremap</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>flash_start</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>flash_len</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-118 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>flash_address</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-119 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err_flashmap</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-120 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-121 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-122 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Set default EEE advertisement */</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-123 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags2</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>FLAG2_HAS_EEE</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-124 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>eee_advert</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>MDIO_EEE_100TX</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>MDIO_EEE_1000T</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-125 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-126 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* construct the net_device struct */</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-127 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#35774;&#32622;net_device&#30340;&#25805;&#20316;&#22238;&#35843;&#21644;ethtool&#22238;&#35843;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-128 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#36825;&#27493;&#26159;&#20851;&#38190;&#65292;C&#35821;&#35328;&#23601;&#21916;&#27426;&#22238;&#35843;&#65292;&#22238;&#35843;&#65292;&#22238;&#35843;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-129 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>netdev_ops</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>e1000e_netdev_ops</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-130 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000e_set_ethtool_ops</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-131 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>watchdog_timeo</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>5</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HZ</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-132 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#20851;&#32852;net_device&#20110;napi&#65292;napi&#32467;&#21512;&#20102;&#20013;&#26029;&#19982;&#36718;&#35810;&#65292;&#21487;&#20197;&#25552;&#39640;&#32593;&#32476;&#25910;&#21253;&#25928;&#30410;&#65292;&#29616;&#22312;&#40664;&#35748;&#20351;&#29992;NAPI&#20102;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-133 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>netif_napi_add</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>napi</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000e_poll</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>64</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-134 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>strlcpy</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>name</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>pci_name</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-r>sizeof</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>name</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-135 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#35760;&#24405;&#19968;&#19979;&#20043;&#21069;&#33719;&#21462;&#30340;PCI bar 0&#30340;&#29289;&#29702;&#22320;&#22336;&#33539;&#22260;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-136 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>mem_start</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>mmio_start</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-137 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>mem_end</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>mmio_start</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>mmio_len</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-138 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-139 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>bd_number</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cards_found</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-140 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-141 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000e_check_options</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-142 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-143 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* setup adapter struct */</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-144 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//adapter&#36824;&#26377;&#19996;&#35199;&#38656;&#35201;&#21021;&#22987;&#21270;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-145 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_sw_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-146 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-147 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err_sw_init</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-148 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#23545;&#31867;&#22411;&#32593;&#21345;&#65292;&#20854;&#25805;&#20316;&#22238;&#35843;&#20026;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-149 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//e1000_82574_info.mac_ops</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-150 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//.mac_ops = &amp;e82571_mac_ops,</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-151 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//.phy_ops = &amp;e82_phy_ops_bm,</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-152 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//.nvm_ops = &amp;e82571_nvm_ops,</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-153 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>memcpy</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>mac</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ops</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ei</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>mac_ops</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-r>sizeof</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>mac</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ops</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-154 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>memcpy</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>nvm</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ops</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ei</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>nvm_ops</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-r>sizeof</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>nvm</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ops</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-155 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>memcpy</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>phy</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ops</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ei</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>phy_ops</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-r>sizeof</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>phy</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ops</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-156 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-157 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ei</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-e>get_variants</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-158 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-159 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err_hw_init</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-160 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-161 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>FLAG_IS_ICH</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-162 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>FLAG_READ_ONLY_NVM</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-163 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000e_write_protect_nvm_ich8lan</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-164 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-165 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>mac</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ops</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-e>get_bus_info</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-166 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-167 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>phy</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>autoneg_wait_to_complete</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-168 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-169 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Copper options */</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-170 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>phy</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>media_type</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_media_type_copper</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-171 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>phy</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>mdix</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>AUTO_ALL_MODES</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-172 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>phy</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>disable_polarity_correction</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-173 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>phy</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ms_type</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_ms_hw_default</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-174 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-175 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-176 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>phy</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ops</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>check_reset_block</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>phy</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ops</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-e>check_reset_block</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-177 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>dev_info</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-178 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-s>"PHY reset is blocked due to SOL/IDER session.n"</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-179 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-180 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Set initial default active device features */</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-181 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>features</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>NETIF_F_SG</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-182 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>NETIF_F_HW_VLAN_CTAG_RX</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-183 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>NETIF_F_HW_VLAN_CTAG_TX</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-184 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>NETIF_F_TSO</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-185 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>NETIF_F_TSO6</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-186 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>NETIF_F_RXHASH</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-187 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>NETIF_F_RXCSUM</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-188 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>NETIF_F_HW_CSUM</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-189 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-190 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Set user-changeable features (subset of all device features) */</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-191 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw_features</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>features</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-192 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw_features</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETIF_F_RXFCS</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-193 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>priv_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>IFF_SUPP_NOFCS</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-194 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw_features</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETIF_F_RXALL</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-195 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-196 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>FLAG_HAS_HW_VLAN_FILTER</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-197 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>features</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETIF_F_HW_VLAN_CTAG_FILTER</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-198 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-199 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>vlan_features</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>NETIF_F_SG</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-200 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>NETIF_F_TSO</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-201 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>NETIF_F_TSO6</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-202 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>NETIF_F_HW_CSUM</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-203 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-204 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>priv_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>IFF_UNICAST_FLT</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-205 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-206 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pci_using_dac</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-207 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>features</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETIF_F_HIGHDMA</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-208 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>vlan_features</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETIF_F_HIGHDMA</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-209 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-210 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-211 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>e1000e_enable_mng_pass_thru</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-212 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>FLAG_MNG_PT_ENABLED</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-213 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-214 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* before reading the NVM, reset the controller to</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-215 class=crayon-line><SPAN class=crayon-c>* put the device in a known good starting state</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-216 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-217 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>mac</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ops</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-e>reset_hw</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-218 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-219 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* systems with ASPM and others may see the checksum fail on the first</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-220 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* attempt. Let's give it a few tries</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-221 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-222 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>for</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-223 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>e1000_validate_nvm_checksum</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&gt;=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-224 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>break</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-225 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>2</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-226 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>dev_err</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"The NVM Checksum Is Not Validn"</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-227 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-v>EIO</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-228 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err_eeprom</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-229 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-230 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-231 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-232 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000_eeprom_checks</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-233 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-234 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* copy the MAC address */</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-235 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>e1000e_read_mac_addr</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-236 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>dev_err</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-237 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-s>"NVM Read Error while reading MAC addressn"</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-238 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-239 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>memcpy</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev_addr</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>mac</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>addr</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>addr_len</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-240 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-241 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>is_valid_ether_addr</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev_addr</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-242 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>dev_err</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"Invalid MAC Address: %pMn"</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-243 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev_addr</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-244 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-v>EIO</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-245 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err_eeprom</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-246 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-247 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-248 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>init_timer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>watchdog_timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-249 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#35302;&#21457;&#35843;&#29992;e1000_watchdog_task &#36825;&#20010;task&#20027;&#35201;&#36127;&#36131;&#26356;&#26032;&#32593;&#21475;&#29366;&#24577;&#21464;&#21270;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-250 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>watchdog_timer</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-t>function</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_watchdog</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-251 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>watchdog_timer</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>data</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-252 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-253 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>init_timer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>phy_info_timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-254 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#35302;&#21457;&#35843;&#29992;e1000e_update_phy_task -&gt; get_info -&gt; e82_phy_ops_bm.get_info = e1000e_get_phy_info_m88 -&gt;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-255 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>phy_info_timer</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-t>function</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_update_phy_info</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-256 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>phy_info_timer</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>data</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-257 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-258 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>INIT_WORK</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>reset_task</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_reset_task</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-259 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>INIT_WORK</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>watchdog_task</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_watchdog_task</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-260 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>INIT_WORK</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>downshift_task</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000e_downshift_workaround</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-261 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>INIT_WORK</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>update_phy_task</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000e_update_phy_task</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-262 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>INIT_WORK</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>print_hang_task</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_print_hw_hang</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-263 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>.</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-264 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#20174;&#19979;&#38754;&#36825;&#20010;strlcpy&#21487;&#20197;&#30475;&#20986;&#65292;&#27599;&#20010;&#25903;&#25345;e1000e&#30340;&#32593;&#21475;&#21021;&#22987;&#21270;&#65292;&#37117;&#20250;&#35843;&#29992;&#36825;&#20010;&#20989;&#25968;&#19968;&#27425;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-265 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>strlcpy</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>name</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"eth%d"</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-r>sizeof</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>name</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-266 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#21021;&#22987;&#21270;netdev&#36825;&#20040;&#22810;&#21442;&#25968;&#65292;&#32456;&#20110;&#21021;&#22987;&#21270;&#23436;&#25104;&#65292;&#21487;&#20197;register netdev&#20102;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-267 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>register_netdev</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-268 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-269 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err_register</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-270 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//netmap attach&#30340;&#20301;&#32622;&#65292;&#22312;netdev&#21021;&#22987;&#21270;&#23436;&#25104;&#21518;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-271 class=crayon-line><SPAN class=crayon-p>#ifdef DEV_NETMAP</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-272 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000_netmap_attach</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-273 class=crayon-line><SPAN class=crayon-p>#endif /* DEV_NETMAP */</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-274 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* carrier off reporting is important to ethtool even BEFORE open */</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-275 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>netif_carrier_off</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#39537;&#21160;prob&#21518;&#65292;&#36824;&#19981;&#33021;&#24037;&#20316;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-276 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-277 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* init PTP hardware clock */</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-278 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000e_ptp_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-279 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-280 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>&nbsp;&nbsp;&nbsp;&nbsp; &#36825;&#37324;&#25171;&#21360;&#32593;&#21345;&#35774;&#22791;&#30340;&#22522;&#26412;&#20449;&#24687;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-281 class=crayon-line><SPAN class=crayon-c>&nbsp;&nbsp;&nbsp;&nbsp; &#20363;&#22914;&#65306;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-282 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>&nbsp;&nbsp;&nbsp;&nbsp; irq 54 for MSI/MSI-X</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-283 class=crayon-line><SPAN class=crayon-c>&nbsp;&nbsp;&nbsp;&nbsp; eth4: (PCI Express:2.5GT/s:Width x4) 00:1b:21:98:e5:9e</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-284 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>&nbsp;&nbsp;&nbsp;&nbsp; eth4: Intel(R) PRO/1000 Network Connection</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-285 class=crayon-line><SPAN class=crayon-c>&nbsp;&nbsp;&nbsp;&nbsp; eth4: MAC: 0, PHY: 4, PBA No: D72468-005</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-286 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>&nbsp;&nbsp;&nbsp;&nbsp; */</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-287 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000_print_device_info</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-288 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-289 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>pci_dev_run_wake</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-290 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>pm_runtime_put_noidle</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-291 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbe77432500845-292 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-293 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>.</SPAN></DIV>
<DIV id=crayon-569898aadbe77432500845-294 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<P>&#21021;&#22987;&#21270;&#32593;&#21345;&#26159;probe&#65292;&#20854;&#23545;&#24212;&#20301;&#21024;&#38500;&#32593;&#21345;remove</P>
<DIV id=crayon-569898aadbe8e684447174 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-57">57</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-58">58</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-59">59</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-60">60</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-61">61</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-62">62</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-63">63</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-64">64</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-65">65</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-66">66</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-67">67</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-68">68</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-69">69</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-70">70</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-71">71</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe8e684447174-72">72</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe8e684447174-73">73</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbe8e684447174-1 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_remove</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pci_dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN><SPAN class=crayon-c>//e1000_remove &#23545;&#24212;e1000_probe</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-3 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>net_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>pci_get_drvdata</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>netdev_priv</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-5 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>bool</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>down</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>test_bit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>__E1000_DOWN</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-6 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe8e684447174-7 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000e_ptp_remove</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-8 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe8e684447174-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* The timers may be rescheduled, so explicitly disable them</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* from being rescheduled.</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-11 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>down</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-13 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>set_bit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>__E1000_DOWN</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>del_timer_sync</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>watchdog_timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-15 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>del_timer_sync</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>phy_info_timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-16 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe8e684447174-17 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>cancel_work_sync</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>reset_task</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>cancel_work_sync</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>watchdog_task</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-19 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>cancel_work_sync</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>downshift_task</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>cancel_work_sync</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>update_phy_task</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-21 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>cancel_work_sync</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>print_hang_task</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-22 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe8e684447174-23 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>FLAG_HAS_HW_TIMESTAMP</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>cancel_work_sync</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_hwtstamp_work</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-25 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_hwtstamp_skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>dev_kfree_skb_any</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_hwtstamp_skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-27 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_hwtstamp_skb</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>NULL</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-28 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-29 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-31 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#38590;&#36947;UP&#30340;&#26102;&#20505;&#23601;&#19981;&#38656;&#35201;power down&#65311;&#24212;&#35813;&#26159;&#27969;&#31243;&#20445;&#35777;up&#30340;&#26102;&#20505;&#26080;&#27861;remove</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>IFF_UP</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-33 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000_power_down_phy</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-34 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe8e684447174-35 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Don't lie to e1000_close() down the road. */</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-36 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>down</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-37 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>clear_bit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>__E1000_DOWN</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>unregister_netdev</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-39 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbe8e684447174-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>pci_dev_run_wake</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-41 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>pm_runtime_get_noresume</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-42 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe8e684447174-43 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Release control of h/w to f/w.&nbsp;&nbsp;If f/w is AMT enabled, this</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-44 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* would have already happened in close and is redundant.</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-45 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-46 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000e_release_hw_control</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-47 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbe8e684447174-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000e_reset_interrupt_capability</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-49 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>kfree</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-50 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>kfree</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-51 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbe8e684447174-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-p>#ifdef DEV_NETMAP</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-53 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//e1000_probe&#30340;&#26102;&#20505;&#65292;&#35843;&#29992;&#20102;e1000_netmap_attach&#65292;&#22312;remove&#30340;&#26102;&#20505;&#65292;&#35843;&#29992;netmap_detach&#65292;&#29992;&#20110;&#37322;&#25918;attach&#20998;&#37197;&#30340;&#36164;&#28304;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-54 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#37322;&#25918;ring&#65292;&#37322;&#25918;adapter&#65292;netmap&#30340;adapter&#21644;e1000e&#30340;adapter&#19981;&#26159;&#23384;&#25918;&#21040;&#21516;&#19968;&#20010;&#22320;&#26041;&#30340;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-55 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//struct netmap_adapter *na = (struct netmap_adapter *)netdev-&gt;ax25_ptr;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-56 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//struct e1000_adapter *adapter = netdev_priv(netdev);</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-57 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#25152;&#20197;free&#20102;netmap_adapter&#19981;&#24433;&#21709;e1000_adapter&#32487;&#32493;&#20351;&#29992;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-58 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>netmap_detach</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-59 class=crayon-line><SPAN class=crayon-p>#endif /* DEV_NETMAP */</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-60 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe8e684447174-61 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>iounmap</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>hw_addr</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-62 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>flash_address</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-63 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>iounmap</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>flash_address</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-64 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>pci_release_selected_regions</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-65 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-e>pci_select_bars</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>IORESOURCE_MEM</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-66 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe8e684447174-67 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>free_netdev</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-68 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe8e684447174-69 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* AER disable */</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-70 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>pci_disable_pcie_error_reporting</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-71 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbe8e684447174-72 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>pci_disable_device</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbe8e684447174-73 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H2>&#32593;&#21475;&#30340;UP&#19982;DOWN</H2>
<P>&#22312;probe&#20989;&#25968;&#37324;&#65292;&#23450;&#20041;&#20102;ops&#22238;&#35843;&#65292;&#37324;&#38754;&#26377;&#35774;&#22791;&#30340;open, stop, &#21457;&#21253;start_xmit&#31561;&#65306;</P>
<DIV id=crayon-569898aadbe99555954399 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbe99555954399-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe99555954399-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe99555954399-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe99555954399-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe99555954399-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe99555954399-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe99555954399-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe99555954399-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe99555954399-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe99555954399-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe99555954399-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe99555954399-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe99555954399-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe99555954399-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe99555954399-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe99555954399-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe99555954399-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe99555954399-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbe99555954399-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbe99555954399-20">20</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbe99555954399-1 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-r>const</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>net_device_ops </SPAN><SPAN class=crayon-v>e1000e_netdev_ops</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbe99555954399-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ndo_open</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_open</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe99555954399-3 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ndo_stop</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_close</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe99555954399-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ndo_start_xmit</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_xmit_frame</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe99555954399-5 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ndo_get_stats64</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000e_get_stats64</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe99555954399-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ndo_set_rx_mode</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000e_set_rx_mode</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe99555954399-7 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ndo_set_mac_address</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_set_mac</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe99555954399-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ndo_change_mtu</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_change_mtu</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe99555954399-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ndo_do_ioctl</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_ioctl</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe99555954399-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ndo_tx_timeout</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_tx_timeout</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe99555954399-11 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ndo_validate_addr</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>eth_validate_addr</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe99555954399-12 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbe99555954399-13 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ndo_vlan_rx_add_vid</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_vlan_rx_add_vid</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe99555954399-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ndo_vlan_rx_kill_vid</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_vlan_rx_kill_vid</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe99555954399-15 class=crayon-line><SPAN class=crayon-p>#ifdef CONFIG_NET_POLL_CONTROLLER</SPAN></DIV>
<DIV id=crayon-569898aadbe99555954399-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#22312;&#20851;&#20013;&#26029;&#30340;&#24773;&#20917;&#19979;&#21457;&#36865;&#25968;&#25454;&#21253;&#65292;&#20363;&#22914;&#20351;&#29992;netconsole&#21457;&#36865;printk&#21040;&#20854;&#20182;host</SPAN></DIV>
<DIV id=crayon-569898aadbe99555954399-17 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ndo_poll_controller</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_netpoll</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe99555954399-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-p>#endif</SPAN></DIV>
<DIV id=crayon-569898aadbe99555954399-19 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ndo_set_features</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_set_features</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbe99555954399-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-sy>;</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<P>&#19981;&#35201;&#24536;&#35760;&#65292;&#35843;&#29992;e1000e_probe&#30340;&#26102;&#20505;&#65292;&#32593;&#21475;&#22788;&#20110;down&#29366;&#24577;&#65292;&#20320;&#38656;&#35201;ifconfig eth up<BR>&#27492;&#26102;&#65292;&#20250;&#22238;&#35843;dev_change_flags-&gt;__dev_open-&gt;ndo_open-&gt;e1000_open</P>
<P>&#23545;&#24212;&#22320;&#65292;&#24403;ifconfig eth down&#30340;&#26102;&#20505;&#65292;&#20250;&#22238;&#35843;dev_change_flags-&gt;__dev_close-&gt;__dev_close_many-&gt;ndo_stop-&gt;e1000_close</P>
<DIV id=crayon-569898aadbea1296623949 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-57">57</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-58">58</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-59">59</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-60">60</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-61">61</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-62">62</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-63">63</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-64">64</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-65">65</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-66">66</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-67">67</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-68">68</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-69">69</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-70">70</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-71">71</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-72">72</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-73">73</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-74">74</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-75">75</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-76">76</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-77">77</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-78">78</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-79">79</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-80">80</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-81">81</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-82">82</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-83">83</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-84">84</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-85">85</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-86">86</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-87">87</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-88">88</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-89">89</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-90">90</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-91">91</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-92">92</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-93">93</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-94">94</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-95">95</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-96">96</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-97">97</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-98">98</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-99">99</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-100">100</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-101">101</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-102">102</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-103">103</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-104">104</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-105">105</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-106">106</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-107">107</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-108">108</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-109">109</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-110">110</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-111">111</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-112">112</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-113">113</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-114">114</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-115">115</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-116">116</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-117">117</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-118">118</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-119">119</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-120">120</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-121">121</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-122">122</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-123">123</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-124">124</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-125">125</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-126">126</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-127">127</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-128">128</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-129">129</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-130">130</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-131">131</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-132">132</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-133">133</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-134">134</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-135">135</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-136">136</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-137">137</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-138">138</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-139">139</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-140">140</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-141">141</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-142">142</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-143">143</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-144">144</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-145">145</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-146">146</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-147">147</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-148">148</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-149">149</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-150">150</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-151">151</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-152">152</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-153">153</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-154">154</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-155">155</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-156">156</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-157">157</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-158">158</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-159">159</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-160">160</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-161">161</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-162">162</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-163">163</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-164">164</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-165">165</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-166">166</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-167">167</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-168">168</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-169">169</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-170">170</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-171">171</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-172">172</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-173">173</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-174">174</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-175">175</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-176">176</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-177">177</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-178">178</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-179">179</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-180">180</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-181">181</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-182">182</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-183">183</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-184">184</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-185">185</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-186">186</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-187">187</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-188">188</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-189">189</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-190">190</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-191">191</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-192">192</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-193">193</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-194">194</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-195">195</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-196">196</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-197">197</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-198">198</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-199">199</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-200">200</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-201">201</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-202">202</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-203">203</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-204">204</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-205">205</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-206">206</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-207">207</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-208">208</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-209">209</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-210">210</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-211">211</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-212">212</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-213">213</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-214">214</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-215">215</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-216">216</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-217">217</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-218">218</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-219">219</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-220">220</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-221">221</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-222">222</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-223">223</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-224">224</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-225">225</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-226">226</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-227">227</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-228">228</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-229">229</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-230">230</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-231">231</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-232">232</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-233">233</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-234">234</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-235">235</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-236">236</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-237">237</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-238">238</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-239">239</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-240">240</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-241">241</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-242">242</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-243">243</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-244">244</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-245">245</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-246">246</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-247">247</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-248">248</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-249">249</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-250">250</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-251">251</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-252">252</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-253">253</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-254">254</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-255">255</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-256">256</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbea1296623949-257">257</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbea1296623949-258">258</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbea1296623949-1 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_open</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>net_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-3 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>netdev_priv</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_hw</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-5 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pci_dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-7 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* disallow open during test */</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>test_bit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>__E1000_TESTING</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-v>EBUSY</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-11 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>pm_runtime_get_sync</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-13 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#30830;&#20445;&#22788;&#20110;no carrier&#29366;&#24577;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>netif_carrier_off</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-15 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* allocate transmit descriptors */</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-17 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//ring&#30340;slot&#26159;&#22312;&#36825;&#37324;&#20998;&#37197;&#30340;&#65292;&#27599;&#27425;up&#32593;&#21475;&#30340;&#26102;&#20505;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000e_setup_tx_resources</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-19 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err_setup_tx</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-21 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* allocate receive descriptors */</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-23 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000e_setup_rx_resources</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-25 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err_setup_rx</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-26 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-27 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* If AMT is enabled, let the firmware know that the network</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-28 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* interface is now open and reset the part to a known state.</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-29 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>FLAG_HAS_AMT</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-31 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000e_get_hw_control</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000e_reset</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-33 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#30830;&#20445;&#36890;&#30005;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-35 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000e_power_up_phy</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-36 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-37 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#37197;&#32622;vlan id</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>mng_vlan_id</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_MNG_VLAN_NONE</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-39 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>mng_cookie</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>status</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_MNG_DHCP_COOKIE_STATUS_VLAN</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000_update_mng_vlan</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-41 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* DMA latency requirement to workaround jumbo issue */</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-43 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>pm_qos_add_request</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>pm_qos_req</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>PM_QOS_CPU_DMA_LATENCY</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-44 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp; </SPAN><SPAN class=crayon-v>PM_QOS_DEFAULT_VALUE</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-45 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-46 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* before we allocate an interrupt, we must be ready to handle it.</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-47 class=crayon-line><SPAN class=crayon-c>* Setting DEBUG_SHIRQ in the kernel makes it fire an interrupt</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* as soon as we call pci_request_irq, so we have to setup our</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-49 class=crayon-line><SPAN class=crayon-c>* clean_rx handler before we do so.</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-50 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-51 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#25191;&#34892;&#20102;alloc_rx_buf&#22238;&#35843;&#65292;&#29992;&#20110;&#20998;&#37197;rx skb&#30340;&#20869;&#23384;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000_configure</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-53 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-54 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#21021;&#22987;&#21270;IRQ</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-55 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_request_irq</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-56 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-57 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err_req_irq</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-58 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-59 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Work around PCIe errata with MSI interrupts causing some chipsets to</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-60 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* ignore e1000e MSI messages, which means we need to test our MSI</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-61 class=crayon-line><SPAN class=crayon-c>* interrupt now</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-62 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-63 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>int_mode</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000E_INT_MODE_LEGACY</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-64 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_test_msi</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-65 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-66 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e_err</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-s>"Interrupt allocation failedn"</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-67 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err_req_irq</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-68 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-69 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-70 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-71 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#24320;&#22987;up&#32593;&#21475;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-72 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* From here on the code is the same as e1000e_up() */</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-73 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>clear_bit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>__E1000_DOWN</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-74 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-75 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#20801;&#35768;NAPI&#35843;&#24230;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-76 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>napi_enable</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>napi</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-77 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-78 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000_irq_enable</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-79 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-80 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_hang_recheck</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>false</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-81 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#20801;&#35768;&#19978;&#23618;&#35843;&#29992;&#35774;&#22791;&#30340;hard_start_xmit routine&#20989;&#25968;&#65292;&#24320;&#22987;&#25968;&#25454;&#20256;&#36865;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-82 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>netif_start_queue</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-83 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-84 class="crayon-line crayon-striped-line"><SPAN class=crayon-p>#ifdef DEV_NETMAP</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-85 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#27492;netdev&#19978;&#30340;&#25152;&#26377;ring&#24320;&#22987;&#24037;&#20316;&#65292;&#31867;&#20284;netif_start_queue</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-86 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>netmap_enable_all_rings</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-87 class=crayon-line><SPAN class=crayon-p>#endif /* DEV_NETMAP */</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-88 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-89 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>idle_check</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>true</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-90 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>mac</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>get_link_status</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>true</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-91 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>pm_runtime_put</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-92 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-93 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* fire a link status change interrupt to start the watchdog */</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-94 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>msix_entries</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-95 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>ew32</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>ICS</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_ICS_LSC</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_ICR_OTHER</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-96 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>else</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-97 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>ew32</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>ICS</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_ICS_LSC</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-98 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-99 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-100 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>.</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-101 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-102 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-103 class=crayon-line><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000e_setup_rx_resources</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_ring</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-104 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-105 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-106 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_buffer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-107 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>size</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>desc_len</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-v>ENOMEM</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-108 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-109 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-110 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>size</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-r>sizeof</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_buffer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-111 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#20998;&#37197;buffer info&#65292;&#29992;&#20110;&#20851;&#32852;desc&#65292;&#20998;&#37197;&#30340;&#20010;&#25968;rx_ring-&gt;count&#40664;&#35748;&#20026;&#65292;&#20351;&#29992;&#30340;&#26159;vzalloc&#65292;allocate virtually continguos memory with zero fill</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-112 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>vzalloc</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>size</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-113 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-114 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-115 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#20026;&#25903;&#25345;packet split&#65292;&#38656;&#35201;&#21021;&#22987;&#21270;e1000_ps_page&#32467;&#26500;&#65292;&#29992;&#20110;&#25910;&#21253;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-116 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>for</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-117 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-118 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>ps_pages</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>kcalloc</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>PS_PAGE_BUFFERS</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-119 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-r>sizeof</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_ps_page</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-120 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>GFP_KERNEL</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-121 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>ps_pages</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-122 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err_pages</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-123 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-124 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#21487;&#33021;&#35013;&#20004;&#20010;&#32467;&#26500;&#20307;&#65292;&#19968;&#26159;e1000_tx_desc&#65292;&#19968;&#26159;e1000_rx_desc_packet_split&#65292;&#20294;&#21069;&#32773;&#35201;&#23567;&#65292;&#25152;&#20197;&#20998;&#37197;&#22823;&#30340;&#65292;&#21487;&#20197;&#20860;&#23481;&#23567;&#30340;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-125 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>desc_len</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-r>sizeof</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>union</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_rx_desc_packet_split</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-126 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-127 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Round up to nearest 4K */</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-128 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>size</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>desc_len</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-129 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>size</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ALIGN</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>size</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>4096</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-130 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#20998;&#37197;desc</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-131 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_alloc_ring_dma</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-132 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-133 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err_pages</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-134 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-135 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_clean</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-136 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_use</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-137 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>rx_skb_top</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>NULL</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-138 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-139 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-140 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>.</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-141 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-142 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-143 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_request_irq</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-144 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-145 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>net_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-146 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-147 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-148 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>&nbsp;&nbsp;&nbsp;&nbsp;#define E1000E_INT_MODE_LEGACY 0</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-149 class=crayon-line><SPAN class=crayon-c>&nbsp;&nbsp;&nbsp;&nbsp;#define E1000E_INT_MODE_MSI &nbsp;&nbsp;&nbsp;&nbsp;1</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-150 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>&nbsp;&nbsp;&nbsp;&nbsp;#define E1000E_INT_MODE_MSIX 2</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-151 class=crayon-line><SPAN class=crayon-c>&nbsp;&nbsp;&nbsp;&nbsp; eth0&#20026;E1000E_INT_MODE_MSI&#27169;&#24335;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-152 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>&nbsp;&nbsp;&nbsp;&nbsp; # cat /proc/interrupts | grep eth0</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-153 class=crayon-line><SPAN class=crayon-c>&nbsp;&nbsp;&nbsp;&nbsp; 46:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;91341&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;IR-PCI-MSI-edge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eth0</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-154 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-155 class=crayon-line><SPAN class=crayon-c>&nbsp;&nbsp;&nbsp;&nbsp; eth1&#20026;E1000E_INT_MODE_MSIX&#27169;&#24335;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-156 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>&nbsp;&nbsp;&nbsp;&nbsp; # cat /proc/interrupts | grep eth1</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-157 class=crayon-line><SPAN class=crayon-c>&nbsp;&nbsp;&nbsp;&nbsp; 47:&nbsp;&nbsp;&nbsp;&nbsp; 103786&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;IR-PCI-MSI-edge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eth1-rx-0</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-158 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>&nbsp;&nbsp;&nbsp;&nbsp; 48:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;IR-PCI-MSI-edge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eth1-tx-0</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-159 class=crayon-line><SPAN class=crayon-c>&nbsp;&nbsp;&nbsp;&nbsp; 49:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;IR-PCI-MSI-edge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eth1</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-160 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>&nbsp;&nbsp;&nbsp;&nbsp; */</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-161 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>msix_entries</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-162 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#22914;&#26524;&#26159;MSIX&#26041;&#24335;&#65292;&#26377;rx, tx, other 3&#31181;&#20013;&#26029;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-163 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_request_msix</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-164 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-165 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-166 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#25105;x&#65292;&#20986;&#38169;&#20102;&#65292;&#22238;&#28378;&#21040;MSI</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-167 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* fall back to MSI */</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-168 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000e_reset_interrupt_capability</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-169 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>int_mode</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000E_INT_MODE_MSI</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-170 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000e_set_interrupt_capability</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-171 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-172 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>FLAG_MSI_ENABLED</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-173 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#22914;&#26524;&#26159;MSI</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-174 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>request_irq</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>irq</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_intr_msi</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-175 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>name</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-176 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-177 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-178 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-179 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* fall back to legacy interrupt */</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-180 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000e_reset_interrupt_capability</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-181 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>int_mode</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000E_INT_MODE_LEGACY</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-182 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-183 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-184 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>request_irq</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>irq</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_intr</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>IRQF_SHARED</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-185 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>name</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-186 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-187 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e_err</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-s>"Unable to allocate interrupt, Error: %dn"</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-188 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-189 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-190 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-191 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-192 class="crayon-line crayon-striped-line"><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000e_down</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-193 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-194 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>net_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-195 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_hw</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-196 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>u32 </SPAN><SPAN class=crayon-v>tctl</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rctl</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-197 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-198 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* signal that we're down so the interrupt handler does not</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-199 class=crayon-line><SPAN class=crayon-c>* reschedule our watchdog timer</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-200 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-201 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>set_bit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>__E1000_DOWN</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-202 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-203 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* disable receives in the hardware */</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-204 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rctl</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>er32</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>RCTL</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-205 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags2</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>FLAG2_NO_DISABLE_RX</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-206 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>ew32</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>RCTL</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rctl</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>~</SPAN><SPAN class=crayon-v>E1000_RCTL_EN</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-207 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* flush and sleep below */</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-208 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#19981;&#33021;&#21457;&#36865;&#25968;&#25454;&#20102;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-209 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>netif_stop_queue</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-210 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-211 class=crayon-line><SPAN class=crayon-p>#ifdef DEV_NETMAP</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-212 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//down&#30340;&#26102;&#20505;&#65292;&#24182;&#19981;&#38656;&#35201;free&#21861;&#65292;&#21482;&#26159;&#26631;&#35760;ring&#19981;&#33021;&#20351;&#29992;&#20102;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-213 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>netmap_disable_all_rings</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-214 class="crayon-line crayon-striped-line"><SPAN class=crayon-p>#endif</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-215 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-216 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* disable transmits in the hardware */</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-217 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tctl</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>er32</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>TCTL</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-218 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tctl</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>~</SPAN><SPAN class=crayon-v>E1000_TCTL_EN</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-219 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>ew32</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>TCTL</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tctl</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-220 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-221 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* flush both disables and wait for them to finish */</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-222 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1e_flush</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-223 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>usleep_range</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-cn>10000</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>20000</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-224 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#20851;&#20013;&#26029;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-225 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000_irq_disable</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-226 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-227 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>napi_synchronize</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>napi</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-228 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-229 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>del_timer_sync</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>watchdog_timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-230 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>del_timer_sync</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>phy_info_timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-231 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-232 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>netif_carrier_off</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-233 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-234 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>spin_lock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>stats64_lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-235 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000e_update_stats</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-236 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>spin_unlock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>stats64_lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-237 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-238 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000e_flush_descriptors</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-239 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#36825;&#37324;&#21024;&#38500;&#30340;&#26159;tx_ring, rx_ring&#20869;&#37096;&#30340;&#32467;&#26500;&#65292;&#26412;&#36523;&#24182;&#27809;&#26377;&#21024;&#38500;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-240 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000_clean_tx_ring</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-241 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000_clean_rx_ring</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-242 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-243 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>link_speed</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-244 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>link_duplex</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-245 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-246 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Disable Si errata workaround on PCHx for jumbo frame flow */</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-247 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>mac</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>type</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&gt;=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_pch2lan</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-248 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>mtu</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&gt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ETH_DATA_LEN</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-249 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>e1000_lv_jumbo_workaround_ich8lan</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>false</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-250 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e_dbg</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-s>"failed to disable jumbo frame workaround moden"</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-251 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-252 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>pci_channel_offline</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-253 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000e_reset</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-254 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbea1296623949-255 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* TODO: for power management, we could drop the link and</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-256 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* pci_disable_device here.</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-257 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbea1296623949-258 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H2>&#25910;&#21457;&#21253;&#38431;&#21015;</H2>
<P>&#27599;&#19968;&#20010;adapter&#65292;&#37117;&#26377;&#19968;&#20010;tx_ring&#25351;&#38024;&#21644;rx_ring&#25351;&#38024;&#65292;&#20854;&#31867;&#22411;&#20026;struct e1000_ring&#12290;</P>
<DIV id=crayon-569898aadbeb4313012838 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeb4313012838-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeb4313012838-44">44</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbeb4313012838-1 class=crayon-line><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>/* Tx - one ring per active queue */</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-3 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_ring</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-e>tx_ring </SPAN><SPAN class=crayon-v>____cacheline_aligned_in_smp</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>/* Rx */</SPAN><SPAN class=crayon-h> </SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-5 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_ring</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-6 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbeb4313012838-7 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>bool</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>clean_rx</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_ring</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>work_done</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>work_to_do</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>____cacheline_aligned_in_smp</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-9 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>alloc_rx_buf</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_ring</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cleaned_count</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>gfp_t </SPAN><SPAN class=crayon-v>gfp</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-11 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbeb4313012838-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//for ethtool</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-13 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_ring </SPAN><SPAN class=crayon-v>test_tx_ring</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_ring </SPAN><SPAN class=crayon-v>test_rx_ring</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-15 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//descriptor count&#65292;&#25551;&#36848;&#31526;&#20010;&#25968;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>u16 </SPAN><SPAN class=crayon-v>tx_ring_count</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-17 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>u16 </SPAN><SPAN class=crayon-v>rx_ring_count</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-19 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbeb4313012838-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_ring</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-21 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>/* back pointer to adapter */</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>desc</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>/* pointer to ring memory&#65292;&#39537;&#21160;&#33021;&#35775;&#38382;&#30340;&#25551;&#36848;&#31526;&#38431;&#21015;&#39318;&#22320;&#22336; */</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-23 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>dma_addr_t </SPAN><SPAN class=crayon-v>dma</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>/* phys address of ring&#65292;&#23545;&#24212;desc&#65292;&#21487;&#20197;&#29992;&#26469;&#23547;&#22336;&#30828;&#20214;&#35774;&#22791;&#37324;&#30340;&#20869;&#23384;*/</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>size</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>/* length of ring in bytes&#65292;desc&#30340;&#23383;&#33410;&#25968;*/</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-25 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>/* number of desc. in ring&#65292;&#25910;&#21457;&#21253;&#38431;&#21015;&#30340;&#26377;&#22810;&#23569;&#20010;&#25551;&#36848;&#31526;&#65292;&#20063;&#23601;&#26159;&#27133;&#65292;&#21021;&#22987;&#20026;adapter-&gt;tx_ring_count/rx_ring_count*/</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-26 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbeb4313012838-27 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>u16 </SPAN><SPAN class=crayon-v>next_to_use</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-28 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>u16 </SPAN><SPAN class=crayon-v>next_to_clean</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-29 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbeb4313012838-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#35835;&#20889;head&#21644;tail&#20301;&#32622;&#30340;&#29289;&#29702;&#22320;&#22336;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-31 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>__iomem</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>head</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>__iomem</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>tail</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-33 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbeb4313012838-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>/* array of buffer information structs */</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-35 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_buffer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-36 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbeb4313012838-37 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>char</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>name</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>IFNAMSIZ</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>5</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>u32 </SPAN><SPAN class=crayon-v>ims_val</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-39 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>u32 </SPAN><SPAN class=crayon-v>itr_val</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>__iomem</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>itr_register</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-41 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>set_itr</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#36825;&#20010;&#26159;&#25910;&#21253;&#26102;&#65292;&#22914;&#26524;&#36935;&#21040;&#20998;&#29255;&#21253;&#65292;&#38656;&#35201;&#20445;&#23384;&#31532;&#19968;&#20010;&#21253;&#65292;&#21518;&#32493;&#30340;&#21253;&#35201;&#36830;&#25509;&#21040;&#31532;&#19968;&#20010;&#21253;&#65292;&#25152;&#20197;&#21483;top</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-43 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>sk_buff</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>rx_skb_top</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeb4313012838-44 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-sy>;</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<DIV id=crayon-569898aadbebd967933202 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbebd967933202-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbebd967933202-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbebd967933202-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbebd967933202-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbebd967933202-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbebd967933202-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbebd967933202-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbebd967933202-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbebd967933202-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbebd967933202-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbebd967933202-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbebd967933202-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbebd967933202-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbebd967933202-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbebd967933202-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbebd967933202-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbebd967933202-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbebd967933202-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbebd967933202-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbebd967933202-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbebd967933202-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbebd967933202-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbebd967933202-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbebd967933202-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbebd967933202-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbebd967933202-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbebd967933202-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbebd967933202-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbebd967933202-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbebd967933202-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbebd967933202-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbebd967933202-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbebd967933202-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbebd967933202-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbebd967933202-35">35</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbebd967933202-1 class=crayon-line><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_probe</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pci_dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-r>const</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pci_device_id</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>ent</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbebd967933202-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#9500;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>netdev_ops</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>e1000e_netdev</SPAN><SPAN class=crayon-sy>_</SPAN>ops<SPAN class=crayon-h> </SPAN>&#27880;&#20876;&#22238;&#35843;</DIV>
<DIV id=crayon-569898aadbebd967933202-3 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>&#21253;&#21547;<SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>ndo_open</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000</SPAN><SPAN class=crayon-sy>_</SPAN>open</DIV>
<DIV id=crayon-569898aadbebd967933202-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#9492;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_sw_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbebd967933202-5 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>&#9492;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_alloc_queues</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbebd967933202-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#9500;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>kzalloc</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-r>sizeof</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_ring</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>GFP_KERNEL</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbebd967933202-7 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#20174;&#36825;&#20010;&#22823;&#23567;&#21487;&#20197;&#30475;&#20986;<SPAN class=crayon-i>e1000e</SPAN>&#27599;&#19968;&#20010;<SPAN class=crayon-i>adapter</SPAN>&#19979;&#38754;&#65292;&#26377;&#19988;&#21482;&#26377;&#19968;&#20010;<SPAN class=crayon-v>tx</SPAN><SPAN class=crayon-sy>_</SPAN>ring&#21644;<SPAN class=crayon-v>rx</SPAN><SPAN class=crayon-sy>_</SPAN>ring</DIV>
<DIV id=crayon-569898aadbebd967933202-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#9500;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_ring_count</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_DEFAULT_TXD</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>256</SPAN></DIV>
<DIV id=crayon-569898aadbebd967933202-9 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#9492;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>adapter </SPAN><SPAN class=crayon-v>rx</SPAN><SPAN class=crayon-sy>_</SPAN>ring&#20063;&#22312;&#36825;&#37324;&#21021;&#22987;&#21270;&#65292;&#27969;&#31243;&#19968;&#26679;</DIV>
<DIV id=crayon-569898aadbebd967933202-10 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbebd967933202-11 class=crayon-line><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_open</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>net_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbebd967933202-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#9500;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000e_setup_tx_resources</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_ring</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbebd967933202-13 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#9500;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>vzalloc</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-r>sizeof</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_buffer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN>&#20998;&#37197;<SPAN class=crayon-v>buffer_info</SPAN></DIV>
<DIV id=crayon-569898aadbebd967933202-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#9500;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>size</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ALIGN</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-r>sizeof</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_tx_desc</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>4096</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h>&nbsp;&nbsp; </SPAN>&#35774;&#32622;<SPAN class=crayon-i>desc</SPAN>&#30340;&#22823;&#23567;</DIV>
<DIV id=crayon-569898aadbebd967933202-15 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#9500;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>desc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>dma_alloc_coherent</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>size</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dma</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>GFP_KERNEL</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbebd967933202-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#21018;&#25165;&#35774;&#32622;&#20102;<SPAN class=crayon-i>desc</SPAN>&#30340;&#22823;&#23567;&#65292;&#29616;&#22312;&#24314;&#31435;&#19968;&#33268;&#24615;&#26144;&#23556;&#65292;&#20998;&#37197;<SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-i>desc</SPAN>&#32473;&#39537;&#21160;&#20351;&#29992;</DIV>
<DIV id=crayon-569898aadbebd967933202-17 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#24635;&#32447;&#22320;&#22336;<SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-i>dma</SPAN>&#20026;&#35774;&#22791;&#33021;&#35775;&#38382;&#30340;&#22320;&#22336;</DIV>
<DIV id=crayon-569898aadbebd967933202-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#9500;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_use</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbebd967933202-19 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#9492;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_clean</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbebd967933202-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#9500;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000e_setup_rx_resources</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_ring</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbebd967933202-21 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#9492;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>rx_skb_top</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>NULL</SPAN><SPAN class=crayon-h> </SPAN>&#25910;&#21253;&#38431;&#21015;&#21644;&#21457;&#21253;&#38431;&#21015;&#26159;&#31163;&#19981;&#24320;&#30340;&#22909;&#22522;&#21451;&#65292;</DIV>
<DIV id=crayon-569898aadbebd967933202-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#21021;&#22987;&#21270;&#37117;&#24046;&#19981;&#22810;&#65292;&#21482;&#26159;&#65292;&#22810;&#21021;&#22987;&#21270;&#20102;&#19968;&#20123;&#29305;&#26377;&#21464;&#37327;&#65292;&#20363;&#22914;<SPAN class=crayon-v>rx_skb</SPAN><SPAN class=crayon-sy>_</SPAN>top&#65292;<SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>ps</SPAN><SPAN class=crayon-sy>_</SPAN>pages</DIV>
<DIV id=crayon-569898aadbebd967933202-23 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#9492;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_configure</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbebd967933202-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>&#9500;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_configure_tx</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbebd967933202-25 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#9500;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>head</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>hw_addr</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>E1000_TDH</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbebd967933202-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#9492;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tail</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>hw_addr</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>E1000_TDT</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbebd967933202-27 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-i>head</SPAN>&#21644;<SPAN class=crayon-i>tail</SPAN>&#29992;&#20110;&#21516;&#27493;&#35774;&#22791;&#21457;&#21253;&#20854;&#23454;&#21644;&#32467;&#26463;&#20301;&#32622;<SPAN class=crayon-h> </SPAN></DIV>
<DIV id=crayon-569898aadbebd967933202-28 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>&#9500;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_configure_rx</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbebd967933202-29 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#38500;&#20102;&#21644;<SPAN class=crayon-v>tx</SPAN><SPAN class=crayon-sy>_</SPAN>ring&#31867;&#20284;&#35774;&#32622;<SPAN class=crayon-i>head</SPAN>&#21644;<SPAN class=crayon-i>tail</SPAN>&#22806;&#65292;&#36824;&#35201;&#26681;&#25454;&#19981;&#21516;&#30340;&#26465;&#20214;&#35774;&#32622;<SPAN class=crayon-v>clean</SPAN><SPAN class=crayon-sy>_</SPAN>rx&#21644;<SPAN class=crayon-v>alloc_rx</SPAN><SPAN class=crayon-sy>_</SPAN>buf&#65292;&#20363;&#22914;</DIV>
<DIV id=crayon-569898aadbebd967933202-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#9500;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>clean_rx</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_clean_jumbo_rx</SPAN><SPAN class=crayon-sy>_</SPAN>irq&#65292;&#20174;&#32593;&#21345;&#37324;&#21462;&#20986;&#25509;&#25910;&#25104;&#21151;&#30340;&#21253;&#65292;</DIV>
<DIV id=crayon-569898aadbebd967933202-31 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>&#36882;&#20132;&#32473;&#19978;&#23618;&#21327;&#35758;&#26632;&#65292;&#28165;&#38500;&#23545;&#24212;<SPAN class=crayon-i>slot</SPAN>&#30340;<SPAN class=crayon-v>desc</SPAN></DIV>
<DIV id=crayon-569898aadbebd967933202-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#9492;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>alloc_rx_buf</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_alloc_jumbo_rx</SPAN><SPAN class=crayon-sy>_</SPAN>buffers&#65292;&#20026;&#32593;&#21345;&#30340;&#21487;&#29992;<SPAN class=crayon-i>slot</SPAN>&#20998;&#37197;&#20869;&#23384;</DIV>
<DIV id=crayon-569898aadbebd967933202-33 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>&#9492;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-e>alloc_rx_buf</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_desc_unused</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>GFP_KERNEL</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN>&#25910;&#21253;&#38656;&#35201;&#25552;&#21069;&#20026;&#32593;&#21345;&#20998;&#37197;&#20869;&#23384;</DIV>
<DIV id=crayon-569898aadbebd967933202-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#36825;&#37324;<SPAN class=crayon-e>e1000_desc_unused</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-o>+</SPAN><SPAN class=crayon-v>ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_clean</SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-v>ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_use</SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-cn>1</SPAN></DIV>
<DIV id=crayon-569898aadbebd967933202-35 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#22240;&#20026;<SPAN class=crayon-v>count</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-cn>256</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>next_to_clean</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-v>next_to_use</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-cn>0</SPAN>&#65292;&#35745;&#31639;&#20986;&#26469;&#24212;&#35813;&#26159;<SPAN class=crayon-cn>255</SPAN>&#32780;&#38750;<SPAN class=crayon-cn>256</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P>&#38500;&#20102;e1000_configure&#31532;&#19968;&#27425;&#20250;&#35843;&#29992;alloc_rx_buf&#26469;&#21021;&#22987;&#21270;&#20869;&#23384;&#22806;&#65292;clean_rx&#37324;&#20063;&#20250;&#35843;&#29992;alloc_rx_buf&#37324;&#34917;&#20805;&#20869;&#23384;&#12290;<BR>clean_rx&#21448;&#22312;&#21738;&#37324;&#35843;&#29992;&#30340;&#21602;&#65311;&#20551;&#35774;&#25910;64&#20010;&#21253;&#65292;weight=64</P>
<DIV id=crayon-569898aadbec9326046395 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbec9326046395-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbec9326046395-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbec9326046395-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbec9326046395-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbec9326046395-5">5</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbec9326046395-1 class=crayon-line><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000e_poll</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>napi_struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>napi</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>weight</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbec9326046395-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbec9326046395-3 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>work_done</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbec9326046395-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-e>clean_rx</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>work_done</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>weight</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbec9326046395-5 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H2>&#25910;&#21253;</H2>
<H3>&#25910;&#21253;&#35302;&#21457;</H3>
<P>&#19968;&#31181;&#26159;&#25910;&#21040;&#20013;&#26029;&#21518;&#35843;&#29992;e1000e_poll&#65292;&#19968;&#31181;&#26159;&#36890;&#36807;napi&#30452;&#25509;&#36718;&#35810;&#65292;&#20107;&#23454;&#19978;&#65292;e1000e&#22312;&#25910;&#21040;&#20013;&#26029;&#21518;&#65292;&#20063;&#26159;&#35843;&#29992;&#30340;napi&#36718;&#35810;&#65292;&#20197;MSI&#20013;&#26029;&#20026;&#20363;&#65306;</P>
<DIV id=crayon-569898aadbed0929742329 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbed0929742329-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbed0929742329-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbed0929742329-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbed0929742329-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbed0929742329-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbed0929742329-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbed0929742329-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbed0929742329-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbed0929742329-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbed0929742329-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbed0929742329-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbed0929742329-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbed0929742329-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbed0929742329-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbed0929742329-15">15</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbed0929742329-1 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>irqreturn_t </SPAN><SPAN class=crayon-e>e1000_intr_msi</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__always_unused </SPAN><SPAN class=crayon-v>irq</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>data</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbed0929742329-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbed0929742329-3 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>.</SPAN></DIV>
<DIV id=crayon-569898aadbed0929742329-4 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbed0929742329-5 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#36825;&#37324;&#65292;&#21551;&#29992;napi sched</SPAN></DIV>
<DIV id=crayon-569898aadbed0929742329-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>napi_schedule_prep</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>napi</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbed0929742329-7 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>total_tx_bytes</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbed0929742329-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>total_tx_packets</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbed0929742329-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>total_rx_bytes</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbed0929742329-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>total_rx_packets</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbed0929742329-11 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>__napi_schedule</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>napi</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbed0929742329-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbed0929742329-13 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbed0929742329-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>IRQ_HANDLED</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbed0929742329-15 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<P>&#22914;&#26524;&#27809;&#26377;&#25171;&#19978;NAPI_STATE_DISABLE&#26631;&#35760;&#65292;&#20063;&#27809;&#26377;&#25171;&#19978;NAPI_STATE_SCHED&#26631;&#35760;&#65292;&#25165;OK&#12290;</P>
<DIV id=crayon-569898aadbed6612240325 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbed6612240325-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbed6612240325-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbed6612240325-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbed6612240325-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbed6612240325-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbed6612240325-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbed6612240325-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbed6612240325-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbed6612240325-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbed6612240325-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbed6612240325-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbed6612240325-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbed6612240325-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbed6612240325-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbed6612240325-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbed6612240325-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbed6612240325-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbed6612240325-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbed6612240325-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbed6612240325-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbed6612240325-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbed6612240325-22">22</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbed6612240325-1 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-m>inline</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>bool</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>napi_schedule_prep</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>napi_struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>n</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbed6612240325-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbed6612240325-3 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>napi_disable_pending</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>n</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN></DIV>
<DIV id=crayon-569898aadbed6612240325-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>test_and_set_bit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>NAPI_STATE_SCHED</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>n</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbed6612240325-5 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbed6612240325-6 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbed6612240325-7 class=crayon-line><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__napi_schedule</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>napi_struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>n</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbed6612240325-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbed6612240325-9 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbed6612240325-10 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbed6612240325-11 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>local_irq_save</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#31105;&#27490;&#20013;&#26029;&#65292;&#24182;&#35760;&#20303;&#20043;&#21069;&#30340;&#29366;&#24577;</SPAN></DIV>
<DIV id=crayon-569898aadbed6612240325-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>____napi_schedule</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-e>__get_cpu_var</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>softnet_data</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>n</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbed6612240325-13 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>local_irq_restore</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#24674;&#22797;&#20013;&#26029;</SPAN></DIV>
<DIV id=crayon-569898aadbed6612240325-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbed6612240325-15 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbed6612240325-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-m>inline</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>____napi_schedule</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>softnet_data</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>sd</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbed6612240325-17 class=crayon-line><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>napi_struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>napi</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbed6612240325-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbed6612240325-19 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#25226;&#33258;&#24049;&#25346;&#21040;per cpu&#30340;softnet_data&#19978;&#65292;&#35302;&#21457;NET_RX_SOFTIRQ&#36719;&#20013;&#26029;</SPAN></DIV>
<DIV id=crayon-569898aadbed6612240325-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>list_add_tail</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>napi</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>poll_list</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>sd</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>poll_list</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbed6612240325-21 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>__raise_softirq_irqoff</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>NET_RX_SOFTIRQ</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbed6612240325-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<P>&#22312;net_dev_init&#30340;&#26102;&#20505;&#65292;&#20320;&#20250;&#30475;&#21040;<BR>open_softirq(NET_TX_SOFTIRQ, net_tx_action);<BR>open_softirq(NET_RX_SOFTIRQ, net_rx_action);<BR>&#37027;&#20040;&#65292;&#36719;&#20013;&#26029;&#35302;&#21457;&#20989;&#25968;&#20026;net_rx_action</P>
<DIV id=crayon-569898aadbedd309985929 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-57">57</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-58">58</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-59">59</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-60">60</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-61">61</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-62">62</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-63">63</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-64">64</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-65">65</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-66">66</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-67">67</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-68">68</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbedd309985929-69">69</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbedd309985929-70">70</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbedd309985929-1 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>net_rx_action</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>softirq_action</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>h</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-3 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>softnet_data</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>sd</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-e>__get_cpu_var</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>softnet_data</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>time_limit</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>jiffies</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>2</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-5 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>budget</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>netdev_budget</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>have</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-7 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>zcm_wakeup_fn_t </SPAN><SPAN class=crayon-v>zcm_wakeup_ptr</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>NULL</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-8 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbedd309985929-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>local_irq_disable</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-11 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#36941;&#21382;&#20043;&#21069;&#25346;&#22312;&#22312;&#36825;&#19978;&#38754;&#30340;napi_struct</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>while</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>list_empty</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>sd</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>poll_list</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-13 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>napi_struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>n</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>work</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>weight</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-15 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbedd309985929-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* If softirq window is exhuasted then punt.</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-17 class=crayon-line><SPAN class=crayon-c>* Allow this to run for 2 jiffies since which will allow</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* an average latency of 1.5/HZ.</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-19 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>budget</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>||</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>time_after_eq</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>jiffies</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>time_limit</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-21 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>softnet_break</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-22 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbedd309985929-23 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>local_irq_enable</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-24 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbedd309985929-25 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Even though interrupts have been re-enabled, this</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* access is safe because interrupts can only add new</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-27 class=crayon-line><SPAN class=crayon-c>* entries to the tail of this list, and only -&gt;poll()</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-28 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* calls can remove this head entry from the list.</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-29 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>n</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>list_first_entry</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>sd</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>poll_list</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>napi_struct</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>poll_list</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-31 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbedd309985929-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>have</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>netpoll_poll_lock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>n</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-33 class=crayon-line><SPAN class=crayon-h></SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#36825;&#20010;&#26435;&#37325;&#65292;&#34920;&#31034;&#19968;&#27425;&#26368;&#22810;&#21487;&#20197;&#22788;&#29702;&#22810;&#23569;&#20010;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-35 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>weight</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>n</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>weight</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-36 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbedd309985929-37 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* This NAPI_STATE_SCHED test is for avoiding a race</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* with netpoll's poll_napi().&nbsp;&nbsp;Only the entity which</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-39 class=crayon-line><SPAN class=crayon-c>* obtains the lock and sees NAPI_STATE_SCHED set will</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* actually make the -&gt;poll() call.&nbsp;&nbsp;Therefore we avoid</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-41 class=crayon-line><SPAN class=crayon-c>* accidentally calling -&gt;poll() when NAPI is not scheduled.</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-43 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>work</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-44 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>test_bit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>NAPI_STATE_SCHED</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>n</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-45 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#36824;&#26816;&#26597;&#19968;&#19979;&#36825;&#20010;&#26631;&#35760;&#65292;&#27809;&#26377;&#25171;NAPI_STATE_SCHED&#23601;&#19981;&#35843;&#29992;poll</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-46 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>rcu_read_lock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-47 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#36890;&#29992;&#32593;&#21345;&#22788;&#29702;&#26041;&#26696;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>zcm_wakeup_ptr</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>rcu_dereference</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>zcm_wakeup_fn</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-49 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>zcm_poll_enabled</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>zcm_wakeup_ptr</SPAN><SPAN class=crayon-h> </SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-50 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>n</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>n</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>vt_zcm_ptr</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-51 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>work</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>zcm_wakeup_ptr</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>n</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>vt_zcm_ptr</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>n</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>else</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-53 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#22312;e1000_probe&#30340;&#26102;&#20505;&#65292;&#24050;&#32463;&#27880;&#20876;&#20102;poll=e1000e_poll, weight=64</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-54 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//netif_napi_add(netdev, &amp;adapter-&gt;napi, e1000e_poll, 64);</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-55 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>work</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>n</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-e>poll</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>n</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>weight</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#22238;&#35843;poll</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-56 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>trace_napi_poll</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>n</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-57 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-58 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>rcu_read_unlock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-59 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-60 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbedd309985929-61 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>WARN_ON_ONCE</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>work</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&gt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>weight</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-62 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>budget</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>work</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-63 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>local_irq_disable</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-64 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbedd309985929-65 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>.</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-66 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbedd309985929-67 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>netpoll_poll_unlock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>have</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-68 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-69 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>.</SPAN></DIV>
<DIV id=crayon-569898aadbedd309985929-70 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<P>&#20877;&#22238;&#21040;e1000e&#39537;&#21160;&#65306;</P>
<DIV id=crayon-569898aadbee6724921636 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbee6724921636-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbee6724921636-43">43</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbee6724921636-1 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000e_poll</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>napi_struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>napi</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>weight</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-3 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>container_of</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>napi</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-v>napi</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-5 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_hw</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>net_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>poll_dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-7 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_cleaned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>work_done</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#36825;&#37324;work_done&#35201;&#32622;&#65292;clean_rx&#22238;&#35843;&#37324;&#38754;&#27809;&#32622;</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-8 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbee6724921636-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>netdev_priv</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>poll_dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-11 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>test_bit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>__E1000_DOWN</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-13 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>zcm_nic_t</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>nic</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>nmd_nic</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>poll_dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-15 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-17 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>msix_entries</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>||</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>ims_val</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>ims_val</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-19 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_cleaned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_clean_tx_irq</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#36825;&#37324;&#65292;&#26597;&#30475;&#24182;&#22238;&#25910;tx slot</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-20 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbee6724921636-21 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#25105;&#20204;&#22312;e1000_configure_rx&#65292;&#27880;&#20876;&#20102;&#65292;&#23558;&#24050;&#32463;done&#30340;data&#65292;&#20174;&#32593;&#21345;&#24324;&#21040;&#20869;&#26680;&#21435;</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//adapter-&gt;clean_rx = e1000_clean_rx_irq;</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-23 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//adapter-&gt;alloc_rx_buf = e1000_alloc_rx_buffers;</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-e>clean_rx</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>work_done</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>weight</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-25 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbee6724921636-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>tx_cleaned</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-27 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>work_done</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>weight</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-28 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbee6724921636-29 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* If weight not fully consumed, exit the polling mode */</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>work_done</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>weight</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-31 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>itr_setting</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>3</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000_set_itr</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#26681;&#25454;&#24403;&#21069;&#30340;&#25968;&#25454;&#37327;&#65292;&#21160;&#24577;&#35843;&#33410;iterrupt&#30340;&#38388;&#38553;</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-33 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>napi_complete</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>napi</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>test_bit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>__E1000_DOWN</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-35 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>msix_entries</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-36 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>ew32</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>IMS</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>ims_val</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-37 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>else</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000_irq_enable</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#24674;&#22797;IRQ</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-39 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-41 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbee6724921636-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>work_done</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbee6724921636-43 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<P>&#25105;&#20204;&#20998;&#26512;&#19968;&#19979;&#24040;&#24103;&#30340;&#20998;&#37197;&#65292;&#31867;&#20284;e1000_alloc_rx_buffers&#65306;</P>
<DIV id=crayon-569898aadbeee520907135 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-57">57</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-58">58</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-59">59</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-60">60</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-61">61</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-62">62</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-63">63</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-64">64</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-65">65</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-66">66</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-67">67</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-68">68</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-69">69</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-70">70</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-71">71</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-72">72</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-73">73</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-74">74</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-75">75</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-76">76</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-77">77</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-78">78</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-79">79</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-80">80</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbeee520907135-81">81</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbeee520907135-82">82</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbeee520907135-1 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_alloc_jumbo_rx_buffers</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_ring</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cleaned_count</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>gfp_t </SPAN><SPAN class=crayon-v>gfp</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-3 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-5 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>net_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pci_dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-7 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>union</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_rx_desc_extended</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>rx_desc</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_buffer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>sk_buff</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-11 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>bufsz</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>256</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>16</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>/* for skb_reserve */</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#26368;&#24320;&#22987;&#30340;&#26102;&#20505;&#65292;next_to_use&#20026;&#65292;cleaned_count = 255&#19988;&#26465;&#20214;&#20026;&#20808;&#21462;&#20540;&#20877;--&#30340;(cleaned_count--)&#65292;&#25152;&#20197;&#65292;&#35201;&#24490;&#29615;&#27425;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-13 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_use</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//recv&#20998;&#37197;&#30340;&#26102;&#20505;&#65292;&#26159;&#20026;next to use&#20998;&#37197;&#65292;&#32780;next to clean&#20026;&#24050;&#32463;&#26377;&#25968;&#25454;&#21253;&#20102;&#30340;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-15 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbeee520907135-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>while</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>cleaned_count</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN><SPAN class=crayon-c>//&#19968;&#27425;&#24615;&#20998;&#37197;&#30340;&#26368;&#22823;&#20010;&#25968;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-17 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#23613;&#21487;&#33021;&#22238;&#25910;&#21033;&#29992;&#65292;&#20363;&#22914;drop&#30340;&#21253;&#65292;&#21487;&#22238;&#25910;&#21033;&#29992;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-19 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>skb_trim</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-21 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>check_page</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-23 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbeee520907135-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__netdev_alloc_skb_ip_align</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>bufsz</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>gfp</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-25 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Better luck next round */</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-27 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>alloc_rx_buff_failed</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-28 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>break</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-29 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-30 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbeee520907135-31 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#20854;&#23454;SKB&#22312;&#32593;&#21345;&#25910;&#21253;&#30340;&#26102;&#20505;&#29992;&#19981;&#21040;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>check_page</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-33 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* allocate a new page if necessary */</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//e1000e&#39537;&#21160;&#35775;&#38382;&#30340;&#26159;buffer_info-&gt;page&#65292;&#35774;&#22791;&#35775;&#38382;&#30340;&#26159;buffer_info-&gt;dma</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-35 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>page</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-36 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>page</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>alloc_page</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>gfp</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-37 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>page</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN><SPAN class=crayon-c>//&#20998;&#37197;&#22833;&#36133;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>alloc_rx_buff_failed</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-39 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>break</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-41 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-42 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbeee520907135-43 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dma</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-44 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dma</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>dma_map_page</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-45 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>page</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-46 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>PAGE_SIZE</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-47 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>DMA_FROM_DEVICE</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>dma_mapping_error</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dma</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-49 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>alloc_rx_buff_failed</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-50 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>break</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-51 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-53 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbeee520907135-54 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rx_desc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>E1000_RX_DESC_EXT</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-55 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#26368;&#32456;&#22320;&#22336;&#36171;&#20540;&#32473;&#25551;&#36848;&#31526;&#30340;read.buffer_addr&#65292;&#25165;&#34920;&#31034;&#27492;&#20010;slot&#21487;&#20197;&#25910;&#21253;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-56 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rx_desc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>read</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>buffer_addr</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>cpu_to_le64</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dma</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-57 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#26368;&#21518;&#19968;&#27425;&#65292;i=254, clean_count&#20026;&#65292;&#36825;&#26102;&#20505;&#65292;&#24050;&#32463;&#24490;&#29615;&#20102;&#27425;&#65292;&#25509;&#19979;&#26469;++i&#65292;i=255&#65292;&#20294;&#26159;&#65292;&#36824;&#27809;&#21040;&#65292;&#25152;&#20197;&#65292;break&#20986;&#21435;&#21518;i=255, clean_count=0&#65292;buffer_info[i=255]</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-58 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-59 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-60 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-61 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-62 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#31532;&#19968;&#27425;&#36827;&#26469;&#65292;&#32034;&#24341;&#20026;&#30340;&#25551;&#36848;&#31526;&#65292;&#27809;&#26377;&#21021;&#22987;&#21270;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-63 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>likely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_use</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-64 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#34920;&#31034;&#21448;&#20934;&#22791;&#22909;&#20869;&#23384;&#65292;next_to_use&#25351;&#21521;&#35774;&#22791;&#19981;&#33021;&#29992;&#30340;&#20869;&#23384;&#30340;&#24320;&#22987;&#20301;&#32622;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-65 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_use</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-66 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#36825;&#37324;i--&#33719;&#21462;&#26368;&#21518;&#19968;&#20010;&#32034;&#24341;&#65292;&#22240;&#20026;&#19978;&#38754;&#30340;i&#26159;&#22810;&#20102;&#19968;&#20301;&#30340;&#65292;&#26412;&#26469;&#20010;&#27133;&#65292;&#20294;&#21021;&#22987;&#21270;&#21482;&#21021;&#22987;&#21270;&#20102;[0,254]=255&#20010;&#65292;&#32780;i&#20026;&#24182;&#19981;&#34920;&#31034;&#26368;&#21518;&#19968;&#20010;&#65292;i-1&#25165;&#34920;&#31034;&#26368;&#21518;&#19968;&#20010;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-67 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-68 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-69 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#23545;rx_ring&#26469;&#35828;&#65292;rx_ring-&gt;next_to_use-1&#34920;&#31034;tail</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-70 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#27492;&#26102;&#65292;&#25910;&#21253;&#38431;&#21015;&#37324;&#30340;tail&#23545;&#32593;&#21345;&#26469;&#35828;&#65292;&#34920;&#31034;&#21487;&#20197;&#23558;&#25968;&#25454;&#21253;&#20889;&#20837;&#21040;&lt;=tail&#25351;&#31034;&#25551;&#36848;&#31526;&#20301;&#32622;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-71 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Force memory writes to complete before letting h/w</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-72 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* know there are new descriptors to fetch.&nbsp;&nbsp;(Only</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-73 class=crayon-line><SPAN class=crayon-c>* applicable for weak-ordered memory model archs,</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-74 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* such as IA-64).</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-75 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-76 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>wmb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-77 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags2</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>FLAG2_PCIM2PCI_ARBITER_WA</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-78 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000e_update_rdt_wa</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-79 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>else</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-80 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>writel</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tail</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-81 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbeee520907135-82 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H3>&#20174;&#32593;&#21345;&#21040;&#20869;&#26680;</H3>
<P></P>
<DIV id=crayon-569898aadbefa698097087 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-57">57</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-58">58</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-59">59</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-60">60</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-61">61</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-62">62</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-63">63</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-64">64</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-65">65</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-66">66</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-67">67</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-68">68</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-69">69</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-70">70</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-71">71</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-72">72</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-73">73</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-74">74</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-75">75</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-76">76</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-77">77</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-78">78</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-79">79</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-80">80</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-81">81</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-82">82</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-83">83</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-84">84</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-85">85</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-86">86</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-87">87</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-88">88</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-89">89</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-90">90</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-91">91</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-92">92</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-93">93</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-94">94</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-95">95</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-96">96</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-97">97</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-98">98</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-99">99</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-100">100</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-101">101</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-102">102</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-103">103</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-104">104</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-105">105</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-106">106</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-107">107</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-108">108</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-109">109</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-110">110</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-111">111</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-112">112</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-113">113</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-114">114</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-115">115</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-116">116</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-117">117</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-118">118</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-119">119</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-120">120</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-121">121</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-122">122</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-123">123</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-124">124</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-125">125</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-126">126</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-127">127</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-128">128</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-129">129</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-130">130</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-131">131</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-132">132</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-133">133</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-134">134</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-135">135</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-136">136</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-137">137</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-138">138</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-139">139</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-140">140</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-141">141</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-142">142</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-143">143</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-144">144</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-145">145</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-146">146</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-147">147</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-148">148</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-149">149</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-150">150</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-151">151</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-152">152</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-153">153</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-154">154</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-155">155</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-156">156</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-157">157</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-158">158</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-159">159</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-160">160</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-161">161</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-162">162</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-163">163</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-164">164</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-165">165</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-166">166</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-167">167</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-168">168</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-169">169</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-170">170</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-171">171</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbefa698097087-172">172</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbefa698097087-173">173</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbefa698097087-1 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>bool</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_clean_rx_irq</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_ring</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>work_done</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>work_to_do</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-3 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-5 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>net_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pci_dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-7 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_hw</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>union</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_rx_desc_extended</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>rx_desc</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>next_rxd</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_buffer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>next_buffer</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>u32 </SPAN><SPAN class=crayon-v>length</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>staterr</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-11 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cleaned_count</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-13 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>bool</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cleaned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>false</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>total_rx_bytes</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>total_rx_packets</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-15 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-p>#ifdef DEV_NETMAP</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-17 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#36825;&#37324;&#22914;&#26524;&#36820;&#22238;&#38750;&#65292;&#23601;&#34920;&#31034;netmap&#24050;&#32463;&#22788;&#29702;&#20102;&#65292;&#22914;&#26524;&#36820;&#22238;&#65292;&#34920;&#31034;&#36208;&#20197;&#21069;e1000e&#30340;&#36923;&#36753;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>netmap_rx_irq</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>work_done</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-19 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>/* seems to be ignored */</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-p>#endif /* DEV_NETMAP */</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-21 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_clean</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rx_desc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>E1000_RX_DESC_EXT</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-23 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>staterr</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>le32_to_cpu</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rx_desc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>wb</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>upper</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>status_error</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-25 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#36825;&#37324;&#19968;&#20010;&#24490;&#29615;&#65292;&#20174;next_to_clean&#24320;&#22987;&#65292;&#23558;&#27599;&#20010;Rx slot&#19978;&#30340;&#21253;&#29366;&#24577;&#20449;&#24687;&#21462;&#20986;&#26469;&#65292;&#22914;&#26524;&#25171;&#19978;&#20102;E1000_RXD_STAT_DD(Descriptor Done&#26631;&#35760;)&#65292;&#23601;&#34920;&#31034;&#21487;&#20197;&#20256;&#36865;&#21040;&#19978;&#23618;&#21327;&#35758;&#26632;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>while</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>staterr</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_RXD_STAT_DD</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-27 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>sk_buff</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-28 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-29 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>work_done</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&gt;=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>work_to_do</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>break</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-31 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>work_done</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>rmb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>/* read descriptor and rx_buffer_info after status DD */</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-33 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-35 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>NULL</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#19978;&#23618;&#25176;&#31649;skb&#24182;&#28165;&#38500;&#21407;slot&#19978;&#30340;skb&#25351;&#38024;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-36 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-37 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-39 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#21462;&#19979;&#19968;&#20010;slot</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-41 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>next_rxd</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>E1000_RX_DESC_EXT</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>prefetch</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>next_rxd</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-43 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-44 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>next_buffer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-45 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-46 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>cleaned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>true</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-47 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>cleaned_count</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#32473;&#35774;&#22791;&#30340;DMA&#22320;&#22336;&#20063;&#35201;&#35299;&#24320;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-49 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#36825;&#20010;&#22320;&#22336;&#22312;&#21738;&#20799;&#26144;&#23556;&#30340;&#65311;&#21442;&#32771;e1000_alloc_rx_buffers</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-50 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>dma_unmap_single</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dma</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-51 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>rx_buffer_len</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>DMA_FROM_DEVICE</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dma</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-53 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>prefetch</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>data</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NET_IP_ALIGN</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-54 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-55 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>length</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>le16_to_cpu</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rx_desc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>wb</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>upper</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>length</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-56 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-57 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* !EOP means multiple descriptors were used to store a single</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-58 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* packet, if that's the case we need to toss it.&nbsp;&nbsp;In fact, we</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-59 class=crayon-line><SPAN class=crayon-c>* need to toss every packet with the EOP bit clear and the</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-60 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* next frame that _does_ have the EOP bit set, as it is by</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-61 class=crayon-line><SPAN class=crayon-c>* definition only a frame fragment</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-62 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-63 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>staterr</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_RXD_STAT_EOP</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-c>//&#22914;&#26524;&#27809;&#26377;&#25171;&#19978;End of Packet&#26631;&#35760;&#65292;&#36825;&#20010;&#21253;&#35201;&#20002;&#24323;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-64 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags2</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>FLAG2_IS_DISCARDING</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-65 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#19981;&#25903;&#25345;&#22810;&#20010;Fragement</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-66 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags2</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>FLAG2_IS_DISCARDING</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-67 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* All receives must fit into a single buffer */</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-68 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e_dbg</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-s>"Receive packet consumed multiple buffersn"</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-69 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* recycle */</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-70 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//skb&#20445;&#30041;&#65292;&#20998;&#37197;&#30340;&#26102;&#20505;&#23601;&#19981;&#29992;&#37325;&#26032;&#20998;&#37197;&#20869;&#23384;&#20102;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-71 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>staterr</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_RXD_STAT_EOP</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-72 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags2</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>~</SPAN><SPAN class=crayon-v>FLAG2_IS_DISCARDING</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-73 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>next_desc</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-74 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-75 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-76 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#21253;&#26377;&#38169;&#35823;&#65292;&#19988;net_device&#19981;&#25509;&#25910;&#38169;&#35823;&#21253;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-77 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>staterr</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_RXDEXT_ERR_FRAME_ERR_MASK</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-78 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>features</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETIF_F_RXALL</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-79 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* recycle */</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-80 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-81 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>next_desc</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-82 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-83 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-84 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* adjust length to remove Ethernet CRC */</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-85 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags2</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>FLAG2_CRC_STRIPPING</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-86 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* If configured to store CRC, don't subtract FCS,</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-87 class=crayon-line><SPAN class=crayon-c>* but keep the FCS bytes out of the total_rx_bytes</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-88 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* counter</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-89 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-90 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>features</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETIF_F_RXFCS</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-91 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>total_rx_bytes</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>4</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#20320;&#20204;&#20063;&#29992;&#39764;&#25968;&#21834;&#65311;&#65311;&#65311;&#35201;&#19981;&#35201;&#36807;CHECKLIST&#65292;&#35201;&#19981;&#35201;&#34987;&#32602;&#27454;&#65311;&#65311;&#65311;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-92 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>else</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-93 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>length</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>4</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-94 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-95 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-96 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>total_rx_bytes</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>length</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-97 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>total_rx_packets</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-98 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-99 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* code added for copybreak, this should improve</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-100 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* performance for small packets with large amounts</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-101 class=crayon-line><SPAN class=crayon-c>* of reassembly being done in the stack</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-102 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-103 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>length</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>copybreak</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-104 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#21253;&#38271;&#23567;&#20110;copybreak(&#24403;&#21069;&#23439;&#20026;)&#30340;&#65292;COPY&#21040;&#23567;&#20869;&#23384;&#32473;&#19978;&#23618;&#65292;&#19981;&#29992;&#28010;&#36153;&#20869;&#23384;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-105 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>sk_buff</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>new_skb</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-106 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>netdev_alloc_skb_ip_align</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>length</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-107 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>new_skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-108 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>skb_copy_to_linear_data_offset</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>new_skb</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-109 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-v>NET_IP_ALIGN</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-110 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>data</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-111 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>NET_IP_ALIGN</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-112 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>length</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-113 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>NET_IP_ALIGN</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-114 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* save the skb in buffer_info as good */</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-115 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-116 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>new_skb</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-117 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-118 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* else just continue with the old one */</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-119 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-120 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* end copybreak code */</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-121 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>skb_put</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>length</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#35774;&#32622;skb&#25968;&#25454;&#38271;&#24230;&#65292;&#22686;&#21152;length</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-122 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-123 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#26816;&#26597;skb check sum&#26159;&#21542;&#27491;&#30830;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-124 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Receive Checksum Offload */</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-125 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000_rx_checksum</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>staterr</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-126 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//rxhash&#65292;&#28041;&#21450;&#21040;&#23558;&#21253;&#20998;&#21457;&#21040;&#21738;&#20010;cpu</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-127 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000_rx_hash</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rx_desc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>wb</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>lower</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>hi_dword</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>rss</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-128 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-129 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000_receive_skb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>staterr</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-130 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>rx_desc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>wb</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>upper</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>vlan</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-131 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-132 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>next_desc</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-133 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rx_desc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>wb</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>upper</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>status_error</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>cpu_to_le32</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>~</SPAN><SPAN class=crayon-cn>0xFF</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-134 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-135 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* return some buffers to hardware, one at a time is too slow */</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-136 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>cleaned_count</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&gt;=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_RX_BUFFER_WRITE</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-137 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-e>alloc_rx_buf</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cleaned_count</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-138 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>GFP_ATOMIC</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-139 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>cleaned_count</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-140 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-141 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-142 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* use prefetched values */</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-143 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rx_desc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>next_rxd</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-144 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>next_buffer</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-145 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-146 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>staterr</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>le32_to_cpu</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rx_desc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>wb</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>upper</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>status_error</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-147 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-148 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_clean</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#19979;&#27425;&#32487;&#32493;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-149 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-150 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>cleaned_count</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_desc_unused</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-151 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>cleaned_count</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-152 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-e>alloc_rx_buf</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cleaned_count</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>GFP_ATOMIC</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-153 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#32047;&#35745;&#35745;&#31639;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-154 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>total_rx_bytes</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>total_rx_bytes</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-155 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>total_rx_packets</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>total_rx_packets</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-156 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cleaned</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-157 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-158 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-159 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_receive_skb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-160 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>net_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>sk_buff</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-161 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>u32 </SPAN><SPAN class=crayon-v>staterr</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__le16 </SPAN><SPAN class=crayon-v>vlan</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-162 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-163 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>u16 </SPAN><SPAN class=crayon-v>tag</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>le16_to_cpu</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>vlan</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-164 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#25171;&#19978;timestamp</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-165 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000e_rx_hwtstamp</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>staterr</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-166 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-167 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>protocol</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>eth_type_trans</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-168 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbefa698097087-169 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>staterr</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_RXD_STAT_VP</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-c>//&#22914;&#26524;&#26159;VLANE&#36824;&#35201;&#25171;&#19978;vlan&#26631;&#35760;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-170 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>__vlan_hwaccel_put_tag</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>htons</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>ETH_P_8021Q</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tag</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-171 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//napi&#25910;&#21253;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-172 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>napi_gro_receive</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>napi</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbefa698097087-173 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<P>gro receive&#20250;&#26681;&#25454;&#24773;&#20917;&#37325;&#32452;&#25968;&#25454;&#21253;&#65292;&#28982;&#21518;&#22914;&#26524;&#27491;&#24120;&#65292;&#35843;&#29992;netif_receive_skb&#65292;&#21040;&#27492;&#25968;&#25454;&#21253;&#24050;&#32463;&#25910;&#21040;&#20869;&#26680;&#20102;&#65292;&#20869;&#26680;&#30340;&#20256;&#36882;&#20026;&#65306;</P>
<DIV id=crayon-569898aadbf0a060471691 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-57">57</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-58">58</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-59">59</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-60">60</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-61">61</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-62">62</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-63">63</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-64">64</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-65">65</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-66">66</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-67">67</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-68">68</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-69">69</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-70">70</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-71">71</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-72">72</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-73">73</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-74">74</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-75">75</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-76">76</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-77">77</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-78">78</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-79">79</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-80">80</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-81">81</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-82">82</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-83">83</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-84">84</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-85">85</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-86">86</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-87">87</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-88">88</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-89">89</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-90">90</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-91">91</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-92">92</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-93">93</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-94">94</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-95">95</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-96">96</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-97">97</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-98">98</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-99">99</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-100">100</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-101">101</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-102">102</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-103">103</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-104">104</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-105">105</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-106">106</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-107">107</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-108">108</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-109">109</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-110">110</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-111">111</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-112">112</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-113">113</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-114">114</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-115">115</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-116">116</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-117">117</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-118">118</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-119">119</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-120">120</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-121">121</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-122">122</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-123">123</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-124">124</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-125">125</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-126">126</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-127">127</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-128">128</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-129">129</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-130">130</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-131">131</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-132">132</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-133">133</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-134">134</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-135">135</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-136">136</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-137">137</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-138">138</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-139">139</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-140">140</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-141">141</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-142">142</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-143">143</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-144">144</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-145">145</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-146">146</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-147">147</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-148">148</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-149">149</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-150">150</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-151">151</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-152">152</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-153">153</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-154">154</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-155">155</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-156">156</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-157">157</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-158">158</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-159">159</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-160">160</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-161">161</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-162">162</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-163">163</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-164">164</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-165">165</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf0a060471691-166">166</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf0a060471691-167">167</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbf0a060471691-1 class=crayon-line><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>netif_receive_skb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>sk_buff</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-3 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NET_RX_SUCCESS</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>dp_rcv_skb_fn_t </SPAN><SPAN class=crayon-v>dp_rcv_skb_in_fn</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>NULL</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-5 class=crayon-line><SPAN class=crayon-h></SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#26816;&#26597;timestamp</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-7 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>net_timestamp_check</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev_tstamp_prequeue</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-8 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf0a060471691-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>skb_defer_rx_timestamp</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NET_RX_SUCCESS</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-11 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>.</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__netif_receive_skb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-13 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-14 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf0a060471691-15 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__netif_receive_skb_core</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>sk_buff</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>bool</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pfmemalloc</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-17 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>packet_type</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>ptype</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>pt_prev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rx_handler_func_t</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>rx_handler</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-19 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>net_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>orig_dev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>net_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>null_or_dev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-21 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>bool</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>deliver_exact</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>false</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NET_RX_DROP</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-23 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>__be16 </SPAN><SPAN class=crayon-v>type</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-24 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf0a060471691-25 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>net_timestamp_check</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>netdev_tstamp_prequeue</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-26 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf0a060471691-27 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>trace_netif_receive_skb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-28 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf0a060471691-29 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* if we've gotten here through NAPI, check netpoll */</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>netpoll_receive_skb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-31 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>out</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-32 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf0a060471691-33 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>orig_dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-34 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf0a060471691-35 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>skb_reset_network_header</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-36 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>skb_transport_header_was_set</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-37 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>skb_reset_transport_header</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>skb_reset_mac_len</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-39 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf0a060471691-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>pt_prev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>NULL</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-41 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf0a060471691-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>rcu_read_lock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-43 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf0a060471691-44 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>another_round</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-45 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>skb_iif</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>ifindex</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-46 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf0a060471691-47 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>__this_cpu_inc</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>softnet_data</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>processed</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-48 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf0a060471691-49 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>protocol</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>cpu_to_be16</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>ETH_P_8021Q</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>||</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-50 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>protocol</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>cpu_to_be16</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>ETH_P_8021AD</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-51 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>vlan_untag</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-53 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>unlock</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-54 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-55 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pfmemalloc</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-56 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skip_taps</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-57 class=crayon-line><SPAN class=crayon-h></SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-58 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#20381;&#27425;&#35843;&#29992;&#22238;&#35843;&#20989;&#25968;&#22788;&#29702;&#25968;&#25454;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-59 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#20808;&#35843;&#29992;ptype_all&#30340;&#65292;&#20351;&#29992;&#19982;&#25968;&#25454;&#21253;&#26159;&#20219;&#24847;&#21327;&#35758;&#30340;&#24773;&#20917;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-60 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>list_for_each_entry_rcu</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>ptype</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>ptype_all</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>list</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-61 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>ptype</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>||</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ptype</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-62 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#25152;&#26377;pt_prev&#30340;&#20889;&#27861;&#37117;&#26159;&#21518;&#36171;&#20540;&#22411;&#65292;&#25152;&#20197;&#20182;&#21483;prev</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-63 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pt_prev</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-64 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>deliver_skb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pt_prev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>orig_dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-65 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>pt_prev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ptype</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-66 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-67 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-68 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf0a060471691-69 class=crayon-line><SPAN class=crayon-v>skip_taps</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-70 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf0a060471691-71 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pfmemalloc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>skb_pfmemalloc_protocol</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-72 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>drop</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-73 class=crayon-line><SPAN class=crayon-h></SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-74 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#22914;&#26524;&#26377;vlan</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-75 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>vlan_tx_tag_present</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-76 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pt_prev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-77 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#36825;&#19968;&#27425;pt_prev&#35843;&#29992;&#65292;&#26159;&#22240;&#20026;&#65292;&#21069;&#38754;&#30041;&#20102;&#26368;&#21518;&#19968;&#20010;ptype_all&#27809;&#26377;&#35843;&#29992;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-78 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>deliver_skb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pt_prev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>orig_dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-79 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>pt_prev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>NULL</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-80 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-h> </SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-81 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>vlan_do_receive</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-82 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>another_round</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#22914;&#26524;&#26377;&#38656;&#35201;&#20462;&#25913;skb&#65292;&#28155;&#21152;vlan&#22836;&#37096;&#65292;&#28982;&#21518;&#20877;&#36208;&#19968;&#36941;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-83 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>else</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-84 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>unlock</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-85 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-86 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-87 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*&#36825;&#37324;&#24320;&#22987;&#22788;&#29702;&#35774;&#22791;&#30340;rx_handler&#22238;&#35843;&#65292;&#20363;&#22914;openvswitch&#65292;&#22312;netdev_create&#26102;&#27880;&#20876;&#20102;netdev_frame_hook</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-88 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>err = netdev_rx_handler_register(netdev_vport-&gt;dev, netdev_frame_hook,vport);</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-89 class=crayon-line><SPAN class=crayon-c>&#36825;&#31181;&#22238;&#35843;&#21487;&#20197;&#35753;&#27969;&#31243;&#19981;&#20877;&#24448;&#19979;&#32487;&#32493;&#65292;&#20363;&#22914;&#24403;netdev_frame_hook&#36820;&#22238;&#30340;RX_HANDLER_CONSUMED&#30340;&#26102;&#20505;&#65292;&#23601;&#32456;&#27490;&#25191;&#34892;&#12290;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-90 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-91 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rx_handler</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>rcu_dereference</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>rx_handler</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-92 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rx_handler</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-93 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pt_prev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-94 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#36825;&#19968;&#27425;pt_prev&#35843;&#29992;&#65292;&#26159;&#22240;&#20026;&#65292;&#21069;&#38754;&#30041;&#20102;&#26368;&#21518;&#19968;&#20010;ptype_all&#27809;&#26377;&#35843;&#29992;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-95 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>deliver_skb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pt_prev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>orig_dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-96 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>pt_prev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>NULL</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-97 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-98 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>switch</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>rx_handler</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-99 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>case</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>RX_HANDLER_CONSUMED</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-100 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NET_RX_SUCCESS</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-101 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>unlock</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-102 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>case</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>RX_HANDLER_ANOTHER</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-103 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>another_round</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-104 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>case</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>RX_HANDLER_EXACT</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-105 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>deliver_exact</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>true</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-106 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>case</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>RX_HANDLER_PASS</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-107 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>break</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-108 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>default</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-109 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>BUG</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-110 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-111 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-112 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf0a060471691-113 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>vlan_tx_tag_present</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-114 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>vlan_tx_tag_get_id</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-115 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>pkt_type</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>PACKET_OTHERHOST</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-116 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Note: we might in the future use prio bits</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-117 class=crayon-line><SPAN class=crayon-c>* and set skb-&gt;priority like in vlan_do_receive()</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-118 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* For the time being, just ignore Priority Code Point</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-119 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-120 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>vlan_tci</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-121 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-122 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf0a060471691-123 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* deliver only exact match when indicated */</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-124 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>null_or_dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>deliver</SPAN><SPAN class=crayon-sy>_</SPAN>exact<SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>?</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>NULL</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-125 class=crayon-line><SPAN class=crayon-h></SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-126 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-127 class=crayon-line><SPAN class=crayon-c>&#36825;&#37324;&#65292;&#26681;&#25454;skb&#21327;&#35758;&#31867;&#22411;&#65292;&#35843;&#29992;&#19981;&#21516;&#30340;&#22238;&#35843;&#65292;&#20197;ipv4&#20026;&#20363;&#65292;&#22312;inet_init&#37324;&#35843;&#29992;dev_add_pack(&amp;ip_packet_type)&#27880;&#20876;&#20102;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-128 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>static struct packet_type ip_packet_type __read_mostly = {</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-129 class=crayon-line><SPAN class=crayon-c>.type = cpu_to_be16(ETH_P_IP),</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-130 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>.func = ip_rcv,</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-131 class=crayon-line><SPAN class=crayon-c>};</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-132 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>&#20854;func&#20026;ip_rcv&#65292;&#20110;&#26159;&#65292;&#36941;&#21382;&#21040;&#20043;&#21518;&#65292;&#30452;&#25509;&#35843;&#29992;deliver_skb-&gt;.func-&gt;ip_rcv</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-133 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-134 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>type</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>protocol</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-135 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>list_for_each_entry_rcu</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>ptype</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-136 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>ptype_base</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-e>ntohs</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>type</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>PTYPE_HASH_MASK</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>list</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-137 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>ptype</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>type</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>type</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-138 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>ptype</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>null_or_dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>||</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ptype</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>||</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-139 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-v>ptype</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>orig_dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-140 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-141 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pt_prev</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-142 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>deliver_skb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pt_prev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>orig_dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-143 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>pt_prev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ptype</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-144 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-145 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-146 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-147 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#20043;&#21069;&#20026;&#20160;&#20040;&#35201;&#30041;&#19979;&#19968;&#27425;pt_prev&#19981;&#35843;&#29992;&#21602;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-148 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>pt_prev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-149 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>skb_orphan_frags</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>GFP_ATOMIC</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-150 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>drop</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-151 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>else</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-152 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pt_prev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-e>func</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pt_prev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>orig_dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-153 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>else</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-154 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>drop</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-155 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>atomic_long_inc</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>rx_dropped</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-156 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>kfree_skb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-157 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Jamal, now you will not able to escape explaining</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-158 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* me how you were going to use this. :-)</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-159 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-160 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NET_RX_DROP</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-161 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-162 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf0a060471691-163 class=crayon-line><SPAN class=crayon-v>unlock</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-164 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>rcu_read_unlock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-165 class=crayon-line><SPAN class=crayon-v>out</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-166 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf0a060471691-167 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H3>rx_ring&#32034;&#24341;</H3>
<DIV class=monospaced>head, tail &#20026;&#38381;&#21306;&#38388;&#32034;&#24341;&#65292;&#20551;&#35774;slot&#20010;&#25968;&#20026;16&#12290;<BR>next_to_use &#26159;&#20869;&#23384;&#20998;&#37197;&#23436;&#27605;&#65292;&#32593;&#21345;&#21487;&#20197;&#23558;&#25968;&#25454;&#20889;&#20837;&#20854;&#25551;&#36848;&#31526;&#30340;&#26368;&#21518;&#19979;&#26631;&#12290;<BR>next_to_clean &#26159;&#32593;&#21345;&#24050;&#32463;&#35762;&#25968;&#25454;&#20889;&#20837;&#21518;&#65292;&#39537;&#21160;&#20174;&#25551;&#36848;&#31526;&#20013;&#23558;&#25968;&#25454;&#21462;&#20986;&#30340;&#24320;&#22987;&#19979;&#26631;&#12290; </DIV>
<P>&#25152;&#20197;&#65292;next_to_clean&#25351;&#31034;&#30340;&#20301;&#32622;&#65292;&#19968;&#23450;&#35201;next_to_use&#20808;&#21021;&#22987;&#21270;&#36807;&#12290;</P>
<DIV class=monospaced>&#31354; &#20195;&#34920;&#27809;&#26377;&#20998;&#37197;&#20869;&#23384;<BR>0 &#20195;&#34920;&#20998;&#37197;&#20102;&#20869;&#23384;&#20294;&#26159;&#27809;&#26377;&#25968;&#25454;<BR>1 &#20195;&#34920;&#25968;&#25454;&#20934;&#22791;&#22909; </DIV>
<DIV class=monospaced>1. e1000e_setup_rx_resources - &#21021;&#22987;&#21270;&#38454;&#27573;
<P></P>
<P>head=tail=0<BR>|<BR>v<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>| | | | | | | | | | | | | | | | |<BR>|01|02|03|04|05|06|07|08|09|10|11|12|13|14|15|16|<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>^<BR>|<BR>clean=use=0</P>
<P>2. e1000_configure-&gt;adapter.alloc_rx_buf - &#31532;&#19968;&#27425;&#20026;&#27599;&#20010;&#25551;&#36848;&#31526;&#20998;&#37197;&#20869;&#23384;<BR>&#21442;&#32771;e1000_alloc_jumbo_rx_buffers</P>
<P>head=0 tail=14<BR>| |<BR>v v<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>|0 |0 |0 |0 |0 |0 |0 |0 |0 |0 |0 |0 |0 |0 |0 | |<BR>|01|02|03|04|05|06|07|08|09|10|11|12|13|14|15|16|<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>^ ^<BR>| |<BR>clean=0 use=15</P>
<P>3. e1000e_poll-&gt;adapter.clean_rx - &#24320;&#22987;&#26816;&#26597;&#25968;&#25454;&#21253;<BR>&#21442;&#32771;e1000_clean_jumbo_rx_irq<BR>&#20551;&#35774;&#26377;11&#20010;slot&#24050;&#32463;Descriptor Done&#20102;&#12290;</P>
<P>head=0 tail=14<BR>| |<BR>v v<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>|1 |1 |1 |1 |1 |1 |1 |1 |1 |1 |1 |0 |0 |0 |0 | |<BR>|01|02|03|04|05|06|07|08|09|10|11|12|13|14|15|16|<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>^ ^<BR>| |<BR>clean=0 use=15</P>
<P>&#20551;&#22914;&#24490;&#29615;&#20102;8&#27425;</P>
<P>head=0 tail=14<BR>| |<BR>v v<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>| | | | | | | | |1 |1 |1 |0 |0 |0 |0 | |<BR>|01|02|03|04|05|06|07|08|09|10|11|12|13|14|15|16|<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>^ ^<BR>| |<BR>clean=0 use=15</P>
<P>&#28982;&#21518;&#35843;&#29992;alloc_rx_buf(8)&#26469;&#22635;&#20805;&#20869;&#23384;&#65292;&#21442;&#32771;e1000_alloc_jumbo_rx_buffers</P>
<P>head=0 tail=6<BR>| |<BR>v v<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>|0 |0 |0 |0 |0 |0 |0 | |1 |1 |1 |0 |0 |0 |0 |0 |<BR>|01|02|03|04|05|06|07|08|09|10|11|12|13|14|15|16|<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>^ ^<BR>| |<BR>clean=0 use=7</P>
<P>&#30001;&#20110;alloc_rx_buf&#26159;&#30001;clean_rx&#35843;&#29992;&#30340;&#65292;alloc&#30340;slot&#20010;&#25968;&#30001;clean_rx&#31934;&#30830;&#25511;&#21046;<BR>use&#25351;&#38024;&#19981;&#20250;&#36229;&#36807;&#36824;&#26410;&#21462;&#25968;&#25454;&#30340;slot&#65292;&#20013;&#38388;&#30041;&#20102;&#19968;&#31354;&#38553;&#65292;&#20445;&#35777;&#35835;&#20889;&#19981;&#20250;&#36861;&#23614;<BR>11&#20010;slot&#37117;&#36941;&#21382;&#23436;&#20043;&#21518;&#65292;&#20250;&#23558;next_to_clean&#36171;&#20540;&#20026;i&#65292;i&#20026;&#31532;&#19968;&#20010;&#27809;&#26377;Descriptor Done&#30340;&#19979;&#26631;<BR>&#20363;&#22914;&#65292;&#29616;&#22312;&#26159;&#31532;12&#20301;&#20026;&#26410;done&#30340;&#65292;&#37027;&#20040;next_to_clean = i = 11</P>
<P>head=0 tail=6<BR>| |<BR>v v<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>|0 |0 |0 |0 |0 |0 |0 | | | | |0 |0 |0 |0 |0 |<BR>|01|02|03|04|05|06|07|08|09|10|11|12|13|14|15|16|<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>^ ^<BR>| |<BR>use=7 clean=11</P>
<P>clean_rx&#32467;&#23614;&#30340;&#22320;&#26041;&#65292;&#36824;&#20250;adapter-&gt;alloc_rx_buf(rx_ring, e1000_desc_unused(rx_ring), GFP_ATOMIC)<BR>&#27492;&#26102;&#65292;e1000_desc_unused&#35745;&#31639;&#20986;&#26469;&#30340;unused = ring-&gt;next_to_clean - ring-&gt;next_to_use - 1 = 11 - 7 - 1 = 3<BR>&#20110;&#26159;&#65292;&#35843;&#29992;&#23436;alloc_rx_buf&#21518;&#65292;&#20250;&#21464;&#20026;</P>
<P>head=0 tail=10<BR>| |<BR>v v<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>|0 |0 |0 |0 |0 |0 |0 |0 |0 |0 | |0 |0 |0 |0 |0 |<BR>|01|02|03|04|05|06|07|08|09|10|11|12|13|14|15|16|<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>^<BR>|<BR>clean=use=11 </P></DIV>
<H2>&#21457;&#21253;</H2>
<H3>&#20174;&#20869;&#26680;&#21040;&#32593;&#21345;</H3>
<P>&#31995;&#32479;&#21457;&#21253;&#19968;&#33324;&#35843;&#29992;&#27969;&#31243;&#65306;</P>
<DIV id=crayon-569898aadbf20607195516 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-57">57</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-58">58</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-59">59</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-60">60</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-61">61</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-62">62</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-63">63</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-64">64</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-65">65</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-66">66</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-67">67</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-68">68</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-69">69</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-70">70</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-71">71</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-72">72</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-73">73</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-74">74</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-75">75</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-76">76</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-77">77</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-78">78</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-79">79</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-80">80</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-81">81</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-82">82</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-83">83</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-84">84</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-85">85</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-86">86</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-87">87</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-88">88</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-89">89</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-90">90</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-91">91</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-92">92</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-93">93</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-94">94</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-95">95</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-96">96</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-97">97</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-98">98</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-99">99</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-100">100</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-101">101</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-102">102</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-103">103</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-104">104</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-105">105</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-106">106</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-107">107</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-108">108</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-109">109</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-110">110</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-111">111</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-112">112</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-113">113</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-114">114</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-115">115</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-116">116</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-117">117</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-118">118</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-119">119</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-120">120</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-121">121</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-122">122</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-123">123</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-124">124</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-125">125</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-126">126</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-127">127</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-128">128</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-129">129</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-130">130</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-131">131</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-132">132</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-133">133</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-134">134</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-135">135</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-136">136</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-137">137</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-138">138</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-139">139</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-140">140</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-141">141</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-142">142</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-143">143</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-144">144</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-145">145</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-146">146</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-147">147</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-148">148</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-149">149</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-150">150</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-151">151</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-152">152</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-153">153</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-154">154</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-155">155</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-156">156</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-157">157</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-158">158</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-159">159</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-160">160</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-161">161</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-162">162</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-163">163</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-164">164</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-165">165</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-166">166</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-167">167</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-168">168</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-169">169</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-170">170</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-171">171</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-172">172</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-173">173</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-174">174</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-175">175</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-176">176</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-177">177</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-178">178</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-179">179</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-180">180</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-181">181</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-182">182</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-183">183</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-184">184</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-185">185</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-186">186</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-187">187</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-188">188</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-189">189</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-190">190</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-191">191</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-192">192</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-193">193</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-194">194</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-195">195</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-196">196</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-197">197</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-198">198</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-199">199</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-200">200</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-201">201</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-202">202</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-203">203</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-204">204</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-205">205</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-206">206</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-207">207</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-208">208</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-209">209</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-210">210</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-211">211</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-212">212</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-213">213</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-214">214</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-215">215</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-216">216</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-217">217</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-218">218</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-219">219</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-220">220</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-221">221</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-222">222</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-223">223</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-224">224</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-225">225</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-226">226</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-227">227</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-228">228</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-229">229</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-230">230</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-231">231</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-232">232</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-233">233</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-234">234</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-235">235</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-236">236</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-237">237</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-238">238</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-239">239</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-240">240</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-241">241</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-242">242</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-243">243</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-244">244</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-245">245</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-246">246</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-247">247</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-248">248</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-249">249</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-250">250</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-251">251</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-252">252</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-253">253</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-254">254</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-255">255</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-256">256</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-257">257</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-258">258</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-259">259</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-260">260</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-261">261</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-262">262</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-263">263</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-264">264</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-265">265</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-266">266</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-267">267</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-268">268</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-269">269</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-270">270</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-271">271</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-272">272</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-273">273</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-274">274</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-275">275</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-276">276</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-277">277</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-278">278</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-279">279</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-280">280</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-281">281</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-282">282</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-283">283</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-284">284</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-285">285</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-286">286</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-287">287</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-288">288</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-289">289</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-290">290</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-291">291</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-292">292</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-293">293</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-294">294</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-295">295</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-296">296</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-297">297</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-298">298</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-299">299</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-300">300</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-301">301</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-302">302</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-303">303</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-304">304</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-305">305</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-306">306</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-307">307</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-308">308</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-309">309</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-310">310</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-311">311</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-312">312</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-313">313</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-314">314</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf20607195516-315">315</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf20607195516-316">316</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbf20607195516-1 class=crayon-line><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>dev_queue_xmit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>sk_buff</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-3 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>net_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>netdev_queue</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-5 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>Qdisc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-v>ENOMEM</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-7 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>dp_rcv_skb_fn_t </SPAN><SPAN class=crayon-v>dp_rcv_skb_out_fn</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>NULL</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-8 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>skb_reset_mac_header</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-10 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-11 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//by cys&nbsp;&nbsp;&#36890;&#29992;&#32593;&#21345;&#25130;&#33719;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>rcu_read_lock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-13 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>dp_rcv_skb_out_fn</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>rcu_dereference</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dp_rcv_skb_out</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>zcm_poll_enabled</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dp_rcv_skb_out_fn</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>vt_zcm_ptr</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-15 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>skb_is_from_dp</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-17 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>dp_rcv_skb_out_fn</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>rcu_read_unlock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-19 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-21 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>rcu_read_unlock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-23 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Disable soft irqs for various locks below. Also</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-25 class=crayon-line><SPAN class=crayon-c>* stops preemption for RCU.</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-27 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>rcu_read_lock_bh</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-28 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#26681;&#25454;&#35774;&#22791;&#30340;prority map&#33719;&#21462;skb&#20248;&#20808;&#32423;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-29 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>skb_update_prio</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//skb&#20837;dev&#30340;&#38431;&#21015;&#65292;&#22914;&#26524;&#26377;&#22238;&#35843;ndo_select_queue&#65292;&#23601;&#29992;&#22238;&#35843;&#26469;&#21028;&#26029;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-31 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>netdev_pick_tx</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>rcu_dereference_bh</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>qdisc</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-33 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-p>#ifdef CONFIG_NET_CLS_ACT</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-35 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tc_verd</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>SET_TC_AT</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tc_verd</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>AT_EGRESS</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-36 class="crayon-line crayon-striped-line"><SPAN class=crayon-p>#endif</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-37 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>trace_net_dev_queue</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>enqueue</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-39 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#22914;&#26524;&#35843;&#24230;&#22120;qdisc&#26377;&#33258;&#24049;&#30340;&#20837;&#38431;&#20989;&#25968;&#65292;&#26377;&#38431;&#21015;&#65292;&#19968;&#33324;&#26159;&#29289;&#29702;&#32593;&#21475;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__dev_xmit_skb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-41 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>out</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-43 class=crayon-line><SPAN class=crayon-h></SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-44 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#19979;&#38754;&#26159;&#27809;&#26377;&#33258;&#24049;&#30340;&#38431;&#21015;&#30340;&#65292;&#22810;&#23569;loop&#21644;tun&#21475;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-45 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* The device has no queue. Common case for software devices:</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-46 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>&nbsp;&nbsp; loopback, all the sorts of tunnels...</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-47 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>&nbsp;&nbsp; Really, it is unlikely that netif_tx_lock protection is necessary</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-49 class=crayon-line><SPAN class=crayon-c>&nbsp;&nbsp; here.&nbsp;&nbsp;(f.e. loopback and IP tunnels are clean ignoring statistics</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-50 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>&nbsp;&nbsp; counters.)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-51 class=crayon-line><SPAN class=crayon-c>&nbsp;&nbsp; However, it is possible, that they rely on protection</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>&nbsp;&nbsp; made by us here.</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-53 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-54 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>&nbsp;&nbsp; Check this and shot the lock. It is not prone from deadlocks.</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-55 class=crayon-line><SPAN class=crayon-c>&nbsp;&nbsp; Either shot noqueue qdisc, it is even simpler 8)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-56 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-57 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>IFF_UP</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-58 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpu</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>smp_processor_id</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>/* ok because BHs are off */</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-59 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-60 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>xmit_lock_owner</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpu</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-61 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#19981;&#33021;&#21152;&#20837;&#28304;CPU&#65311;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-62 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>__this_cpu_read</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>xmit_recursion</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&gt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>RECURSION_LIMIT</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-63 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>recursion_alert</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-64 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-65 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>HARD_TX_LOCK</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpu</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-66 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-67 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>netif_xmit_stopped</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-68 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>__this_cpu_inc</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>xmit_recursion</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-69 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#21457;&#21040;txq&#38431;&#21015;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-70 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>dev_hard_start_xmit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-71 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>__this_cpu_dec</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>xmit_recursion</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-72 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#21457;&#36865;&#23436;&#20102;&#36824;&#35201;&#26816;&#26597;&#36820;&#22238;&#20540;&#26159;&#21542;OK</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-73 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>dev_xmit_complete</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-74 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>HARD_TX_UNLOCK</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-75 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>out</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-76 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-77 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-78 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>HARD_TX_UNLOCK</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-79 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-h> </SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-80 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-81 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-82 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-v>ENETDOWN</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-83 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>rcu_read_unlock_bh</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-84 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-85 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>kfree_skb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-86 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-87 class=crayon-line><SPAN class=crayon-v>out</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-88 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>rcu_read_unlock_bh</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-89 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-90 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-91 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-92 class="crayon-line crayon-striped-line"><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-m>inline</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__dev_xmit_skb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>sk_buff</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>Qdisc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-93 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>net_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-94 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>netdev_queue</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-95 class=crayon-line><SPAN class=crayon-sy>{</SPAN><SPAN class=crayon-c>//&#36825;&#20010;&#20989;&#25968;&#32467;&#21512;&#35843;&#24230;&#22120;&#26469;&#21457;&#21253;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-96 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>spinlock_t</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>root_lock</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>qdisc_lock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-97 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>bool</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>contended</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-98 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-99 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-100 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>qdisc_pkt_len_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-101 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>qdisc_calculate_pkt_len</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-102 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-103 class=crayon-line><SPAN class=crayon-c>* Heuristic to force contended enqueues to serialize on a</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-104 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* separate lock before trying to get qdisc main lock.</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-105 class=crayon-line><SPAN class=crayon-c>* This permits __QDISC_STATE_RUNNING owner to get the lock more often</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-106 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* and dequeue packets faster.</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-107 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-108 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>contended</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>qdisc_is_running</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-109 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>contended</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-110 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>spin_lock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>busylock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-111 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-112 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>spin_lock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>root_lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-113 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>test_bit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>__QDISC_STATE_DEACTIVATED</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-114 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#35843;&#24230;&#22120;&#20026;&#26410;&#28608;&#27963;&#29366;&#24577;&#65292;&#20002;&#24323;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-115 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>kfree_skb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-116 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NET_XMIT_DROP</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-117 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>else</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>TCQ_F_CAN_BYPASS</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>qdisc_qlen</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-118 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp; </SPAN><SPAN class=crayon-e>qdisc_run_begin</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-119 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#35843;&#24230;&#22120;&#35828;&#21487;&#20197;BYPASS&#65292;&#19988;&#27809;&#26377;&#25968;&#25454;&#21253;&#20877;&#35843;&#24230;&#22120;&#37324;&#25490;&#38431;&#65292;&#19988;&#35843;&#24230;&#22120;&#20043;&#21069;&#27809;&#26377;&#36816;&#34892;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-120 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-121 class=crayon-line><SPAN class=crayon-c>* This is a work-conserving queue; there are no old skbs</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-122 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* waiting to be sent out; and the qdisc is not running -</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-123 class=crayon-line><SPAN class=crayon-c>* xmit the skb directly.</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-124 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-125 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>priv_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>IFF_XMIT_DST_RELEASE</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-126 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>skb_dst_force</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-127 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-128 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>qdisc_bstats_update</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-129 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#36890;&#36807;sched direct xmit&#21457;&#36865;skb</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-130 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>sch_direct_xmit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>root_lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-131 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#22914;&#26524;q&#37324;&#36824;&#26377;&#25968;&#25454;&#38656;&#35201;&#21457;&#36865;&#65292;&#38656;&#35201;&#21551;&#21160;qdisc</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-132 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>contended</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-133 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>spin_unlock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>busylock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-134 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>contended</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>false</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-135 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-136 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>__qdisc_run</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-137 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>else</SPAN><SPAN class=crayon-h> </SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-138 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>qdisc_run_end</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-139 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-140 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NET_XMIT_SUCCESS</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-141 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>else</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-142 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>skb_dst_force</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-143 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#20837;&#38431;&#35843;&#24230;&#65292;&#27604;&#22914;&#26368;&#31616;&#21333;&#30340;&#21040;&#30340;pfifo_enqueue&#65292;&#22914;&#26524;&#36229;&#20986;&#38480;&#21046;&#65292;&#20002;&#24323;&#65292;&#21542;&#21017;&#23558;&#21253;&#28155;&#21152;&#21040;&#38431;&#23614;&#12290;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-144 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-e>enqueue</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NET_XMIT_MASK</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-145 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>qdisc_run_begin</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-146 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>contended</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-147 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>spin_unlock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>busylock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-148 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>contended</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>false</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-149 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-150 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>__qdisc_run</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-151 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-152 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-153 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>spin_unlock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>root_lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-154 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>contended</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-155 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>spin_unlock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>busylock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-156 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-157 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-158 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-159 class=crayon-line><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>sch_direct_xmit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>sk_buff</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>Qdisc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-160 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>net_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>netdev_queue</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-161 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>spinlock_t</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>root_lock</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-162 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-163 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETDEV_TX_BUSY</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-164 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-165 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* And release qdisc */</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-166 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>spin_unlock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>root_lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-167 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-168 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>HARD_TX_LOCK</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>smp_processor_id</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-169 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>netif_xmit_frozen_or_stopped</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-170 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>dev_hard_start_xmit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#21457;&#21253;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-171 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-172 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>HARD_TX_UNLOCK</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-173 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-174 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>spin_lock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>root_lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-175 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#21644;dev_queue_xmit&#37324;&#38754;, loopback, tun&#21475;&#20351;&#29992;dev_hard_start_xmit&#21457;&#36865;&#21518;&#36824;&#35201;&#26816;&#26597;&#36820;&#22238;&#20540;&#19968;&#26679;&#65292;&#36825;&#37324;&#20063;&#26159;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-176 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>dev_xmit_complete</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-177 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Driver sent out skb successfully or skb was consumed */</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-178 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>qdisc_qlen</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-179 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>else</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETDEV_TX_LOCKED</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-180 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Driver try lock failed */</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-181 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>handle_dev_cpu_collision</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-182 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>else</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-183 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Driver returned NETDEV_TX_BUSY - requeue skb */</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-184 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETDEV_TX_BUSY</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-185 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>net_warn_ratelimited</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-s>"BUG %s code %d qlen %dn"</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-186 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>name</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>qlen</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-187 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#22914;&#26524;&#36820;&#22238;&#30340;&#26159;BUSY&#65292;&#35201;&#37325;&#26032;&#20837;&#38431;&#65292;loopback&#21475;&#21487;&#27809;&#36825;&#24453;&#36935;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-188 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>dev_requeue_skb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>q</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-189 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-190 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-191 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>netif_xmit_frozen_or_stopped</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-192 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-193 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-194 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-195 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-196 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-197 class=crayon-line><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>dev_hard_start_xmit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>sk_buff</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>net_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-198 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>netdev_queue</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-199 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-200 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-r>const</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>net_device_ops</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>ops</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>netdev_ops</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-201 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETDEV_TX_OK</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-202 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb_len</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-203 class=crayon-line><SPAN class=crayon-h></SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-204 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#26377;next&#30340;&#34920;&#31034;&#24050;&#32463;&#20998;&#36807;&#21253;&#20102;&#65311;&#19981;&#38656;&#35201;&#20877;GSO&#65311;&#65311;&#65311;&#35980;&#20284;&#22914;&#27492;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-205 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>likely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-206 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#22914;&#26524;&#27809;&#26377;next&#65292;&#22823;&#27010;&#19981;&#38656;&#35201;Generic Segmentation Offload&#65292;&#26377;next&#65292;&#19968;&#23450;&#35201;gso</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-207 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>netdev_features_t </SPAN><SPAN class=crayon-v>features</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-208 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-209 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-210 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* If device doesn't need skb-&gt;dst, release it right now while</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-211 class=crayon-line><SPAN class=crayon-c>* its hot in this cpu cache</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-212 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-213 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>priv_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>IFF_XMIT_DST_RELEASE</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-214 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>skb_dst_drop</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-215 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-216 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>features</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>netif_skb_features</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-217 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-218 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>vlan_tx_tag_present</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-219 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>vlan_hw_offload_capable</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>features</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>vlan_proto</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-220 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#26377;vlan tag&#30340;&#26102;&#20505;&#65292;&#38656;&#35201;&#22312;SKB&#25968;&#25454;&#21306;&#22495;&#28155;&#21152;&#19978;data&#65292;&#32780;&#19988;&#36825;&#37324;&#20351;&#29992;&#20102;memove&#26469;&#31227;&#21160;&#25968;&#25454;&#65292;&#28010;&#36153;CPU&#65292;&#20026;&#22043;&#19981;&#25552;&#21069;&#39044;&#30041;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-221 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__vlan_put_tag</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>vlan_proto</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-222 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-e>vlan_tx_tag_get</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-223 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-224 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>out</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-225 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-226 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>vlan_tci</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-227 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-228 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-229 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* If encapsulation offload request, verify we are testing</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-230 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* hardware encapsulation features instead of standard</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-231 class=crayon-line><SPAN class=crayon-c>* features for the netdev</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-232 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-233 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>encapsulation</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-234 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>features</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw_enc_features</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-235 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-236 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>netif_needs_gso</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>features</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-237 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#21333;skb&#20063;&#38656;&#35201;gso&#30340;&#24773;&#20917;&#65292;&#20808;&#35843;&#29992;dev_gso_segment&#20998;&#21253;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-238 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>dev_gso_segment</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>features</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-239 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>out_kfree_skb</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-240 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-241 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>gso</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-242 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>else</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-243 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>skb_needs_linearize</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>features</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-244 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>__skb_linearize</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-245 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>out_kfree_skb</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-246 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-247 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* If packet is not checksummed and device does not</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-248 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* support checksumming for this protocol, complete</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-249 class=crayon-line><SPAN class=crayon-c>* checksumming here.</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-250 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-251 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#35774;&#32622;checksum</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-252 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>ip_summed</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CHECKSUM_PARTIAL</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-253 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>encapsulation</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-254 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>skb_set_inner_transport_header</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-255 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>skb_checksum_start_offset</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-256 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>else</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-257 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>skb_set_transport_header</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-258 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>skb_checksum_start_offset</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-259 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>features</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETIF_F_ALL_CSUM</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-260 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-e>skb_checksum_help</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-261 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>out_kfree_skb</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-262 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-263 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-264 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-265 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#20026;taps copy&#19968;&#20221;&#20986;&#21475;&#25968;&#25454;&#65292;&#20363;&#22914;&#25235;&#21253;&#24037;&#20855;&#30417;&#21548;PF_PACKET&#20250;&#33719;&#21462;&#21040;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-266 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//dev_queue_xmit_nit&#20026;out&#22238;&#35843;, netif_receive_skb&#20026;in&#22238;&#35843;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-267 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>list_empty</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>ptype_all</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-268 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>dev_queue_xmit_nit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-269 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-270 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>skb_len</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-271 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//OK&#65292;&#32456;&#20110;&#21040;&#20102;&#35843;&#29992;&#39537;&#21160;xmit&#30340;&#22320;&#26041;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-272 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ops</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-e>ndo_start_xmit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-273 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>trace_net_dev_xmit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb_len</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-274 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETDEV_TX_OK</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-275 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>txq_trans_update</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-276 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-277 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-278 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-279 class=crayon-line><SPAN class=crayon-v>gso</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-280 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>do</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-281 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>sk_buff</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>nskb</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-282 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-283 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>nskb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-284 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>nskb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>NULL</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-285 class=crayon-line><SPAN class=crayon-h></SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-286 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#21516;&#19978;&#65292;copy&#19968;&#20221;&#32473;taps</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-287 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>list_empty</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>ptype_all</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-288 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>dev_queue_xmit_nit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>nskb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-289 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-290 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>skb_len</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>nskb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-291 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#19968;&#20010;&#19968;&#20010;&#30340;&#21457;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-292 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ops</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-e>ndo_start_xmit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>nskb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-293 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>trace_net_dev_xmit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>nskb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb_len</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-294 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETDEV_TX_OK</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-295 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>~</SPAN><SPAN class=crayon-v>NETDEV_TX_MASK</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-296 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>out_kfree_gso_skb</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-297 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>nskb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-298 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>nskb</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-299 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-300 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-301 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>txq_trans_update</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-302 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>netif_xmit_stopped</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>txq</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-303 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETDEV_TX_BUSY</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-304 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>while</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#36718;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-305 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf20607195516-306 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>out_kfree_gso_skb</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-307 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>likely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>NULL</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-308 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>destructor</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>DEV_GSO_CB</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>destructor</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-309 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>consume_skb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-310 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-311 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-312 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>out_kfree_skb</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-313 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>kfree_skb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-314 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>out</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-315 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf20607195516-316 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<P>&#32780;E1000E&#30340;xmit&#22238;&#35843;&#20989;&#25968;&#20026;&#65306;</P>
<DIV id=crayon-569898aadbf35340988637 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-57">57</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-58">58</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-59">59</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-60">60</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-61">61</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-62">62</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-63">63</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-64">64</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-65">65</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-66">66</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-67">67</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-68">68</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-69">69</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-70">70</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-71">71</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-72">72</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-73">73</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-74">74</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-75">75</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-76">76</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-77">77</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-78">78</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-79">79</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-80">80</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-81">81</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-82">82</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-83">83</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-84">84</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-85">85</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-86">86</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-87">87</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-88">88</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-89">89</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-90">90</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-91">91</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-92">92</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-93">93</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-94">94</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-95">95</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-96">96</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-97">97</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-98">98</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-99">99</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-100">100</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-101">101</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-102">102</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-103">103</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-104">104</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-105">105</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-106">106</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-107">107</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-108">108</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-109">109</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-110">110</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-111">111</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-112">112</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-113">113</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-114">114</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-115">115</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-116">116</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-117">117</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-118">118</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-119">119</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-120">120</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-121">121</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-122">122</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-123">123</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-124">124</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-125">125</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-126">126</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-127">127</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-128">128</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-129">129</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-130">130</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-131">131</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-132">132</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-133">133</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-134">134</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-135">135</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-136">136</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-137">137</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-138">138</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-139">139</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-140">140</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-141">141</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-142">142</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-143">143</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-144">144</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-145">145</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-146">146</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-147">147</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-148">148</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-149">149</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-150">150</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-151">151</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-152">152</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-153">153</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-154">154</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-155">155</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-156">156</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-157">157</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-158">158</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-159">159</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-160">160</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-161">161</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-162">162</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-163">163</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-164">164</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-165">165</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-166">166</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-167">167</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-168">168</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-169">169</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-170">170</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-171">171</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-172">172</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-173">173</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-174">174</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-175">175</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-176">176</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-177">177</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-178">178</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-179">179</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-180">180</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-181">181</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-182">182</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-183">183</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-184">184</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-185">185</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-186">186</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-187">187</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-188">188</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-189">189</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-190">190</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-191">191</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-192">192</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-193">193</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-194">194</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-195">195</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-196">196</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-197">197</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-198">198</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-199">199</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-200">200</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-201">201</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-202">202</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-203">203</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-204">204</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-205">205</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-206">206</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-207">207</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-208">208</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-209">209</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-210">210</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-211">211</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-212">212</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-213">213</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-214">214</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-215">215</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-216">216</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-217">217</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-218">218</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-219">219</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-220">220</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-221">221</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-222">222</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-223">223</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-224">224</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-225">225</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-226">226</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-227">227</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-228">228</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-229">229</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-230">230</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-231">231</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-232">232</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-233">233</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-234">234</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-235">235</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-236">236</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-237">237</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-238">238</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-239">239</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-240">240</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-241">241</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-242">242</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-243">243</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-244">244</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-245">245</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-246">246</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-247">247</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-248">248</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-249">249</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-250">250</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-251">251</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-252">252</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-253">253</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-254">254</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-255">255</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-256">256</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-257">257</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-258">258</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-259">259</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-260">260</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-261">261</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-262">262</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-263">263</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-264">264</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-265">265</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-266">266</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-267">267</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-268">268</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-269">269</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-270">270</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-271">271</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-272">272</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-273">273</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-274">274</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-275">275</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-276">276</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-277">277</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-278">278</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-279">279</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-280">280</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-281">281</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-282">282</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-283">283</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-284">284</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-285">285</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-286">286</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-287">287</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-288">288</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-289">289</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-290">290</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-291">291</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-292">292</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-293">293</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-294">294</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-295">295</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-296">296</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-297">297</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-298">298</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-299">299</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-300">300</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-301">301</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-302">302</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-303">303</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-304">304</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-305">305</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-306">306</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-307">307</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-308">308</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-309">309</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-310">310</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf35340988637-311">311</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf35340988637-312">312</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbf35340988637-1 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>netdev_tx_t </SPAN><SPAN class=crayon-e>e1000_xmit_frame</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>sk_buff</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>net_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-3 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>netdev_priv</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-5 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_ring</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>first</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-7 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>skb_headlen</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>nr_frags</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>mss</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-11 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tso</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-13 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>f</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-15 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#32593;&#21475;down&#30340;&#24773;&#20917;&#65292;&#19981;&#21457;&#36865;&#25968;&#25454;&#65292;&#24182;free skb</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>test_bit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>__E1000_DOWN</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-17 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>dev_kfree_skb_any</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETDEV_TX_OK</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-19 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#38271;&#24230;&#19981;&#21512;&#27861;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-21 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>dev_kfree_skb_any</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-23 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETDEV_TX_OK</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-25 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* The minimum packet size with TCTL.PSP set is 17 bytes so</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-27 class=crayon-line><SPAN class=crayon-c>* pad skb in order to meet this minimum size requirement</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-28 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-29 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>17</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>skb_pad</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>17</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-31 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETDEV_TX_OK</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>17</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-33 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>skb_set_tail_pointer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>17</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-35 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-36 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>mss</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>skb_shinfo</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>gso_size</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-37 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>mss</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>u8 </SPAN><SPAN class=crayon-v>hdr_len</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-39 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* TSO Workaround for 82571/2/3 Controllers -- if skb-&gt;data</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-41 class=crayon-line><SPAN class=crayon-c>* points to just header, pull a few bytes of payload from</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* frags into skb-&gt;data</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-43 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-44 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>hdr_len</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>skb_transport_offset</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>tcp_hdrlen</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-45 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* we do this workaround for ES2LAN, but it is un-necessary,</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-46 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* avoiding it could save a lot of cycles</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-47 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>data_len</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>hdr_len</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-49 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pull_size</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-50 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-51 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>pull_size</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>min_t</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>4</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>data_len</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>__pskb_pull_tail</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pull_size</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-53 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e_err</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-s>"__pskb_pull_tail failed.n"</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-54 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>dev_kfree_skb_any</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-55 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETDEV_TX_OK</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-56 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-57 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>skb_headlen</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-58 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-59 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-60 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-61 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* reserve a descriptor for the offload context */</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-62 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>mss</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>||</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>ip_summed</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CHECKSUM_PARTIAL</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-63 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-64 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-65 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-66 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>DIV_ROUND_UP</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_fifo_limit</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-67 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-68 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>nr_frags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>skb_shinfo</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>nr_frags</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-69 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>for</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>f</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>f</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>nr_frags</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>f</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-70 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>DIV_ROUND_UP</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>skb_frag_size</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-e>skb_shinfo</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>frags</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>f</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-71 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_fifo_limit</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-72 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-73 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>mac</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tx_pkt_filtering</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-74 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000_transfer_dhcp_info</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-75 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-76 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* need: count + 2 desc gap to keep tail from touching</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-77 class=crayon-line><SPAN class=crayon-c>* head, otherwise try next time</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-78 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-79 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>e1000_maybe_stop_tx</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>2</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-80 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETDEV_TX_BUSY</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-81 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-82 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>vlan_tx_tag_present</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-83 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TX_FLAGS_VLAN</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-84 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>vlan_tx_tag_get</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TX_FLAGS_VLAN_SHIFT</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-85 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-86 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-87 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>first</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_use</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-88 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-89 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tso</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_tso</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-90 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tso</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-91 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>dev_kfree_skb_any</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-92 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETDEV_TX_OK</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-93 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-94 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#22914;&#26524;tso&#25104;&#21151;&#65292;&#35201;&#25171;&#19978;E1000_TX_FLAGS_TSO&#26631;&#35760;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-95 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tso</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-96 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TX_FLAGS_TSO</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-97 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>else</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>e1000_tx_csum</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-98 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TX_FLAGS_CSUM</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-99 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-100 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Old method was to assume IPv4 packet by default if TSO was enabled.</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-101 class=crayon-line><SPAN class=crayon-c>* 82571 hardware supports TSO capabilities for IPv6 as well...</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-102 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* no longer assume, we must.</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-103 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-104 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>protocol</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>htons</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>ETH_P_IP</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-105 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TX_FLAGS_IPV4</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-106 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-107 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>no_fcs</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-108 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TX_FLAGS_NO_FCS</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-109 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-110 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* if count is 0 then mapping error has occurred */</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-111 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_tx_map</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>first</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_fifo_limit</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-112 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-v>nr_frags</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-113 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-114 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>skb_shinfo</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>SKBTX_HW_TSTAMP</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-115 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_hwtstamp_skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-116 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>skb_shinfo</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>SKBTX_IN_PROGRESS</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-117 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TX_FLAGS_HWTSTAMP</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-118 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_hwtstamp_skb</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>skb_get</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-119 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>schedule_work</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_hwtstamp_work</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-120 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>else</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-121 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>skb_tx_timestamp</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-122 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-123 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-124 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>netdev_sent_queue</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-125 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000_tx_queue</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_flags</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-126 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Make sure there is space in the ring for the next send. */</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-127 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000_maybe_stop_tx</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-128 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>MAX_SKB_FRAGS</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-129 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-e>DIV_ROUND_UP</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>PAGE_SIZE</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-130 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_fifo_limit</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>2</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-131 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>else</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-132 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>dev_kfree_skb_any</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-133 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>first</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>time_stamp</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-134 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_use</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>first</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-135 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-136 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-137 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NETDEV_TX_OK</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-138 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-139 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-140 class="crayon-line crayon-striped-line"><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_tx_map</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_ring</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>sk_buff</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-141 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>first</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>max_per_txd</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-142 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>nr_frags</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-143 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-144 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-145 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pci_dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-146 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_buffer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-147 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>skb_headlen</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-148 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>offset</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>size</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-149 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>f</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>bytecount</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>segs</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-150 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-151 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_use</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-152 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#20808;&#22788;&#29702;none paged data</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-153 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>while</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-154 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-155 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>size</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>min</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>max_per_txd</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-156 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-157 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>length</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>size</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#36825;&#20010;length&#35760;&#24405;&#30340;&#26159;&#34987;dma map&#30340;&#38271;&#24230;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-158 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>time_stamp</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>jiffies</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-159 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_watch</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-160 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dma</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>dma_map_single</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-161 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>data</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>offset</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-162 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>size</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>DMA_TO_DEVICE</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-163 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>mapped_as_page</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>false</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-164 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>dma_mapping_error</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dma</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-165 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dma_error</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-166 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-167 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>size</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-168 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>offset</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>size</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-169 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-170 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-171 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-172 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-173 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-174 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-175 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-176 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-177 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-178 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#20877;&#22788;&#29702;paged data</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-179 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>for</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>f</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>f</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>nr_frags</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>f</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-180 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-r>const</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb_frag_struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>frag</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-181 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-182 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>frag</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-e>skb_shinfo</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>frags</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>f</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-183 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>skb_frag_size</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>frag</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-184 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>offset</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-185 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-186 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>while</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-187 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-188 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-189 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-190 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-191 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-192 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>size</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>min</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>max_per_txd</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-193 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-194 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>length</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>size</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-195 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>time_stamp</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>jiffies</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-196 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_watch</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-197 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dma</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>skb_frag_dma_map</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>frag</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-198 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>offset</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>size</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-199 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>DMA_TO_DEVICE</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-200 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>mapped_as_page</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>true</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-201 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>dma_mapping_error</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dma</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-202 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dma_error</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-203 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-204 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>size</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-205 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>offset</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>size</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-206 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-207 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-208 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-209 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-210 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>segs</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>skb_shinfo</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>gso</SPAN><SPAN class=crayon-sy>_</SPAN>segs<SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>?</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-211 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* multiply data chunks by size of headers */</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-212 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>bytecount</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>segs</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>skb_headlen</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-213 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-214 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-215 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>segs</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>segs</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#36825;&#20010;segs&#35760;&#24405;&#20102;&#27492;skb&#26377;&#22810;&#23569;&#20010;&#20998;&#29255;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-216 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>bytecount</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>bytecount</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//segs&#21644;skb&#19968;&#26679;&#65292;&#21482;&#35760;&#24405;&#21040;&#26368;&#21518;&#19968;&#20010;slot&#65292;&#26041;&#20415;clean tx&#30340;&#26102;&#20505;&#32479;&#35745;&#21457;&#36865;&#20102;&#22810;&#23569;&#21253;&#21644;&#23383;&#33410;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-217 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>first</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>next_to_watch</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#26159;&#19968;&#20010;&#33539;&#22260;&#65292;&#20445;&#30041;&#19968;&#19979;&#36825;&#20010;skb&#20174;&#37027;&#20010;slot&#21040;&#21738;&#20010;slot&#65292;&#37027;&#20040;first&#23601;&#26159;from, i&#23601;&#26159;to&#65292;&#21040;&#26102;&#20505;clean tx&#30340;&#26102;&#20505;&#38656;&#35201;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-218 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-219 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-220 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-221 class=crayon-line><SPAN class=crayon-v>dma_error</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-222 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>dev_err</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>pdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"Tx DMA map failedn"</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-223 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dma</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-224 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-225 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-226 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-227 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>while</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-228 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-229 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-230 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-231 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-232 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000_put_txbuf</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-233 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-234 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-235 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-236 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-237 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-238 class="crayon-line crayon-striped-line"><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_tx_queue</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_ring</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_flags</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-239 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-240 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-241 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_tx_desc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>tx_desc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>NULL</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-242 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_buffer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-243 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>u32 </SPAN><SPAN class=crayon-v>txd_upper</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>txd_lower</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TXD_CMD_IFCS</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-244 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-245 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-246 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tx_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TX_FLAGS_TSO</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-247 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>txd_lower</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TXD_CMD_DEXT</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TXD_DTYP_D</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-248 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>E1000_TXD_CMD_TSE</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-249 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>txd_upper</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TXD_POPTS_TXSM</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>8</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-250 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-251 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tx_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TX_FLAGS_IPV4</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-252 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>txd_upper</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TXD_POPTS_IXSM</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>8</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-253 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-254 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-255 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tx_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TX_FLAGS_CSUM</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-256 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>txd_lower</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TXD_CMD_DEXT</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TXD_DTYP_D</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-257 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>txd_upper</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TXD_POPTS_TXSM</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>8</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-258 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-259 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-260 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tx_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TX_FLAGS_VLAN</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-261 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>txd_lower</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TXD_CMD_VLE</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-262 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>txd_upper</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tx_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TX_FLAGS_VLAN_MASK</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-263 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-264 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-265 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tx_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TX_FLAGS_NO_FCS</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-266 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>txd_lower</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>~</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>E1000_TXD_CMD_IFCS</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-267 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-268 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tx_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TX_FLAGS_HWTSTAMP</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-269 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>txd_lower</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TXD_CMD_DEXT</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TXD_DTYP_D</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-270 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>txd_upper</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TXD_EXTCMD_TSTAMP</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-271 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-272 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-273 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_use</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-274 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-275 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>do</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-276 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-277 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_desc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>E1000_TX_DESC</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-278 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_desc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_addr</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>cpu_to_le64</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>dma</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-279 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_desc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>lower</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>data</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>cpu_to_le32</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>txd_lower</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-280 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>length</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-281 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_desc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>upper</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>data</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>cpu_to_le32</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>txd_upper</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-282 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-283 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-284 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-285 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-286 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>while</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&gt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-287 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-288 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_desc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>lower</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>data</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>cpu_to_le32</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>txd_cmd</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-289 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-290 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* txd_cmd re-enables FCS, so we'll re-disable it here as desired. */</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-291 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tx_flags</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_TX_FLAGS_NO_FCS</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-292 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_desc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>lower</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>data</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>~</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>cpu_to_le32</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>E1000_TXD_CMD_IFCS</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-293 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-294 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Force memory writes to complete before letting h/w</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-295 class=crayon-line><SPAN class=crayon-c>* know there are new descriptors to fetch.&nbsp;&nbsp;(Only</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-296 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* applicable for weak-ordered memory model archs,</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-297 class=crayon-line><SPAN class=crayon-c>* such as IA-64).</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-298 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-299 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>wmb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-300 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-301 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_use</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-302 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-303 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>flags2</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>FLAG2_PCIM2PCI_ARBITER_WA</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-304 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000e_update_tdt_wa</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-305 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>else</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-306 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>writel</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tail</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-307 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf35340988637-308 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* we need this if more than one processor can write to our tail</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-309 class=crayon-line><SPAN class=crayon-c>* at a time, it synchronizes IO on IA64/Altix systems</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-310 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-311 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>mmiowb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf35340988637-312 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H3>&#23436;&#25104;&#21457;&#21253;</H3>
<P>&#19978;&#38754;&#21482;&#26159;&#23558;&#21253;&#25918;&#21040;&#32593;&#21345;&#30340;&#21457;&#21253;slot&#37324;&#20102;&#65292;&#20294;&#26159;&#21457;&#36865;&#25104;&#21151;&#19982;&#21542;&#65292;&#20320;&#24182;&#19981;&#30693;&#36947;&#65292;&#39537;&#21160;&#19968;&#33324;&#26377;&#20004;&#31181;&#26041;&#24335;&#26469;&#33719;&#21462;&#26159;&#21542;&#25104;&#21151;&#65292;&#19968;&#26159;&#36890;&#36807;&#20013;&#26029;&#36890;&#30693;&#65307;&#20108;&#26159;&#22312;recv poll&#30340;&#26102;&#20505;&#39034;&#20415;&#26816;&#27979;&#12290;</P>
<P>&#20013;&#26029;&#27880;&#20876;&#36807;&#31243;&#20026;&#65306;</P>
<DIV id=crayon-569898aadbf4c315142549 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbf4c315142549-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf4c315142549-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf4c315142549-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf4c315142549-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf4c315142549-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf4c315142549-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf4c315142549-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf4c315142549-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf4c315142549-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf4c315142549-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf4c315142549-11">11</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbf4c315142549-1 class=crayon-line><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_open</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>net_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf4c315142549-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#9492;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_request_irq</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN>&#27880;&#20876;&#20013;&#26029;</DIV>
<DIV id=crayon-569898aadbf4c315142549-3 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN>&#9500;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_request_msix</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN></DIV>
<DIV id=crayon-569898aadbf4c315142549-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>&#20248;&#20808;&#23581;&#35797;<SPAN class=crayon-v>msix</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>int_mode</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-v>E1000E_INT_MODE_MSIX</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-cn>2</SPAN></DIV>
<DIV id=crayon-569898aadbf4c315142549-5 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>&#9500;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-i>vector</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN>&#27880;&#20876;&#20026;<SPAN class=crayon-v>e1000_intr_msix</SPAN><SPAN class=crayon-sy>_</SPAN>rx&#65292;<SPAN class=crayon-st>for</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rx</SPAN></DIV>
<DIV id=crayon-569898aadbf4c315142549-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>&#9500;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-i>vector</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN>&#27880;&#20876;&#20026;<SPAN class=crayon-v>e1000_intr_msix</SPAN><SPAN class=crayon-sy>_</SPAN>tx&#65292;<SPAN class=crayon-st>for</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx</SPAN></DIV>
<DIV id=crayon-569898aadbf4c315142549-7 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>&#9492;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-i>vector</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>2</SPAN>&#27880;&#20876;&#20026;<SPAN class=crayon-e>e1000_msix_other</SPAN></DIV>
<DIV id=crayon-569898aadbf4c315142549-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-e>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-i>elif</SPAN>&#9500;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_request_msix</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN></DIV>
<DIV id=crayon-569898aadbf4c315142549-9 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>&#28982;&#21518;&#23581;&#35797;<SPAN class=crayon-v>msi</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>int_mode</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-v>E1000E_INT_MODE_MSI</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-cn>1</SPAN></DIV>
<DIV id=crayon-569898aadbf4c315142549-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>else</SPAN>&#9492;&#9472;&#9472;&#9472;<SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>irqreturn_t </SPAN><SPAN class=crayon-e>e1000_intr</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__always_unused </SPAN><SPAN class=crayon-v>irq</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>data</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN></DIV>
<DIV id=crayon-569898aadbf4c315142549-11 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN>&#37117;&#19981;&#34892;&#65292;&#21482;&#33021;&#29992;&#20256;&#32479;&#27169;&#24335;&#65292;<SPAN class=crayon-v>int_mode</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-v>E1000E_INT_MODE_LEGACY</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-cn>0</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P>recv poll&#20026;e1000e_poll&#65292;&#20854;&#35843;&#29992;e1000_clean_tx_irq&#26469;&#26816;&#26597;&#26159;&#21542;&#21457;&#21253;&#25104;&#21151;&#65306;</P>
<DIV id=crayon-569898aadbf55064940501 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-57">57</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-58">58</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-59">59</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-60">60</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-61">61</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-62">62</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-63">63</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-64">64</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-65">65</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-66">66</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-67">67</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-68">68</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-69">69</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-70">70</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-71">71</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-72">72</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-73">73</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-74">74</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-75">75</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-76">76</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-77">77</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-78">78</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-79">79</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-80">80</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-81">81</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-82">82</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-83">83</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-84">84</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-85">85</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-86">86</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-87">87</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-88">88</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-89">89</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-90">90</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-91">91</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-92">92</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-93">93</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-94">94</DIV>
<DIV class=crayon-num data-line="crayon-569898aadbf55064940501-95">95</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898aadbf55064940501-96">96</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898aadbf55064940501-1 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>msix_entries</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>||</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>rx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>ims_val</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>ims_val</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-3 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_cleaned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_clean_tx_irq</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#26816;&#26597;&#21457;&#21253;&#26159;&#21542;&#23436;&#25104;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-4 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf55064940501-5 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>bool</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>e1000_clean_tx_irq</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_ring</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-7 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>net_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_hw</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hw</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_tx_desc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>tx_desc</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>eop_desc</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-11 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>e1000_buffer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>eop</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-13 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>total_tx_bytes</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>total_tx_packets</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-15 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>bytes_compl</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pkts_compl</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-16 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf55064940501-17 class=crayon-line><SPAN class=crayon-p>#ifdef DEV_NETMAP</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#21457;&#21253;HOOK</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-19 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>netmap_tx_irq</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>/* cleaned ok */</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-21 class=crayon-line><SPAN class=crayon-p>#endif /* DEV_NETMAP */</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-22 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf55064940501-23 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//next_to_clean&#65292;&#26159;&#38656;&#35201;tx_clean&#30340;&#36215;&#22987;&#20301;&#32622;&#65292;&#32467;&#26463;&#20301;&#32622;&#20026;next_to_use</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//next_to_watch&#26159;&#19968;&#20010;skb&#35013;&#21040;n&#20010;slot&#30340;&#32467;&#26463;slot&#20301;&#32622;&#65292;&#36825;&#20010;&#20301;&#32622;&#37324;&#23384;&#25918;&#20102;skb, segs, bytecount&#31561;&#29992;&#20110;&#32479;&#35745;&#30340;&#20449;&#24687;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-25 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_clean</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>eop</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>next_to_watch</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-27 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>eop_desc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>E1000_TX_DESC</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>eop</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-28 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf55064940501-29 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>while</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>eop_desc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>upper</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>data</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>cpu_to_le32</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>E1000_TXD_STAT_DD</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-31 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>bool</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cleaned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>false</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>rmb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>/* read buffer_info after eop_desc */</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-33 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>for</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>cleaned</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_desc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>E1000_TX_DESC</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-35 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-36 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>cleaned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>eop</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-37 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf55064940501-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>cleaned</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-39 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>total_tx_packets</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>segs</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>total_tx_bytes</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>bytecount</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-41 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>bytes_compl</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>skb</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>len</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-43 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>pkts_compl</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-44 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-45 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-46 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf55064940501-47 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>e1000_put_txbuf</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_desc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>upper</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>data</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-49 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf55064940501-50 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-51 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-53 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-54 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf55064940501-55 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_use</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-c>//&#36861;&#19978;&#20102;next_to_use&#65292;OK&#65292;&#32467;&#26463;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-56 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>break</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-57 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>eop</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>next_to_watch</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-58 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>eop_desc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>E1000_TX_DESC</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>eop</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-59 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-60 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf55064940501-61 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_to_clean</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-62 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf55064940501-63 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>netdev_completed_queue</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>pkts_compl</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>bytes_compl</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-64 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf55064940501-65 class=crayon-line><SPAN class=crayon-p>#define TX_WAKE_THRESHOLD 32</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-66 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>netif_carrier_ok</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-67 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>e1000_desc_unused</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&gt;=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>TX_WAKE_THRESHOLD</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-68 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Make sure that anybody stopping the queue after this</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-69 class=crayon-line><SPAN class=crayon-c>* sees the new next_to_clean.</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-70 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-71 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>smp_mb</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-72 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898aadbf55064940501-73 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>netif_queue_stopped</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-74 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>test_bit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>__E1000_DOWN</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-75 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>netif_wake_queue</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>netdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-76 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>restart_queue</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-77 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-78 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-79 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898aadbf55064940501-80 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>detect_tx_hung</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-81 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Detect a transmit hang in hardware, this serializes the</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-82 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* check with the clearing of time_stamp and movement of i</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-83 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-84 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>detect_tx_hung</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>false</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-85 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>time_stamp</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-86 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>time_after</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>jiffies</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>buffer_info</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>time_stamp</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-87 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-o>+</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_timeout_factor</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HZ</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-88 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>er32</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>STATUS</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>E1000_STATUS_TXOFF</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-89 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>schedule_work</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>print_hang_task</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-90 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>else</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-91 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>tx_hang_recheck</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>false</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-92 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-93 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>total_tx_bytes</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>total_tx_bytes</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-94 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>adapter</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>total_tx_packets</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>total_tx_packets</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-95 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tx_ring</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>count</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898aadbf55064940501-96 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H3>tx_ring&#32034;&#24341;</H3>
<P>&#36825;&#37324;&#28041;&#21450;&#21040;tx_ring&#30340;&#32034;&#24341;&#38382;&#39064;&#65292;&#25105;&#23558;&#20854;&#30011;&#20026;&#22270;&#38416;&#36848;&#22914;&#19979;&#65288;head&#24573;&#30053;&#65289;&#65306;</P>
<DIV class=monospaced>head, tail &#20026;&#38381;&#21306;&#38388;&#32034;&#24341;&#65292;&#20551;&#35774;slot&#20010;&#25968;&#20026;16&#12290;<BR>next_to_use &#26159;&#20869;&#23384;&#20998;&#37197;&#23436;&#27605;&#65292;&#32593;&#21345;&#21487;&#20197;&#23558;&#25968;&#25454;&#20889;&#20837;&#20854;&#25551;&#36848;&#31526;&#30340;&#26368;&#21518;&#19979;&#26631;&#12290;<BR>next_to_clean &#26159;&#32593;&#21345;&#24050;&#32463;&#35762;&#25968;&#25454;&#20889;&#20837;&#21518;&#65292;&#39537;&#21160;&#20174;&#25551;&#36848;&#31526;&#20013;&#23558;&#25968;&#25454;&#21462;&#20986;&#30340;&#24320;&#22987;&#19979;&#26631;&#12290; </DIV>
<P>&#25152;&#20197;&#65292;next_to_clean&#25351;&#31034;&#30340;&#20301;&#32622;&#65292;&#19968;&#23450;&#35201;next_to_use&#20808;&#21021;&#22987;&#21270;&#36807;&#12290;</P>
<DIV class=monospaced>1 &#20195;&#34920;&#39537;&#21160;&#24050;&#32463;&#20889;&#20837;&#25968;&#25454;&#21040;&#32593;&#21345;&#30340;slot<BR>&#31354; &#20195;&#34920;&#21861;&#37117;&#27809;&#20570;<BR>0 &#20195;&#34920;&#21482;&#23569;&#22635;&#20805;&#36807;&#19968;&#27425;&#25968;&#25454; </DIV>
<DIV class=monospaced>1. e1000e_setup_tx_resources - &#21021;&#22987;&#21270;&#38454;&#27573;
<P></P>
<P>head=tail=0<BR>|<BR>v<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>| | | | | | | | | | | | | | | | |<BR>|01|02|03|04|05|06|07|08|09|10|11|12|13|14|15|16|<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>^<BR>|<BR>clean=use=0</P>
<P>2. e1000_xmit_frame - &#21457;&#21253;<BR>&#32771;&#34385;&#26368;&#31616;&#21333;&#30340;&#24773;&#20917;&#65292;&#19981;&#38656;&#20998;&#21253;&#65292;&#19981;&#38656;&#35201;checksum<BR>&#20110;&#26159;&#36827;&#20837;e1000_tx_map&#21644;e1000_tx_queue&#65306; </P>
<P>head=0<BR>| tail=1<BR>| |<BR>v v<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>|1 | | | | | | | | | | | | | | | |<BR>|01|02|03|04|05|06|07|08|09|10|11|12|13|14|15|16|<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>^ ^<BR>| |<BR>| use=1<BR>clean=0</P>
<P>&#27599;&#20889;&#19968;&#20010;&#21253;&#65292;&#26356;&#26032;use&#21644;tail&#65292;&#20004;&#32773;&#30456;&#21516;<BR>&#20551;&#35774;&#19968;&#19979;&#23376;&#20889;&#20102;11&#20010;&#21253;&#65306;</P>
<P>head=0 tail=11<BR>| |<BR>v v<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>|1 |1 |1 |1 |1 |1 |1 |1 |1 |1 |1 | | | | | |<BR>|01|02|03|04|05|06|07|08|09|10|11|12|13|14|15|16|<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>^ ^<BR>| |<BR>clean=0 use=11</P>
<P>3. e1000_clean_tx_irq &#20013;&#26029;&#25110;poll&#26469;&#26816;&#26597;&#26159;&#21542;&#21457;&#21253;&#25104;&#21151;<BR>&#20551;&#35774;&#21457;&#21253;&#25104;&#21151;4&#20010;&#21253;&#65292;clean&#25351;&#21521;&#12290;</P>
<P>head=0 tail=11<BR>| |<BR>v v<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>|0 |0 |0 |0 |1 |1 |1 |1 |1 |1 |1 | | | | | |<BR>|01|02|03|04|05|06|07|08|09|10|11|12|13|14|15|16|<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>^ ^<BR>| |<BR>clean=4 use=11</P>
<P>&#27492;&#26102;&#65292;unused = ring-&gt;count + ring-&gt;next_to_clean - ring-&gt;next_to_use - 1 = 16 + 4 - 11 - 1 = 8&#65292;&#20107;&#23454;&#19978;&#20301;9&#20010;&#31354;&#20301;&#65292;&#20294;&#26159;&#20026;&#20102;&#20445;&#35777;&#19981;&#20250;&#20914;&#25481;clean&#65292;&#37117;&#30041;&#20102;&#19968;&#20010;&#38388;&#38553;&#12290;</P>
<P>&#20551;&#35774;&#37117;&#21457;&#36865;&#25104;&#21151;&#65292;&#20877;&#27425;&#35843;&#29992;e1000_clean_tx_irq&#65292;&#26816;&#26597;64&#20010;&#65292;&#37027;&#20040;&#26368;&#22810;&#26816;&#26597;&#21040;use&#21069;&#38754;&#65306;</P>
<P>head=0 tail=11<BR>| |<BR>v v<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>|0 |0 |0 |0 |0 |0 |0 |0 |0 |0 |0 | | | | | |<BR>|01|02|03|04|05|06|07|08|09|10|11|12|13|14|15|16|<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>^<BR>|<BR>clean=use=11</P>
<P>unused = 15&#65292;&#20551;&#35774;&#27492;&#27425;&#21457;&#36865;15&#20010;&#21253;&#65306;</P>
<P>head=0 tail=10<BR>| |<BR>v v<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>|1 |1 |1 |1 |1 |1 |1 |1 |1 |1 |0 |1 |1 |1 |1 |1 |<BR>|01|02|03|04|05|06|07|08|09|10|11|12|13|14|15|16|<BR>+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<BR>^ ^<BR>| |<BR>| clean=11<BR>use=10</P></DIV>
<H2>&#21442;&#32771;&#36164;&#26009;</H2>
<OL class=decimal>
<LI>&#12298;SKB&#35299;&#26512;&#12299;<A href="http://vger.kernel.org/~davem/skb_data.html">http://vger.kernel.org/~davem/skb_data.html</A> </LI>
<LI>&#12298;PCI&#35774;&#22791;&#39537;&#21160;&#12299; <A href="http://blog.csdn.net/lamdoc/article/details/7698709">http://blog.csdn.net/lamdoc/article/details/7698709</A> </LI>
<LI>&#12298;Linux&#20869;&#26680;&#20013;ioremap&#26144;&#23556;&#30340;&#36879;&#24443;&#29702;&#35299;&#12299;<A href="http://blog.csdn.net/do2jiang/article/details/5450839">http://blog.csdn.net/do2jiang/article/details/5450839</A></LI></OL>
<P><A href="http://mnstory.net/wp-content/uploads/2014/12/e1000e-driver-source-analysis/e1000e-driver-source-analysis.pdf" target=_bank>PDF&#19979;&#36733;</A></P></DIV>