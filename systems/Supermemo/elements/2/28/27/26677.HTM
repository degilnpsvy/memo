<HEADER class=entry-header>&nbsp;
<H1 class=entry-title>LINUX&#39640;&#31934;&#24230;&#23450;&#26102;&#22120;&#23454;&#29616;&#20998;&#26512;</H1>
<DIV class=entry-meta><SPAN class=sep>&#21457;&#34920;&#20110; </SPAN><A title="&#19979;&#21320; 4:59" href="http://mnstory.net/2014/03/linux%e9%ab%98%e7%b2%be%e5%ba%a6%e5%ae%9a%e6%97%b6%e5%99%a8%e5%ae%9e%e7%8e%b0%e5%88%86%e6%9e%90/" rel=bookmark><TIME class=entry-date datetime="2014-03-02T16:59:36+00:00">2014 &#24180; 3 &#26376; 2 &#26085;</TIME></A> </DIV></HEADER>
<DIV class=entry-content>
<P>hrtimer&#65292;&#26159;High-resolution kernel timers&#30340;&#32553;&#20889;&#65292;&#20174;&#23383;&#38754;&#24847;&#24605;&#23601;&#30693;&#36947;&#65292;&#36825;&#26159;&#19968;&#20010;&#39640;&#31934;&#24230;&#20869;&#26680;timer&#12290;</P>
<H2>HRTIMER&#29992;&#27861;&#31034;&#20363;</H2>
<P>&#20808;&#35843;&#29992;hrtimer_init<B>&#21021;&#22987;&#21270;</B>&#65292;&#28982;&#21518;&#35774;&#32622;function&#22238;&#35843;&#65292;&#20363;&#22914;&#65292;&#27492;&#22788;&#35774;&#32622;&#22238;&#35843;&#20026;coalesced_timer_fn&#12290;</P>
<DIV id=crayon-569898d2b13a1048048867 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b13a1048048867-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13a1048048867-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13a1048048867-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13a1048048867-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13a1048048867-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13a1048048867-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13a1048048867-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13a1048048867-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13a1048048867-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13a1048048867-10">10</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b13a1048048867-1 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>enum</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_restart </SPAN><SPAN class=crayon-e>coalesced_timer_fn</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13a1048048867-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13a1048048867-3 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>kvm_rtc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>rtc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>container_of</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>kvm_rtc</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>coalesced_timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13a1048048867-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>CHECK_PAUSE_RET</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rtc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>pause</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_NORESTART</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13a1048048867-5 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>queue_work</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rtc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>wq</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>rtc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>ws_coalesced</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13a1048048867-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_NORESTART</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#36825;&#37324;&#36820;&#22238;&#20540;&#24456;&#37325;&#35201;&#65292;&#22914;&#26524;&#24819;&#27492;timer&#20026;&#21608;&#26399;timer&#65292;&#36820;&#22238;HRTIMER_RESTART(&#36229;&#26102;&#24517;&#39035;&#20808;&#35774;&#32622;)</SPAN></DIV>
<DIV id=crayon-569898d2b13a1048048867-7 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13a1048048867-8 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13a1048048867-9 class=crayon-line><SPAN class=crayon-e>hrtimer_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>rtc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>coalesced_timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CLOCK_MONOTONIC</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_MODE_ABS</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13a1048048867-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>rtc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>coalesced_timer</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-t>function</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>coalesced_timer_fn</SPAN><SPAN class=crayon-sy>;</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P><B>&#35774;&#32622;&#36229;&#26102;&#26102;&#38388;</B>&#65292;&#35774;&#32622;&#19968;&#20010;&#36229;&#26102;&#30340;ABS&#26102;&#38388;&#65292;&#36229;&#26102;&#26102;&#38388;&#35774;&#32622;&#20102;&#65292;&#24182;&#19981;&#20195;&#34920;timer&#24050;&#32463;&#36816;&#34892;&#65292;&#36824;&#24517;&#39035;&#23558;&#20854;&#21152;&#20837;active&#38431;&#21015;&#65292;start&#31995;&#21015;&#20989;&#25968;&#23601;&#20570;&#27492;&#20107;&#12290;</P>
<DIV id=crayon-569898d2b13b3514257120 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b13b3514257120-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13b3514257120-2">2</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b13b3514257120-1 class=crayon-line><SPAN class=crayon-e>hrtimer_forward</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>rtc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>coalesced_timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ns_to_ktime</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>now_time</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ns_to_ktime</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>next_time</SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-v>now_time</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13b3514257120-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-e>hrtimer_add_expires_ns</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>rtc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>coalesced_timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1000000000</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//1&#31186;</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P><SPAN id=more-262></SPAN><BR><B>&#21152;&#20837;active&#38431;&#21015;</B>&#12290;</P>
<DIV id=crayon-569898d2b13ba700950312 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b13ba700950312-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ba700950312-2">2</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b13ba700950312-1 class=crayon-line><SPAN class=crayon-e>hrtimer_start_expires</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>rtc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>coalesced_timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_MODE_ABS</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ba700950312-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-e>hrtimer_restart</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>rtc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>coalesced_timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P>&#20174;active&#38431;&#21015;<B>&#21024;&#38500;</B>(&#22914;&#27491;&#22312;&#22238;&#35843;&#20013;&#65292;&#20250;&#31561;&#24453;&#22238;&#35843;&#36816;&#34892;&#23436;&#25104;)&#12290;</P>
<DIV id=crayon-569898d2b13c1233178076 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b13c1233178076-1">1</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b13c1233178076-1 class=crayon-line><SPAN class=crayon-e>hrtimer_cancel</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>rtc</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>coalesced_timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H2>HRTIMER&#25968;&#25454;&#32467;&#26500;</H2>
<P><A title="hrtimer data struct" class=fancybox href="http://mnstory.net/wp-content/uploads/2014/03/hrtimer-source-analysis/data-struct.png" rel=fancybox><IMG class=size-full src="http://mnstory.net/wp-content/uploads/2014/03/hrtimer-source-analysis/data-struct.png"></A><BR><A name=data-struct>Figure 1&#25968;&#25454;&#32467;&#26500;&#31034;&#24847;&#22270;</A></P>
<DIV id=crayon-569898d2b13c8208113242 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-57">57</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-58">58</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-59">59</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-60">60</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-61">61</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-62">62</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-63">63</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-64">64</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-65">65</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-66">66</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-67">67</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-68">68</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-69">69</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-70">70</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-71">71</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-72">72</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-73">73</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-74">74</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-75">75</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-76">76</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-77">77</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-78">78</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-79">79</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-80">80</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13c8208113242-81">81</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13c8208113242-82">82</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b13c8208113242-1 class=crayon-line><SPAN class=crayon-t>enum</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>hrtimer_base_type</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>HRTIMER_BASE_MONOTONIC</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-3 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>HRTIMER_BASE_REALTIME</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>HRTIMER_BASE_BOOTTIME</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-5 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>HRTIMER_MAX_CLOCK_BASES</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//max &#36793;&#30028;&#65292;&#19979;&#38754;&#30340;clock_base&#23601;&#26159;&#29992;&#26469;&#20570;&#25968;&#32452;&#22823;&#23567;</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-7 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13c8208113242-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-9 class=crayon-line><SPAN class=crayon-c>* struct hrtimer_cpu_base - the per cpu clock bases</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-11 class=crayon-line><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_cpu_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>raw_spinlock_t </SPAN><SPAN class=crayon-v>lock</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//lock protecting the base and associated clock bases and timers</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-13 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>active_bases</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//Bitfield to mark bases with active timers</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>clock_was_set</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//Indicates that clock was set from irq context.</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-15 class=crayon-line><SPAN class=crayon-p>#ifdef CONFIG_HIGH_RES_TIMERS</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>ktime_t </SPAN><SPAN class=crayon-v>expires_next</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//absolute time of the next event which was scheduled, via clock_set_next_event()</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-17 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hres_active</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//State of high resolution mode</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hang_detected</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//The last hrtimer interrupt detected a hang</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-19 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>nr_events</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//Total number of hrtimer interrupt events</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>nr_retries</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//Total number of hrtimer interrupt retries</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-21 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>nr_hangs</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h>&nbsp;&nbsp; </SPAN><SPAN class=crayon-c>//Total number of hrtimer interrupt hangs</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>ktime_t </SPAN><SPAN class=crayon-v>max_hang_time</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//Maximum time spent in hrtimer_interrupt</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-23 class=crayon-line><SPAN class=crayon-p>#endif</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_clock_base </SPAN><SPAN class=crayon-v>clock_base</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>HRTIMER_MAX_CLOCK_BASES</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//array of clock bases for this cpu</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-25 class=crayon-line><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-26 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13c8208113242-27 class=crayon-line><SPAN class=crayon-e>DEFINE_PER_CPU</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer_cpu_base</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer_bases</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-28 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-29 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13c8208113242-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>lock</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__RAW_SPIN_LOCK_UNLOCKED</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>hrtimer_bases</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-31 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>clock_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-33 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>index</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_BASE_MONOTONIC</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-35 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>clockid</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CLOCK_MONOTONIC</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-36 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>get_time</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>ktime_get</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//monotonic time</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-37 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>resolution</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>KTIME_LOW_RES</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//&#21018;&#21021;&#22987;&#21270;&#30340;&#26102;&#20505;&#65292;&#37117;&#26159;&#20302;&#31934;&#24230;&#30340;</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-39 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>index</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_BASE_REALTIME</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-41 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>clockid</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CLOCK_REALTIME</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>get_time</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>ktime_get_real</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//get the real (wall-) time, TOD</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-43 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>resolution</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>KTIME_LOW_RES</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-44 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-45 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-46 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>index</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_BASE_BOOTTIME</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-47 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>clockid</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CLOCK_BOOTTIME</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>get_time</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>ktime_get_boottime</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-c>//monotonic time since boot</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-49 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>resolution</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>KTIME_LOW_RES</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-50 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-51 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-53 class=crayon-line><SPAN class=crayon-c>/**</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-54 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* struct hrtimer_clock_base - the timer base for a specific clock</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-55 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-56 class="crayon-line crayon-striped-line"><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_clock_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-57 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer_cpu_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//per cpu clock base</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-58 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>index</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//clock type index for per_cpu support when moving a timer to a base on another cpu.</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-59 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>clockid_t </SPAN><SPAN class=crayon-v>clockid</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//clock id for per_cpu support</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-60 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>timerqueue_head </SPAN><SPAN class=crayon-v>active</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//red black tree root node for the active timers, active queue&#37324;&#38754;&#23384;&#25918;&#30340;&#65292;&#23601;&#26159;hrtimer</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-61 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>ktime_t </SPAN><SPAN class=crayon-v>resolution</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//the resolution of the clock, in nanoseconds</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-62 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>ktime_t</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>get_time</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//function to retrieve the current time of the clock</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-63 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>ktime_t </SPAN><SPAN class=crayon-v>softirq_time</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//the time when running the hrtimer queue in the softirq</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-64 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>ktime_t </SPAN><SPAN class=crayon-v>offset</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//offset of this clock to the monotonic base</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-65 class=crayon-line><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-66 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13c8208113242-67 class=crayon-line><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>timerqueue_node</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-68 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>rb_node </SPAN><SPAN class=crayon-v>node</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-69 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>ktime_t </SPAN><SPAN class=crayon-v>expires</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//&#36825;&#20010;&#36229;&#26102;&#65292;&#26159;&#30495;&#27491;&#29992;&#20110;&#27604;&#36739;&#26102;&#38388;&#30340;&#65292;&#25454;&#35828;&#26159;&#20026;&#20102;&#33410;&#33021;&#20248;&#21270;</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-70 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-71 class=crayon-line><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-72 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>timerqueue_node </SPAN><SPAN class=crayon-v>node</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-73 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>ktime_t </SPAN><SPAN class=crayon-v>_softexpires</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//&#36825;&#26159;&#36229;&#26102;&#65292;&#21483;soft expires&#65292;&#23545;&#24212;timerqueue_node-&gt;expires&#21483;&#20570;hard expires</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-74 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>enum</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_restart</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-t>function</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//&#36825;&#23601;&#26159;&#22238;&#35843;&#20989;&#25968;&#20102;</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-75 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer_clock_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-76 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//&#29366;&#24577;&#23383;&#27573;&#65292;&#25351;&#31034;hrtimer&#22788;&#20110;&#20160;&#20040;&#29366;&#24577;&#65292;&#35265;#&#29366;&#24577;&#36716;&#25442;</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-77 class=crayon-line><SPAN class=crayon-p>#ifdef CONFIG_TIMER_STATS</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-78 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>start_pid</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-79 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>start_site</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-80 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>char</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>start_comm</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-cn>16</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-81 class=crayon-line><SPAN class=crayon-p>#endif</SPAN></DIV>
<DIV id=crayon-569898d2b13c8208113242-82 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-sy>;</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H2>HRTIMER&#21021;&#22987;&#21270;&#27969;&#31243;</H2>
<P></P>
<DIV id=crayon-569898d2b13d3970135754 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-57">57</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-58">58</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-59">59</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-60">60</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-61">61</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-62">62</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-63">63</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-64">64</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-65">65</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-66">66</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-67">67</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-68">68</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-69">69</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-70">70</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-71">71</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-72">72</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-73">73</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-74">74</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-75">75</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-76">76</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13d3970135754-77">77</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13d3970135754-78">78</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b13d3970135754-1 class=crayon-line><SPAN class=crayon-e>asmlinkage </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__init </SPAN><SPAN class=crayon-e>start_kernel</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-3 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-sy>.</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-5 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>init_IRQ</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>init_timers</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//&#21021;&#22987;&#21270;&#20302;&#31934;&#24230;timer</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-7 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>hrtimers_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//&#21021;&#22987;&#21270;&#39640;&#36827;&#24230;timer</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>softirq_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>timekeeping_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>time_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-11 class=crayon-line><SPAN class=crayon-h></SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-sy>.</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-13 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-14 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13d3970135754-15 class=crayon-line><SPAN class=crayon-c>//hrtimer&#30340;CPU&#20107;&#20214;&#36890;&#30693;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__cpuinit </SPAN><SPAN class=crayon-e>hrtimer_cpu_notify</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>notifier_block</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-r>self</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-17 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>action</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>hcpu</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-19 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>scpu</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-v>hcpu</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-20 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13d3970135754-21 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>switch</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>action</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-22 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13d3970135754-23 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>case</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CPU_UP_PREPARE</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>case</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CPU_UP_PREPARE_FROZEN</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-25 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>init_hrtimers_cpu</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>scpu</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#23545;&#27599;&#20010;CPU&#65292;&#21021;&#22987;&#21270;&#20854;struct hrtimer_cpu_base * &#20013;&#30340;hrtimer_clock_base</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>break</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-27 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13d3970135754-28 class="crayon-line crayon-striped-line"><SPAN class=crayon-p>#ifdef CONFIG_HOTPLUG_CPU //&#28909;&#25554;&#25300;&#25903;&#25345;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-29 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>case</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CPU_DYING</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>case</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CPU_DYING_FROZEN</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-31 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>clockevents_notify</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>CLOCK_EVT_NOTIFY_CPU_DYING</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>scpu</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>break</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-33 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>case</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CPU_DEAD</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>case</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CPU_DEAD_FROZEN</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-35 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-36 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>clockevents_notify</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>CLOCK_EVT_NOTIFY_CPU_DEAD</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>scpu</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-37 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>migrate_hrtimers</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>scpu</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//CPU DEAD&#30340;&#26102;&#20505;&#65292;&#23558;DEAD&#30340;CPU&#19978;&#30340;timer&#36801;&#31227;&#21040;&#26412;CPU</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>break</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-39 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-p>#endif</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-41 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>default</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>break</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-43 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-44 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13d3970135754-45 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NOTIFY_OK</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-46 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-47 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13d3970135754-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>notifier_block </SPAN><SPAN class=crayon-e>__cpuinitdata </SPAN><SPAN class=crayon-v>hrtimers_nb</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-49 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>notifier_call</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer_cpu_notify</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-50 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-51 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13d3970135754-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__init </SPAN><SPAN class=crayon-e>hrtimers_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-53 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-54 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>hrtimer_cpu_notify</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>hrtimers_nb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-v>CPU_UP_PREPARE</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-55 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-e>smp_processor_id</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#36825;&#37324;&#23558;BSP&#30340;PREPARE&#21021;&#22987;&#21270;&#26174;&#31034;&#35843;&#29992;&#19968;&#19979;&#65292;&#22240;&#20026;BSP&#24050;&#32463;&#21551;&#21160;&#20102;&#65292;&#20854;&#20182;CPU&#36890;&#36807;&#19979;&#38754;&#27880;&#20876;&#30340;&#22238;&#35843;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-56 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>register_cpu_notifier</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>hrtimers_nb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//CPU&#20107;&#20214;&#36890;&#30693;&#65292;&#20250;&#35843;&#29992;hrtimer_cpu_notify</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-57 class=crayon-line><SPAN class=crayon-p>#ifdef CONFIG_HIGH_RES_TIMERS</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-58 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>open_softirq</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>HRTIMER_SOFTIRQ</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>run_hrtimer_softirq</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#27880;&#20876;&#39640;&#31934;&#24230;&#27169;&#24335;&#19979;&#30340;&#23450;&#26102;&#22120;&#36719;&#20013;&#26029;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-59 class=crayon-line><SPAN class=crayon-p>#endif</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-60 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-61 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13d3970135754-62 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-63 class=crayon-line><SPAN class=crayon-c>* Functions related to boot-time initialization:</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-64 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-65 class=crayon-line><SPAN class=crayon-c>//&#23545;&#27599;&#19968;&#20010;CPU&#65292;&#21021;&#22987;&#21270;&#21644;CPU&#20851;&#32852;&#30340;hrtimer_cpu_base&#32467;&#26500;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-66 class="crayon-line crayon-striped-line"><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__cpuinit </SPAN><SPAN class=crayon-e>init_hrtimers_cpu</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpu</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-67 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-68 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer_cpu_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-e>per_cpu</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>hrtimer_bases</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpu</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-69 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-70 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#20854;&#23454;&#65292;&#20063;&#21021;&#22987;&#21270;&#20102;hrtimer_cpu_base&#20013;&#30340;hrtimer_clock_base&#25968;&#32452;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-71 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#27599;&#20010;clock base&#65292;&#38656;&#35201;&#23558;&#20854;&#23384;&#25918;hrtimer&#30340;queue&#21021;&#22987;&#21270;&#22909;&#65292;&#23558;&#22238;&#28335;&#25351;&#38024;&#35774;&#32622;&#22909;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-72 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>for</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_MAX_CLOCK_BASES</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-73 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>clock_base</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-74 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>timerqueue_init_head</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>clock_base</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>active</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-75 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-76 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13d3970135754-77 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>hrtimer_init_hres</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#20363;&#22914;&#21021;&#22987;&#21270;&#39640;&#31934;&#24230;&#20026;&#26410;&#28608;&#27963;&#29366;&#24577;</SPAN></DIV>
<DIV id=crayon-569898d2b13d3970135754-78 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H2>HRTIMER CPU&#28909;&#25554;&#25300;&#25903;&#25345;</H2>
<P>&#28909;&#25554;&#25300;&#25903;&#25345;&#65292;&#20854;&#26680;&#24515;&#21151;&#33021;&#65292;&#23601;&#26159;&#24403;&#19968;&#20010;CPU&#27515;&#25481;&#30340;&#26102;&#20505;&#65292;&#23558;&#20854;&#19978;&#38754;&#30340;hrtimer&#36801;&#31227;&#21040;&#26412;CPU&#19978;&#26469;&#65292;&#38656;&#35201;&#39044;&#32534;&#35793;&#23439;CONFIG_HOTPLUG_CPU&#12290;</P>
<DIV id=crayon-569898d2b13dd801478810 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-57">57</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-58">58</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-59">59</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-60">60</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-61">61</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-62">62</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-63">63</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-64">64</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13dd801478810-65">65</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13dd801478810-66">66</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b13dd801478810-1 class=crayon-line><SPAN class=crayon-p>#ifdef CONFIG_HOTPLUG_CPU</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>migrate_hrtimers</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>scpu</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-3 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer_cpu_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>old_base</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>new_base</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-5 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-6 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13dd801478810-7 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>BUG_ON</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>cpu_online</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>scpu</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>tick_cancel_sched_timer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>scpu</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-9 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13dd801478810-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>local_irq_disable</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#36801;&#31227;timer&#30340;&#26102;&#20505;&#20851;&#20013;&#26029;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-11 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>old_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-e>per_cpu</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>hrtimer_bases</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>scpu</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>new_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-e>__get_cpu_var</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>hrtimer_bases</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-13 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* The caller is globally serialized and nobody else</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-15 class=crayon-line><SPAN class=crayon-c>* takes two locks at once, deadlock is not possible.</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-17 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>raw_spin_lock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>new_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>raw_spin_lock_nested</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>old_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>lock</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>SINGLE_DEPTH_NESTING</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-19 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#26032;&#30340;&#32769;&#30340;hrtimer_bases&#37117;&#38145;&#36215;&#26469;&#65292;&#28982;&#21518;&#36801;&#31227;timer&#33410;&#28857;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#19968;&#20010;hrtimer_bases&#19979;&#21448;&#26377;&#22810;&#20010;clock base</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-21 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>for</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_MAX_CLOCK_BASES</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>migrate_hrtimer_list</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>old_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>clock_base</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-23 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>new_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>clock_base</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-25 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13dd801478810-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>raw_spin_unlock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>old_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-27 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>raw_spin_unlock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>new_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-28 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13dd801478810-29 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Check, if we got expired work to do */</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>__hrtimer_peek_ahead_timers</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#36825;&#37324;&#26159;&#20026;&#20102;&#30830;&#20445;&#23454;&#26102;&#24615;&#65292;&#36801;&#31227;&#23436;&#25104;&#21518;&#65292;&#23601;&#26816;&#26597;&#19968;&#19979;&#22788;&#20110;&#26412;CPU&#19978;&#30340;hrtimer_bases&#20013;&#26159;&#21542;&#26377;timer&#36229;&#26102;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-31 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>local_irq_enable</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#36801;&#31227;&#25104;&#21151;&#21518;&#24320;&#20013;&#26029;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-33 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13dd801478810-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>migrate_hrtimer_list</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer_clock_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>old_base</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-35 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer_clock_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>new_base</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-36 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-37 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>timerqueue_node</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>node</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-39 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#20570;&#20102;&#20010;&#24456;&#31616;&#21333;&#26159;&#20107;&#24773;&#65292;&#23601;&#26159;&#23558;&#32769;&#30340;clock_base&#37324;&#30340;active&#38142;&#34920;&#30340;timer&#37325;&#26032;&#36830;&#25509;&#21040;&#26032;&#30340;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>while</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>node</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>timerqueue_getnext</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>old_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>active</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-41 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>container_of</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>node</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>node</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>BUG_ON</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>hrtimer_callback_running</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-43 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>debug_deactivate</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-44 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13dd801478810-45 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-46 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* Mark it as STATE_MIGRATE not INACTIVE otherwise the</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-47 class=crayon-line><SPAN class=crayon-c>* timer could be seen as !active and just vanish away</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* under us on another CPU</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-49 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-50 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>__remove_hrtimer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>old_base</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_STATE_MIGRATE</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-51 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>new_base</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-53 class=crayon-line><SPAN class=crayon-c>* Enqueue the timers on the new cpu. This does not</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-54 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* reprogram the event device in case the timer</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-55 class=crayon-line><SPAN class=crayon-c>* expires before the earliest on this CPU, but we run</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-56 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* hrtimer_interrupt after we migrated everything to</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-57 class=crayon-line><SPAN class=crayon-c>* sort out already expired timers and reprogram the</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-58 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* event device.</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-59 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-60 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>enqueue_hrtimer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>new_base</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-61 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13dd801478810-62 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Clear the migration state bit */</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-63 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>~</SPAN><SPAN class=crayon-v>HRTIMER_STATE_MIGRATE</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-64 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-65 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13dd801478810-66 class="crayon-line crayon-striped-line"><SPAN class=crayon-p>#endif /* CONFIG_HOTPLUG_CPU */</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H2>&#26102;&#38047;&#35774;&#22791;</H2>
<P>&#22914;&#19979;&#26012;&#20307;&#37096;&#20998;&#25991;&#23383;&#25688;&#33258;&#38472;&#21151;&#30340;&#12298;Linux &#26102;&#38047;&#31649;&#29702;&#12299;<BR></P>
<BLOCKQUOTE>tick device<BR>Tick device &#29992;&#26469;&#22788;&#29702;&#21608;&#26399;&#24615;&#30340; tick event&#12290;Tick device &#20854;&#23454;&#26159;&#26102;&#38047;&#20107;&#20214;&#35774;&#22791;&#30340;&#19968;&#20010; wrapper&#65292;&#22240;&#27492; tick device &#20063;&#26377; one-shot &#21644;&#21608;&#26399;&#24615;&#36825;&#20004;&#31181;&#20013;&#26029;&#35302;&#21457;&#27169;&#24335;&#12290;<BR>&#27599;&#27880;&#20876;&#19968;&#20010;&#26102;&#38047;&#20107;&#20214;&#35774;&#22791;&#65292;&#36825;&#20010;&#35774;&#22791;&#20250;&#33258;&#21160;&#34987;&#27880;&#20876;&#20026;&#19968;&#20010; tick device&#12290;&#20840;&#23616;&#30340; tick device &#29992;&#26469;&#26356;&#26032;&#35832;&#22914; jiffies &#36825;&#26679;&#30340;&#20840;&#23616;&#20449;&#24687;&#65292;per-CPU &#30340; tick device &#21017;&#29992;&#26469;&#26356;&#26032;&#27599;&#20010; CPU &#30456;&#20851;&#30340;&#29305;&#23450;&#20449;&#24687;&#12290;
<P></P>
<P>broadcast<BR>Broadcast &#30340;&#20986;&#29616;&#26159;&#20026;&#20102;&#24212;&#23545;&#36825;&#26679;&#19968;&#31181;&#24773;&#20917;&#65306;&#20551;&#23450; CPU &#20351;&#29992; Local APIC Timer &#20316;&#20026; per-CPU &#30340; tick device&#65292;&#20294;&#26159;&#26576;&#20123;&#29305;&#23450;&#30340; CPU&#65288;&#22914; Intel &#30340; Westmere &#20043;&#21069;&#30340; CPU&#65289;&#22312;&#36827;&#20837; C3+ &#30340;&#29366;&#24577;&#26102; Local APIC Timer &#20063;&#20250;&#21516;&#26102;&#20572;&#27490;&#24037;&#20316;&#65292;&#36827;&#20837;&#30561;&#30496;&#29366;&#24577;&#12290;&#22312;&#36825;&#31181;&#24773;&#24418;&#19979; broadcast &#21487;&#20197;&#26367;&#20195; Local APIC Timer &#32487;&#32493;&#23436;&#25104;&#32479;&#35745;&#36827;&#31243;&#30340;&#25191;&#34892;&#26102;&#38388;&#31561;&#26377;&#20851;&#25805;&#20316;&#12290;&#26412;&#36136;&#19978; broadcast &#26159;&#21457;&#36865;&#19968;&#20010; IPI&#65288;Inter-processor interrupt&#65289;&#20013;&#26029;&#32473;&#20854;&#20182;&#25152;&#26377;&#30340; CPU&#65292;&#24403;&#30446;&#26631; CPU &#25910;&#21040;&#36825;&#20010; IPI &#20013;&#26029;&#21518;&#23601;&#20250;&#35843;&#29992;&#21407;&#20808; Local APIC Timer &#27491;&#24120;&#24037;&#20316;&#26102;&#30340;&#20013;&#26029;&#22788;&#29702;&#20989;&#25968;&#65292;&#20174;&#32780;&#23454;&#29616;&#20102;&#21516;&#26679;&#30340;&#21151;&#33021;&#12290;&#30446;&#21069;&#20027;&#35201;&#22312; x86 &#20197;&#21450; MIPS &#19979;&#20250;&#29992;&#21040; broadcast &#21151;&#33021;&#12290;</P>
<P>Timekeeping &amp; GTOD (Generic Time-of-Day)<BR>Timekeeping&#65288;&#21487;&#20197;&#29702;&#35299;&#20026;&#26102;&#38388;&#27979;&#37327;&#25110;&#32773;&#35745;&#26102;&#65289;&#26159;&#20869;&#26680;&#26102;&#38388;&#31649;&#29702;&#30340;&#19968;&#20010;&#26680;&#24515;&#32452;&#25104;&#37096;&#20998;&#12290;&#27809;&#26377; Timekeeping&#65292;&#23601;&#26080;&#27861;&#26356;&#26032;&#31995;&#32479;&#26102;&#38388;&#65292;&#32500;&#25345;&#31995;&#32479;&#8220;&#24515;&#36339;&#8221;&#12290;GTOD &#26159;&#19968;&#20010;&#36890;&#29992;&#30340;&#26694;&#26550;&#65292;&#29992;&#26469;&#23454;&#29616;&#35832;&#22914;&#35774;&#32622;&#31995;&#32479;&#26102;&#38388; gettimeofday &#25110;&#32773;&#20462;&#25913;&#31995;&#32479;&#26102;&#38388; settimeofday &#31561;&#24037;&#20316;&#12290;</P></BLOCKQUOTE>
<P></P>
<DIV id=crayon-569898d2b13ea410704998 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-57">57</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-58">58</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-59">59</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-60">60</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-61">61</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-62">62</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-63">63</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-64">64</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-65">65</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-66">66</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-67">67</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-68">68</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-69">69</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-70">70</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-71">71</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-72">72</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-73">73</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-74">74</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-75">75</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-76">76</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-77">77</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-78">78</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-79">79</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-80">80</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-81">81</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-82">82</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-83">83</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-84">84</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-85">85</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-86">86</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-87">87</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-88">88</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-89">89</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-90">90</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-91">91</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-92">92</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-93">93</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-94">94</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-95">95</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-96">96</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-97">97</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-98">98</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-99">99</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-100">100</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13ea410704998-101">101</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13ea410704998-102">102</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b13ea410704998-1 class=crayon-line><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* The hpet clock event device</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-3 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>clock_event_device </SPAN><SPAN class=crayon-v>hpet_clockevent</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-5 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>name</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"hpet"</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>features</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CLOCK_EVT_FEAT_PERIODIC</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CLOCK_EVT_FEAT_ONESHOT</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-7 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>set_mode</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hpet_legacy_set_mode</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>set_next_event</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hpet_legacy_next_event</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>irq</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>rating</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>50</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-11 class=crayon-line><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-12 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13ea410704998-13 class=crayon-line><SPAN class=crayon-e>asmlinkage </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__init </SPAN><SPAN class=crayon-e>start_kernel</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-15 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-sy>.</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>init_IRQ</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-17 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>init_timers</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>hrtimers_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-19 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>softirq_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>timekeeping_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-21 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>time_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-h> </SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-23 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>late_time_init</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>late_time_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-25 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-sy>.</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-27 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13ea410704998-28 class="crayon-line crayon-striped-line"><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__init </SPAN><SPAN class=crayon-e>time_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-29 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>late_time_init</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>x86_late_time_init</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-31 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-32 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13ea410704998-33 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__init </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>x86_late_time_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-35 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>x86_init</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>timers</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-e>timer_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-36 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>tsc_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-37 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-38 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13ea410704998-39 class=crayon-line><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>x86_init_ops </SPAN><SPAN class=crayon-e>x86_init </SPAN><SPAN class=crayon-v>__initdata</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-sy>.</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-41 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>timers</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>setup_percpu_clockev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>setup_boot_APIC_clock</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-43 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tsc_pre_init</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>x86_init_noop</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-44 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>timer_init</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hpet_time_init</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-45 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>wallclock_init</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>x86_init_noop</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-46 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-47 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-sy>.</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-49 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13ea410704998-50 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>/* Default timer init function */</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-51 class=crayon-line><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__init </SPAN><SPAN class=crayon-e>hpet_time_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-53 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>hpet_enable</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-c>//&#40664;&#35748;&#20351;&#29992;HPET&#65292;&#22914;&#26524;HPET&#19981;&#25903;&#25345;&#65292;&#20877;&#20351;&#29992;PIT&#20195;&#26367;&#26102;&#38047;&#28304;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-54 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>setup_pit_timer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-55 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>setup_default_timer_irq</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#20026;IRQ0&#35774;&#32622;&#22788;&#29702;HANDLE</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-56 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-57 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13ea410704998-58 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>hpet_enable</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-&gt;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-59 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hpet_legacy_clockevent_register</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-60 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-61 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Start HPET legacy interrupts */</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-62 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>hpet_enable_legacy_int</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-63 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13ea410704998-64 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-65 class=crayon-line><SPAN class=crayon-c>* Start hpet with the boot cpu mask and make it</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-66 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* global after the IO_APIC has been initialized.</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-67 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-68 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>hpet_clockevent</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>cpumask</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>cpumask_of</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>smp_processor_id</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-69 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>clockevents_config_and_register</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>hpet_clockevent</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hpet_freq</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-70 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>HPET_MIN_PROG_DELTA</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0x7FFFFFFF</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#38750;&#24120;&#20851;&#38190;&#65292;&#27880;&#20876;clock event</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-71 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>global_clock_event</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>hpet_clockevent</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#35753;IRQ 0&#30340;&#20013;&#26029;HANDLE&#20351;&#29992;hpet&#30340;HANDLE</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-72 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>printk</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>KERN</SPAN><SPAN class=crayon-sy>_</SPAN>DEBUG<SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"hpet clockevent registeredn"</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-73 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-74 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13ea410704998-75 class=crayon-line><SPAN class=crayon-v>clockevents_config_and_register</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-&gt;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-76 class="crayon-line crayon-striped-line"><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>clockevents_register_device</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>clock_event_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-77 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-78 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-79 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13ea410704998-80 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>BUG_ON</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-m>mode</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CLOCK_EVT_MODE_UNUSED</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-81 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>cpumask</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-82 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>WARN_ON</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>num_possible_cpus</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&gt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-83 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>cpumask</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>cpumask_of</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>smp_processor_id</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-84 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-85 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13ea410704998-86 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>raw_spin_lock_irqsave</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>clockevents_lock</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-87 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#23558;clock event &#21152;&#20837;clockevent_devices&#38142;&#34920;&#65292;&#21487;&#20197;&#29992;&#22312;suspend, resume&#25110;&#20854;&#20182;&#28040;&#24687;&#36890;&#30693;&#30340;&#26102;&#20505;&#22238;&#35843;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-88 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>list_add</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>list</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>clockevent_devices</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-89 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>clockevents_do_notify</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>CLOCK_EVT_NOTIFY_ADD</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#36890;&#30693;clock event&#28155;&#21152;&#20107;&#20214;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-90 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>clockevents_notify_released</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-91 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13ea410704998-92 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>raw_spin_unlock_irqrestore</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>clockevents_lock</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-93 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-94 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13ea410704998-95 class=crayon-line><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-96 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* Notify about a clock event change. Called with clockevents_lock</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-97 class=crayon-line><SPAN class=crayon-c>* held.</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-98 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-99 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>clockevents_do_notify</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>reason</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-100 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-101 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>raw_notifier_call_chain</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>clockevents_chain</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>reason</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13ea410704998-102 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<P>CLOCK_EVT_NOTIFY_ADD&#36890;&#30693;&#20250;&#22312;tick_notify&#37324;&#25910;&#21040;&#65292;&#28982;&#21518;&#22238;&#35843;<BR>tick_check_new_device -&gt; tick_setup_device(td, newdev, cpu, cpumask_of(cpu));</P>
<DIV id=crayon-569898d2b13f5939189489 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13f5939189489-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13f5939189489-57">57</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b13f5939189489-1 class=crayon-line><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* Setup the tick device</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-3 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>tick_setup_device</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tick_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>td</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-5 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>clock_event_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>newdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpu</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-r>const</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpumask</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>cpumask</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-7 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>ktime_t </SPAN><SPAN class=crayon-v>next_event</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>handler</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>clock_event_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>NULL</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-10 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13f5939189489-11 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* First device setup ?</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-13 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>td</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>evtdev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-15 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* If no cpu took the do_timer update, assign it to</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-17 class=crayon-line><SPAN class=crayon-c>* this cpu:</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-19 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tick_do_timer_cpu</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>TICK_DO_TIMER_BOOT</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tick_do_timer_cpu</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpu</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-21 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tick_next_period</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_get</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tick_period</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_set</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NSEC_PER_SEC</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>/</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HZ</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-23 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-24 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13f5939189489-25 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* Startup in periodic mode first.</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-27 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-28 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>td</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-m>mode</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>TICKDEV_MODE_PERIODIC</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#21021;&#22987;&#30340;&#26102;&#20505;&#65292;&#37117;&#26159;PERIODIC&#27169;&#24335;&#65292;&#24403;&#39640;&#31934;&#24230;&#26102;&#38047;&#30340;&#26102;&#20505;&#65292;&#25165;&#26159;ONE SHORT</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-29 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>else</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>handler</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>td</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>evtdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>event_handler</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-31 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>next_event</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>td</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>evtdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_event</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>td</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>evtdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>event_handler</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>clockevents_handle_noop</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-33 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-34 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13f5939189489-35 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>td</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>evtdev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>newdev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-36 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13f5939189489-37 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* When the device is not per cpu, pin the interrupt to the</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-39 class=crayon-line><SPAN class=crayon-c>* current cpu:</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-41 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>cpumask_equal</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>newdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>cpumask</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpumask</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>irq_set_affinity</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>newdev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>irq</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpumask</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-43 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13f5939189489-44 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-45 class=crayon-line><SPAN class=crayon-c>* When global broadcasting is active, check if the current</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-46 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* device is registered as a placeholder for broadcast mode.</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-47 class=crayon-line><SPAN class=crayon-c>* This allows us to handle this x86 misfeature in a generic</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* way.</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-49 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-50 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>tick_device_uses_broadcast</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>newdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpu</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-51 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#21021;&#22987;&#21270;</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-53 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>td</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-m>mode</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>TICKDEV_MODE_PERIODIC</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-54 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>tick_setup_periodic</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>newdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#36825;&#37324;&#38754;&#35774;&#32622;handle&#20026;tick_handle_periodic &#25110;tick_handle_periodic_broadcast</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-55 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>else</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-56 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>tick_setup_oneshot</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>newdev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>handler</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>next_event</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//&#22312;&#39640;&#31934;&#24230;&#27169;&#24335;&#19979;&#65292;handler&#20854;&#23454;&#26159;hrtimer_interrupt</SPAN></DIV>
<DIV id=crayon-569898d2b13f5939189489-57 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H3>&#20302;&#31934;&#24230;&#27169;&#24335;</H3>
<P>&#25152;&#20197;&#65292;&#21608;&#26399;&#26102;&#38047;(&#20302;&#31934;&#24230;)&#26102;&#65292;&#22238;&#35843;&#20989;&#25968;&#20026;tick_handle_periodic&#25110;tick_handle_periodic_broadcast</P>
<DIV id=crayon-569898d2b13fe397578117 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-57">57</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-58">58</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-59">59</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-60">60</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-61">61</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-62">62</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-63">63</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-64">64</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-65">65</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-66">66</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-67">67</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-68">68</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-69">69</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-70">70</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-71">71</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-72">72</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-73">73</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-74">74</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-75">75</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-76">76</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-77">77</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b13fe397578117-78">78</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b13fe397578117-79">79</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b13fe397578117-1 class=crayon-line><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* Event handler for periodic ticks</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-3 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>tick_handle_periodic</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>clock_event_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-5 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpu</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>smp_processor_id</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-7 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>ktime_t </SPAN><SPAN class=crayon-v>next</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-8 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13fe397578117-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>tick_periodic</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>cpu</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-10 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13fe397578117-11 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-m>mode</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CLOCK_EVT_MODE_ONESHOT</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-13 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* Setup the next period for devices, which do not have</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-15 class=crayon-line><SPAN class=crayon-c>* periodic mode:</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-17 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>next</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_add</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_event</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tick_period</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>for</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-19 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>clockevents_program_event</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>next</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>false</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-21 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* Have to be careful here. If we're in oneshot mode,</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-23 class=crayon-line><SPAN class=crayon-c>* before we call tick_periodic() in a loop, we need</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* to be sure we're using a real hardware clocksource.</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-25 class=crayon-line><SPAN class=crayon-c>* Otherwise we could get trapped in an infinite</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* loop, as the tick_periodic() increments jiffies,</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-27 class=crayon-line><SPAN class=crayon-c>* when then will increment time, posibly causing</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-28 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* the loop to trigger again and again.</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-29 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>timekeeping_valid_for_hres</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-31 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>tick_periodic</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>cpu</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>next</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_add</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>next</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tick_period</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-33 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-35 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13fe397578117-36 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-37 class=crayon-line><SPAN class=crayon-c>* Periodic tick</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-39 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>tick_periodic</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpu</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-41 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tick_do_timer_cpu</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpu</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>write_seqlock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>jiffies_lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-43 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13fe397578117-44 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Keep track of the next tick event */</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-45 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tick_next_period</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_add</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tick_next_period</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tick_period</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-46 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13fe397578117-47 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>do_timer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>write_sequnlock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>jiffies_lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-49 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-50 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-51 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>update_process_times</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>user_mode</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>get_irq_regs</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#20302;&#31934;&#24230;&#19979;&#65292;&#36816;&#34892;&#27492;&#20989;&#25968;&#65292;&#26356;&#26032;&#36827;&#31243;&#26102;&#38388;&#65292;&#35843;&#29992;run_local_timers</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>profile_tick</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>CPU_PROFILING</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-53 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-54 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b13fe397578117-55 class=crayon-line><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>update_process_times</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>user_tick</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-56 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-57 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>task_struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>p</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>current</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-58 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpu</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>smp_processor_id</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-59 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13fe397578117-60 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Note: this timer irq context must be accounted for as well. */</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-61 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>account_process_tick</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>p</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>user_tick</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-62 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>run_local_timers</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//&#36816;&#34892;local timers</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-63 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>rcu_check_callbacks</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>cpu</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>user_tick</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-64 class="crayon-line crayon-striped-line"><SPAN class=crayon-p>#ifdef CONFIG_IRQ_WORK</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-65 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>in_irq</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-66 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>irq_work_run</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-67 class=crayon-line><SPAN class=crayon-p>#endif</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-68 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>scheduler_tick</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-69 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>run_posix_cpu_timers</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>p</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-70 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-71 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b13fe397578117-72 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-73 class=crayon-line><SPAN class=crayon-c>* Called by the local, per-CPU timer interrupt on SMP.</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-74 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-75 class=crayon-line><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>run_local_timers</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-76 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-77 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>hrtimer_run_queues</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//hardirq context&#19979;&#36816;&#34892;&#25152;&#26377;&#21040;&#26399;&#30340;timer</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-78 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>raise_softirq</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>TIMER_SOFTIRQ</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//TIMER&#36719;&#20013;&#26029;&#65292;&#19981;&#26159;HTIMER, softirq context&#19979;&#36816;&#34892;&#25152;&#26377;&#21040;&#26399;&#30340;timer&#65292;start_kernel-&gt;init_timers-&gt;open_softirq(TIMER_SOFTIRQ, run_timer_softirq); &#36825;&#37324;&#27880;&#20876;&#30340;SOFTIRQ&#22238;&#35843;</SPAN></DIV>
<DIV id=crayon-569898d2b13fe397578117-79 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<P>&#36825;&#37324;&#30340;TIMER SOFTIRQ&#65292;&#26159;&#22312;start_kernel&#37324;&#38754;&#35843;&#29992;init_timers&#21021;&#22987;&#21270;&#30340;&#65292;&#20250;&#35843;&#29992;&#21040;run_timer_softirq</P>
<DIV id=crayon-569898d2b1408047538015 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b1408047538015-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1408047538015-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1408047538015-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1408047538015-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1408047538015-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1408047538015-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1408047538015-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1408047538015-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1408047538015-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1408047538015-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1408047538015-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1408047538015-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1408047538015-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1408047538015-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1408047538015-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1408047538015-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1408047538015-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1408047538015-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1408047538015-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1408047538015-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1408047538015-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1408047538015-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1408047538015-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1408047538015-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1408047538015-25">25</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b1408047538015-1 class=crayon-line><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__init </SPAN><SPAN class=crayon-e>init_timers</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1408047538015-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1408047538015-3 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1408047538015-4 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1408047538015-5 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* ensure there are enough low bits for flags in timer-&gt;base pointer */</SPAN></DIV>
<DIV id=crayon-569898d2b1408047538015-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>BUILD_BUG_ON</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-r>__alignof__</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tvec_base</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>TIMER_FLAG_MASK</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1408047538015-7 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#26174;&#31034;&#35843;&#29992;&#19968;&#19979;&#24403;&#21069;CPU&#30340;PREPARE</SPAN></DIV>
<DIV id=crayon-569898d2b1408047538015-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>timer_cpu_notify</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>timers_nb</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-v>CPU_UP_PREPARE</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b1408047538015-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-e>smp_processor_id</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1408047538015-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>init_timer_stats</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1408047538015-11 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1408047538015-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>BUG_ON</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>err</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NOTIFY_OK</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1408047538015-13 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>register_cpu_notifier</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>timers_nb</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#36825;&#37324;&#25165;&#26159;&#27880;&#20876;&#22238;&#35843;</SPAN></DIV>
<DIV id=crayon-569898d2b1408047538015-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>open_softirq</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>TIMER_SOFTIRQ</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>run_timer_softirq</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#27880;&#20876;TIMER_SOFTIRQ&#36719;&#20013;&#26029;</SPAN></DIV>
<DIV id=crayon-569898d2b1408047538015-15 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1408047538015-16 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1408047538015-17 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>run_timer_softirq</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>softirq_action</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>h</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1408047538015-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1408047538015-19 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tvec_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__this_cpu_read</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tvec_bases</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1408047538015-20 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1408047538015-21 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>hrtimer_run_pending</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#26816;&#26597;&#19968;&#19979;&#65292;&#26159;&#21542;&#38656;&#20999;&#25442;&#21040;&#39640;&#31934;&#24230;</SPAN></DIV>
<DIV id=crayon-569898d2b1408047538015-22 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1408047538015-23 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>time_after_eq</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>jiffies</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>timer_jiffies</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1408047538015-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>__run_timers</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#20302;&#31934;&#24230;&#27169;&#24335;&#19979;&#65292;&#22312;&#36719;&#20013;&#26029;&#19978;&#19979;&#25991;&#35843;&#29992;&#20302;&#31934;&#24230;&#30340;timer&#22238;&#35843;</SPAN></DIV>
<DIV id=crayon-569898d2b1408047538015-25 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<P>&#19978;&#38754;&#30340;run_local_timers&#37324;&#65292;&#35843;&#29992;hrtimer_run_queues&#65292;&#30446;&#30340;&#26159;&#22312;&#20302;&#31934;&#24230;&#27169;&#24335;&#19979;&#65292;&#23454;&#29616;hrtimer&#21151;&#33021;</P>
<DIV id=crayon-569898d2b140f259037904 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b140f259037904-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b140f259037904-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b140f259037904-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b140f259037904-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b140f259037904-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b140f259037904-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b140f259037904-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b140f259037904-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b140f259037904-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b140f259037904-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b140f259037904-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b140f259037904-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b140f259037904-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b140f259037904-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b140f259037904-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b140f259037904-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b140f259037904-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b140f259037904-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b140f259037904-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b140f259037904-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b140f259037904-41">41</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b140f259037904-1 class=crayon-line><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* Called from hardirq context every jiffy</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-3 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_run_queues</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-5 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>timerqueue_node</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>node</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-7 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer_cpu_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-e>__get_cpu_var</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>hrtimer_bases</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer_clock_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>index</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>gettime</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-10 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b140f259037904-11 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#22914;&#26524;&#24320;&#21551;&#20102;&#39640;&#31934;&#24230;&#27169;&#24335;&#65292;&#36825;&#37324;&#23601;&#19981;&#20250;&#36827;&#26469;</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#25442;&#35328;&#20043;&#65292;&#36825;&#37324;&#23454;&#29616;&#20102;&#20302;&#31934;&#24230;&#25903;&#25345;hrtimer&#30340;&#21151;&#33021;</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-13 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#20999;&#35760;&#65292;&#36825;&#20010;&#35843;&#29992;&#26159;&#22312;&#26102;&#38047;&#35774;&#22791;&#30340;&#30828;&#20013;&#26029;&#20013;&#35843;&#29992;&#30340;</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>hrtimer_hres_active</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-15 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-16 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b140f259037904-17 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>for</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>index</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>index</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_MAX_CLOCK_BASES</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>index</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>clock_base</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>index</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#23558;&#24403;&#21069;CPU&#19978;&#30340;&#25152;&#26377;&#31867;&#22411;&#30340;CLOCK&#19978;&#30340;&#25152;&#26377;timer&#37117;&#26816;&#26597;&#19968;&#36941;</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-19 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>timerqueue_getnext</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>active</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>continue</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-21 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b140f259037904-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>gettime</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-23 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>hrtimer_get_softirq_time</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#36825;&#37324;&#20250;&#23558;&#25152;&#26377;&#30340;base&#30340;softirq_time&#26356;&#26032;&#20026;&#26368;&#26032;</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>gettime</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-25 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-26 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b140f259037904-27 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>raw_spin_lock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-28 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b140f259037904-29 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>while</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>node</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>timerqueue_getnext</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>active</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-31 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#36825;&#37324;&#27604;&#36739;&#30340;&#19990;&#30028;&#26159;node&#30340;&#26102;&#38388;&#65292;&#21363;hard expires</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>container_of</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>node</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>node</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-33 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>softirq_time</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;=</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>hrtimer_get_expires_tv64</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-c>//timer-&gt;node.expires.tv64;&#36825;&#37324;&#27604;&#36739;&#26102;&#38388;&#65292;&#29992;&#30340;&#26159;timer-&gt;node.expires&#65292;&#19981;&#26159;timer-&gt;_softexpires</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-35 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>break</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-36 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b140f259037904-37 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>__run_hrtimer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>softirq_time</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#35843;&#29992;run timer</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-39 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>raw_spin_unlock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b140f259037904-41 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H3>&#20302;&#31934;&#24230;&#20999;&#25442;&#21040;&#39640;&#31934;&#24230;</H3>
<P>&#19978;&#38754;&#20302;&#31934;&#24230;&#27169;&#24335;&#19979;&#65292;&#36816;&#34892;TIMER SOFTIRQ&#30340;&#26102;&#20505;(run_timer_softirq)&#65292;&#20250;&#26816;&#26597;&#26159;&#21542;&#21487;&#20197;&#20999;&#25442;&#21040;&#39640;&#31934;&#24230;&#27169;&#24335;</P>
<DIV id=crayon-569898d2b1417858724434 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-57">57</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-58">58</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-59">59</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-60">60</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-61">61</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-62">62</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-63">63</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-64">64</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-65">65</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-66">66</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-67">67</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-68">68</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-69">69</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-70">70</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-71">71</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-72">72</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-73">73</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-74">74</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-75">75</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-76">76</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-77">77</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-78">78</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-79">79</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-80">80</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-81">81</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-82">82</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-83">83</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-84">84</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-85">85</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-86">86</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-87">87</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-88">88</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-89">89</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-90">90</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-91">91</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-92">92</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-93">93</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-94">94</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-95">95</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-96">96</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-97">97</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-98">98</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-99">99</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-100">100</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-101">101</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-102">102</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-103">103</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-104">104</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-105">105</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-106">106</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-107">107</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-108">108</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-109">109</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-110">110</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-111">111</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-112">112</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-113">113</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-114">114</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-115">115</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-116">116</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-117">117</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-118">118</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-119">119</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-120">120</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-121">121</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-122">122</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-123">123</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-124">124</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-125">125</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-126">126</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-127">127</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-128">128</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-129">129</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-130">130</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-131">131</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-132">132</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-133">133</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-134">134</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-135">135</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-136">136</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-137">137</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-138">138</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-139">139</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-140">140</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-141">141</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-142">142</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-143">143</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-144">144</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-145">145</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-146">146</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-147">147</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-148">148</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1417858724434-149">149</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1417858724434-150">150</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b1417858724434-1 class=crayon-line><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_run_pending</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-3 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>hrtimer_hres_active</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-c>//&#24050;&#32463;&#26159;&#39640;&#31934;&#24230;&#20102;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-5 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1417858724434-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-7 class=crayon-line><SPAN class=crayon-c>* This _is_ ugly: We have to check in the softirq context,</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* whether we can switch to highres and / or nohz mode. The</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-9 class=crayon-line><SPAN class=crayon-c>* clocksource switch happens in the timer interrupt with</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* xtime_lock held. Notification from there only sets the</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-11 class=crayon-line><SPAN class=crayon-c>* check bit in the tick_oneshot code, otherwise we might</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* deadlock vs. xtime_lock.</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-13 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>tick_check_oneshot_change</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>hrtimer_is_hres_enabled</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-15 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>hrtimer_switch_to_hres</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#30475;&#19979;&#65292;&#26159;&#21542;&#39640;&#31934;&#24230;&#27169;&#24335;&#24320;&#21551;&#65292;&#26159;&#30340;&#35805;&#20999;&#25442;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-17 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1417858724434-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>tick_check_oneshot_change</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>allow_nohz</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-19 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tick_sched</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>ts</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-e>__get_cpu_var</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tick_cpu_sched</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-21 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//0&#20301;&#29992;&#20110;&#20445;&#23384;&#21313;&#20998;clock&#21457;&#29983;&#20102;&#21464;&#21270;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>test_and_clear_bit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>ts</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>check_clocks</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-23 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-24 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1417858724434-25 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>ts</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>nohz_mode</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NOHZ_MODE_INACTIVE</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-c>//&#24050;&#32463;&#24320;&#21551;&#20102;NOHZ&#27169;&#24335;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-27 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1417858724434-28 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//timekeeping&#19981;&#25903;&#25345;&#39640;&#31934;&#24230;&#25110;clock event&#19981;&#25903;&#25345;oneshot&#65292;&#26080;&#27861;&#20999;&#25442;&#21040;&#39640;&#31934;&#24230;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-29 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>timekeeping_valid_for_hres</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>||</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>tick_is_oneshot_available</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-31 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1417858724434-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#24403;&#36816;&#34892;&#39640;&#31934;&#24230;&#30340;&#26102;&#20505;&#65292;return 1&#65292;&#20250;&#35774;&#32622;hrtimer_interrupt</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-33 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#21542;&#21017;&#20999;&#25442;&#21040;nohz&#65292;&#35774;&#32622;tick_nohz_handler</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>allow_nohz</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-35 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-36 class="crayon-line crayon-striped-line"><SPAN class=crayon-p>#if 0</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-37 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-e>low </SPAN><SPAN class=crayon-e>resolution </SPAN><SPAN class=crayon-m>mode</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>High </SPAN><SPAN class=crayon-e>resolution </SPAN><SPAN class=crayon-m>mode</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>+</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-o>+</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>-</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-39 class=crayon-line><SPAN class=crayon-e>periodic </SPAN><SPAN class=crayon-v>tick</SPAN><SPAN class=crayon-h> &nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tick_handle_periodic</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_interrupt</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-e>dynamic </SPAN><SPAN class=crayon-v>tick</SPAN><SPAN class=crayon-h> &nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tick_nohz_handler</SPAN><SPAN class=crayon-h> &nbsp;&nbsp;</SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer_interrupt</SPAN><SPAN class=crayon-h> </SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-41 class=crayon-line><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>+</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-o>+</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>--</SPAN><SPAN class=crayon-o>-</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-p>#endif</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-43 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>tick_nohz_switch_to_nohz</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-44 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-45 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-46 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1417858724434-47 class=crayon-line><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* Switch to high resolution mode</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-49 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-50 class="crayon-line crayon-striped-line"><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_switch_to_hres</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-51 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpu</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>smp_processor_id</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-53 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer_cpu_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-e>per_cpu</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>hrtimer_bases</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpu</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-54 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-55 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1417858724434-56 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hres_active</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-c>//&#24050;&#32463;&#26159;&#39640;&#31934;&#24230;&#27169;&#24335;&#20102;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-57 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-58 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1417858724434-59 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>local_irq_save</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-60 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1417858724434-61 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>tick_init_highres</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>// =&gt; tick_switch_to_oneshot(hrtimer_interrupt)</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-62 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#21021;&#22987;&#21270;&#38169;&#20102;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-63 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>local_irq_restore</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-64 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>printk</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>KERN</SPAN><SPAN class=crayon-sy>_</SPAN>WARNING<SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"Could not switch to high resolution "</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-65 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-s>"mode on CPU %dn"</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpu</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-66 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-67 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-68 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hres_active</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#36825;&#20010;&#26631;&#24535;&#39640;&#31934;&#24230;&#27169;&#24335;active</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-69 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>for</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_MAX_CLOCK_BASES</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-70 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>clock_base</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>resolution</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>KTIME_HIGH_RES</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#20462;&#25913;clock base&#30340;&#26631;&#24535;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-71 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1417858724434-72 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>tick_setup_sched_timer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#20302;&#31934;&#24230;&#19979;&#35201;&#24178;&#30340;&#20107;&#65292;&#39640;&#31934;&#24230;&#19979;&#29992;&#19968;&#20010;hrtimer&#26469;&#20570;&#65292;&#20026;&#21861;?&#25105;&#24819;&#26159;&#22240;&#20026;&#39640;&#31934;&#24230;&#30340;&#39057;&#29575;&#27604;&#20302;&#31934;&#24230;&#39640;&#65292;&#32780;&#36825;&#20123;&#20219;&#21153;&#29992;&#19981;&#30528;&#39640;&#39057;&#29575;&#22788;&#29702;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-73 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* "Retrigger" the interrupt to get things going */</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-74 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>retrigger_next_event</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>NULL</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-75 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>local_irq_restore</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-76 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-77 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-78 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1417858724434-79 class=crayon-line><SPAN class=crayon-c>/**</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-80 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* tick_switch_to_oneshot - switch to oneshot mode</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-81 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-82 class="crayon-line crayon-striped-line"><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>tick_switch_to_oneshot</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>handler</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>clock_event_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-83 class=crayon-line><SPAN class=crayon-sy>{</SPAN><SPAN class=crayon-c>//&#39640;&#31934;&#24230;&#25903;&#25345;&#65292;&#38656;&#35201;oneshot&#27169;&#24335;&#65292;&#26041;&#20415;&#21450;&#26102;&#20999;&#25442;&#39057;&#29575;&#25110;&#20572;&#27490;&#21551;&#21160;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-84 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tick_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>td</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-e>__get_cpu_var</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tick_cpu_device</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-85 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>clock_event_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>td</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>evtdev</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-86 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1417858724434-87 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>||</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>features</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CLOCK_EVT_FEAT_ONESHOT</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>||</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-88 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>tick_device_is_functional</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-89 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#31967;&#31957;&#65292;&#35774;&#22791;&#19981;&#25903;&#25345;ONESHORT</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-90 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>printk</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>KERN</SPAN><SPAN class=crayon-sy>_</SPAN>INFO<SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"Clockevents: "</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-91 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-s>"could not switch to one-shot mode:"</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-92 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-93 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>printk</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-s>" no tick devicen"</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-94 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>else</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-95 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>tick_device_is_functional</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-96 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>printk</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-s>" %s is not functional.n"</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>name</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-97 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>else</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-98 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>printk</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-s>" %s does not support one-shot mode.n"</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-99 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>name</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-100 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-101 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-v>EINVAL</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-102 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-103 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1417858724434-104 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>td</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-m>mode</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>TICKDEV_MODE_ONESHOT</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#20462;&#25913;&#20026;ONESHORT&#27169;&#24335;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-105 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>event_handler</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>handler</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#29616;&#22312;&#65292;HANDLER&#20063;&#20462;&#25913;&#20102;&#65292;&#20302;&#31934;&#24230;&#30340;&#22238;&#35843;&#26159;&#22312;tick_setup_periodic&#37324;&#35774;&#32622;&#30340;&#65292;&#39640;&#31934;&#24230;&#26159;hrtimer_interrupt</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-106 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>clockevents_set_mode</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CLOCK_EVT_MODE_ONESHOT</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-107 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>tick_broadcast_switch_to_oneshot</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#35753;broadcast&#35774;&#22791;&#20063;&#20999;&#25442;&#21040;oneshot&#27169;&#24335;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-108 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-109 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-110 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1417858724434-111 class=crayon-line><SPAN class=crayon-c>/**</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-112 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* tick_setup_sched_timer - setup the tick emulation timer</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-113 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-114 class="crayon-line crayon-striped-line"><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>tick_setup_sched_timer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-115 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-116 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tick_sched</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>ts</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-e>__get_cpu_var</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tick_cpu_sched</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-117 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>ktime_t </SPAN><SPAN class=crayon-v>now</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_get</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-118 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1417858724434-119 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-120 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* Emulate tick processing via per-CPU hrtimers:</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-121 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-122 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>hrtimer_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>ts</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>sched_timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CLOCK_MONOTONIC</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_MODE_ABS</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-123 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>ts</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>sched_timer</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-t>function</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tick_sched_timer</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#20027;&#35201;&#26356;&#26032;&#19979;JIFFIES&#65292;&#36827;&#31243;&#36816;&#34892;&#26102;&#38388;&#31561;&#22312;&#20302;&#31934;&#24230;&#19979;&#20063;&#35201;&#20570;&#30340;&#24037;&#20316;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-124 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1417858724434-125 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Get the next period (per cpu) */</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-126 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>hrtimer_set_expires</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>ts</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>sched_timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>tick_init_jiffy_update</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-127 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1417858724434-128 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Offset the tick to avert jiffies_lock contention. */</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-129 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>sched_skew_tick</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN><SPAN class=crayon-c>//&#36825;&#20010;&#19981;&#38169;&#65292;&#38450;&#27490;jiffies lock&#31454;&#20105;&#65292;&#35753;&#36229;&#26102;&#27599;&#20010;CPU&#30340;&#36229;&#26102;&#21608;&#26399;&#21644;CPU ID&#20570;&#19968;&#20010;&#25955;&#21015;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-130 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>u64 </SPAN><SPAN class=crayon-v>offset</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_to_ns</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tick_period</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&gt;&gt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-131 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>do_div</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>offset</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>num_possible_cpus</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-132 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>offset</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>smp_processor_id</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-133 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>hrtimer_add_expires_ns</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>ts</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>sched_timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>offset</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-134 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-135 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1417858724434-136 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>for</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN><SPAN class=crayon-c>//&#23601;&#26159;&#30830;&#20445;sched timer&#36816;&#34892;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-137 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>hrtimer_forward</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>ts</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>sched_timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>now</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tick_period</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-138 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>hrtimer_start_expires</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>ts</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>sched_timer</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-139 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>HRTIMER_MODE_ABS_PINNED</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-140 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Check, if the timer was already in the past */</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-141 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>hrtimer_active</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>ts</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>sched_timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-142 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>break</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-143 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>now</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_get</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-144 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-145 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1417858724434-146 class="crayon-line crayon-striped-line"><SPAN class=crayon-p>#ifdef CONFIG_NO_HZ</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-147 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tick_nohz_enabled</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-148 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>ts</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>nohz_mode</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NOHZ_MODE_HIGHRES</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-149 class=crayon-line><SPAN class=crayon-p>#endif</SPAN></DIV>
<DIV id=crayon-569898d2b1417858724434-150 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H3>&#39640;&#31934;&#24230;&#27169;&#24335;</H3>
<P></P>
<DIV id=crayon-569898d2b1426152241666 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-57">57</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-58">58</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-59">59</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-60">60</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-61">61</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-62">62</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-63">63</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-64">64</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-65">65</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-66">66</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-67">67</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-68">68</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-69">69</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-70">70</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-71">71</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-72">72</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-73">73</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-74">74</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-75">75</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-76">76</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-77">77</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-78">78</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-79">79</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-80">80</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-81">81</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-82">82</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-83">83</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-84">84</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-85">85</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-86">86</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-87">87</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-88">88</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-89">89</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-90">90</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-91">91</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-92">92</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-93">93</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-94">94</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-95">95</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-96">96</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-97">97</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-98">98</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-99">99</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-100">100</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-101">101</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-102">102</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-103">103</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-104">104</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-105">105</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-106">106</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-107">107</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-108">108</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-109">109</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-110">110</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-111">111</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-112">112</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-113">113</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-114">114</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-115">115</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-116">116</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-117">117</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-118">118</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-119">119</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-120">120</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-121">121</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-122">122</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-123">123</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-124">124</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-125">125</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-126">126</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-127">127</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-128">128</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-129">129</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-130">130</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-131">131</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-132">132</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-133">133</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-134">134</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-135">135</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-136">136</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-137">137</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-138">138</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-139">139</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-140">140</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-141">141</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-142">142</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-143">143</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-144">144</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-145">145</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-146">146</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-147">147</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-148">148</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-149">149</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-150">150</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-151">151</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-152">152</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-153">153</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-154">154</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-155">155</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-156">156</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-157">157</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-158">158</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-159">159</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-160">160</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-161">161</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-162">162</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-163">163</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-164">164</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-165">165</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-166">166</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-167">167</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-168">168</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-169">169</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-170">170</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-171">171</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-172">172</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-173">173</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-174">174</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-175">175</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-176">176</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-177">177</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-178">178</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-179">179</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-180">180</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-181">181</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-182">182</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-183">183</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-184">184</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-185">185</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-186">186</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-187">187</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-188">188</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-189">189</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-190">190</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-191">191</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-192">192</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-193">193</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-194">194</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-195">195</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-196">196</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-197">197</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-198">198</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-199">199</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-200">200</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-201">201</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-202">202</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-203">203</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-204">204</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-205">205</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-206">206</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-207">207</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-208">208</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-209">209</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-210">210</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-211">211</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-212">212</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-213">213</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-214">214</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-215">215</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-216">216</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-217">217</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-218">218</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-219">219</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1426152241666-220">220</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1426152241666-221">221</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b1426152241666-1 class=crayon-line><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* High resolution timer interrupt</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-3 class=crayon-line><SPAN class=crayon-c>* Called with interrupts disabled</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-5 class=crayon-line><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_interrupt</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>clock_event_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-7 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer_cpu_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-e>__get_cpu_var</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>hrtimer_bases</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>ktime_t </SPAN><SPAN class=crayon-v>expires_next</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>now</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>entry_time</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>delta</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>retries</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-10 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-11 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>BUG_ON</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hres_active</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>nr_events</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#32479;&#35745;&#24635;&#30340;interrupt&#27425;&#25968;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-13 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_event</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>KTIME_MAX</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-14 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-15 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>raw_spin_lock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>entry_time</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>now</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_update_base</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#26356;&#26032;clock_base&#30340;&#26102;&#38388;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-17 class=crayon-line><SPAN class=crayon-v>retry</SPAN><SPAN class=crayon-o>:</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>expires_next</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>KTIME_MAX</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-19 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* We set expires_next to KTIME_MAX here with cpu_base-&gt;lock</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-21 class=crayon-line><SPAN class=crayon-c>* held to prevent that a timer is enqueued in our queue via</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* the migration code. This does not affect enqueueing of</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-23 class=crayon-line><SPAN class=crayon-c>* timers which run their callback and need to be requeued on</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* this CPU.</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-25 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>expires_next</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>KTIME_MAX</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-27 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-28 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>for</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_MAX_CLOCK_BASES</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-29 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer_clock_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>timerqueue_node</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>node</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-31 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>ktime_t </SPAN><SPAN class=crayon-v>basenow</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-32 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-33 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>active_bases</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-c>//clock&#19981;&#26159;&#28608;&#27963;&#29366;&#24577;&#65292;&#27604;&#22914;&#65292;clock base&#37324;&#38754;&#27809;&#26377;timer&#65292;&#20309;&#24517;&#35843;&#29992;&#19968;&#27425;?</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>continue</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-35 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-36 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>clock_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>+</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#27599;&#19968;&#20010;CLOCK BASE</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-37 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>basenow</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_add</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>now</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>offset</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#27599;&#19968;&#20010;CLOCK BASE&#30340;&#24403;&#21069;&#26102;&#38388;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-38 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-39 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#21462;&#27599;&#19968;&#20010;CLOCK BASE&#30340;active&#32418;&#40657;&#26641;&#20013;&#26368;&#39030;&#31471;hrtimer&#65292;&#26368;&#21487;&#33021;&#36229;&#26102;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>while</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>node</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>timerqueue_getnext</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>active</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-41 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-42 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-43 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>container_of</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>node</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>node</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-44 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-45 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-46 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* The immediate goal for using the softexpires is</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-47 class=crayon-line><SPAN class=crayon-c>* minimizing wakeups, not running timers at the</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* earliest interrupt after their soft expiration.</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-49 class=crayon-line><SPAN class=crayon-c>* This allows us to avoid using a Priority Search</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-50 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* Tree, which can answer a stabbing querry for</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-51 class=crayon-line><SPAN class=crayon-c>* overlapping intervals and instead use the simple</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* BST we already have.</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-53 class=crayon-line><SPAN class=crayon-c>* We don't add extra wakeups by delaying timers that</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-54 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* are right-of a not yet expired timer, because that</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-55 class=crayon-line><SPAN class=crayon-c>* timer will have to trigger a wakeup anyway.</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-56 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-57 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#36825;&#37324;&#27604;&#36739;&#30340;&#26159;soft expires&#65292;&#22914;&#26524;soft expires&#36229;&#36807;&#20102;&#24403;&#21069;CLOCK BASE&#30340;&#26102;&#38388;&#65292;&#34920;&#31034;&#36824;&#27809;&#21040;&#26399;&#65292;&#24403;&#21069;&#30340;CLOCK BASE&#21487;&#20197;&#20013;&#26029;&#26816;&#26597;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-58 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>basenow</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_get_softexpires_tv64</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-59 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>ktime_t </SPAN><SPAN class=crayon-v>expires</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-60 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-61 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>expires</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_sub</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>hrtimer_get_expires</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-62 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>offset</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#29992;&#26410;&#36229;&#26102;&#30340;timer&#30340;hard expires - base-&gt;offset&#65292;&#20854;&#23454;&#23601;&#26159;base &#19979;&#27425;&#35302;&#21457;&#30340;&#26102;&#38388;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-63 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>expires</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-64 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>expires</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>KTIME_MAX</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#28322;&#20986;&#20102;?&#36825;&#19981;&#31185;&#23398;&#65292;&#35774;&#32622;&#20026;&#26368;&#22823;&#20540;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-65 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>expires</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>expires_next</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-66 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>expires_next</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>expires</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//expires&#20854;&#23454;&#23601;&#26159;next expires</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-67 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>break</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-68 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-69 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-70 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>__run_hrtimer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>basenow</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#35843;&#29992;run timer</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-71 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-72 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-73 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-74 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-75 class=crayon-line><SPAN class=crayon-c>* Store the new expiry value so the migration code can verify</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-76 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* against it.</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-77 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-78 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>expires_next</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>expires_next</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-79 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>raw_spin_unlock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-80 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-81 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Reprogramming necessary ? */</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-82 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>expires_next</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>KTIME_MAX</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>||</SPAN><SPAN class=crayon-c>//&#19981;&#38656;&#35201;next expires &#25110;&#35774;&#32622;&#30828;&#20214;next&#27491;&#30830;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-83 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>tick_program_event</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>expires_next</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN><SPAN class=crayon-c>//&#35774;&#32622;&#23545;&#24212;&#30828;&#20214;&#30340;&#19979;&#19968;&#27425;&#36229;&#26102;&#65292;&#20026;&#34920;&#31034;&#27491;&#30830;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-84 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hang_detected</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-85 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-86 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-87 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-88 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp; </SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-89 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-90 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* The next timer was already expired due to:</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-91 class=crayon-line><SPAN class=crayon-c>* - tracing</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-92 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* - long lasting callbacks</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-93 class=crayon-line><SPAN class=crayon-c>* - being scheduled away when running in a VM</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-94 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-95 class=crayon-line><SPAN class=crayon-c>* We need to prevent that we loop forever in the hrtimer</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-96 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* interrupt routine. We give it 3 attempts to avoid</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-97 class=crayon-line><SPAN class=crayon-c>* overreacting on some spurious event.</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-98 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-99 class=crayon-line><SPAN class=crayon-c>* Acquire base lock for updating the offsets and retrieving</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-100 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* the current time.</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-101 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-102 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>raw_spin_lock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-103 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#24403;&#21069;&#26102;&#38388;&#24050;&#32463;&#36229;&#36807;next time,&#23581;&#35797;&#20462;&#22797;&#65292;&#25191;&#34892;&#27425;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-104 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>now</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_update_base</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-105 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>nr_retries</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-106 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-v>retries</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>3</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-107 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>goto</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>retry</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-108 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#36824;&#26159;&#19981;&#34892;?&#26631;&#24535;hang&#20102;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-109 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-110 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* Give the system a chance to do something else than looping</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-111 class=crayon-line><SPAN class=crayon-c>* here. We stored the entry time, so we know exactly how long</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-112 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* we spent here. We schedule the next event this amount of</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-113 class=crayon-line><SPAN class=crayon-c>* time away.</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-114 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-115 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>nr_hangs</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-116 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>hang_detected</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-117 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>raw_spin_unlock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-118 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>delta</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_sub</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>now</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>entry_time</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#20174;&#21018;&#36827;&#26469;&#21040;&#29616;&#22312;&#65292;&#32791;&#26102;&#22810;&#38271;?delta</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-119 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>delta</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&gt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>max_hang_time</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-120 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>max_hang_time</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>delta</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#20445;&#23384;&#26368;&#22823;&#30340;hang time&#23601;&#21487;&#20197;&#20102;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-121 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-122 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* Limit it to a sensible value as we enforce a longer</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-123 class=crayon-line><SPAN class=crayon-c>* delay. Give the CPU at least 100ms to catch up.</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-124 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-125 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>delta</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&gt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>100</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NSEC_PER_MSEC</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-126 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>expires_next</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_add_ns</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>now</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>100</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>NSEC_PER_MSEC</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-127 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>else</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-128 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>expires_next</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_add</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>now</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>delta</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-129 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>tick_program_event</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>expires_next</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#35774;&#32622;&#38271;&#19968;&#20123;&#30340;&#36229;&#26102;&#26368;&#22823;ms</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-130 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>printk_once</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>KERN</SPAN><SPAN class=crayon-sy>_</SPAN>WARNING<SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"hrtimer: interrupt took %llu nsn"</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-131 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>ktime_to_ns</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>delta</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-132 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-133 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-134 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>tick_program_event</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-&gt;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-135 class=crayon-line><SPAN class=crayon-c>/**</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-136 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* clockevents_program_event - Reprogram the clock event device.</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-137 class=crayon-line><SPAN class=crayon-c>* @dev: device to program</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-138 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* @expires: absolute expiry time (monotonic clock)</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-139 class=crayon-line><SPAN class=crayon-c>* @force: program minimum delay if expires can not be set</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-140 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-141 class=crayon-line><SPAN class=crayon-c>* Returns 0 on success, -ETIME when the event is in the past.</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-142 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-143 class=crayon-line><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>clockevents_program_event</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>clock_event_device</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_t </SPAN><SPAN class=crayon-v>expires</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-144 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-t>bool</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>force</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-145 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-146 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>clc</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-147 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>int64_t </SPAN><SPAN class=crayon-v>delta</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-148 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-149 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-150 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>expires</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-151 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>WARN_ON_ONCE</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-152 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-v>ETIME</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-153 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-154 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-155 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>next_event</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>expires</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-156 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-157 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-m>mode</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CLOCK_EVT_MODE_SHUTDOWN</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-158 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-159 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-160 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Shortcut for clockevent devices that can deal with ktime. */</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-161 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>features</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CLOCK_EVT_FEAT_KTIME</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-162 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-e>set_next_ktime</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>expires</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-163 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-164 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>delta</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_to_ns</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>ktime_sub</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>expires</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_get</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-165 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>delta</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-c>//&#29616;&#22312;&#30340;&#26102;&#38388;&#65292;&#24050;&#32463;&#36229;&#36807;&#20102;&#24819;&#35201;&#39044;&#35774;&#30340;&#36229;&#26102;&#65292;&#24590;&#20040;&#21150;?&#26681;&#25454;&#26159;&#21542;&#38656;&#35201;force&#20915;&#23450;&#26159;&#21542;&#35774;&#32622;&#20026;min delta</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-166 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-i>force</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>?</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>clockevents_program_min_delta</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-v>ETIME</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-167 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-168 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>delta</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>min</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>delta</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>int64_t</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>max_delta_ns</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-169 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>delta</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>max</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>delta</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>int64_t</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>min_delta_ns</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-170 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-171 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>clc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>delta</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>mult</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&gt;&gt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>shift</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-172 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-e>set_next_event</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>clc</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//&#27604;&#22914;hpet&#65292;&#20854;&#22238;&#35843;&#20026;hpet_next_event</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-173 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#36820;&#22238;&#38750;&#34920;&#31034;&#38169;&#35823;&#65292;&#22914;&#26524;&#38656;&#35201;force&#65292;&#37027;&#20040;&#24378;&#34892;&#35774;&#32622;&#20026;min delta</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-174 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>force</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>?</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>clockevents_program_min_delta</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>rc</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-175 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-176 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-177 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__run_hrtimer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ktime_t</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>now</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-178 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-179 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer_clock_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-180 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer_cpu_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-181 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>enum</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_restart</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>fn</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-182 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>restart</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-183 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-184 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>WARN_ON</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>irqs_disabled</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-185 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-186 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>debug_deactivate</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-187 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>__remove_hrtimer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_STATE_CALLBACK</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#20808;&#23558;timer&#20174;base&#20013;&#21024;&#38500;&#65292;&#24182;&#35774;&#32622;timer&#30340;&#29366;&#24577;&#20026;CALLBACK</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-188 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>timer_stats_account_hrtimer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-189 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-190 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>&#36825;&#37324;&#30340;function&#22238;&#35843;&#25351;&#38024;&#65292;&#23601;&#26159;&#25105;&#20204;&#35843;&#29992;hrtimer_init&#21518;&#35774;&#32622;&#30340;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-191 class=crayon-line><SPAN class=crayon-c>hrtimer_init(&amp;rtc-&gt;coalesced_timer, CLOCK_MONOTONIC, HRTIMER_MODE_ABS); </SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-192 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>rtc-&gt;coalesced_timer.function = coalesced_timer_fn; </SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-193 class=crayon-line><SPAN class=crayon-c>&#21487;&#20197;&#30475;&#20986;&#65292;&#25105;&#20204;&#35774;&#32622;&#30340;hrtimer&#22238;&#35843;&#26159;&#22312;hardirq context&#20013;&#25191;&#34892;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-194 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-195 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>fn</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-t>function</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-196 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-197 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-198 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* Because we run timers from hardirq context, there is no chance</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-199 class=crayon-line><SPAN class=crayon-c>* they get migrated to another cpu, therefore its safe to unlock</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-200 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* the timer base.</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-201 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-202 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>raw_spin_unlock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#36825;&#21477;&#35805;&#28857;&#21517;&#20102;&#65292;timer&#30340;&#22238;&#35843;&#20989;&#25968;&#26159;&#22312;hardirq context</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-203 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>trace_hrtimer_expire_entry</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>now</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-204 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>restart</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>fn</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#35843;&#29992;&#25105;&#20204;&#30340;&#22238;&#35843;&#20989;&#25968;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-205 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>trace_hrtimer_expire_exit</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-206 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>raw_spin_lock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-207 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-208 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-209 class=crayon-line><SPAN class=crayon-c>* Note: We clear the CALLBACK bit after enqueue_hrtimer and</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-210 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* we do not reprogramm the event hardware. Happens either in</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-211 class=crayon-line><SPAN class=crayon-c>* hrtimer_start_range_ns() or in hrtimer_interrupt()</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-212 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-213 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>restart</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_NORESTART</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-214 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>BUG_ON</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_STATE_CALLBACK</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-215 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>enqueue_hrtimer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-216 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-217 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-218 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>WARN_ON_ONCE</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_STATE_CALLBACK</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-219 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1426152241666-220 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>~</SPAN><SPAN class=crayon-v>HRTIMER_STATE_CALLBACK</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1426152241666-221 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H2>HRTIMER&#20989;&#25968;&#35814;&#35299;</H2>
<H3>&#21021;&#22987;&#21270;</H3>
<P></P>
<DIV id=crayon-569898d2b1439326894111 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b1439326894111-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1439326894111-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1439326894111-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1439326894111-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1439326894111-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1439326894111-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1439326894111-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1439326894111-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1439326894111-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1439326894111-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1439326894111-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1439326894111-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1439326894111-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1439326894111-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1439326894111-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1439326894111-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1439326894111-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1439326894111-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1439326894111-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1439326894111-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1439326894111-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1439326894111-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1439326894111-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1439326894111-24">24</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b1439326894111-1 class=crayon-line><SPAN class=crayon-c>//hrtimer_init&#38750;&#24120;&#31616;&#21333;&#65292;&#23601;&#26159;&#23558;hrtimer*&#21152;&#20837;&#23545;&#24212;&#30340;RB TREE</SPAN></DIV>
<DIV id=crayon-569898d2b1439326894111-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__hrtimer_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>clockid_t </SPAN><SPAN class=crayon-v>clock_id</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b1439326894111-3 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp; </SPAN><SPAN class=crayon-t>enum</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_mode </SPAN><SPAN class=crayon-m>mode</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1439326894111-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1439326894111-5 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer_cpu_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1439326894111-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1439326894111-7 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1439326894111-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>memset</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-r>sizeof</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1439326894111-9 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1439326894111-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-e>__raw_get_cpu_var</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>hrtimer_bases</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1439326894111-11 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1439326894111-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>clock_id</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CLOCK_REALTIME</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-m>mode</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_MODE_ABS</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1439326894111-13 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>clock_id</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>CLOCK_MONOTONIC</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1439326894111-14 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1439326894111-15 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_clockid_to_base</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>clock_id</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1439326894111-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>clock_base</SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1439326894111-17 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>timerqueue_init</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>node</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1439326894111-18 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1439326894111-19 class=crayon-line><SPAN class=crayon-p>#ifdef CONFIG_TIMER_STATS</SPAN></DIV>
<DIV id=crayon-569898d2b1439326894111-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>start_site</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>NULL</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1439326894111-21 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>start_pid</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1439326894111-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>memset</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>start_comm</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>TASK_COMM_LEN</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1439326894111-23 class=crayon-line><SPAN class=crayon-p>#endif</SPAN></DIV>
<DIV id=crayon-569898d2b1439326894111-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H3>&#35774;&#32622;&#36229;&#26102;</H3>
<P></P>
<DIV id=crayon-569898d2b1441913007787 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1441913007787-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1441913007787-55">55</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b1441913007787-1 class=crayon-line><SPAN class=crayon-c>/**</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* hrtimer_forward - forward the timer expiry</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-3 class=crayon-line><SPAN class=crayon-c>* @timer: hrtimer to forward</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* @now: forward past this time</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-5 class=crayon-line><SPAN class=crayon-c>* @interval: the interval to forward</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-7 class=crayon-line><SPAN class=crayon-c>* Forward the timer expiry so it will expire in the future.</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* Returns the number of overruns.</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-9 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-e>u64 </SPAN><SPAN class=crayon-e>hrtimer_forward</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_t </SPAN><SPAN class=crayon-v>now</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_t </SPAN><SPAN class=crayon-v>interval</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-11 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>u64 </SPAN><SPAN class=crayon-v>orun</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-13 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>ktime_t </SPAN><SPAN class=crayon-v>delta</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-14 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1441913007787-15 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>delta</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_sub</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>now</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_get_expires</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-16 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1441913007787-17 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>delta</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-c>//&#22914;&#26524;timer&#21407;&#26412;&#30340;&#36229;&#26102;&#26102;&#38388;&#36824;&#22312;&#24819;&#35201;&#23450;&#20301;&#30340;now&#20043;&#21518;&#65292;&#23601;&#19981;&#20462;&#25913;&#65292;&#22240;&#20026;&#36825;&#20010;&#20989;&#25968;&#30340;&#30446;&#30340;&#26159;&#23558;&#36229;&#26102;&#26102;&#38388;&#35774;&#32622;&#22312;now&#21518;</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-19 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1441913007787-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>interval</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>resolution</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-c>//&#22914;&#26524;interval&#36807;&#23567;&#65292;&#23567;&#20110;clock base&#25152;&#33021;&#36798;&#21040;&#30340;&#31934;&#24230;&#65292;&#24403;&#28982;&#20351;&#29992;clock base&#30340;&#26368;&#23567;&#31934;&#24230;&#20102;</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-21 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>interval</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>resolution</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-22 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1441913007787-23 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#27442;&#20462;&#25913;&#30340;&#26102;&#38388;&#22522;&#20934;&#19982;&#21407;&#26377;&#36229;&#26102;&#26102;&#38388;&#24046;&#65292;&#22823;&#20110;interval</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#36825;&#20010;&#35805;&#20351;&#29992;&#30340;&#26159;unlikely&#65292;&#34920;&#31034;&#65292;&#36825;&#31181;&#24773;&#20917;&#36824;&#26159;&#19981;&#22810;&#30340;</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-25 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#20363;&#22914;&#65292;&#20320;&#22312;&#19968;&#20010;&#21608;&#26399;&#22238;&#35843;&#37324;&#38754;&#65292;&#20877;&#27425;add&#65292;&#20854;interval&#32943;&#23450;&#35201;&#22823;</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>unlikely</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>delta</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&gt;=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>interval</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-27 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>s64 </SPAN><SPAN class=crayon-v>incr</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_to_ns</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>interval</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-28 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1441913007787-29 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>orun</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_divns</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>delta</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>incr</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#30456;&#24046;&#26377;&#22810;&#23569;&#20010;interval</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>hrtimer_add_expires_ns</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>incr</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>orun</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-31 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-e>hrtimer_get_expires_tv64</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&gt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>now</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>tv64</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-c>//&#36825;&#20010;&#20989;&#25968;&#65292;&#19981;&#26159;&#31616;&#21333;&#30340;add interval&#65292;&#32780;&#26159;&#35302;&#21457;&#26102;&#38388;&#33021;&#22815;&gt;now&#23601;&#21487;&#20197;&#20102;&#65292;&#24819;&#24819;&#21608;&#26399;&#26102;&#38047;&#30340;&#29992;&#27861;&#65292;&#30830;&#23454;&#24212;&#35813;&#26159;&#36825;&#26679;</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>orun</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-33 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* This (and the ktime_add() below) is the</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-35 class=crayon-line><SPAN class=crayon-c>* correction for exact:</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-36 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-37 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>orun</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-39 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>hrtimer_add_expires</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>interval</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#22312;&#19978;&#27425;&#36229;&#26102;&#30340;&#22522;&#30784;&#19978;&#21152;&#19978;interval</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-40 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1441913007787-41 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>orun</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-43 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b1441913007787-44 class="crayon-line crayon-striped-line"><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-m>inline</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_add_expires</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_t </SPAN><SPAN class=crayon-v>time</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-45 class=crayon-line><SPAN class=crayon-sy>{</SPAN><SPAN class=crayon-c>//&#12298;Linux &#26102;&#38047;&#31649;&#29702;&#12299;&#35828;&#65292;&#23558;&#21407;&#26469;&#24517;&#39035;&#22312;hard expire &#36229;&#26102;&#25165;&#33021;&#25191;&#34892;&#30340;&#19968;&#20010;&#28857;&#21464;&#25104;&#19968;&#20010;&#33539;&#22260;&#21518;&#65292;&#21487;&#20197;&#23613;&#37327;&#25226;hrtimer </SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-46 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#20013;&#26029;&#25918;&#22312;&#19968;&#36215;&#22788;&#29702;&#65292;&#36825;&#26679;CPU &#34987;&#37325;&#22797;&#21796;&#37266;&#30340;&#20960;&#29575;&#20250;&#21464;&#23567;&#65292;&#20174;&#32780;&#36798;&#21040;&#33410;&#33021;&#30340;&#25928;&#26524;&#65292;&#21516;&#26102;&#36825;&#20010;hrtimer &#20063;&#21487;&#20197;&#20445;&#35777;&#20854;&#25191;&#34892;&#31934;&#24230;&#12290;</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-47 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>node</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>expires</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_add_safe</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>node</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>expires</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>time</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>_softexpires</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_add_safe</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>_softexpires</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>time</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-49 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-50 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b1441913007787-51 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-m>inline</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>void</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_add_expires_ns</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>u64 </SPAN><SPAN class=crayon-v>ns</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-53 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>node</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>expires</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_add_ns</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>node</SPAN><SPAN class=crayon-sy>.</SPAN><SPAN class=crayon-v>expires</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ns</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-54 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>_softexpires</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_add_ns</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>_softexpires</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ns</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1441913007787-55 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H3>&#21551;&#21160;</H3>
<P></P>
<DIV id=crayon-569898d2b144b203335483 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-57">57</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-58">58</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-59">59</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-60">60</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-61">61</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-62">62</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-63">63</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-64">64</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-65">65</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-66">66</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-67">67</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-68">68</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-69">69</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-70">70</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-71">71</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b144b203335483-72">72</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b144b203335483-73">73</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b144b203335483-1 class=crayon-line><SPAN class=crayon-t>int</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-e>hrtimer_start</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_t </SPAN><SPAN class=crayon-v>tim</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-r>const</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>enum</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_mode </SPAN><SPAN class=crayon-m>mode</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-3 class=crayon-line><SPAN class=crayon-sy>{</SPAN><SPAN class=crayon-c>//&#36825;&#37324;&#30340;mode &#21644;tim&#26377;&#20851;&#65292;mode&#20026;HRTIMER_REL&#30340;&#26102;&#20505;&#65292;&#34920;&#31034;tim&#20026;&#30456;&#23545;&#20110;now&#30340;&#26102;&#38388;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>//&#39038;&#26126;&#24605;&#24847;&#65292;&#22914;&#26524;mode&#20026;HRTIMER_ABS&#65292;&#36825;tim&#20026;&#32477;&#23545;&#26102;&#38388;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-5 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__hrtimer_start_range_ns</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tim</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-m>mode</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-7 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b144b203335483-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>__hrtimer_start_range_ns</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_t </SPAN><SPAN class=crayon-v>tim</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-9 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>delta_ns</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-r>const</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>enum</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_mode </SPAN><SPAN class=crayon-m>mode</SPAN><SPAN class=crayon-sy>,</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>wakeup</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-11 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer_clock_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>new_base</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-13 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>leftmost</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-15 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b144b203335483-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>lock_hrtimer_base</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-17 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b144b203335483-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Remove an active timer from the queue: */</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-19 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>remove_hrtimer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-20 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b144b203335483-21 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/* Switch the timer base, if necessary: */</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#21551;&#21160;&#30340;&#26102;&#20505;&#65292;&#20250;&#26816;&#26597;&#26159;&#21542;&#38656;&#35201;switch clock base&#21040;&#24403;&#21069;CPU&#30340;clock base</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-23 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>new_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>switch_hrtimer_base</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-m>mode</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_MODE_PINNED</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-24 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b144b203335483-25 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-m>mode</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_MODE_REL</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tim</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_add_safe</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tim</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>new_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-e>get_time</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-27 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-28 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* CONFIG_TIME_LOW_RES is a temporary way for architectures</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-29 class=crayon-line><SPAN class=crayon-c>* to signal that they simply return xtime in</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* do_gettimeoffset(). In this case we want to round up by</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-31 class=crayon-line><SPAN class=crayon-c>* resolution when starting a relative timer, to avoid short</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* timeouts. This will go away with the GTOD framework.</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-33 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-p>#ifdef CONFIG_TIME_LOW_RES</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-35 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>tim</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>ktime_add_safe</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>tim</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>resolution</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-36 class="crayon-line crayon-striped-line"><SPAN class=crayon-p>#endif</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-37 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-38 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b144b203335483-39 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>hrtimer_set_expires_range_ns</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>tim</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>delta_ns</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-40 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b144b203335483-41 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>timer_stats_hrtimer_set_start_info</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>//&#21152;&#20837;&#32418;&#40657;&#26641;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-43 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>leftmost</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>enqueue_hrtimer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>new_base</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-44 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b144b203335483-45 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-46 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* Only allow reprogramming if the new base is on this CPU.</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-47 class=crayon-line><SPAN class=crayon-c>* (it might still be on another CPU if the timer was pending)</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-49 class=crayon-line><SPAN class=crayon-c>* XXX send_remote_softirq() ?</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-50 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-51 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#21152;&#20837;&#20043;&#21518;&#65292;&#22914;&#26524;&#21457;&#19979;&#33258;&#24049;&#36825;&#20010;hrtimer&#26368;&#26089;&#36229;&#26102;, leftmost&#20026;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#22914;&#26524;&#26159;&#26412;CPU&#19978;&#30340;CLOCK BASE&#65292;&#37027;&#20040;&#65292;&#37325;&#26032;&#35774;&#32622;&#36229;&#26102;&#65292;&#22240;&#20026;&#20043;&#21069;&#35774;&#32622;&#30340;&#36229;&#26102;&#27604;&#36739;&#38752;&#21518;&#20102;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-53 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>leftmost</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>new_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-e>__get_cpu_var</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>hrtimer_bases</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-54 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-o>&amp;&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_enqueue_reprogram</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>new_base</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-55 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>//&#22914;&#26524;&#21152;&#20837;&#22833;&#36133;&#65292;&#28608;&#27963;HRTIMER_SOFTIRQ&#65292;&#20351;&#24471;&#33021;&#22815;&#22312;&#36719;&#20013;&#26029;&#20013;&#26816;&#26597;timer&#26159;&#21542;&#36229;&#26102;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-56 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>wakeup</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-57 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-c>/*</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-58 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* We need to drop cpu_base-&gt;lock to avoid a</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-59 class=crayon-line><SPAN class=crayon-c>* lock ordering issue vs. rq-&gt;lock.</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-60 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-61 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>raw_spin_unlock</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>new_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>cpu_base</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>lock</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-62 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>raise_softirq_irqoff</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>HRTIMER_SOFTIRQ</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-63 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>local_irq_restore</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-64 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-65 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>else</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-66 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>__raise_softirq_irqoff</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>HRTIMER_SOFTIRQ</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-67 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-68 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-69 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b144b203335483-70 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>unlock_hrtimer_base</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-71 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b144b203335483-72 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b144b203335483-73 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H3>&#21024;&#38500;</H3>
<P></P>
<DIV id=crayon-569898d2b146b690387796 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b146b690387796-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b146b690387796-48">48</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b146b690387796-1 class=crayon-line><SPAN class=crayon-m>static</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-m>inline</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_callback_running</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-3 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_STATE_CALLBACK</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-5 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b146b690387796-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>/**</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-7 class=crayon-line><SPAN class=crayon-c>* hrtimer_try_to_cancel - try to deactivate a timer</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* @timer: hrtimer to stop</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-9 class=crayon-line><SPAN class=crayon-c>*</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* Returns:</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-11 class=crayon-line><SPAN class=crayon-c>*&nbsp;&nbsp;0 when the timer was not active</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*&nbsp;&nbsp;1 when the timer was active</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-13 class=crayon-line><SPAN class=crayon-c>* -1 when the timer is currently excuting the callback function and</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*&nbsp;&nbsp;&nbsp;&nbsp;cannot be stopped</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-15 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_try_to_cancel</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-17 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer_clock_base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-19 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>unsigned</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-t>long</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-21 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b146b690387796-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>lock_hrtimer_base</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-23 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b146b690387796-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-e>hrtimer_callback_running</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-c>//&#22914;&#26524;&#22788;&#20110;&#22238;&#35843;&#20989;&#25968;&#25191;&#34892;&#29366;&#24577;&#65292;&#19981;CANCEL</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-25 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>remove_hrtimer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-26 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b146b690387796-27 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>unlock_hrtimer_base</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-v>flags</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-28 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898d2b146b690387796-29 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-31 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898d2b146b690387796-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>/**</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-33 class=crayon-line><SPAN class=crayon-c>* hrtimer_cancel - cancel a timer and wait for the handler to finish.</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* @timer: the timer to be cancelled</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-35 class=crayon-line><SPAN class=crayon-c>*</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-36 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>* Returns:</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-37 class=crayon-line><SPAN class=crayon-c>*&nbsp;&nbsp;0 when the timer was not active</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>*&nbsp;&nbsp;1 when the timer was active</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-39 class=crayon-line><SPAN class=crayon-c>*/</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_cancel</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-t>struct</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>hrtimer</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>*</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-41 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>for</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-43 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-t>int</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>hrtimer_try_to_cancel</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#19981;&#20572;&#23581;&#35797;cancel&#65292;&#30452;&#21040;&#25104;&#21151;</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-44 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&gt;=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-45 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>ret</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-46 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>cpu_relax</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-47 class=crayon-line><SPAN class=crayon-h></SPAN><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b146b690387796-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H3>&#29366;&#24577;&#36716;&#25442;</H3>
<P>state&#20026;hrtimer&#30340;&#22235;&#20010;&#29366;&#24577;&#65306;</P>
<DIV id=crayon-569898d2b1475150310558 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b1475150310558-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1475150310558-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1475150310558-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1475150310558-4">4</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b1475150310558-1 class=crayon-line><SPAN class=crayon-p>#define HRTIMER_STATE_INACTIVE 0x00 </SPAN></DIV>
<DIV id=crayon-569898d2b1475150310558-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-p>#define HRTIMER_STATE_ENQUEUED 0x01 </SPAN></DIV>
<DIV id=crayon-569898d2b1475150310558-3 class=crayon-line><SPAN class=crayon-p>#define HRTIMER_STATE_CALLBACK 0x02</SPAN></DIV>
<DIV id=crayon-569898d2b1475150310558-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-p>#define HRTIMER_STATE_MIGRATE 0x04</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<P>&#21487;&#20197;&#24819;&#35937;&#65292;HRTIMER_STATE_INACTIVE&#36825;&#20010;&#26159;&#21021;&#22987;&#20540;&#65292;&#35843;&#29992;hrtimer_init&#21518;&#65292;&#36825;&#20010;&#21464;&#37327;&#35774;&#32622;&#20026;HRTIMER_STATE_INACTIVE</P>
<P>&#35843;&#29992;enqueue_hrtimer&#23558;hrtimer*&#21152;&#20837;&#21040;RB TREE&#21518;&#65292;&#29366;&#24577;&#20250; OR &#19978; HRTIMER_STATE_ENQUEUED<BR>&#20160;&#20040;&#26102;&#20505;&#28165;&#26970;&#65292;&#24403;&#35843;&#29992;__remove_hrtimer&#30340;&#20174;RB TREE&#37324;&#21024;&#38500;&#21518;&#65292;&#20250;&#8220;&#35774;&#32622;&#8221;&#20026;&#26032;&#29366;&#24577;&#65292;&#27492;&#26032;&#29366;&#24577;&#20013;&#19968;&#23450;&#19981;&#21253;&#21547;HRTIMER_STATE_ENQUEUED</P>
<OL class=decimal>
<LI>&#22312;remove_hrtimer&#35843;&#29992;&#30340;&#26102;&#20505;&#65292;&#21482;&#20445;&#30041;&#20102;CALLBACK&#29366;&#24577; 
<DIV id=crayon-569898d2b147c263735193 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b147c263735193-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b147c263735193-2">2</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b147c263735193-1 class=crayon-line><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_STATE_CALLBACK</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN></DIV>
<DIV id=crayon-569898d2b147c263735193-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-e>__remove_hrtimer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>reprogram</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV></LI>
<LI>&#22312;__run_hrtimer&#30340;&#26102;&#20505;&#65292;&#20250;&#20808;&#20174;RB TREE&#37324;&#23558;hrtimer*&#21024;&#38500;&#65292;&#35774;&#32622;&#29366;&#24577;&#20026;CALLBACK&#65292;&#28982;&#21518;&#35843;&#29992;&#22238;&#35843;&#20989;&#25968;<BR>&#20808;&#23558;timer&#20174;base&#20013;&#21024;&#38500;&#65292;&#24182;&#35774;&#32622;timer&#30340;&#29366;&#24577;&#20026;CALLBACK 
<DIV id=crayon-569898d2b1482281780033 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b1482281780033-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1482281780033-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1482281780033-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1482281780033-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1482281780033-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1482281780033-6">6</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b1482281780033-1 class=crayon-line><SPAN class=crayon-e>__remove_hrtimer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_STATE_CALLBACK</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1482281780033-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>restart</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>fn</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1482281780033-3 class=crayon-line><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>restart</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_NORESTART</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898d2b1482281780033-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h></SPAN><SPAN class=crayon-e>enqueue_hrtimer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1482281780033-5 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898d2b1482281780033-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>~</SPAN><SPAN class=crayon-v>HRTIMER_STATE_CALLBACK</SPAN><SPAN class=crayon-sy>;</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV><BR>&#35843;&#29992;&#23436;fn&#21518;&#65292;&#21448;&#23558;CALLBACK&#29366;&#24577;&#21435;&#38500; </LI>
<LI>&#22312;&#23558;&#20854;&#20182;DEAD&#30340;CPU&#19978;&#30340;hrtimer&#23545;&#35937;&#36801;&#31227;&#21040;&#26412;CPU&#30340;&#26102;&#20505;&#65292;migrate_hrtimer_list 
<DIV id=crayon-569898d2b1489260340975 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898d2b1489260340975-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1489260340975-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898d2b1489260340975-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898d2b1489260340975-4">4</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898d2b1489260340975-1 class=crayon-line><SPAN class=crayon-e>__remove_hrtimer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>old_base</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>HRTIMER_STATE_MIGRATE</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898d2b1489260340975-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>base</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>new_base</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//&#26367;&#25442;base&#20026;&#24403;&#21069;CPU&#30340;base</SPAN></DIV>
<DIV id=crayon-569898d2b1489260340975-3 class=crayon-line><SPAN class=crayon-e>enqueue_hrtimer</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>new_base</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-c>//&#21152;&#20837;&#24403;&#21069;CPU&#30340;base</SPAN></DIV>
<DIV id=crayon-569898d2b1489260340975-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>timer</SPAN><SPAN class=crayon-o>-&gt;</SPAN><SPAN class=crayon-v>state</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&amp;=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>~</SPAN><SPAN class=crayon-v>HRTIMER_STATE_MIGRATE</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>//&#28165;&#38500;HRTIMER_STATE_MIGRATE&#29366;&#24577;</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV></LI></OL>
<H2>&#21442;&#32771;&#36164;&#26009;</H2>
<OL class=decimal>
<LI>&#27973;&#26512; Linux &#20013;&#30340;&#26102;&#38388;&#32534;&#31243;&#21644;&#23454;&#29616;&#21407;&#29702;<BR><A href="http://www.uml.org.cn/embeded/201308211.asp" target=_blank>http://www.uml.org.cn/embeded/201308211.asp</A></LI>
<LI>Linux &#26102;&#38047;&#31649;&#29702;<BR><A href="http://www.ibm.com/developerworks/cn/linux/l-cn-timerm/index.html" target=_blank>http://www.ibm.com/developerworks/cn/linux/l-cn-timerm/index.html</A></LI></OL>
<P><A href="http://mnstory.net/wp-content/uploads/2014/03/hrtimer-source-analysis/hrtimer-source-analysis.pdf" target=_bank>PDF&#19979;&#36733;</A></P></DIV>