<HEADER class=entry-header>&nbsp;
<H1 class=entry-title>Netmap&#24615;&#33021;&#39564;&#35777;</H1>
<DIV class=entry-meta><SPAN class=sep>&#21457;&#34920;&#20110; </SPAN><A title="&#19979;&#21320; 5:46" href="http://mnstory.net/2014/11/netmap-performance/" rel=bookmark><TIME class=entry-date datetime="2014-11-09T17:46:58+00:00">2014 &#24180; 11 &#26376; 9 &#26085;</TIME></A> </DIV></HEADER>
<DIV class=entry-content>
<P>&#26412;&#39564;&#35777;&#22522;&#20110;LINUX&#24179;&#21488;&#65292;E1000E&#32593;&#21345;&#12290;<BR>&#30446;&#26631;&#35774;&#22791;&#65306;&#26377;&#19977;&#20010;&#32593;&#21475;&#65292;eth0,eth1&#30342;&#20026;Intel 82574L&#32593;&#21345;&#65292;&#29992;&#20110;&#25968;&#25454;&#36716;&#21457;&#65292;eth2&#20026;&#31649;&#29702;&#21475;&#65292;&#26041;&#20415;eth0,eth1&#36716;&#21457;&#25968;&#25454;&#26102;&#36824;&#33021;&#36828;&#31243;&#36830;&#25509;&#12290;<BR>&#20351;&#29992;smartflow&#26469;&#27979;&#35797;&#27969;&#37327;&#65292;&#25299;&#25169;&#22270;&#20026;&#65306;<BR><A title="topological picture" class=fancybox href="http://mnstory.net/wp-content/uploads/2014/11/netmap-performance/topological.png" rel=fancybox><IMG class=size-full src="http://mnstory.net/wp-content/uploads/2014/11/netmap-performance/topological.png"></A><BR><SPAN id=more-334></SPAN></P>
<H2>&#32534;&#35793;</H2>
<P>&#20808;&#36827;&#20837;LINUX&#30446;&#24405;</P>
<P></P>
<DIV id=crayon-569898afcb19c363581497 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898afcb19c363581497-1">1</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898afcb19c363581497-1 class=crayon-line><SPAN class=crayon-c># cd netmap-src-dir/LINUX</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P>&#25105;&#20204;&#27979;&#35797;e1000e&#39537;&#21160;&#65292;&#26681;&#25454;&#29256;&#26412;&#21495;&#30340;&#21629;&#21517;&#35268;&#21017;&#65292;COPY&#23545;&#24212;&#30340;e1000e&#39537;&#21160;patch&#21040;patches&#30446;&#24405;<BR>&#20363;&#22914;&#65292;&#25105;&#30340;KERNEL&#29256;&#26412;&#20026; 3.10.0</P>
<DIV id=crayon-569898afcb1ac384076813 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898afcb1ac384076813-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1ac384076813-2">2</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898afcb1ac384076813-1 class=crayon-line><SPAN class=crayon-c># uname -a</SPAN></DIV>
<DIV id=crayon-569898afcb1ac384076813-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-e>Linux </SPAN><SPAN class=crayon-v>host</SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-cn>001e67a1aaf9</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>3.10.0</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-c>#128 SMP x86_64 GNU/Linux</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P>&#37027;&#20040;&#65292;3.10.0&#32763;&#35793;&#36807;&#26469;&#23601;&#26159;31000&#65292;&#26597;&#30475;final-patches&#19979;&#38754;&#30340;&#25991;&#20214;&#65292;&#21487;&#20197;&#25512;&#20986;&#23545;&#24212;patch&#25991;&#20214;&#29256;&#26412;&#21495;&#33539;&#22260;&#20026;30900--99999</P>
<DIV id=crayon-569898afcb1b3016376428 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898afcb1b3016376428-1">1</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898afcb1b3016376428-1 class=crayon-line><SPAN class=crayon-c># mkdir patches</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P>&#23558;&#23545;&#24212;e1000e&#32593;&#21345;&#30340;patch&#25335;&#36125;&#21040;patches&#30446;&#24405;</P>
<DIV id=crayon-569898afcb1ba779057863 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898afcb1ba779057863-1">1</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898afcb1ba779057863-1 class=crayon-line><SPAN class=crayon-c># cp final-patches/diff--e1000e--30900--99999 patches/</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P>&#32534;&#35793;&#30340;&#26102;&#20505;&#65292;&#38656;&#35201;&#25351;&#23450;&#30446;&#26631;&#26426;&#22120;&#30340;&#28304;&#30721;&#30446;&#24405;KSRC</P>
<DIV id=crayon-569898afcb1c0551162351 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898afcb1c0551162351-1">1</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898afcb1c0551162351-1 class=crayon-line><SPAN class=crayon-c># make clean; make KSRC=/src/VMP4.0/src/linux</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P>&#29983;&#25104;netmap_lin.ko &#21644; e1000e/e1000e.ko&#65292;&#25335;&#36125;&#21040;&#30446;&#26631;&#26426;&#22120;&#12290;<BR>&#32534;&#35793;pkt-gen&#31561;examples</P>
<DIV id=crayon-569898afcb1c5696254134 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898afcb1c5696254134-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1c5696254134-2">2</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898afcb1c5696254134-1 class=crayon-line><SPAN class=crayon-c># cd ../examples</SPAN></DIV>
<DIV id=crayon-569898afcb1c5696254134-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-c># make </SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P>&#29983;&#25104;&#30340;&#25991;&#20214;&#65292;COPY&#21040;&#30446;&#26631;&#26426;&#12290;</P>
<H2>&#36816;&#34892;&#27979;&#35797;</H2>
<P>&#36816;&#34892;&#30340;&#26102;&#20505;&#65292;&#21457;&#29616;&#19968;&#20010;&#38382;&#39064;&#65292;&#21551;&#21160;ptk-gen&#21518;&#20869;&#26680;&#20250;&#20986;CORE&#65292;demsg&#25171;&#21360;<BR>&#38169;&#35823;&#20449;&#24687;&#20026;&#65306; </P>
<DIV class=monospaced>[ 3.561456] {1}[Hardware Error]: Hardware error from APEI Generic Hardware Error Source: 1<BR>[ 3.562540] {1}[Hardware Error]: APEI generic hardware error status<BR>[ 3.563146] {1}[Hardware Error]: severity: 1, fatal<BR>[ 3.563734] {1}[Hardware Error]: section: 0, severity: 1, fatal<BR>[ 3.564326] {1}[Hardware Error]: flags: 0x01<BR>[ 3.564911] {1}[Hardware Error]: primary<BR>[ 3.565516] {1}[Hardware Error]: section_type: PCIe error<BR>[ 3.566105] {1}[Hardware Error]: port_type: 0, PCIe end point<BR>[ 3.566700] {1}[Hardware Error]: version: 1.16<BR>[ 3.567289] {1}[Hardware Error]: command: 0x4010, status: 0x0547<BR>[ 3.567878] {1}[Hardware Error]: device_id: 0000:00:00.0<BR>[ 3.568464] {1}[Hardware Error]: slot: 0<BR>[ 3.569046] {1}[Hardware Error]: secondary_bus: 0x00<BR>[ 3.569652] {1}[Hardware Error]: vendor_id: 0x8086, device_id: 0x10d3<BR>[ 3.570246] {1}[Hardware Error]: class_code: 000002<BR>[ 3.570856] Kernel panic - not syncing: Fatal hardware error!</DIV>
<P>&#20854;&#20013;vendor_id: 0x8086, device_id: 0x10d3&#20026;&#21457;&#29983;&#38169;&#35823;&#30340;&#35774;&#22791;&#21378;&#21830;&#21644;&#35774;&#22791;&#65292;&#36890;&#36807;lspci&#26597;&#25214;device_id</P>
<DIV id=crayon-569898afcb1d0650728559 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898afcb1d0650728559-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1d0650728559-2">2</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898afcb1d0650728559-1 class=crayon-line><SPAN class=crayon-c># lspci -nn -vv&nbsp;&nbsp;| grep 10d3</SPAN></DIV>
<DIV id=crayon-569898afcb1d0650728559-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-cn>03</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-cn>00.0</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>Ethernet </SPAN><SPAN class=crayon-i>controller</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-cn>0200</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>Intel </SPAN><SPAN class=crayon-i>Corporation</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>82574L</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>Gigabit </SPAN><SPAN class=crayon-e>Network </SPAN><SPAN class=crayon-i>Connection</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-cn>8086</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-cn>10d3</SPAN><SPAN class=crayon-sy>]</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P>&#21457;&#29616;&#26159;&#23601;&#26159;&#21457;&#21253;&#32593;&#21345;&#65292;&#21518;&#32493;&#21448;&#21457;&#29616;dmesg&#65306; </P>
<DIV class=monospaced>e1000e 0000:00:19.0 eth0: registered PHC clock<BR>e1000e 0000:00:19.0 eth0: (PCI Express:2.5GT/s:Width x1) 00:1e:67:a1:aa:f9<BR>e1000e 0000:00:19.0 eth0: Intel(R) PRO/1000 Network Connection<BR>e1000e 0000:00:19.0 eth0: MAC: 10, PHY: 11, PBA No: 0100FF-0FF<BR>ACPI Warning: SystemIO range 0x0000000000005000-0x000000000000501f conflicts with OpRegion 0x0000000000005000-0x000000000000500f (\_SB_.PCI0.SBUS.SMBI) (20130517/utaddress-254)<BR>ACPI: If an ACPI driver is available for this device, you should use it instead of the native driver<BR>ahci 0000:00:1f.2: version 3.0<BR>e1000e 0000:03:00.0: Interrupt Throttling Rate (ints/sec) set to dynamic conservative mode<BR>e1000e 0000:03:00.0: irq 46 for MSI/MSI-X
<P></P>
<P>DMAR:[fault reason 05] PTE Write access is not set<BR>dmar: DRHD: handling fault status reg 2<BR>dmar: DMAR:[DMA Write] Request device [03:00.0] fault addr 7285ac000<BR>DMAR:[fault reason 05] PTE Write access is not set<BR>irq 48: nobody cared (try booting with the "irqpoll" option)<BR>CPU: 0 PID: 0 Comm: swapper/0 Tainted: G O-------------- 3.10.0 #128<BR>Hardware name: Intel Corporation S1200BTL/S1200BTL, BIOS S1200BT.86B.02.00.0035.030220120927 03/02/2012<BR>ffff8807053f5e84 ffff88081e803e28 ffffffff81653b0a ffff88081e803e58<BR>ffffffff810dba9d 0000000000013080 ffff8807053f5e00 0000000000000030<BR>0000000000000000 ffff88081e803ea8 ffffffff810dbf41 00000030669e0b7c<BR>Call Trace:<BR><IRQ>[<FFFFFFFF81653B0A>] dump_stack+0x19/0x1b<BR>[<FFFFFFFF810DBA9D>] __report_bad_irq+0x3d/0xe0<BR>[<FFFFFFFF810DBF41>] note_interrupt+0x1b1/0x200<BR>[<FFFFFFFF814FB70B>] ? cpuidle_enter_state+0x5b/0xe0<BR>[<FFFFFFFF810D96F2>] handle_irq_event_percpu+0xa2/0x1e0<BR>[<FFFFFFFF810D9872>] handle_irq_event+0x42/0x70<BR>[<FFFFFFFF810DC0FF>] handle_edge_irq+0x6f/0x110<BR>[<FFFFFFFF81004972>] handle_irq+0x22/0x40<BR>[<FFFFFFFF81663C8E>] do_IRQ+0x5e/0x110<BR>[<FFFFFFFF81659A6A>] common_interrupt+0x6a/0x6a<BR><EOI>[<FFFFFFFF814FB70B>] ? cpuidle_enter_state+0x5b/0xe0<BR>[<FFFFFFFF814FB707>] ? cpuidle_enter_state+0x57/0xe0<BR>[<FFFFFFFF814FB84B>] cpuidle_idle_call+0xbb/0x200<BR>[<FFFFFFFF8100B3DE>] arch_cpu_idle+0xe/0x30<BR>[<FFFFFFFF8109911A>] cpu_startup_entry+0x9a/0x220<BR>[<FFFFFFFF816377B7>] rest_init+0x77/0x80<BR>[<FFFFFFFF81A40031>] start_kernel+0x44e/0x45b<BR>[<FFFFFFFF81A3F9E2>] ? repair_env_string+0x5e/0x5e<BR>[<FFFFFFFF81A3F5AF>] x86_64_start_reservations+0x2a/0x2c<BR>[<FFFFFFFF81A3F6AE>] x86_64_start_kernel+0xfd/0x101<BR>handlers:<BR>[<FFFFFFFFA08441C0>] e1000_msix_other [e1000e]<BR>Disabling IRQ #48</FFFFFFFFA08441C0></FFFFFFFF81A3F6AE></FFFFFFFF81A3F5AF></FFFFFFFF81A3F9E2></FFFFFFFF81A40031></FFFFFFFF816377B7></FFFFFFFF8109911A></FFFFFFFF8100B3DE></FFFFFFFF814FB84B></FFFFFFFF814FB707></FFFFFFFF814FB70B></EOI></FFFFFFFF81659A6A></FFFFFFFF81663C8E></FFFFFFFF81004972></FFFFFFFF810DC0FF></FFFFFFFF810D9872></FFFFFFFF810D96F2></FFFFFFFF814FB70B></FFFFFFFF810DBF41></FFFFFFFF810DBA9D></FFFFFFFF81653B0A></IRQ></P></DIV>
<P>&#20174;&#19978;&#36848;&#20449;&#24687;&#65292;&#20998;&#26512;&#20986;&#65292;&#21487;&#33021;&#21644;DMA&#26377;&#20851;&#65292;&#26597;&#30475;&#20869;&#26680;&#32534;&#35793;&#36873;&#39033;&#65306;</P>
<DIV id=crayon-569898afcb1dd903390136 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898afcb1dd903390136-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1dd903390136-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1dd903390136-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1dd903390136-4">4</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898afcb1dd903390136-1 class=crayon-line><SPAN class=crayon-c># cat .config | grep INTEL_IOMMU</SPAN></DIV>
<DIV id=crayon-569898afcb1dd903390136-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>CONFIG_INTEL_IOMMU</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-i>y</SPAN></DIV>
<DIV id=crayon-569898afcb1dd903390136-3 class=crayon-line><SPAN class=crayon-v>CONFIG_INTEL_IOMMU_DEFAULT_ON</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-i>y</SPAN></DIV>
<DIV id=crayon-569898afcb1dd903390136-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>CONFIG_INTEL_IOMMU_FLOPPY_WA</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-v>y</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P>&#40664;&#35748;IOMMU&#37117;&#24320;&#21551;&#20102;&#65292;&#20110;&#26159;&#22312;grub&#21551;&#21160;&#39033;&#37324;&#20462;&#25913;&#65292;&#23558;iommu&#20851;&#38381;:</P>
<DIV id=crayon-569898afcb1e3045560744 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898afcb1e3045560744-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1e3045560744-2">2</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898afcb1e3045560744-1 class=crayon-line><SPAN class=crayon-c># cat /proc/cmdline </SPAN></DIV>
<DIV id=crayon-569898afcb1e3045560744-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>BOOT_IMAGE</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-o>/</SPAN><SPAN class=crayon-v>firmware</SPAN><SPAN class=crayon-o>/</SPAN><SPAN class=crayon-v>current</SPAN><SPAN class=crayon-o>/</SPAN><SPAN class=crayon-t>package</SPAN><SPAN class=crayon-o>/</SPAN><SPAN class=crayon-v>files</SPAN><SPAN class=crayon-o>/</SPAN><SPAN class=crayon-e>vm </SPAN><SPAN class=crayon-v>crashkernel</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-cn>400M</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>loglevel</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-cn>3</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>elevator</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-e>deadline </SPAN><SPAN class=crayon-v>softlockup_panic</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>reboot</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-e>force </SPAN><SPAN class=crayon-v>nohz</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-e>off </SPAN><SPAN class=crayon-v>intel_iommu</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-v>off</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H3>LINUX&#21407;&#29983;&#27979;&#35797;</H3>
<P>&#21407;&#29983;LINUX&#27979;&#35797;&#30340;&#26102;&#20505;&#65292;&#36935;&#21040;&#19968;&#20010;&#38382;&#39064;&#26159;&#27809;&#24320;&#21551;ip_forward&#23548;&#33268;&#19977;&#23618;&#25968;&#25454;&#19981;&#36890;&#65292;&#25968;&#25454;&#21482;&#21040;eth0&#65292;&#26080;&#27861;&#20174;eth1&#20986;&#21435;&#65306;</P>
<DIV id=crayon-569898afcb1e9152186749 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898afcb1e9152186749-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1e9152186749-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1e9152186749-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1e9152186749-4">4</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898afcb1e9152186749-1 class=crayon-line><SPAN class=crayon-c># pps.sh eth0 eth1</SPAN></DIV>
<DIV id=crayon-569898afcb1e9152186749-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-cn>02</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-cn>25</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-cn>03</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-i>IFN</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-i>RXB</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-i>TXB</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-i>RXP</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-e>TXP</SPAN></DIV>
<DIV id=crayon-569898afcb1e9152186749-3 class=crayon-line><SPAN class=crayon-e>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-i>eth0</SPAN><SPAN class=crayon-h>&nbsp;&nbsp; </SPAN><SPAN class=crayon-cn>18661696</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-cn>507</SPAN><SPAN class=crayon-h>&nbsp;&nbsp; </SPAN><SPAN class=crayon-cn>291589</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-cn>5</SPAN></DIV>
<DIV id=crayon-569898afcb1e9152186749-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-i>eth1</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-cn>0</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P>&#26597;&#30475;ip_forward&#21457;&#29616;&#20851;&#38381;&#20102;&#36716;&#21457;&#65292;&#24320;&#21551;&#23427;&#65306;</P>
<DIV id=crayon-569898afcb1ef693347581 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898afcb1ef693347581-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1ef693347581-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1ef693347581-3">3</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898afcb1ef693347581-1 class=crayon-line><SPAN class=crayon-c># cat /proc/sys/net/ipv4/ip_forward </SPAN></DIV>
<DIV id=crayon-569898afcb1ef693347581-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-cn>0</SPAN></DIV>
<DIV id=crayon-569898afcb1ef693347581-3 class=crayon-line><SPAN class=crayon-c># echo 1 &gt; /proc/sys/net/ipv4/ip_forward </SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<P>&#28982;&#21518;&#36890;&#20102;&#65306;</P>
<DIV id=crayon-569898afcb1f5755057146 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898afcb1f5755057146-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1f5755057146-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1f5755057146-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1f5755057146-4">4</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898afcb1f5755057146-1 class=crayon-line><SPAN class=crayon-c># pps.sh eth0 eth1</SPAN></DIV>
<DIV id=crayon-569898afcb1f5755057146-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-cn>02</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-cn>27</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-cn>51</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-i>IFN</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-i>RXB</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-i>TXB</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-i>RXP</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;</SPAN><SPAN class=crayon-sy>,</SPAN><SPAN class=crayon-e>TXP</SPAN></DIV>
<DIV id=crayon-569898afcb1f5755057146-3 class=crayon-line><SPAN class=crayon-e>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-i>eth0</SPAN><SPAN class=crayon-h>&nbsp;&nbsp; </SPAN><SPAN class=crayon-cn>27094848</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-cn>95</SPAN><SPAN class=crayon-h>&nbsp;&nbsp; </SPAN><SPAN class=crayon-cn>423357</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-cn>1</SPAN></DIV>
<DIV id=crayon-569898afcb1f5755057146-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN class=crayon-i>eth1</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-h>&nbsp;&nbsp; </SPAN><SPAN class=crayon-cn>27058240</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-h>&nbsp;&nbsp; </SPAN><SPAN class=crayon-cn>422789</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<H3>Netmap vale&#27979;&#35797;</H3>
<P>&#21021;&#22987;&#21270;&#29615;&#22659;&#30340;&#26102;&#20505;&#65292;&#23558;&#32593;&#21475;&#20013;&#26029;&#32465;&#23450;&#21040;CPU 1&#19978;&#65292;&#38450;&#27490;&#22312;CPU 0&#19978;&#21463;&#24178;&#25200;&#36807;&#22810;&#65292;&#20889;&#25104;&#33050;&#26412;&#65292;&#26041;&#20415;&#22797;&#29992;&#65306;</P>
<DIV id=crayon-569898afcb1fb667973733 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-57">57</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-58">58</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-59">59</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-60">60</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-61">61</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-62">62</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-63">63</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-64">64</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-65">65</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-66">66</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-67">67</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-68">68</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-69">69</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-70">70</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-71">71</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-72">72</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-73">73</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-74">74</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-75">75</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-76">76</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-77">77</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-78">78</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-79">79</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-80">80</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-81">81</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-82">82</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-83">83</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-84">84</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-85">85</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-86">86</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-87">87</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-88">88</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-89">89</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-90">90</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-91">91</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-92">92</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-93">93</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-94">94</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-95">95</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-96">96</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-97">97</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-98">98</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-99">99</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-100">100</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-101">101</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-102">102</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-103">103</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-104">104</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-105">105</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-106">106</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-107">107</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-108">108</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-109">109</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-110">110</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-111">111</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-112">112</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-113">113</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-114">114</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-115">115</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-116">116</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-117">117</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-118">118</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-119">119</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-120">120</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-121">121</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb1fb667973733-122">122</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb1fb667973733-123">123</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898afcb1fb667973733-1 class=crayon-line><SPAN class=crayon-e>lcmdrun</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-3 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>cmd</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-s>"$*"</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-r>echo</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"$cmd"</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-5 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-i>eval</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"$cmd"</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-7 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898afcb1fb667973733-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-c>#&#27492;&#20989;&#25968;&#35774;&#32622;&#32593;&#21475;&#20013;&#26029;&#21040;&#25351;&#23450;CPU</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-9 class=crayon-line><SPAN class=crayon-v>w</SPAN><SPAN class=crayon-e>.eth</SPAN><SPAN class=crayon-e>.irqaffinity</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-11 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>eth</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-s>"$1"</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>affinity</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-s>"$2"</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-13 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898afcb1fb667973733-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"$eth"</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>""</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>then</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-15 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-i>lerror</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"w.eth.irqaffinity \$eth [\$affinity]"</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-16 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-17 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>fi</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-18 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898afcb1fb667973733-19 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#make mult lie result to one line&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>lines</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-sy>`</SPAN><SPAN class=crayon-r>cat</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>/</SPAN><SPAN class=crayon-v>proc</SPAN><SPAN class=crayon-o>/</SPAN><SPAN class=crayon-v>interrupts</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-r>grep</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>$eth</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-r>awk</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-v>F</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>'{print $2}'</SPAN><SPAN class=crayon-sy>`</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-21 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#lines='&nbsp;&nbsp;47</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#48</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-23 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#49'</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>SAVE_IFS</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-v>$IFS</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-25 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>IFS</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-sy>$</SPAN><SPAN class=crayon-s>'\n'</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#if we set IFS=$'\n' and pass lines as args, it become =&gt; trim '&nbsp;&nbsp;47' '&nbsp;&nbsp;48' '&nbsp;&nbsp;49'</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-27 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#if we set IFS=$' ' and pass lines as args, it become =&gt;</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-28 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#trim '47</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-29 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#' '48</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#' 49</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-31 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>lines</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-sy>$</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-i>trim</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>$lines</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#trim return lines='47&nbsp;&nbsp; 48&nbsp;&nbsp; 49'</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-33 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>IFS</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-sy>$</SPAN><SPAN class=crayon-s>' '</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#in $lines, not in "$lines", "$lines" can't split by space, by $lines can be</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-35 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>for</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-i>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>in</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>$lines</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>do</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-36 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-sy>$</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-i>trim</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>$i</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-37 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"$affinity"</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>""</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>then</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#just echo</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-39 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>cmd</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-s>"cat /proc/irq/$i/smp_affinity"</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>else</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-41 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>cmd</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-s>"echo \"$affinity\" &gt; /proc/irq/$i/smp_affinity"</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>fi</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-43 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-i>lcmdrun</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"$cmd"</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-44 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>done</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-45 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>IFS</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-v>$SAVE_IFS</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-46 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-47 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898afcb1fb667973733-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>w</SPAN><SPAN class=crayon-e>.nm</SPAN><SPAN class=crayon-e>.stop</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-49 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-50 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>nic</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-sy>$</SPAN><SPAN class=crayon-cn>1</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-51 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>shift</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-52 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898afcb1fb667973733-53 class=crayon-line><SPAN class=crayon-e>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>ifs</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>$</SPAN><SPAN class=crayon-sy>@</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-54 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>ifs_nr</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-sy>$</SPAN><SPAN class=crayon-c>#</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-55 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-56 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#stop interface</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-57 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>for</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&lt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>$ifs_nr</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>i</SPAN><SPAN class=crayon-o>++</SPAN><SPAN class=crayon-sy>)</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-58 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>do</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-59 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-i>lcmdrun</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"ifconfig ${ifs[$i]} down"</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-60 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>done</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-61 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898afcb1fb667973733-62 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#remove old modules</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-63 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>lcmdrun </SPAN><SPAN class=crayon-i>rmmod</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"${nic}.ko"</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-64 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>lcmdrun </SPAN><SPAN class=crayon-i>rmmod</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"netmap_lin.ko"</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-65 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-66 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898afcb1fb667973733-67 class=crayon-line><SPAN class=crayon-v>w</SPAN><SPAN class=crayon-e>.nm</SPAN><SPAN class=crayon-e>.start</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-68 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-69 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>nic</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-sy>$</SPAN><SPAN class=crayon-cn>1</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-70 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>shift</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-71 class=crayon-line><SPAN class=crayon-e></SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-72 class="crayon-line crayon-striped-line"><SPAN class=crayon-e>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>ifs</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>$</SPAN><SPAN class=crayon-sy>@</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-73 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898afcb1fb667973733-74 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-i>f</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"${nic}.ko"</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>then</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-75 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-r>echo</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"can't found ${nic}.ko"</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-76 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-77 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>fi</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-78 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898afcb1fb667973733-79 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-i>f</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"netmap_lin.ko"</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>then</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-80 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-r>echo</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"can't found netmap_lin.ko"</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-81 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-82 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>fi</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-83 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898afcb1fb667973733-84 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#clean dmsg</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-85 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>dmesg</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-v>c</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>&gt;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>/</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>/</SPAN><SPAN class=crayon-t>null</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-86 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898afcb1fb667973733-87 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#set ring slot, set before netmap attach when eth is down</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-88 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>for</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>eth </SPAN><SPAN class=crayon-st>in</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"${ifs[@]}"</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>do</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-89 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-i>lcmdrun</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"ifconfig $eth down 2&gt;/dev/null"</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-90 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>done</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-91 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898afcb1fb667973733-92 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#insert new modules</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-93 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>lcmdrun </SPAN><SPAN class=crayon-i>insmod</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"netmap_lin.ko"</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-94 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>lcmdrun </SPAN><SPAN class=crayon-i>insmod</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"${nic}.ko"</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-95 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898afcb1fb667973733-96 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>for</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>eth </SPAN><SPAN class=crayon-st>in</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"${ifs[@]}"</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>do</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-97 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#"ethtool -G $eth rx 4096 tx 4096"</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-98 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898afcb1fb667973733-99 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#start interface</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-100 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-i>lcmdrun</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"ifconfig $eth up"</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-101 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#set irq affinity to cpu1</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-102 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-i>lcmdrun</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"w.eth.irqaffinity $eth 2"</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-103 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#set promisc module, important</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-104 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-i>lcmdrun</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"ifconfig $eth promisc"</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-105 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#ethtool -K $eth tso off</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-106 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#ethtool -K $eth gso off</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-107 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>done</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-108 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898afcb1fb667973733-109 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#show log</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-110 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-e>lcmdrun </SPAN><SPAN class=crayon-e>dmesg</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-111 class=crayon-line><SPAN class=crayon-e>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-i>lcmdrun</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"lsmod | grep \"${nic}\""</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-112 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-113 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898afcb1fb667973733-114 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>w</SPAN><SPAN class=crayon-e>.nm</SPAN><SPAN class=crayon-e>.restart</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-115 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-116 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>w</SPAN><SPAN class=crayon-e>.nm</SPAN><SPAN class=crayon-e>.stop</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>$</SPAN><SPAN class=crayon-o>*</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-117 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>w</SPAN><SPAN class=crayon-e>.nm</SPAN><SPAN class=crayon-e>.start</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>$</SPAN><SPAN class=crayon-o>*</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-118 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-119 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898afcb1fb667973733-120 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>w</SPAN><SPAN class=crayon-e>.nm</SPAN><SPAN class=crayon-e>.restart</SPAN><SPAN class=crayon-e>.e1000e</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-121 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-122 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>w</SPAN><SPAN class=crayon-e>.nm</SPAN><SPAN class=crayon-e>.restart</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"e1000e"</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"eth0"</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"eth1"</SPAN></DIV>
<DIV id=crayon-569898afcb1fb667973733-123 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P>&#21482;&#38656;&#35843;&#29992;w.nm.restart.e1000e&#21363;&#21487;&#21021;&#22987;&#21270;netmap&#29615;&#22659;&#65292;&#21021;&#22987;&#21270;&#23436;&#25104;&#21518;&#65292;&#35774;&#32622;&#34394;&#25311;bridge&#65306;</P>
<DIV id=crayon-569898afcb206148384655 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898afcb206148384655-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb206148384655-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb206148384655-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb206148384655-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb206148384655-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb206148384655-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb206148384655-7">7</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898afcb206148384655-1 class=crayon-line><SPAN class=crayon-c># vale-ctl -h vale23:eth0</SPAN></DIV>
<DIV id=crayon-569898afcb206148384655-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-c># vale-ctl -h vale23:eth1</SPAN></DIV>
<DIV id=crayon-569898afcb206148384655-3 class=crayon-line><SPAN class=crayon-c># vale-ctl -l</SPAN></DIV>
<DIV id=crayon-569898afcb206148384655-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>bdg</SPAN><SPAN class=crayon-sy>_</SPAN>ctl<SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-cn>98</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>bridge</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>port</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>vale23</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-e>eth0</SPAN></DIV>
<DIV id=crayon-569898afcb206148384655-5 class=crayon-line><SPAN class=crayon-v>bdg</SPAN><SPAN class=crayon-sy>_</SPAN>ctl<SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-cn>98</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>bridge</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>port</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-e>eth0</SPAN></DIV>
<DIV id=crayon-569898afcb206148384655-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>bdg</SPAN><SPAN class=crayon-sy>_</SPAN>ctl<SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-cn>98</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>bridge</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>port</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-cn>2</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>vale23</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-e>eth1</SPAN></DIV>
<DIV id=crayon-569898afcb206148384655-7 class=crayon-line><SPAN class=crayon-v>bdg</SPAN><SPAN class=crayon-sy>_</SPAN>ctl<SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-cn>98</SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>bridge</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-cn>0</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>port</SPAN><SPAN class=crayon-o>:</SPAN><SPAN class=crayon-cn>3</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>eth1</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<P>&#27492;&#26102;eth0&#21644;eth1&#23601;&#26725;&#25509;&#21040;&#21516;&#19968;bridge&#19978;&#20102;&#65292;&#25968;&#25454;&#21253;&#23601;&#21487;&#20197;&#20174;eth0&#36716;&#21457;&#21040;eth1&#65292;&#21453;&#20043;&#20134;&#28982;&#12290;</P>
<H3>Netmap bridge&#27979;&#35797;</H3>
<P>&#19978;&#38754;&#20351;&#29992;&#30340;&#26159;vale&#26041;&#24335;&#36716;&#21457;&#65292;netmap&#24212;&#29992;&#22330;&#26223;&#36824;&#26377;&#36890;&#36807;socket&#65306;&#36718;&#35810;&#65292;&#25910;&#21462;&#65292;&#36716;&#21457;&#25968;&#25454;&#65292;&#20854;&#25552;&#20379;&#20102;&#31034;&#20363;&#20195;&#30721;bridge&#65292;&#25105;&#20204;&#23601;&#29992;bridge&#27979;&#35797;&#12290;</P>
<P>&#20351;&#29992;bridge&#30340;&#26102;&#20505;&#21457;&#29616;netmap&#19981;&#33021;&#25910;&#21457;&#25968;&#25454;&#65292;&#21518;&#26469;&#21457;&#29616;&#27809;&#26377;&#24320;&#21551;&#32593;&#21475;&#28151;&#26434;&#27169;&#24335;&#65292;&#20363;&#22914;eth0&#65292;&#36890;&#36807;ifconfig eth0 | grep PROMISC&#26597;&#30475;&#26159;&#21542;&#35774;&#32622;&#20102;&#28151;&#26434;&#27169;&#24335;&#65292;&#22914;&#26524;&#27809;&#26377;&#65292;&#20351;&#29992;ifconfig eth0 promisc&#35774;&#32622;&#12290;</P>
<P>Bridge&#27979;&#35797;&#27604;&#36739;&#31616;&#21333;&#65292;&#30452;&#25509;&#65306;</P>
<DIV id=crayon-569898afcb20d174272164 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898afcb20d174272164-1">1</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898afcb20d174272164-1 class=crayon-line><SPAN class=crayon-c>#./bridge -i netmap:eth0 -i netmap:eth1</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P>&#24403;&#28982;&#65292;&#20026;&#20102;&#26356;&#20248;&#24615;&#33021;&#65292;&#20063;&#23558;&#27492;&#36827;&#31243;&#32465;&#23450;&#21040;&#32593;&#21475;&#20013;&#26029;&#21457;&#29983;&#30340;CPU 1&#65292;&#24182;&#35774;&#32622;&#20854;&#20026;&#23454;&#26102;&#36827;&#31243;&#65306;</P>
<DIV id=crayon-569898afcb213060337548 class="crayon-syntax crayon-theme-github crayon-font-consolas crayon-os-pc print-yes notranslate" style="FONT-SIZE: 14px !important; HEIGHT: auto; LINE-HEIGHT: 15px !important" data-settings=" minimize scroll-mouseover">
<DIV class=crayon-plain-wrap></DIV>
<DIV class=crayon-main style="OVERFLOW: hidden; POSITION: relative; Z-INDEX: 1">
<TABLE class=crayon-table>
<TBODY>
<TR class=crayon-row>
<TD class="crayon-nums " data-settings="show">
<DIV class=crayon-nums-content style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important">
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-1">1</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-2">2</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-3">3</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-4">4</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-5">5</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-6">6</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-7">7</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-8">8</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-9">9</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-10">10</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-11">11</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-12">12</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-13">13</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-14">14</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-15">15</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-16">16</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-17">17</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-18">18</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-19">19</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-20">20</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-21">21</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-22">22</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-23">23</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-24">24</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-25">25</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-26">26</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-27">27</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-28">28</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-29">29</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-30">30</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-31">31</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-32">32</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-33">33</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-34">34</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-35">35</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-36">36</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-37">37</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-38">38</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-39">39</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-40">40</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-41">41</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-42">42</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-43">43</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-44">44</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-45">45</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-46">46</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-47">47</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-48">48</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-49">49</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-50">50</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-51">51</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-52">52</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-53">53</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-54">54</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-55">55</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-56">56</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-57">57</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-58">58</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-59">59</DIV>
<DIV class="crayon-num crayon-striped-num" data-line="crayon-569898afcb213060337548-60">60</DIV>
<DIV class=crayon-num data-line="crayon-569898afcb213060337548-61">61</DIV></DIV></TD>
<TD class=crayon-code>
<DIV class=crayon-pre style="FONT-SIZE: 14px !important; LINE-HEIGHT: 15px !important; -moz-tab-size: 4; -o-tab-size: 4; -webkit-tab-size: 4; tab-size: 4">
<DIV id=crayon-569898afcb213060337548-1 class=crayon-line><SPAN class=crayon-e>pidexpend</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-2 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-3 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>ip</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-sy>$</SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-4 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"$ip"</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>==</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>""</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>then</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-5 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-6 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>fi</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-7 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-8 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"$ip"</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-i>eq</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"$ip"</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>2</SPAN><SPAN class=crayon-o>&gt;</SPAN><SPAN class=crayon-o>/</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>/</SPAN><SPAN class=crayon-t>null</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>then</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-9 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-r>echo</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>$ip</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-10 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-sy>;</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-11 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>fi</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-12 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-13 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#not digit</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-14 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-i>pidof</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-v>$ip</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>|</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-r>awk</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>'{print $1}'</SPAN><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-15 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-16 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898afcb213060337548-17 class=crayon-line><SPAN class=crayon-v>w</SPAN><SPAN class=crayon-e>.cpu</SPAN><SPAN class=crayon-e>.affinity</SPAN><SPAN class=crayon-e>.show</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-18 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-19 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>pid</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-sy>$</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-i>pidexpend</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>$</SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-20 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-21 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"$pid"</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>""</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>then</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-22 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-r>echo</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"w.cpu.affinity.show (pid|progname)"</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-23 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-24 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>fi</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-25 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898afcb213060337548-26 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-i>lcmdrun</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"taskset -p $pid"</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-27 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-i>lcmdrun</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"chrt -p $pid"</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-28 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898afcb213060337548-29 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-30 class="crayon-line crayon-striped-line"><SPAN class=crayon-sy>}</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-31 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898afcb213060337548-32 class="crayon-line crayon-striped-line"><SPAN class=crayon-v>w</SPAN><SPAN class=crayon-e>.cpu</SPAN><SPAN class=crayon-e>.affinity</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-33 class=crayon-line><SPAN class=crayon-sy>{</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-34 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-c>#set eth affinity to cpu 1, hex 0x2</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-35 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>pid</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-sy>$</SPAN><SPAN class=crayon-sy>(</SPAN><SPAN class=crayon-i>pidexpend</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>$</SPAN><SPAN class=crayon-cn>1</SPAN><SPAN class=crayon-sy>)</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-36 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898afcb213060337548-37 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>cpumask</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-cn>2</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-38 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"$2"</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>""</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>then</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-39 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>cpumask</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-sy>$</SPAN><SPAN class=crayon-cn>2</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-40 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>fi</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-41 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898afcb213060337548-42 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>realtime</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-cn>90</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-43 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"$3"</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>!=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>""</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>then</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-44 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-v>realtime</SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-sy>$</SPAN><SPAN class=crayon-cn>3</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-45 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>fi</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-46 class="crayon-line crayon-striped-line">&nbsp;</DIV>
<DIV id=crayon-569898afcb213060337548-47 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"$pid"</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>=</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>""</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>then</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-48 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-r>echo</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"w.cpu.affinity (pid|progname) [\$cpumask=$cpumask] [\$realtime=$realtime]"</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-49 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>1</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-50 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>fi</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-51 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898afcb213060337548-52 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"$cpumask"</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-i>eq</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"$cpumask"</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>2</SPAN><SPAN class=crayon-o>&gt;</SPAN><SPAN class=crayon-o>/</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>/</SPAN><SPAN class=crayon-t>null</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>then</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-53 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-i>lcmdrun</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"taskset -p $cpumask $pid"</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-54 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>fi</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-55 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898afcb213060337548-56 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>if</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>[</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"$realtime"</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-o>-</SPAN><SPAN class=crayon-i>eq</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"$realtime"</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-sy>]</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>2</SPAN><SPAN class=crayon-o>&gt;</SPAN><SPAN class=crayon-o>/</SPAN><SPAN class=crayon-v>dev</SPAN><SPAN class=crayon-o>/</SPAN><SPAN class=crayon-t>null</SPAN><SPAN class=crayon-sy>;</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-st>then</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-57 class=crayon-line><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-i>lcmdrun</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-s>"chrt -p -r $realtime $pid"</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-58 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>fi</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-59 class=crayon-line>&nbsp;</DIV>
<DIV id=crayon-569898afcb213060337548-60 class="crayon-line crayon-striped-line"><SPAN class=crayon-h>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=crayon-st>return</SPAN><SPAN class=crayon-h> </SPAN><SPAN class=crayon-cn>0</SPAN></DIV>
<DIV id=crayon-569898afcb213060337548-61 class=crayon-line><SPAN class=crayon-sy>}</SPAN></DIV></DIV></TD></TR></TBODY></TABLE></DIV></DIV>
<P></P>
<P>&#36816;&#34892;&#20102;bridge&#20043;&#21518;&#65292;&#20877;&#35843;&#29992;w.cpu.affinity bridge&#21487;&#20197;&#35774;&#32622;&#20854;&#20026;CPU&#20146;&#21644;&#24615;&#19982;&#23454;&#26102;&#24615;&#65292;&#28982;&#21518;&#21487;&#20197;&#24320;&#22987;&#27979;&#35797;&#12290;</P>
<H2>&#27979;&#35797;&#32467;&#26524;</H2>
<P><A title=&#32508;&#21512;&#32467;&#26524; class=fancybox href="http://mnstory.net/wp-content/uploads/2014/11/netmap-performance/result1.jpg" rel=fancybox><IMG class=size-full src="http://mnstory.net/wp-content/uploads/2014/11/netmap-performance/result1.jpg"></A><BR><A title=&#35814;&#32454;&#32467;&#26524; class=fancybox href="http://mnstory.net/wp-content/uploads/2014/11/netmap-performance/result2.jpg" rel=fancybox><IMG class=size-full src="http://mnstory.net/wp-content/uploads/2014/11/netmap-performance/result2.jpg"></A></P>
<OL class=decimal>
<LI>netmap bridge&#21644;netmap vale&#24615;&#33021;&#30456;&#24403;&#12290;</LI>
<LI>&#22312;&#21457;64&#23383;&#33410;&#21253;&#30340;&#26102;&#20505;&#65292;netmap&#24615;&#33021;&#20026;121&#19975;PPS&#65292;LINUX&#21407;&#29983;&#20026;83&#19975;PPS&#65292;&#25552;&#39640;&#20102;45%&#12290;&#23448;&#26041;&#32473;&#20986;&#30340;&#19975;&#20806;&#32593;&#21345;&#24615;&#33021;&#21487;&#36798;&#21040;,1488&#19975;PPS&#65292;&#25240;&#25442;&#20026;&#21315;&#20806;&#32593;&#21345;&#22823;&#32422;&#20026;148&#19975;PPS&#65292;&#27604;&#25105;&#27979;&#35797;&#30340;&#25968;&#25454;&#39640;22%&#65292;&#20063;&#19981;&#30693;&#36947;&#23427;&#22914;&#20309;&#27979;&#35797;&#30340;&#12290;</LI>
<LI>&#24403;frame size&#22686;&#22823;&#21518;&#65292;&#24615;&#33021;&#26080;&#24046;&#21035;&#65292;&#22240;&#20026;&#27969;&#37327;&#21040;&#20102;&#29942;&#39048;&#65292;&#38500;&#20102;64&#23383;&#33410;frame size&#30340;&#26102;&#20505;&#65292;CPU&#21033;&#29992;&#29575;&#37117;&#19981;&#20250;100%&#12290;</LI></OL>
<P><A href="http://mnstory.net/wp-content/uploads/2014/11/netmap-performance/netmap-performance.pdf" target=_bank>PDF&#19979;&#36733;</A></P></DIV>