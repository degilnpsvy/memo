<HEADER class=entry-header>&nbsp;
<H1 class=entry-title>&#22522;&#26412;&#26102;&#38047;&#35774;&#22791;&#27010;&#24565;</H1>
<DIV class=entry-meta><SPAN class=sep>&#21457;&#34920;&#20110; </SPAN><A title="&#19979;&#21320; 4:13" href="http://mnstory.net/2014/03/%e5%9f%ba%e6%9c%ac%e6%97%b6%e9%92%9f%e8%ae%be%e5%a4%87%e6%a6%82%e5%bf%b5/" rel=bookmark><TIME class=entry-date datetime="2014-03-02T16:13:56+00:00">2014 &#24180; 3 &#26376; 2 &#26085;</TIME></A> </DIV></HEADER>
<DIV class=entry-content>
<H2>&#26102;&#38047;&#20107;&#20214;&#35774;&#22791;&#65288;clock-event device&#65289;</H2>
<P>&#31995;&#32479;&#20013;&#21487;&#20197;&#35302;&#21457; one-shot&#65288;&#21333;&#27425;&#65289;&#25110;&#32773;&#21608;&#26399;&#24615;&#20013;&#26029;&#30340;&#35774;&#22791;&#37117;&#21487;&#20197;&#20316;&#20026;&#26102;&#38047;&#20107;&#20214;&#35774;&#22791;&#12290;&#22914; HPET&#65292;CPU Local APIC Timer &#31561;&#12290;</P>
<P>&#22914;&#19979;&#20026;&#24120;&#29992;&#26102;&#38047;&#20107;&#20214;&#35774;&#22791;(HPET&#22312;&#26102;&#38047;&#28304;&#37324;&#19968;&#24182;&#20171;&#32461;)&#65306;</P>
<H3>Local APIC (local advanced programmable interrupt controller timers)</H3>
<P>counter: 32-bit<BR>&#26159;&#26102;&#38047;&#20107;&#20214;&#35774;&#22791;&#65292;&#20854;rating&#20026;100&#12290;<BR>&#39057;&#29575;&#65306;&#36719;&#20214;&#27809;&#26377;&#19968;&#20010;&#38752;&#35889;&#30340;&#26041;&#27861;&#21435;&#25506;&#27979;&#20854;&#39057;&#29575;&#65292;&#19968;&#33324;&#26469;&#35828;&#65292;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;PIT&#25110;RTC&#26469;&#24110;&#21161;&#25506;&#27979;&#20854;&#39057;&#29575;&#65292;&#20294;&#26159;&#65292;&#36825;&#21482;&#26159;&#20010;&#20272;&#20540;&#12290;<BR>&#30465;&#30005;&#27169;&#24335;&#26159;&#21542;&#24433;&#21709;: &#22788;&#29702;&#22120;&#22312;&#26576;&#20123;&#30005;&#28304;&#31649;&#29702;&#24773;&#20917;&#19979;&#20250;&#26242;&#20572;</P>
<P>&#26159;&#29616;&#20195;PC&#20013;&#30340;&#20013;&#26029;&#20998;&#21457;&#36923;&#36753;&#21333;&#20803;&#65292;&#22312;&#22810;&#22788;&#29702;&#22120;&#30340;&#31995;&#32479;&#65292;&#27599;&#20010;CPU&#23601;&#26377;&#19968;&#20010;Local APIC&#65292;&#19968;&#33324;&#34987;&#38598;&#25104;&#21040;&#22788;&#29702;&#22120;&#33455;&#29255;&#20869;&#37096;&#65292;&#21253;&#21547;&#20102;&#19968;&#20010;&#26102;&#38047;&#35774;&#22791;&#65292;&#26377;&#19968;&#20010;32-bit&#30340;counter&#21644;counter&#36755;&#20837;&#23492;&#23384;&#22120;&#65292;&#27604;&#36215;PIT&#25110;RTC&#26469;&#35828;&#65292;&#20182;&#20855;&#26377;&#26356;&#31934;&#32454;&#30340;&#31890;&#24230;(more finely grained)<BR>&#21644;&#33021;&#23384;&#20648;&#26356;&#22823;&#30340;counterbit&#20540;(&#22240;&#20026;&#23427;&#26377;32-bit)&#65292;&#20294;&#26159;&#31934;&#24230;&#36824;&#26159;&#36739;&#20302;&#12290;<SPAN id=more-257></SPAN></P>
<H4>APIC</H4>
<P>&#21253;&#25324;IO APIC&#21644;LOCAL APIC<BR><B>IO APIC&#65306;</B>&#21644;&#22806;&#37096;I/O&#35774;&#22791;&#30456;&#36830;&#65292;&#24182;&#25226;&#36825;&#20123;&#35774;&#22791;&#30340;IO&#35831;&#27714;&#20316;&#20026;&#20013;&#26029;&#20449;&#24687;&#36716;&#36798;&#32473;LOCAL APIC&#65292;&#22312;MP&#31995;&#32479;&#19978;&#65292;IO APIC&#21487;&#20197;&#23558;&#22806;&#37096;&#20013;&#26029;&#20998;&#21457;&#21040;&#26576;&#20010;/&#32452;&#25351;&#23450;&#30340;LOCAL APIC&#12290;<BR><B>LOCAL APIC(LAPIC)&#65306;</B>&#25509;&#25910;&#26469;&#33258;&#20869;&#37096;&#25110;&#22806;&#37096;&#65288;&#22914;IO APIC 8259&#31561;&#20013;&#26029;&#25511;&#21046;&#22120;&#65289;&#30340;&#20013;&#26029;&#65292;&#24182;&#25226;&#23427;&#20204;&#21457;&#36865;&#32473;CPU&#26680;&#24515;&#36827;&#34892;&#22788;&#29702;&#12290;&#22312;MP&#31995;&#32479;&#19978;&#65292;LOCAL APIC&#36824;&#29992;&#20110;&#21457;&#36865;&#21644;&#25509;&#25910;&#22788;&#29702;&#22120;&#38388;&#20013;&#26029;&#65288;IPI &#65306;interprocessor interrupt&#65292;&#21487;&#29992;&#20110;&#25226;&#20013;&#26029;&#20998;&#21457;&#21040;&#31995;&#32479;&#30340;&#22810;&#20010;&#22788;&#29702;&#22120;&#19978;&#65292;&#25110;&#25191;&#34892;&#19968;&#20123;&#31995;&#32479;&#32423;&#30340;&#21151;&#33021;&#65289;&#12290;8259(intel chip number 82093)&#21644;IO APIC&#23646;&#20110;&#20013;&#26029;&#25511;&#21046;&#22120;&#32780;&#38750;&#26102;&#38047;&#28304;&#12290;<BR><A title=apic class=fancybox href="http://mnstory.net/wp-content/uploads/2014/03/clock-device-intro/apic.png" rel=fancybox><IMG class=size-full src="http://mnstory.net/wp-content/uploads/2014/03/clock-device-intro/apic.png"></A></P>
<H2>&#26102;&#38047;&#28304;&#35774;&#22791;&#65288;clock-source device&#65289;</H2>
<P>&#31995;&#32479;&#20013;&#21487;&#20197;&#25552;&#20379;&#19968;&#23450;&#31934;&#24230;&#30340;&#35745;&#26102;&#35774;&#22791;&#37117;&#21487;&#20197;&#20316;&#20026;&#26102;&#38047;&#28304;&#35774;&#22791;&#12290;&#22914; TSC&#65292;HPET&#65292;ACPI PM-Timer&#65292;PIT &#31561;&#12290;<BR><B>WINDOWS&#19979;&#26597;&#30475;&#26102;&#38047;&#28304;</B><BR>&#36816;&#34892;&#21629;&#20196;powercfg /energy&#65292;&#20250;&#29983;&#25104;&#19968;&#20010;&#25253;&#34920;HTML&#25991;&#20214;&#65292;&#21487;&#30475;&#21040;&#20854;&#20013;&#30340;&#24179;&#21488;&#20998;&#36776;&#29575;&#12290;<BR><A title=windows-solution class=fancybox href="http://mnstory.net/wp-content/uploads/2014/03/clock-device-intro/windows-solution.png" rel=fancybox><IMG class=size-full src="http://mnstory.net/wp-content/uploads/2014/03/clock-device-intro/windows-solution.png"></A></P>
<P><B>LINUX&#19979;&#26597;&#30475;&#26102;&#38047;&#28304;</B><BR>&#21487;&#29992;&#26102;&#38047;&#28304;&#65306;<BR># cat /sys/devices/system/clocksource/clocksource0/available_clocksource<BR>kvm-clock tsc hpet acpi_pm jiffies<BR>&#26597;&#30475;&#24403;&#21069;&#20351;&#29992;&#30340;&#26102;&#38047;&#28304;&#65306;<BR># cat /sys/devices/system/clocksource/clocksource0/current_clocksource<BR>kvm-clock</P>
<P><B>LINUX&#19979;&#26597;&#30475;&#26102;&#38047;&#20013;&#26029;&#21495;&#21644;&#20869;&#23384;&#21306;&#22495;&#20449;&#24687;</B></P>
<DIV class=monospaced># cat /proc/interrupts<BR>IRQ CPU0 CPU1 CPU2 CPU3<BR>0: 47 0 0 0 IO-APIC-edge timer<BR>1: 23 0 1 0 IO-APIC-edge i8042<BR>6: 0 0 1 2 IO-APIC-edge floppy<BR>7: 0 0 0 0 IO-APIC-edge parport0<BR>8: 1 0 0 0 IO-APIC-edge rtc0 //MC<BR>9: 0 0 0 0 IO-APIC-fasteoi acpi<BR>12: 5 0 2 0 IO-APIC-edge i8042<BR>14: 0 0 0 0 IO-APIC-edge ata_piix<BR>15: 50 24 15 22 IO-APIC-edge ata_piix<BR>17: 252488 172099 243760 171706 IO-APIC-fasteoi ioc0<BR>18: 62772667 0 310289 0 IO-APIC-fasteoi eth0<BR>19: 39873812 0 0 0 IO-APIC-fasteoi eth1</DIV>
<DIV class=monospaced># cat /proc/ioports<BR>0000-0cf7 : PCI Bus 0000:00<BR>0000-001f : dma1<BR>0020-0021 : pic1<BR>0040-0043 : timer0 //8254<BR>0050-0053 : timer1<BR>0060-0060 : keyboard<BR>0064-0064 : keyboard<BR>0070-0071 : rtc0<BR>0080-008f : dma page reg<BR>00a0-00a1 : pic2</DIV>
<P>&#22914;&#19979;&#26159;&#24120;&#29992;&#30828;&#20214;&#26102;&#38047;&#28304;&#65306;</P>
<H3>TSC (time stamp counter)</H3>
<P>rating: 300<BR>counter: 64-bit<BR>&#26159;&#21542;&#26159;&#26102;&#38047;&#20107;&#20214;&#35774;&#22791;&#65306;&#21542;<BR>&#39057;&#29575;: &gt;= 2GHz&#65292;&#30446;&#21069;&#20026;&#27490;&#31934;&#24230;&#26368;&#22909;&#65292;&#20294;&#27809;&#26377;&#20010;&#22909;&#30340;&#21150;&#27861;&#21435;&#25506;&#27979;&#22120;&#39057;&#29575;&#65292;&#21482;&#33021;&#36890;&#36807;PIT&#25110;RTC&#26469;&#20272;&#27979;&#65292;calibrate_tsc&#36890;&#36807;&#32479;&#35745;clock signals&#22312;5&#27627;&#31186;&#20869;&#30340;&#35745;&#25968;&#27979;&#37327;&#39057;&#29575;<BR>&#30465;&#30005;&#27169;&#24335;&#26159;&#21542;&#24433;&#21709;: &#19968;&#20123;&#22788;&#29702;&#22120;&#22312;&#20302;&#30005;&#25346;&#36215;&#29366;&#24577;&#20250;&#20572;&#27490;TSC<BR>&#35775;&#38382;: &#19981;&#20135;&#29983;&#20013;&#26029;&#65292;&#27809;&#26377;counter&#36755;&#20837;&#23492;&#23384;&#22120;&#65292;&#33021;&#22815;&#36890;&#36807;rdtsc&#21482;&#33021;&#35835;&#21462;counter</P>
<H3>HPET (high precision event timer)</H3>
<P>rating:250<BR>counter: 32-bit&#25110;64-bit<BR>&#39057;&#29575;&#65306;&#22266;&#23450;&#36816;&#34892;&#39057;&#29575;14.31818MHz<BR>&#30465;&#30005;&#27169;&#24335;&#26159;&#21542;&#24433;&#21709;: &#36719;&#20214;&#21487;&#20572;&#27490;&#20013;&#22830;counter&#65292;&#36825;&#26679;&#19968;&#26469;&#65292;&#20854;&#38271;&#25928;&#30340;&#26102;&#38388;&#35760;&#24405;&#21151;&#33021;&#23601;&#22833;&#25928;&#20102;<BR>timer: &#25552;&#20379;&#22810;&#20010;timer&#65292;&#27599;&#19968;&#20010;&#20851;&#32852;&#19968;&#20010;&#36229;&#26102;&#23492;&#23384;&#22120;comparator&#65292;&#29992;&#20110;&#21644;&#20013;&#22830;counter&#27604;&#36739;&#65292;&#22914;&#26524;&#30456;&#31561;&#21017;&#35302;&#21457;timer(&#22914;&#26524;&#35774;&#32622;&#36827;&#21435;&#30340;&#26102;&#20505;&#23601;<COUNTER&#65292;&#23601;&#35201;&#31561;&#21040;2^32&#25110;2^64&#27425;&#26041;&#27425;&#35745;&#25968;&#20043;&#21518;&#25165;&#33021;&#35302;&#21457;)&#12290;<BR> &#22914;&#26524;timer&#34987;&#35774;&#32622;&#20026;&#21608;&#26399;&#35302;&#21457;&#65292;HPET&#30828;&#20214;&#20250;&#33258;&#21160;&#21608;&#26399;&#24615;&#27604;&#36739;&#24182;&#35302;&#21457;timer&#12290;<BR>&#22791;&#27880;&#65306;&#22914;&#26524;&#23558;HPET&#35774;&#22791;&#30340;&#20013;&#26029;&#32447;&#36830;&#25509;&#21040;PIT&#21644;CMOS RTC&#20013;&#26029;&#32447;&#36830;&#25509;&#30340;&#22320;&#26041;&#65292;&#23601;&#21487;&#20197;&#26367;&#25442;PIT&#21644;RTC&#20135;&#29983;&#21608;&#26399;&#24615;timer&#30340;&#21151;&#33021;&#12290; &#39057;&#29575;&#19981;&#26159;&#26368;&#24555;&#65292;&#32473;&#20986;&#26368;&#20855;&#20445;&#38556;&#30340;&#21333;&#35843;&#36882;&#22686;&#26102;&#38047;(monotonic time)&#23427;&#26159;&#26368;&#24555;&#30340;&#12290;</COUNTER&#65292;&#23601;&#35201;&#31561;&#21040;2^32&#25110;2^64&#27425;&#26041;&#27425;&#35745;&#25968;&#20043;&#21518;&#25165;&#33021;&#35302;&#21457;)&#12290;<BR></P>
<P>&#20063;&#26159;&#26102;&#38047;&#20107;&#20214;&#35774;&#22791;&#65292;&#20854;rateing&#20026;50&#12290;</P>
<H3>ACPI-PM Timer (advanced configuration and power interface timer)</H3>
<P>rating:200<BR>counter: 24-bit&#65292;&#26080;counter&#36755;&#20837;&#23492;&#23384;&#22120;<BR>&#26159;&#21542;&#26159;&#26102;&#38047;&#20107;&#20214;&#35774;&#22791;&#65306;&#21542;<BR>&#39057;&#29575;&#65306;3.579545MHz<BR>&#30465;&#30005;&#27169;&#24335;&#26159;&#21542;&#24433;&#21709;: &#26080;&#24433;&#21709;<BR>&#20063;&#31216;&#20026;the power management(PM) timer&#25110;PM clock&#25110;the chipset timer&#65292;&#21487;&#32534;&#31243;&#25511;&#21046;&#20351;&#20854;&#22312;&#39640;bit&#20301;&#20540;&#21464;&#21270;&#30340;&#26102;&#20505;&#65292;&#20135;&#29983;&#19968;&#20010;&#20013;&#26029;&#12290;<BR>ACPI&#26102;&#38047;&#30456;&#23545;&#26469;&#35828;&#35835;&#21462;&#27604;&#36739;&#24930;&#65292;&#36890;&#24120;&#38656;&#35201;1-2us(ACPI timer is relatively slow to read, typically 1-2us)</P>
<H3>PIT (programmable interval timer)</H3>
<P>rating:110<BR>counter: 16-bit&#65292;&#26377;counter&#36755;&#20837;&#23492;&#23384;&#22120;<BR>&#26159;&#21542;&#26159;&#26102;&#38047;&#20107;&#20214;&#35774;&#22791;&#65306;&#21542;<BR>&#39057;&#29575;&#65306;3.579545MHz<BR>&#30465;&#30005;&#27169;&#24335;&#26159;&#21542;&#24433;&#21709;: </P>
<P>&#24120;&#35828;&#30340;8253/8254&#65292;&#26368;&#21476;&#32769;&#65292;&#20351;&#29992;&#20102;&#19968;&#20010;1.193182MHz&#30340;&#36755;&#20837;&#25391;&#23376;&#65292;<BR>&#26377;&#19977;&#20010;&#30456;&#21516;&#30340;TIMER&#29992;&#20110;&#36830;&#25509;&#25903;&#25345;&#35745;&#31639;&#26426;&#30340;&#19981;&#21516;&#37096;&#20998;<BR>timer 0 &#20135;&#29983;&#20013;&#26029;&#65292;&#27604;&#36739;&#36866;&#21512;&#29992;&#20110;&#31995;&#32479;&#35745;&#26102;&#22120;<BR>timer 1 &#20256;&#32479;&#19978;&#29992;&#20110;RAM&#21047;&#26032;&#65292;&#36890;&#24120;&#34987;BIOS&#35774;&#32622;15us&#19968;&#27425;&#30340;&#21608;&#26399;<BR>timer 2 &#36830;&#25509;&#21040;PC&#25196;&#22768;&#22120;&#29992;&#20110;&#20135;&#29983;&#35821;&#38899;<BR>&#21487;&#20197;&#36890;&#36807;&#31471;&#21475; 0x40~0x43 &#35775;&#38382; PIT&#12290;<BR>&#31995;&#32479;&#21033;&#29992; PIT &#26469;&#20135;&#29983;&#21608;&#26399;&#24615;&#30340;&#26102;&#38047;&#20013;&#26029;&#65292;&#26102;&#38047;&#20013;&#26029;&#36890;&#36807; 8259A &#30340; IRQ0 &#21521; CPU &#25253;&#21578;&#12290;<BR>&#23427;&#30340;&#31934;&#24230;&#19981;&#39640;&#65292;&#20854;&#20837;&#21475; clock &#30340;&#39057;&#29575;&#20026; 1MHz&#65292;&#29702;&#35770;&#19978;&#33021;&#20135;&#29983;&#30340;&#26368;&#39640;&#26102;&#38047;&#39057;&#29575;&#30053;&#23567;&#20110; 0.5MHz&#12290;<BR>&#23454;&#38469;&#31995;&#32479;&#24448;&#24448;&#20351;&#29992; 100 &#25110;&#32773; 1000Hz &#30340; PIT&#12290;</P>
<H3>RTC (CMOS real time clock)</H3>
<P>rating:LINUX&#19979;&#27809;&#20351;&#29992;&#23427;&#20316;&#20026;clock source<BR>counter: LINUX&#26410;&#20351;&#29992;<BR>&#26159;&#21542;&#26159;&#26102;&#38047;&#20107;&#20214;&#35774;&#22791;&#65306;LINUX&#26410;&#20351;&#29992;<BR>&#39057;&#29575;:<BR>&#22312;&#20027;&#26426;&#25481;&#30005;&#20043;&#21518;&#36824;&#33021;&#20445;&#23384;&#26102;&#38388;&#65292;&#23601;&#26159;&#24120;&#35828;&#30340;CMOS&#26102;&#38047;&#65292;&#20027;&#35201;&#23454;&#34892;&#29256;&#26412;&#26377;Motorola 146818&#65292;&#21487;&#35302;&#21457;IRQ 8&#12290;&#36890;&#36807;0x70&#65292;0x71&#31471;&#21475;&#25805;&#20316;&#12290;<BR>&#21442;&#32771;LINUX&#20869;&#26680;&#65306;mach_get_cmos_time()&#65292;&#21551;&#21160;&#30340;&#26102;&#20505;&#33719;&#21462;&#26085;&#26399;&#26102;&#38388;&#12290;&#34429;&#28982;&#20869;&#26680;&#20063;&#21487;&#20197;&#22312;&#27599;&#27425;&#38656;&#35201;&#30340;&#24471;&#21040;&#24403;&#21069;&#26102;&#38388;&#30340;&#26102;&#20505;&#35835;&#21462; RTC&#65292;&#20294;&#36825;&#26159;&#19968;&#20010; IO &#35843;&#29992;&#65292;&#24615;&#33021;&#20302;&#19979;&#12290;&#23454;&#38469;&#19978;&#65292;&#22312;&#24471;&#21040;&#20102;&#24403;&#21069;&#26102;&#38388;&#21518;&#65292;Linux &#31995;&#32479;&#20250;&#31435;&#21363;&#21551;&#21160; tick &#20013;&#26029;&#12290;&#27492;&#21518;&#65292;&#22312;&#27599;&#27425;&#30340;&#26102;&#38047;&#20013;&#26029;&#22788;&#29702;&#20989;&#25968;&#20869;&#65292;Linux &#26356;&#26032;&#24403;&#21069;&#30340;&#26102;&#38388;&#20540;&#65292;&#24182;&#20445;&#23384;&#22312;&#20840;&#23616;&#21464;&#37327; xtime &#20869;&#12290;&#27604;&#22914;&#26102;&#38047;&#20013;&#26029;&#30340;&#21608;&#26399;&#20026; 10ms&#65292;&#37027;&#20040;&#27599;&#27425;&#20013;&#26029;&#20135;&#29983;&#65292;&#23601;&#23558; xtime &#21152;&#19978; 10ms&#12290;</P>
<P>CMOS RTC&#26159;&#22312;PC&#26029;&#30005;&#21518;&#25345;&#20037;&#20445;&#23384;BIOS&#35774;&#32622;&#30340;&#33258;&#24102;&#21518;&#22791;&#20648;&#30005;&#28304;&#35760;&#24518;&#35774;&#22791;&#20013;&#30340;&#19968;&#37096;&#20998;<BR>&#26377;&#20004;&#20010;&#26102;&#38388;&#30456;&#20851;&#30340;&#29305;&#24449;&#65306;<BR>1. &#25345;&#32493;&#20445;&#23384;&#26085;&#26399;&#26102;&#38388;&#65292;TOD&#26102;&#38047;&#65292;&#26684;&#24335; yy/mm/dd hh:MM:ss<BR>2. &#26377;&#19968;&#20010;TIMER&#21487;&#20197;&#20135;&#29983;&#20197;2&#30340;&#27425;&#26041;&#20540;&#20026;&#21608;&#26399;&#30340;&#26102;&#38047;&#65292;&#21608;&#26399;&#33539;&#22260;2-8192HZ&#20043;&#38388;<BR>&#20849;&#19977;&#20010;&#20013;&#26029;&#65306;<BR><B>update,periodic interrupt</B><BR>&#39057;&#29575;&#33539;&#22260;30.517us to 500ms<BR><B>alarm interrupt</B><BR>once-per-second&#26159;&#27599;&#31186;&#20135;&#29983;&#19968;&#27425;&#20013;&#26029;&#65292;&#20854;&#20027;&#35201;&#29992;&#20110;&#23558;TOD&#26102;&#38047;&#26356;&#26032;&#21040;&#19979;&#19968;&#31186;<BR>&#24403;TOD&#26102;&#38388;&#20026;&#26576;&#19968;&#20540;&#30340;&#26102;&#20505;&#65292;&#35302;&#21457;&#19968;&#27425;&#20013;&#26029;<BR>&#20174;once-per-second&#21040;once-per-day&#30340;&#21608;&#26399;&#20013;&#26029;<BR><B>update-ended interupt</B><BR>end-of-clock update cycle&#65292;&#29992;&#20110;&#36890;&#30693;&#31243;&#24207;&#65292;&#34920;&#26126;&#19968;&#20010;update cycle&#23436;&#25104;</P>
<H4>&#23492;&#23384;&#22120;&#35299;&#37322;</H4>
<P>OSC1,OSC2 - time base, inputs<BR>&#20869;&#37096;&#30340;&#26102;&#38388;&#22522;&#20934;&#39057;&#29575;&#26159;&#22312;REGISTER A&#37324;&#38754;&#36873;&#23450;&#30340;<BR>&#21487;&#20197;&#20135;&#29983;4.194304MHz&#65292;1.048576MHz&#65292;32.768KHz&#30340;&#39057;&#29575;<BR>CKOUT - clock out, output<BR>&#36755;&#20986;&#26102;&#38388;&#22522;&#20934;&#39057;&#29575;&#38500;&#20197;1&#25110;4&#21518;&#30340;&#32467;&#26524;<BR>CKFS - clock out frequency select, input<BR>CKFS&#20026;VDD,CKOUT&#21644;OSC1&#26377;&#21516;&#26679;&#30340;&#39057;&#29575;<BR>CKFS&#20026;VSS,CKOUT&#39057;&#29575;=OSC1&#39057;&#29575;/4<BR>SQW - square wave, output<BR>SQW&#30340;&#39057;&#29575;&#21487;&#20197;&#36890;&#36807;REGISTER A&#20462;&#25913;<BR>SQW&#20449;&#21495;&#21487;&#20197;&#36890;&#36807;REGISTER B&#30340;SQWE&#20301;&#24320;&#20851;<BR>AD0-AD7 - multiplexed bidirectional address/data bus&#65292;&#22810;&#36335;&#22797;&#29992;&#21452;&#21521;&#22320;&#22336;/&#25968;&#25454;&#32447;&#36335;<BR>AS - multiplexed address strobe, input<BR>DS - data strobe(&#38392;&#38376;) or read, input<BR>R/W - read/write, input<BR>R/W&#20026;&#39640;&#30005;&#24179;&#19988;DS&#20026;&#39640;&#30005;&#24179;&#26102;&#65292;&#34920;&#31034; read cycle&#65292;&#21542;&#21017;&#20026;write cycle<BR>IRQ - interrupt request, output<BR>&#29992;&#20110;&#32473;&#22788;&#29702;&#22120;&#27880;&#20837;&#20013;&#26029;&#65292;&#21482;&#26377;&#22312;interrupt-enable bit&#34987;&#35774;&#32622;&#30340;&#26102;&#20505;&#65292;&#25165;&#20250;&#21457;&#20986;&#20013;&#26029;<BR>&#35835;REGISTER C&#25110;&#25805;&#20316;RESET pin&#21487;&#20197;&#28165;&#38500;pending interrupts<BR>&#24403;&#20013;&#26029;&#26465;&#20214;&#26410;&#20986;&#29616;&#65292;IRQ level&#22788;&#20110;&#39640;&#38459;&#25239;&#29366;&#24577;<BR>RESET - reset, input<BR>&#19978;&#30005;&#30340;&#26102;&#20505;&#65292;RESET pin&#38656;&#35201;&#20445;&#25345;&#22312;&#20302;&#30005;&#24179;&#29366;&#24577;&#19968;&#27573;&#26102;&#38388;<BR>&#24403;RESET&#20026;&#20302;&#30005;&#24179;&#29366;&#24577;&#26102;&#65306;<BR>Periodic Interrupt Enable(PIE)&#20301;&#34987;&#32622;0<BR>Alarm Interrupt Enable(AIE)&#20301;&#34987;&#32622;0<BR>Update ended Interrupt Flag(UF)&#20301;&#34987;&#32622;0<BR>Interrupt Request status Flag(IRQF)&#20301;&#34987;&#32622;0<BR>Periodic Interrupt Flag(PF)<BR>Alarm Interrupt Flag(AF)<BR>IRQ pin is &#22788;&#20110;&#39640;&#38459;&#25239;&#29366;&#24577;&#65292;&#24182;&#19988;Square Wave output Enable(SQWE)&#20301;&#34987;&#32622;0<BR>STBY - Stand-by<BR>&#38459;&#27490;&#35775;&#38382;MC146818A&#65292;&#35753;&#23427;&#25104;&#20026;&#26368;&#20339;&#22791;&#20221;&#30005;&#28304;<BR>&#22312;DS&#19979;&#38477;&#27839;&#65292;STBY&#20449;&#21495;&#24320;&#21551;&#65292;AS&#19978;&#21319;&#27839;&#20851;&#38381;<BR>&#21487;&#24320;&#20851;&#25152;&#26377;&#26469;&#33258;BUS&#30340;&#36755;&#20837;(R/W,DS,AS,AD0-AD7)&#65292;&#36890;&#36807;&#20943;&#23569;&#20869;&#37096;&#36716;&#25442;&#27425;&#25968;&#26469;&#20943;&#23569;&#32791;&#30005;</P>
<P>PS - Power Sense, input<BR>&#29992;&#20110;&#25511;&#21046;RAM&#26159;&#21542;&#26377;&#25928;&#21644;&#25511;&#21046;REGISTER D&#20013;&#30340;VRT&#20301;</P>
<P>MC146818A&#23492;&#23384;&#22120;&#22320;&#22336;&#22270;</P>
<DIV class=monospaced>----------------------+--------------<BR>0 Seconds |<BR>1 Seconds Alarm |<BR>2 Minutes | Binary<BR>3 Minutes Alarm | or<BR>4 Hours | BCD Contents<BR>5 Hours Alarm |<BR>6 Day of Week |<BR>7 Date of Month |<BR>8 Month |<BR>9 Year |<BR>----------------------+--------------<BR>10 Register A |<BR>11 Register B |<BR>12 Register C |<BR>13 Register D |<BR>----------------------+--------------<BR>. |<BR>. | 50 Bytes<BR>. | User RAM<BR>63 |<BR>----------------------+--------------</DIV>
<P>&#20854;&#20013;50 Bytes User RAM&#19981;&#26159;&#32473;MC146818A&#29992;&#30340;&#65292;&#32780;&#26159;&#32473;&#22788;&#29702;&#22120;&#31243;&#24207;&#29992;&#30340;</P>
<DIV class=monospaced>+-----+-----+-----+-----+-----+-----+-----+-----+<BR>| 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |<BR>REG A --&gt; | UIP | DV2 | DV1 | DV0 | RS3 | RS2 | RS1 | RS0 |<BR>REG B --&gt; | SET | PIE | AIE | UIE | SQWE| DM |24/12| DES |<BR>REG C --&gt; |IRQF | PF | AF | UF | 0 | 0 | 0 | 0 |<BR>REG D --&gt; | VRT | 0 | 0 | 0 | 0 | 0 | 0 | 0 |<BR>+-----+-----+-----+-----+-----+-----+-----+-----+</DIV>
<P>REG A&#37324;&#30340;DV2&#65292;DV1&#65292;DV0&#65292;&#20854;&#20540;&#24433;&#21709;&#65306;</P>
<DIV class=monospaced>+------------+-------+-------+-------+------+<BR>| time-base | Register A |&#22788;&#20110;&#25805;|<BR>| frequency | DV2 | DV1 | DV0 |&#20316;&#27169;&#24335;|<BR>+------------+-------+-------+-------+------+<BR>|4.194304 MHz| 0 | 0 | 0 | YES |<BR>|1.048576 MHz| 0 | 0 | 1 | YES |<BR>|32.768 kHz| 0 | 1 | 0 | YES |<BR>|Any | 1 | 1 | 0 | NO |<BR>|Any | 1 | 1 | 1 | NO |<BR>+------------+-------+-------+-------+------+</DIV>
<P>update cycle timers</P>
<DIV class=monospaced>+-----+------------+------------------+--------------------+<BR>| UIP | Time Base | Update Cycle Time|Minumum Time Before |<BR>| Bit | (OSC1) | (tUC) |Update Cycle(tBUC) |<BR>+-----+------------+------------------+--------------------+<BR>| 1 |4.194304 MHz| 248 us | - |<BR>| 1 |1.048576 MHz| 248 us | - |<BR>| 1 |32.768 kHz| 1984 us | - |<BR>| 0 |4.194304 MHz| - | 244us |<BR>| 0 |1.048576 MHz| - | 244us |<BR>| 0 |32.768 kHz| - | 244us |<BR>+-----+------------+------------------+--------------------+</DIV>
<P>&#38500;&#19978;&#36848;&#24120;&#29992;&#30828;&#20214;&#26102;&#38047;&#28304;&#22806;&#65292;&#36824;&#26377;&#36719;&#20214;&#26102;&#38047;&#28304;&#65292;&#27604;&#22914;kvm-clock&#65292;&#20854;&#23454;&#29616;&#21407;&#29702;&#26159;guest&#30452;&#25509;&#35835;&#21462;&#30001;host&#26356;&#26032;&#30340;&#25968;&#25454;&#32467;&#26500;&#65292;&#26080;&#38656;vm exit&#65292;&#25928;&#30410;&#26368;&#22909;&#12290;&#36824;&#26377;&#26368;&#22522;&#26412;&#30340;jiffies&#36719;&#20214;&#26102;&#38047;&#28304;&#65292;&#19981;&#25512;&#33616;&#12290;</P>
<TABLE cellSpacing=0 cellPadding=0 border=1>
<TBODY>
<TR>
<TD vAlign=top width=108></TD>
<TD vAlign=top width=107><STRONG>&#26102;&#38047;&#28304;&#35774;&#22791;rating</STRONG> </TD>
<TD vAlign=top width=104><STRONG>&#26102;&#38047;&#20107;&#20214;&#35774;&#22791;rating</STRONG> </TD>
<TD vAlign=top width=76><STRONG>&#36719;&#30828;&#26102;&#38047;&#28304;</STRONG> </TD>
<TD vAlign=top width=82><STRONG>counter</STRONG> </TD>
<TD vAlign=top width=91><STRONG>&#39057;&#29575;</STRONG> </TD></TR>
<TR>
<TD vAlign=top width=108><STRONG>kvm-clock/xen</STRONG> </TD>
<TD vAlign=top width=107>400 </TD>
<TD vAlign=top width=104></TD>
<TD vAlign=top width=76>&#36719; </TD>
<TD vAlign=top width=82></TD>
<TD vAlign=top width=91></TD></TR>
<TR>
<TD vAlign=top width=108><STRONG>TSC</STRONG> </TD>
<TD vAlign=top width=107>300 </TD>
<TD vAlign=top width=104></TD>
<TD vAlign=top width=76>&#30828;</TD>
<TD vAlign=top width=82>64-bit </TD>
<TD vAlign=top width=91>&gt;= 2GHz </TD></TR>
<TR>
<TD vAlign=top width=108><STRONG>HPET</STRONG> </TD>
<TD vAlign=top width=107>250 </TD>
<TD vAlign=top width=104>50 </TD>
<TD vAlign=top width=76>&#30828; </TD>
<TD vAlign=top width=82>32-bit&#25110;64-bit</TD>
<TD vAlign=top width=91>14.31818MHz</TD></TR>
<TR>
<TD vAlign=top width=108><STRONG>ACPI PM-Timer</STRONG> </TD>
<TD vAlign=top width=107>200 </TD>
<TD vAlign=top width=104></TD>
<TD vAlign=top width=76>&#30828; </TD>
<TD vAlign=top width=82>24-bit </TD>
<TD vAlign=top width=91>3.579545MHz </TD></TR>
<TR>
<TD vAlign=top width=108><STRONG>PIT</STRONG> </TD>
<TD vAlign=top width=107>110 </TD>
<TD vAlign=top width=104></TD>
<TD vAlign=top width=76>&#30828; </TD>
<TD vAlign=top width=82>16-bit </TD>
<TD vAlign=top width=91>1.193182MHz </TD></TR>
<TR>
<TD vAlign=top width=108><STRONG>LAPIC</STRONG> </TD>
<TD vAlign=top width=107></TD>
<TD vAlign=top width=104>100 </TD>
<TD vAlign=top width=76>&#30828; </TD>
<TD vAlign=top width=82>32-bit </TD>
<TD vAlign=top width=91></TD></TR>
<TR>
<TD vAlign=top width=108><STRONG>RTC</STRONG> </TD>
<TD vAlign=top width=107></TD>
<TD vAlign=top width=104></TD>
<TD vAlign=top width=76>&#30828; </TD>
<TD vAlign=top width=82></TD>
<TD vAlign=top width=91></TD></TR>
<TR>
<TD vAlign=top width=108><STRONG>JIFFIES</STRONG> </TD>
<TD vAlign=top width=107>1 </TD>
<TD vAlign=top width=104></TD>
<TD vAlign=top width=76>&#36719; </TD>
<TD vAlign=top width=82></TD>
<TD vAlign=top width=91></TD></TR></TBODY></TABLE>
<P><A name=table-clock-source>Table 1&#26102;&#38047;&#28304;&#65292;&#26102;&#38047;&#20107;&#20214;&#21015;&#34920;</A></P>
<H2>&#21442;&#32771;&#36164;&#26009;</H2>
<OL class=decimal>
<LI>Interrupt In Linux &#8211; ZX_WING(xing5820@163.com) </LI>
<LI>&#27973;&#26512; Linux &#20013;&#30340;&#26102;&#38388;&#32534;&#31243;&#21644;&#23454;&#29616;&#21407;&#29702;<BR><A href="http://www.uml.org.cn/embeded/201308211.asp" target=_blank>http://www.uml.org.cn/embeded/201308211.asp</A></LI>
<LI>Linux &#26102;&#38047;&#31649;&#29702;<BR><A href="http://www.ibm.com/developerworks/cn/linux/l-cn-timerm/index.html" target=_blank>http://www.ibm.com/developerworks/cn/linux/l-cn-timerm/index.html</A></LI>
<LI>Real Time Clock (RTC) Drivers for Linux<BR><A href="https://www.kernel.org/doc/Documentation/rtc.txt" target=_blank>https://www.kernel.org/doc/Documentation/rtc.txt</A></LI>
<LI>Advanced Programmable Interrupt Controller<BR><A href="http://linux.linti.unlp.edu.ar/images/e/ec/ULK3-CAPITULO6-UNNOBA.pdf" target=_blank>http://linux.linti.unlp.edu.ar/images/e/ec/ULK3-CAPITULO6-UNNOBA.pdf</A></LI>
<LI>Chapter 6. Timing Measurements<BR><A href="http://www.osdever.net/tutorials/pdf/apic.pdf" target=_blank>http://www.osdever.net/tutorials/pdf/apic.pdf</A></LI>
<LI>Understanding The Linux Kernel - Chapter 6. Timing Measurements<BR><A href="http://repo.popoliito.tk/Linux/Kernel-land/Understanding%20The%20Linux%20Kernel/index.html?page=0596005652/understandlk-CHP-6-SECT-1.html" target=_blank>http://repo.popoliito.tk/Linux/Kernel-land/Understanding%20The%20Linux%20Kernel/index.html?page=0596005652/understandlk-CHP-6-SECT-1.html</A></LI>
<LI>Chapter 6. Timing Measurements<BR><A href="http://linux.linti.unlp.edu.ar/images/e/ec/ULK3-CAPITULO6-UNNOBA.pdf" target=_blank>http://linux.linti.unlp.edu.ar/images/e/ec/ULK3-CAPITULO6-UNNOBA.pdf</A></LI>
<LI>Timekeeping in VMware Virtual Machines<BR><A href="http://www.vmware.com/files/pdf/techpaper/Timekeeping-In-VirtualMachines.pdf" target=_blank>http://www.vmware.com/files/pdf/techpaper/Timekeeping-In-VirtualMachines.pdf</A></LI></OL>
<P><A href="http://mnstory.net/wp-content/uploads/2014/03/clock-device-intro/clock-device-intro.pdf" target=_bank>PDF&#19979;&#36733;</A></P></DIV>