<H3 id=-100000 class=docSection1Title>Looking at the Sources</H3>
<P class=docText><A name="In the"></A>In the kernel tree, the <SPAN class=docEmphasis>drivers/mtd/</SPAN><A name="the sources"></A> directory contains the sources for the MTD layer. Map, chip, and NAND drivers live in the <SPAN class=docEmphasis>drivers/mtd/maps/</SPAN>, <SPAN class=docEmphasis>drivers/mtd/chips/</SPAN>, and <A name=iddle1045></A><A name=iddle1104></A><A name=iddle1409></A><A name=iddle1839></A><A name=iddle1996></A><A name=iddle1997></A><A name=iddle2896></A><A name=iddle3084></A><A name=iddle3089></A><A name=iddle3116></A><A name=iddle3118></A><A name=iddle3180></A><A name=iddle4004></A><A name=iddle4096></A><SPAN class=docEmphasis>drivers/mtd/nand/</SPAN><A name="are defined"></A> subdirectories, respectively. Most MTD data structures are defined in header files present in <SPAN class=docEmphasis>include/linux/mtd/</SPAN>.</P>
<P class=docText><A name="unsupported BIOS"></A>To access an unsupported BIOS firmware hub from Linux, implement a driver using <SPAN class=docEmphasis>drivers/mtd/maps/ichxrom.c</SPAN> as your starting point.</P>
<P class=docText><A name="look at"></A>For examples of operating on NAND OOB data from user space, look at <SPAN class=docEmphasis>nanddump.c</SPAN> and <SPAN class=docEmphasis>nandwrite.c</SPAN> in the MTD-utils package.</P>
<P class=docText><A class=docLink href="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/ch17lev1sec12.html#ch17tab01">Table 17.1</A><A name="structures used"></A> contains the main data structures used in this chapter and their location in the source tree. <A class=docLink href="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/ch17lev1sec12.html#ch17tab02">Table 17.2</A><A name="you used"></A> lists the main kernel programming interfaces that you used in this chapter along with the location of their definitions.</P><A name=ch17tab01></A>
<P>
<TABLE cellSpacing=0 cellPadding=4 rules=rows frame=hsides>
<CAPTION>
<H5 class=docTableTitle>Table 17.1. Summary of Data Structures</H5></CAPTION>
<COLGROUP span=3 align=left>
<COL width=125>
<COL width=175>
<COL width=250></COLGROUP>
<THEAD>
<TR>
<TH class="docTableCell thead" style="TEXT-ALIGN: left" vAlign=top scope=col align=left>Data Structure</TH>
<TH class="docTableCell thead" style="TEXT-ALIGN: left" vAlign=top scope=col align=left>Location</TH>
<TH class="docTableCell thead" style="TEXT-ALIGN: left" vAlign=top scope=col align=left>Description</TH></TR></THEAD>
<TBODY>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>mtd_partition</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>include/linux/mtd/partitions.h</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Representation of a flash chip's partition layout.</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>map_info</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>include/linux/mtd/map.h</SPAN></TD>
<TD class=docTableCell vAlign=top align=left><A name="map driver"></A>Low-level access routines implemented by the map driver are passed to the chip driver using this structure.</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>mtd_info</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>include/linux/mtd/mtd.h</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>General device-specific information.</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>erase_info, erase_info_user</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>include/linux/mtd/mtd.h, include/mtd/mtd-abi.h</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Structures used for flash erase management.</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>cfi_private</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>include/linux/mtd/cfi.h</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Device-specific information maintained by NOR chip drivers.</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>amd_flash_info</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>drivers/mtd/chips/jedec_probe.c</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Device-specific information supplied to the JEDEC chip driver.</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>nand_ecclayout</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>include/mtd/mtd-abi.h</SPAN></TD>
<TD class=docTableCell vAlign=top align=left><A name="NAND chip"></A>Layout of the OOB spare area of a NAND chip.</TD></TR></TBODY></TABLE></P><BR><A name=ch17tab02></A>
<P>
<TABLE cellSpacing=0 cellPadding=4 rules=rows frame=hsides>
<CAPTION>
<H5 class=docTableTitle>Table 17.2. Summary of Kernel Programming Interfaces</H5></CAPTION>
<COLGROUP span=3 align=left>
<COL width=162>
<COL width=175>
<COL width=215></COLGROUP>
<THEAD>
<TR>
<TH class="docTableCell thead" style="TEXT-ALIGN: left" vAlign=top scope=col align=left>Kernel Interface</TH>
<TH class="docTableCell thead" style="TEXT-ALIGN: left" vAlign=top scope=col align=left>Location</TH>
<TH class="docTableCell thead" style="TEXT-ALIGN: left" vAlign=top scope=col align=left>Description</TH></TR></THEAD>
<TBODY>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>simple_map_init()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>drivers/mtd/maps/map_funcs.c</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Initializes a <TT>map_info</TT> structure with generic flash access methods</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>do_map_probe()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>drivers/mtd/chips/chipreg.c</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Probes the NOR flash via a chip driver</TD></TR>
<TR>
<TD class=docTableCell vAlign=top align=left><TT>add_mtd_partitions()</TT></TD>
<TD class=docTableCell vAlign=top align=left><SPAN class=docEmphasis>drivers/mtd/mtdpart.c</SPAN></TD>
<TD class=docTableCell vAlign=top align=left>Registers an <TT>mtd_partition</TT> structure with the MTD core</TD></TR></TBODY></TABLE>