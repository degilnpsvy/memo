<H3 id=-100000 class=docSection1Title>Configuring MTD</H3>
<P class=docText><A name="To MTD"></A>To MTD-enable your kernel, you have to choose the appropriate configuration options. For the flash chip shown in <A class=docLink href="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/ch17lev1sec3.html#ch17fig02">Figure 17.2</A><A name="options are"></A>, the required options are as follows:</P>
<DIV class=docText><PRE>CONFIG_MTD=y                <IMG alt="rightwards double arrow" src="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/images/U2192.GIF"> Enable the MTD subsystem
CONFIG_MTD_PARTITIONS=y     <IMG alt="rightwards double arrow" src="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/images/U2192.GIF"> Support for multiple partitions
CONFIG_MTD_GEN_PROBE=y      <IMG alt="rightwards double arrow" src="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/images/U2192.GIF"> Common routines for chip probing
CONFIG_MTD_CFI=y            <IMG alt="rightwards double arrow" src="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/images/U2192.GIF"> Enable CFI chip driver
CONFIG_MTD_PDA_MAP=y        <IMG alt="rightwards double arrow" src="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/images/U2192.GIF"> Option to enable the map driver
CONFIG_JFFS2_FS=y           <IMG alt="rightwards double arrow" src="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/images/U2192.GIF"> Enable JFFS2</PRE></DIV><BR>
<P class=docText><TT>CONFIG_MTD_PDA_MAP</TT><A name="a new"></A> is assumed to be a new option added to enable the map driver we previously wrote. Each of these features can also be built as a kernel module unless you have an MTD-resident root filesystem. To mount the filesystem partition in <A class=docLink href="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/ch17lev1sec3.html#ch17fig02">Figure 17.2</A><A name="device during"></A> as the root device during boot, ask your bootloader to append <TT>root=/dev/mtdblock/2</TT> to the command-line string that it passes to the kernel.</P>
<P class=docText><A name="example handheld"></A>You may reduce kernel footprint by eliminating redundant probing. Because our example handheld has two parallel 16-bit banks sitting on a 32-bit physical bus (thus <A name=iddle1350></A><A name=iddle2030></A><A name=iddle2077></A><A name=iddle2120></A><A name=iddle2121></A><A name=iddle2858></A><A name=iddle2861></A><A name=iddle3087></A><A name=iddle3115></A><A name=iddle4668></A><A name="and a"></A>resulting in a two-way interleave and a 2-byte bank width), you can optimize using these additional options:</P>
<DIV class=docText><PRE>CONFIG_MTD_CFI_ADV_OPTIONS=y
CONFIG_MTD_CFI_GEOMETRY=y
CONFIG_MTD_MAP_BANK_WIDTH_2=y
CONFIG_MTD_CFI_I2=y</PRE></DIV><BR>
<P class=docText><TT>CONFIG_MTD_MAP_BANK_WIDTH_2</TT> enables a CFI bus width of 2, and <TT>CONFIG_MTD_CFI_I2</TT> sets an interleave of 2.