<P class=MsoNormal style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" align=left><SPAN lang=EN-US style="FONT-SIZE: 11pt; FONT-FAMILY: TheSansMonoCondensed-SemiLight; mso-bidi-font-size: 8.0pt; mso-bidi-font-family: TheSansMonoCondensed-SemiLight; mso-font-kerning: 0pt"><FONT face=Calibri>void local_irq_save(unsigned long flags);</FONT></SPAN></P>
<P class=MsoNormal style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" align=left><SPAN lang=EN-US style="FONT-SIZE: 11pt; FONT-FAMILY: TheSansMonoCondensed-SemiLight; mso-bidi-font-size: 8.0pt; mso-bidi-font-family: TheSansMonoCondensed-SemiLight; mso-font-kerning: 0pt"><FONT face=Calibri>void local_irq_disable(void);</FONT></SPAN></P>
<P class=MsoNormal style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" align=left><FONT face=Calibri><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka; mso-font-kerning: 0pt">A call to </SPAN><I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka-Italic; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka-Italic; mso-font-kerning: 0pt">local_irq_save </SPAN></I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka; mso-font-kerning: 0pt">disables interrupt delivery on the current processor after saving the current interrupt state into </SPAN><SPAN lang=EN-US style="FONT-SIZE: 12pt; FONT-FAMILY: TheSansMonoCondensed-SemiLight; mso-bidi-font-size: 9.0pt; mso-bidi-font-family: TheSansMonoCondensed-SemiLight; mso-font-kerning: 0pt">flags</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka; mso-font-kerning: 0pt">. Note that </SPAN><SPAN lang=EN-US style="FONT-SIZE: 12pt; FONT-FAMILY: TheSansMonoCondensed-SemiLight; mso-bidi-font-size: 9.0pt; mso-bidi-font-family: TheSansMonoCondensed-SemiLight; mso-font-kerning: 0pt">flags </SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka; mso-font-kerning: 0pt">is passed directly, not by pointer. </SPAN><I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka-Italic; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka-Italic; mso-font-kerning: 0pt">local_irq_disable </SPAN></I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka; mso-font-kerning: 0pt">shuts off local interrupt delivery without saving the state; you should use this version only if you know that interrupts have not already been disabled elsewhere.</SPAN></FONT></P>
<P class=MsoNormal style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" align=left><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka; mso-font-kerning: 0pt"><FONT face=Calibri>Turning interrupts back on is accomplished with:</FONT></SPAN></P>
<P class=MsoNormal style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" align=left><SPAN lang=EN-US style="FONT-SIZE: 11pt; FONT-FAMILY: TheSansMonoCondensed-SemiLight; mso-bidi-font-size: 8.0pt; mso-bidi-font-family: TheSansMonoCondensed-SemiLight; mso-font-kerning: 0pt"><FONT face=Calibri>void local_irq_restore(unsigned long flags);</FONT></SPAN></P>
<P class=MsoNormal style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" align=left><SPAN lang=EN-US style="FONT-SIZE: 11pt; FONT-FAMILY: TheSansMonoCondensed-SemiLight; mso-bidi-font-size: 8.0pt; mso-bidi-font-family: TheSansMonoCondensed-SemiLight; mso-font-kerning: 0pt"><FONT face=Calibri>void local_irq_enable(void);</FONT></SPAN></P>
<P class=MsoNormal style="TEXT-ALIGN: left; MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none" align=left><FONT face=Calibri><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka; mso-font-kerning: 0pt">The first version restores that state which was stored into </SPAN><SPAN lang=EN-US style="FONT-SIZE: 12pt; FONT-FAMILY: TheSansMonoCondensed-SemiLight; mso-bidi-font-size: 9.0pt; mso-bidi-font-family: TheSansMonoCondensed-SemiLight; mso-font-kerning: 0pt">flags </SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka; mso-font-kerning: 0pt">by </SPAN><I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka-Italic; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka-Italic; mso-font-kerning: 0pt">local_irq_save</SPAN></I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka; mso-font-kerning: 0pt">, while </SPAN><I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka-Italic; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka-Italic; mso-font-kerning: 0pt">local_irq_enable </SPAN></I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka; mso-font-kerning: 0pt">enables interrupts unconditionally. Unlike </SPAN><I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka-Italic; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka-Italic; mso-font-kerning: 0pt">disable_irq</SPAN></I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka; mso-font-kerning: 0pt">, </SPAN><I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka-Italic; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka-Italic; mso-font-kerning: 0pt">local_irq_disable </SPAN></I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka; mso-font-kerning: 0pt">does not keep track of multiple calls. If more than one function in the call chain might need to disable interrupts, </SPAN><I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka-Italic; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka-Italic; mso-font-kerning: 0pt">local_irq_save </SPAN></I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka; mso-font-kerning: 0pt">should be used. In the 2.6 kernel, there is no way to disable all interrupts globally across the entire system. The kernel developers have decided that the cost of shutting off all interrupts is too high and that there is no need for that capability in any case. If you are working with an older driver that makes calls to functions such as </SPAN><I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka-Italic; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka-Italic; mso-font-kerning: 0pt">cli </SPAN></I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka; mso-font-kerning: 0pt">and </SPAN><I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka-Italic; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka-Italic; mso-font-kerning: 0pt">sti</SPAN></I><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka; mso-font-kerning: 0pt">, you need to update it to use proper locking before it will work under 2.6.</SPAN></FONT></P><FONT face=Calibri><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: Birka; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: Birka; mso-font-kerning: 0pt"><PRE><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#84" name=84>84</A><SPAN class=c>/*
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#85" name=85>85</A> * The local_irq_*() APIs are equal to the raw_local_irq*()
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#86" name=86>86</A> * if !TRACE_IRQFLAGS.
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#87" name=87>87</A> */</SPAN>
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#88" name=88>88</A>#<B>ifdef</B> <A href="http://172.29.26.110:8080/source/s?defs=CONFIG_TRACE_IRQFLAGS&amp;project=Linux-v4.6">CONFIG_TRACE_IRQFLAGS</A>
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#89" name=89>89</A>#<B>define</B> <A class=xm name=local_irq_enable></A><A class=xm href="http://172.29.26.110:8080/source/s?refs=local_irq_enable&amp;project=Linux-v4.6">local_irq_enable</A>() \
<A class=hl href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#90" name=90>90</A>	<B>do</B> { <A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#trace_hardirqs_on">trace_hardirqs_on</A>(); <A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#raw_local_irq_enable">raw_local_irq_enable</A>(); } <B>while</B> (0)
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#91" name=91>91</A>#<B>define</B> <A class=xm name=local_irq_disable></A><A class=xm href="http://172.29.26.110:8080/source/s?refs=local_irq_disable&amp;project=Linux-v4.6">local_irq_disable</A>() \
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#92" name=92>92</A>	<B>do</B> { <A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#raw_local_irq_disable">raw_local_irq_disable</A>(); <A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#trace_hardirqs_off">trace_hardirqs_off</A>(); } <B>while</B> (0)
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#93" name=93>93</A>#<B>define</B> <A class=xm name=local_irq_save></A><A class=xm href="http://172.29.26.110:8080/source/s?refs=local_irq_save&amp;project=Linux-v4.6">local_irq_save</A>(<A href="http://172.29.26.110:8080/source/s?defs=flags&amp;project=Linux-v4.6">flags</A>)				\
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#94" name=94>94</A>	<B>do</B> {						\
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#95" name=95>95</A>		<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#raw_local_irq_save">raw_local_irq_save</A>(<A href="http://172.29.26.110:8080/source/s?defs=flags&amp;project=Linux-v4.6">flags</A>);		\
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#96" name=96>96</A>		<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#trace_hardirqs_off">trace_hardirqs_off</A>();			\
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#97" name=97>97</A>	} <B>while</B> (0)
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#98" name=98>98</A>
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#99" name=99>99</A>
<A class=hl href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#100" name=100>100</A>#<B>define</B> <A class=xm name=local_irq_restore></A><A class=xm href="http://172.29.26.110:8080/source/s?refs=local_irq_restore&amp;project=Linux-v4.6">local_irq_restore</A>(<A href="http://172.29.26.110:8080/source/s?defs=flags&amp;project=Linux-v4.6">flags</A>)			\
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#101" name=101>101</A>	<B>do</B> {						\
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#102" name=102>102</A>		<B>if</B> (<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#raw_irqs_disabled_flags">raw_irqs_disabled_flags</A>(<A href="http://172.29.26.110:8080/source/s?defs=flags&amp;project=Linux-v4.6">flags</A>)) {	\
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#103" name=103>103</A>			<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#raw_local_irq_restore">raw_local_irq_restore</A>(<A href="http://172.29.26.110:8080/source/s?defs=flags&amp;project=Linux-v4.6">flags</A>);	\
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#104" name=104>104</A>			<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#trace_hardirqs_off">trace_hardirqs_off</A>();		\
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#105" name=105>105</A>		} <B>else</B> {				\
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#106" name=106>106</A>			<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#trace_hardirqs_on">trace_hardirqs_on</A>();		\
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#107" name=107>107</A>			<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#raw_local_irq_restore">raw_local_irq_restore</A>(<A href="http://172.29.26.110:8080/source/s?defs=flags&amp;project=Linux-v4.6">flags</A>);	\
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#108" name=108>108</A>		}					\
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#109" name=109>109</A>	} <B>while</B> (0)</PRE><PRE><PRE><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#56" name=56>56</A><SPAN class=c>/*
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#57" name=57>57</A> * Wrap the arch provided IRQ routines to provide appropriate checks.
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#58" name=58>58</A> */</SPAN>
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#59" name=59>59</A>#<B>define</B> <A class=xm name=raw_local_irq_disable></A><A class=xm href="http://172.29.26.110:8080/source/s?refs=raw_local_irq_disable&amp;project=Linux-v4.6">raw_local_irq_disable</A>()		<A href="http://172.29.26.110:8080/source/s?defs=arch_local_irq_disable&amp;project=Linux-v4.6">arch_local_irq_disable</A>()
<A class=hl href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#60" name=60>60</A>#<B>define</B> <A class=xm name=raw_local_irq_enable></A><A class=xm href="http://172.29.26.110:8080/source/s?refs=raw_local_irq_enable&amp;project=Linux-v4.6">raw_local_irq_enable</A>()		<A href="http://172.29.26.110:8080/source/s?defs=arch_local_irq_enable&amp;project=Linux-v4.6">arch_local_irq_enable</A>()
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#61" name=61>61</A>#<B>define</B> <A class=xm name=raw_local_irq_save></A><A class=xm href="http://172.29.26.110:8080/source/s?refs=raw_local_irq_save&amp;project=Linux-v4.6">raw_local_irq_save</A>(<A href="http://172.29.26.110:8080/source/s?defs=flags&amp;project=Linux-v4.6">flags</A>)			\
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#62" name=62>62</A>	<B>do</B> {						\
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#63" name=63>63</A>		<A href="http://172.29.26.110:8080/source/s?defs=typecheck&amp;project=Linux-v4.6">typecheck</A>(<B>unsigned</B> <B>long</B>, <A href="http://172.29.26.110:8080/source/s?defs=flags&amp;project=Linux-v4.6">flags</A>);	\
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#64" name=64>64</A>		<A href="http://172.29.26.110:8080/source/s?defs=flags&amp;project=Linux-v4.6">flags</A> = <A href="http://172.29.26.110:8080/source/s?defs=arch_local_irq_save&amp;project=Linux-v4.6">arch_local_irq_save</A>();		\
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#65" name=65>65</A>	} <B>while</B> (0)
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#66" name=66>66</A>#<B>define</B> <A class=xm name=raw_local_irq_restore></A><A class=xm href="http://172.29.26.110:8080/source/s?refs=raw_local_irq_restore&amp;project=Linux-v4.6">raw_local_irq_restore</A>(<A href="http://172.29.26.110:8080/source/s?defs=flags&amp;project=Linux-v4.6">flags</A>)			\
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#67" name=67>67</A>	<B>do</B> {						\
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#68" name=68>68</A>		<A href="http://172.29.26.110:8080/source/s?defs=typecheck&amp;project=Linux-v4.6">typecheck</A>(<B>unsigned</B> <B>long</B>, <A href="http://172.29.26.110:8080/source/s?defs=flags&amp;project=Linux-v4.6">flags</A>);	\
<A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#69" name=69>69</A>		<A href="http://172.29.26.110:8080/source/s?defs=arch_local_irq_restore&amp;project=Linux-v4.6">arch_local_irq_restore</A>(<A href="http://172.29.26.110:8080/source/s?defs=flags&amp;project=Linux-v4.6">flags</A>);		\
<A class=hl href="http://172.29.26.110:8080/source/xref/Linux-v4.6/include/linux/irqflags.h#70" name=70>70</A>	} <B>while</B> (0)</PRE><PRE>&nbsp;</PRE><PRE>&nbsp;</PRE></PRE></SPAN></FONT>