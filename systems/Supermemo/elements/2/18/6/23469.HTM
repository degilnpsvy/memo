<B><SPAN lang=EN-US style='FONT-SIZE: 24pt; FONT-FAMILY: "Futura-Bold","sans-serif"; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: DogmaBold; mso-bidi-font-family: Futura-Bold; mso-font-kerning: 0pt'>49.1 Overview</SPAN></B> 
<P></P>
<P><FONT class=extract><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-fareast-font-family: DogmaBold; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>The </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-fareast-font-family: DogmaBold; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>mmap() </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-fareast-font-family: DogmaBold; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>system call creates a new </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-fareast-font-family: DogmaBold; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>memory mapping </SPAN></FONT><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-fareast-font-family: DogmaBold; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'><FONT class=extract>in the calling process&#8217;s virtual address space.</FONT> <FONT class=extract>A mapping can be of two types:</FONT></SPAN></P>
<P><FONT class=extract><SPAN lang=EN-US style="FONT-SIZE: 12pt; FONT-FAMILY: Wingdings; mso-bidi-font-size: 6.0pt; mso-fareast-font-family: DogmaBold; mso-bidi-font-family: Wingdings; mso-font-kerning: 0pt">&#56256;&#56442; </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-fareast-font-family: DogmaBold; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>File mapping</SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-fareast-font-family: DogmaBold; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>: A file mapping maps a region of a file directly into the calling process&#8217;s virtual memory. Once a file is mapped, its contents can be accessed by operations on the bytes in the corresponding memory region. The pages of the mapping are (automatically) loaded from the file as required. This type of mapping is also known as a </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-fareast-font-family: DogmaBold; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>file-based mapping </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-fareast-font-family: DogmaBold; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>or </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-fareast-font-family: DogmaBold; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>memory-mapped file</SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-fareast-font-family: DogmaBold; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>. </SPAN></FONT></P>
<P><FONT class=extract><SPAN lang=EN-US style="FONT-SIZE: 12pt; FONT-FAMILY: Wingdings; mso-bidi-font-size: 6.0pt; mso-fareast-font-family: DogmaBold; mso-bidi-font-family: Wingdings; mso-font-kerning: 0pt">&#56256;&#56442; </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-fareast-font-family: DogmaBold; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>Anonymous mapping</SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-fareast-font-family: DogmaBold; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>: An anonymous mapping doesn&#8217;t have a corresponding file. Instead, the pages of the mapping are initialized to 0.</SPAN></FONT></P>
<P><SPAN lang=EN-US style='FONT-SIZE: 16pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 9.0pt; mso-fareast-font-family: DogmaBold; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'><FONT class=extract>Another way of thinking of an anonymous mapping (and one is that is close to the truth) is that it is a mapping of a virtual file whose contents are always initialized with zeros.</FONT></SPAN></P>
<P><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'><FONT class=extract>The memory in one process&#8217;s mapping may be shared with mappings in other processes (i.e., the page-table entries of each process point to the same pages of RAM).</FONT></SPAN></P>
<P><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'><FONT class=extract>This can occur in two ways:</FONT></SPAN></P>
<P><FONT class=extract><SPAN lang=EN-US style="FONT-SIZE: 12pt; FONT-FAMILY: Wingdings; mso-bidi-font-size: 6.0pt; mso-bidi-font-family: Wingdings; mso-font-kerning: 0pt">&#56256;&#56442; </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>When two processes map the same region of a file, they share the same pages of physical memory.</SPAN></FONT></P>
<P><FONT class=extract><SPAN lang=EN-US style="FONT-SIZE: 12pt; FONT-FAMILY: Wingdings; mso-bidi-font-size: 6.0pt; mso-bidi-font-family: Wingdings; mso-font-kerning: 0pt">&#56256;&#56442; </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>A child process created by </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>fork() </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>inherits copies of its parent&#8217;s mappings, and these mappings refer to the same pages of physical memory as the corresponding mappings in the parent.</SPAN></FONT></P>
<P><FONT class=extract><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>When two or more processes share the same pages, each process can potentially see the changes to the page contents made by other processes, depending on whether the mapping is </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>private </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>or </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>shared</SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>:</SPAN></FONT></P>
<P><FONT class=extract><SPAN lang=EN-US style="FONT-SIZE: 12pt; FONT-FAMILY: Wingdings; mso-bidi-font-size: 6.0pt; mso-bidi-font-family: Wingdings; mso-font-kerning: 0pt">&#56256;&#56442; </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>Private mapping </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>(</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: TheSansMonoCondensed-Plain; mso-bidi-font-size: 8.5pt; mso-bidi-font-family: TheSansMonoCondensed-Plain; mso-font-kerning: 0pt; mso-hansi-font-family: NewBaskervilleEF-Roman"><FONT face=Calibri>MAP_PRIVATE</FONT></SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>): Modifications to the contents of the mapping are not visible to other processes and, for a file mapping, are not carried through to the underlying file. Although the pages of a private mapping are initially shared in the circumstances described above, changes to the contents of the mapping are nevertheless private to each process. The kernel accomplishes this using the copy-on-write technique (Section 24.2.2). This means that whenever a process attempts to modify the contents of a page, the kernel first creates a new, separate copy of that page for the process (and adjusts the process&#8217;s page tables). For this reason, a </SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: TheSansMonoCondensed-Plain; mso-bidi-font-size: 8.5pt; mso-bidi-font-family: TheSansMonoCondensed-Plain; mso-font-kerning: 0pt; mso-hansi-font-family: NewBaskervilleEF-Roman"><FONT face=Calibri>MAP_PRIVATE </FONT></SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>mapping is sometimes referred to as a </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>private, copy-on-write mapping</SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>.</SPAN></FONT></P>
<P><FONT class=extract><SPAN lang=EN-US style="FONT-SIZE: 12pt; FONT-FAMILY: Wingdings; mso-bidi-font-size: 6.0pt; mso-bidi-font-family: Wingdings; mso-font-kerning: 0pt">&#56256;&#56442; </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>Shared mapping </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>(</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: TheSansMonoCondensed-Plain; mso-bidi-font-size: 8.5pt; mso-bidi-font-family: TheSansMonoCondensed-Plain; mso-font-kerning: 0pt; mso-hansi-font-family: NewBaskervilleEF-Roman"><FONT face=Calibri>MAP_SHARED</FONT></SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>): Modifications to the contents of the mapping are visible to other processes that share the same mapping and, for a file mapping, are carried through to the underlying file.</SPAN></FONT></P>
<P><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'><FONT class=extract>The two mapping attributes described above (file versus anonymous and private versus shared) can be combined in four different ways, as summarized in Table 49-1.</FONT></SPAN></P>
<P><FONT class=extract><B><SPAN lang=EN-US style='FONT-SIZE: 16pt; FONT-FAMILY: "Futura-Heavy","sans-serif"; mso-bidi-font-size: 9.0pt; mso-bidi-font-family: Futura-Heavy; mso-font-kerning: 0pt'>Table 49-1: </SPAN></B><SPAN lang=EN-US style='FONT-SIZE: 16pt; FONT-FAMILY: "Futura-Book","sans-serif"; mso-bidi-font-size: 9.0pt; mso-bidi-font-family: Futura-Book; mso-font-kerning: 0pt'>Purposes of various types of memory mappings</SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'></SPAN></FONT></P>
<DIV align=center>
<TABLE class=MsoNormalTable style="BORDER-TOP: medium none; BORDER-RIGHT: medium none; BORDER-COLLAPSE: collapse; BORDER-BOTTOM: medium none; BORDER-LEFT: medium none; mso-border-alt: solid windowtext .5pt; mso-yfti-tbllook: 1184; mso-padding-alt: 0cm 5.4pt 0cm 5.4pt; mso-border-insideh: .5pt solid windowtext; mso-border-insidev: .5pt solid windowtext" cellSpacing=0 cellPadding=0 border=1>
<TBODY>
<TR style="mso-yfti-irow: 0; mso-yfti-firstrow: yes">
<TD style="BORDER-TOP: windowtext 1pt solid; BORDER-RIGHT: windowtext 1pt solid; BORDER-BOTTOM: windowtext 1pt solid; PADDING-BOTTOM: 0cm; PADDING-TOP: 0cm; PADDING-LEFT: 5.4pt; BORDER-LEFT: windowtext 1pt solid; PADDING-RIGHT: 5.4pt; BACKGROUND-COLOR: transparent; mso-border-alt: solid windowtext .5pt" vAlign=top rowSpan=2>
<P><FONT class=extract><B><SPAN lang=EN-US style='FONT-SIZE: 16pt; FONT-FAMILY: "NewBaskervilleEF-Bold","sans-serif"; mso-bidi-font-size: 9.0pt; mso-bidi-font-family: NewBaskervilleEF-Bold; mso-font-kerning: 0pt'>Visibility of modifications</SPAN></B><SPAN lang=EN-US style="FONT-SIZE: 16.5pt; mso-bidi-font-size: 11.0pt"></SPAN></FONT></P></TD>
<TD style="BORDER-TOP: windowtext 1pt solid; BORDER-RIGHT: windowtext 1pt solid; BORDER-BOTTOM: windowtext 1pt solid; PADDING-BOTTOM: 0cm; PADDING-TOP: 0cm; PADDING-LEFT: 5.4pt; BORDER-LEFT: #f0f0f0; PADDING-RIGHT: 5.4pt; BACKGROUND-COLOR: transparent; mso-border-alt: solid windowtext .5pt; mso-border-left-alt: solid windowtext .5pt" vAlign=top colSpan=2>
<P><FONT class=extract><B><SPAN lang=EN-US style='FONT-SIZE: 16pt; FONT-FAMILY: "NewBaskervilleEF-Bold","sans-serif"; mso-bidi-font-size: 9.0pt; mso-bidi-font-family: NewBaskervilleEF-Bold; mso-font-kerning: 0pt'>Mapping type</SPAN></B><SPAN lang=EN-US style="FONT-SIZE: 16.5pt; mso-bidi-font-size: 11.0pt"></SPAN></FONT></P></TD></TR>
<TR style="mso-yfti-irow: 1">
<TD style="BORDER-TOP: #f0f0f0; BORDER-RIGHT: windowtext 1pt solid; BORDER-BOTTOM: windowtext 1pt solid; PADDING-BOTTOM: 0cm; PADDING-TOP: 0cm; PADDING-LEFT: 5.4pt; BORDER-LEFT: #f0f0f0; PADDING-RIGHT: 5.4pt; BACKGROUND-COLOR: transparent; mso-border-alt: solid windowtext .5pt; mso-border-left-alt: solid windowtext .5pt; mso-border-top-alt: solid windowtext .5pt" vAlign=top>
<P><FONT class=extract><B><SPAN lang=EN-US style='FONT-SIZE: 16pt; FONT-FAMILY: "NewBaskervilleEF-Bold","sans-serif"; mso-bidi-font-size: 9.0pt; mso-bidi-font-family: NewBaskervilleEF-Bold; mso-font-kerning: 0pt'>File</SPAN></B><SPAN lang=EN-US style="FONT-SIZE: 16.5pt; mso-bidi-font-size: 11.0pt"></SPAN></FONT></P></TD>
<TD style="BORDER-TOP: #f0f0f0; BORDER-RIGHT: windowtext 1pt solid; BORDER-BOTTOM: windowtext 1pt solid; PADDING-BOTTOM: 0cm; PADDING-TOP: 0cm; PADDING-LEFT: 5.4pt; BORDER-LEFT: #f0f0f0; PADDING-RIGHT: 5.4pt; BACKGROUND-COLOR: transparent; mso-border-alt: solid windowtext .5pt; mso-border-left-alt: solid windowtext .5pt; mso-border-top-alt: solid windowtext .5pt" vAlign=top>
<P><FONT class=extract><B><SPAN lang=EN-US style='FONT-SIZE: 16pt; FONT-FAMILY: "NewBaskervilleEF-Bold","sans-serif"; mso-bidi-font-size: 9.0pt; mso-bidi-font-family: NewBaskervilleEF-Bold; mso-font-kerning: 0pt'>Anonymous</SPAN></B><SPAN lang=EN-US style="FONT-SIZE: 16.5pt; mso-bidi-font-size: 11.0pt"></SPAN></FONT></P></TD></TR>
<TR style="mso-yfti-irow: 2">
<TD style="BORDER-TOP: #f0f0f0; BORDER-RIGHT: windowtext 1pt solid; BORDER-BOTTOM: windowtext 1pt solid; PADDING-BOTTOM: 0cm; PADDING-TOP: 0cm; PADDING-LEFT: 5.4pt; BORDER-LEFT: windowtext 1pt solid; PADDING-RIGHT: 5.4pt; BACKGROUND-COLOR: transparent; mso-border-alt: solid windowtext .5pt; mso-border-top-alt: solid windowtext .5pt" vAlign=top>
<P><FONT class=extract><B><SPAN lang=EN-US style='FONT-SIZE: 16pt; FONT-FAMILY: "NewBaskervilleEF-Bold","sans-serif"; mso-bidi-font-size: 9.0pt; mso-bidi-font-family: NewBaskervilleEF-Bold; mso-font-kerning: 0pt'>Private</SPAN></B><SPAN lang=EN-US style="FONT-SIZE: 16.5pt; mso-bidi-font-size: 11.0pt"></SPAN></FONT></P></TD>
<TD style="BORDER-TOP: #f0f0f0; BORDER-RIGHT: windowtext 1pt solid; BORDER-BOTTOM: windowtext 1pt solid; PADDING-BOTTOM: 0cm; PADDING-TOP: 0cm; PADDING-LEFT: 5.4pt; BORDER-LEFT: #f0f0f0; PADDING-RIGHT: 5.4pt; BACKGROUND-COLOR: transparent; mso-border-alt: solid windowtext .5pt; mso-border-left-alt: solid windowtext .5pt; mso-border-top-alt: solid windowtext .5pt" vAlign=top>
<P><FONT class=extract><SPAN lang=EN-US style='FONT-SIZE: 16pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 9.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>Initializing memory from contents of file</SPAN><SPAN lang=EN-US style="FONT-SIZE: 16.5pt; mso-bidi-font-size: 11.0pt"></SPAN></FONT></P></TD>
<TD style="BORDER-TOP: #f0f0f0; BORDER-RIGHT: windowtext 1pt solid; BORDER-BOTTOM: windowtext 1pt solid; PADDING-BOTTOM: 0cm; PADDING-TOP: 0cm; PADDING-LEFT: 5.4pt; BORDER-LEFT: #f0f0f0; PADDING-RIGHT: 5.4pt; BACKGROUND-COLOR: transparent; mso-border-alt: solid windowtext .5pt; mso-border-left-alt: solid windowtext .5pt; mso-border-top-alt: solid windowtext .5pt" vAlign=top>
<P><FONT class=extract><SPAN lang=EN-US style='FONT-SIZE: 16pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 9.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>Memory allocation</SPAN><SPAN lang=EN-US style="FONT-SIZE: 16.5pt; mso-bidi-font-size: 11.0pt"></SPAN></FONT></P></TD></TR>
<TR style="mso-yfti-irow: 3; mso-yfti-lastrow: yes">
<TD style="BORDER-TOP: #f0f0f0; BORDER-RIGHT: windowtext 1pt solid; BORDER-BOTTOM: windowtext 1pt solid; PADDING-BOTTOM: 0cm; PADDING-TOP: 0cm; PADDING-LEFT: 5.4pt; BORDER-LEFT: windowtext 1pt solid; PADDING-RIGHT: 5.4pt; BACKGROUND-COLOR: transparent; mso-border-alt: solid windowtext .5pt; mso-border-top-alt: solid windowtext .5pt" vAlign=top>
<P><FONT class=extract><B><SPAN lang=EN-US style='FONT-SIZE: 16pt; FONT-FAMILY: "NewBaskervilleEF-Bold","sans-serif"; mso-bidi-font-size: 9.0pt; mso-bidi-font-family: NewBaskervilleEF-Bold; mso-font-kerning: 0pt'>Shared</SPAN></B><SPAN lang=EN-US style="FONT-SIZE: 16.5pt; mso-bidi-font-size: 11.0pt"></SPAN></FONT></P></TD>
<TD style="BORDER-TOP: #f0f0f0; BORDER-RIGHT: windowtext 1pt solid; BORDER-BOTTOM: windowtext 1pt solid; PADDING-BOTTOM: 0cm; PADDING-TOP: 0cm; PADDING-LEFT: 5.4pt; BORDER-LEFT: #f0f0f0; PADDING-RIGHT: 5.4pt; BACKGROUND-COLOR: transparent; mso-border-alt: solid windowtext .5pt; mso-border-left-alt: solid windowtext .5pt; mso-border-top-alt: solid windowtext .5pt" vAlign=top>
<P><FONT class=extract><SPAN lang=EN-US style='FONT-SIZE: 16pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 9.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>Memory-mapped I/O; sharing memory between processes (IPC)</SPAN><SPAN lang=EN-US style="FONT-SIZE: 16.5pt; mso-bidi-font-size: 11.0pt"></SPAN></FONT></P></TD>
<TD style="BORDER-TOP: #f0f0f0; BORDER-RIGHT: windowtext 1pt solid; BORDER-BOTTOM: windowtext 1pt solid; PADDING-BOTTOM: 0cm; PADDING-TOP: 0cm; PADDING-LEFT: 5.4pt; BORDER-LEFT: #f0f0f0; PADDING-RIGHT: 5.4pt; BACKGROUND-COLOR: transparent; mso-border-alt: solid windowtext .5pt; mso-border-left-alt: solid windowtext .5pt; mso-border-top-alt: solid windowtext .5pt" vAlign=top>
<P><SPAN lang=EN-US style='FONT-SIZE: 16pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 9.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'><FONT class=extract>Sharing memory between</FONT></SPAN></P>
<P><FONT class=extract><SPAN lang=EN-US style='FONT-SIZE: 16pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 9.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>processes (IPC)</SPAN><SPAN lang=EN-US style="FONT-SIZE: 16.5pt; mso-bidi-font-size: 11.0pt"></SPAN></FONT></P></TD></TR></TBODY></TABLE></DIV>
<P><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'><FONT class=extract>The four different types of memory mappings are created and used as follows:</FONT></SPAN></P>
<P><FONT class=extract><SPAN lang=EN-US style="FONT-SIZE: 12pt; FONT-FAMILY: Wingdings; mso-bidi-font-size: 6.0pt; mso-bidi-font-family: Wingdings; mso-font-kerning: 0pt">&#56256;&#56442; </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>Private file mapping</SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>: The contents of the mapping are initialized from a file region. Multiple processes mapping the same file initially share the same physical pages of memory, but the copy-on-write technique is employed, so that changes to the mapping by one process are invisible to other processes. The main use of this type of mapping is to initialize a region of memory from the contents of a file. Some common examples are initializing a process&#8217;s text and initialized data segments from the corresponding parts of a binary executable file or a shared library file.</SPAN></FONT></P>
<P><FONT class=extract><SPAN lang=EN-US style="FONT-SIZE: 12pt; FONT-FAMILY: Wingdings; mso-bidi-font-size: 6.0pt; mso-bidi-font-family: Wingdings; mso-font-kerning: 0pt">&#56256;&#56442; </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>Private anonymous mapping</SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>: Each call to </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>mmap() </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>to create a private anonymous mapping yields a new mapping that is distinct from (i.e., does not share physical pages with) other anonymous mappings created by the same (or a different) process. Although a child process inherits its parent&#8217;s mappings, copy-on-write semantics ensure that, after the </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>fork()</SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>, the parent and child don&#8217;t see changes made to the mapping by the other process. The primary purpose of private anonymous mappings is to allocate new (zero-filled) memory for a process (e.g., </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>malloc() </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>employs </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>mmap() </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>for this purpose when allocating large blocks of memory).</SPAN></FONT></P>
<P><FONT class=extract><SPAN lang=EN-US style="FONT-SIZE: 12pt; FONT-FAMILY: Wingdings; mso-bidi-font-size: 6.0pt; mso-bidi-font-family: Wingdings; mso-font-kerning: 0pt">&#56256;&#56442; </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>Shared file mapping</SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>: All processes mapping the same region of a file share the same physical pages of memory, which are initialized from a file region. Modifications to the contents of the mapping are carried through to the file. This type of mapping serves two purposes. First, it permits </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>memory-mapped I/O</SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>. By this, we mean that a file is loaded into a region of the process&#8217;s virtual memory, and modifications to that memory are automatically written to the file. Thus, memory-mapped I/O provides an alternative to using </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>read() </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>and </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>write() </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>for performing file I/O. A second purpose of this type of mapping is to allow unrelated processes to share a region of memory in order to perform (fast) IPC in a manner similar to System V shared memory segments (Chapter 48).</SPAN></FONT></P>
<P><FONT class=extract><SPAN lang=EN-US style="FONT-SIZE: 12pt; FONT-FAMILY: Wingdings; mso-bidi-font-size: 6.0pt; mso-bidi-font-family: Wingdings; mso-font-kerning: 0pt">&#56256;&#56442; </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>Shared anonymous mapping</SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>: As with a private anonymous mapping, each call to </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>mmap() </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>to create a shared anonymous mapping creates a new, distinct mapping that doesn&#8217;t share pages with any other mapping. The difference is that the pages of the mapping are not copied-on-write. This means that when a child inherits the mapping after a </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>fork()</SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>, the parent and child share the same pages of RAM, and changes made to the contents of the mapping by one process are visible to the other process. Shared anonymous mappings allow IPC in a manner similar to System V shared memory segments, but only between related processes.</SPAN></FONT></P>
<P><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>We consider each of these types of mapping in more detail in the remainder of this chapter.</SPAN></P>
<P><FONT class=extract><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>Mappings are lost when a process performs an </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>exec()</SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>, but are inherited by the child of a </SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>fork()</SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>. The mapping type (</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: TheSansMonoCondensed-Plain; mso-bidi-font-size: 8.5pt; mso-bidi-font-family: TheSansMonoCondensed-Plain; mso-font-kerning: 0pt; mso-hansi-font-family: NewBaskervilleEF-Roman"><FONT face=Calibri>MAP_PRIVATE </FONT></SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>or </SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: TheSansMonoCondensed-Plain; mso-bidi-font-size: 8.5pt; mso-bidi-font-family: TheSansMonoCondensed-Plain; mso-font-kerning: 0pt; mso-hansi-font-family: NewBaskervilleEF-Roman"><FONT face=Calibri>MAP_SHARED</FONT></SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>) is also inherited.</SPAN></FONT></P>
<P><FONT class=extract><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>Information about all of a process&#8217;s mappings is visible in the Linux-specific </SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: TheSansMonoCondensed-Plain; mso-bidi-font-size: 8.5pt; mso-bidi-font-family: TheSansMonoCondensed-Plain; mso-font-kerning: 0pt; mso-hansi-font-family: NewBaskervilleEF-Roman"><FONT face=Calibri>/proc/</FONT></SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>PID</SPAN><SPAN lang=EN-US style="FONT-SIZE: 14pt; FONT-FAMILY: TheSansMonoCondensed-Plain; mso-bidi-font-size: 8.5pt; mso-bidi-font-family: TheSansMonoCondensed-Plain; mso-font-kerning: 0pt; mso-hansi-font-family: NewBaskervilleEF-Roman"><FONT face=Calibri>/maps </FONT></SPAN><SPAN lang=EN-US style='FONT-SIZE: 18pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 10.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>file, which we described in Section 48.5.</SPAN></FONT></P>
<P><FONT class=extract><SPAN lang=EN-US style='FONT-SIZE: 16pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 9.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>One further use of </SPAN><SPAN lang=EN-US style='FONT-SIZE: 16pt; FONT-FAMILY: "NewBaskervilleEF-RomanIta","sans-serif"; mso-bidi-font-size: 9.0pt; mso-bidi-font-family: NewBaskervilleEF-RomanIta; mso-font-kerning: 0pt'>mmap() </SPAN><SPAN lang=EN-US style='FONT-SIZE: 16pt; FONT-FAMILY: "NewBaskervilleEF-Roman","sans-serif"; mso-bidi-font-size: 9.0pt; mso-bidi-font-family: NewBaskervilleEF-Roman; mso-font-kerning: 0pt'>is with POSIX shared memory objects, which allow a region of memory to be shared between unrelated processes without having to create an associated disk file (as is required for a shared file mapping). We describe POSIX shared memory objects in Chapter 54.</SPAN></FONT>