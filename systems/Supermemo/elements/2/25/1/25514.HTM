/**<BR>&nbsp;* platform_get_irq - get an IRQ for a device<BR>&nbsp;* @dev: platform device<BR>&nbsp;* @num: IRQ number index<BR>&nbsp;*/<BR>int platform_get_irq(struct platform_device *dev, unsigned int num)<BR>{<BR>#ifdef CONFIG_SPARC<BR>&nbsp;/* sparc does not have irqs represented as IORESOURCE_IRQ resources */<BR>&nbsp;if (!dev || num &gt;= dev-&gt;archdata.num_irqs)<BR>&nbsp;&nbsp;return -ENXIO;<BR>&nbsp;return dev-&gt;archdata.irqs[num];<BR>#else<BR>&nbsp;struct resource *r;<BR>&nbsp;if (IS_ENABLED(CONFIG_OF_IRQ) &amp;&amp; dev-&gt;dev.of_node) {<BR>&nbsp;&nbsp;int ret;
<P></P>
<P>&nbsp;&nbsp;ret = of_irq_get(dev-&gt;dev.of_node, num);<BR>&nbsp;&nbsp;if (ret &gt;= 0 || ret == -EPROBE_DEFER)<BR>&nbsp;&nbsp;&nbsp;return ret;<BR>&nbsp;}</P>
<P>&nbsp;r = platform_get_resource(dev, IORESOURCE_IRQ, num);<BR>&nbsp;/*<BR>&nbsp; * The resources may pass trigger flags to the irqs that need<BR>&nbsp; * to be set up. It so happens that the trigger flags for<BR>&nbsp; * IORESOURCE_BITS correspond 1-to-1 to the IRQF_TRIGGER*<BR>&nbsp; * settings.<BR>&nbsp; */<BR>&nbsp;if (r &amp;&amp; r-&gt;flags &amp; IORESOURCE_BITS)<BR>&nbsp;&nbsp;irqd_set_trigger_type(irq_get_irq_data(r-&gt;start),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r-&gt;flags &amp; IORESOURCE_BITS);</P>
<P>&nbsp;return r ? r-&gt;start : -ENXIO;<BR>#endif<BR>}<BR>EXPORT_SYMBOL_GPL(platform_get_irq);