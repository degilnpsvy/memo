# Build modules<BR>#<BR># A module can be listed more than once in obj-m resulting in<BR># duplicate lines in modules.order files.&nbsp; Those are removed<BR># using awk while concatenating to the final file.
<P></P>
<P>PHONY += modules<BR>modules: $(vmlinux-dirs) $(if $(KBUILD_BUILTIN),vmlinux) modules.builtin<BR>&nbsp;$(Q)$(AWK) '!x[$$0]++' $(vmlinux-dirs:%=$(objtree)/%/modules.order) &gt; $(objtree)/modules.order<BR>&nbsp;@$(kecho) '&nbsp; Building modules, stage 2.';<BR>&nbsp;$(Q)$(MAKE) -f $(srctree)/scripts/Makefile.modpost<BR>&nbsp;$(Q)$(MAKE) -f $(srctree)/scripts/Makefile.fwinst obj=firmware __fw_modbuild</P>
<P>modules.builtin: $(vmlinux-dirs:%=%/modules.builtin)<BR>&nbsp;$(Q)$(AWK) '!x[$$0]++' $^ &gt; $(objtree)/modules.builtin</P>
<P>%/modules.builtin: include/config/auto.conf<BR>&nbsp;$(Q)$(MAKE) $(modbuiltin)=$*