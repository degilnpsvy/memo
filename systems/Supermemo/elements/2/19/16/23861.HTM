<P class=docText>The following utilities are available to manipulate modules: <SPAN class=docEmphasis>insmod</SPAN>, <SPAN class=docEmphasis>rmmod</SPAN>, <SPAN class=docEmphasis>lsmod, modprobe</SPAN>, <SPAN class=docEmphasis>modinfo</SPAN>, and <SPAN class=docEmphasis>depmod.</SPAN><A name="whereas lsmod"></A> The first two are utilities to insert and remove modules, whereas lsmod lists the modules that are currently loaded. modprobe is a cleverer version of insmod that also inserts dependent modules after examining the contents of <SPAN class=docEmphasis>/lib/modules/X.Y.Z/modules.dep.</SPAN><A name="mount a"></A> For example, assume that you need to mount a <SPAN class=docEmphasis>Virtual File Allocation Table</SPAN><A name="to load"></A> (VFAT) partition present on a USB pen drive. Use modprobe to load the VFAT filesystem driver:<SUP class=docFootnote><A class=docLink href="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/ch01lev1sec8.html#ch01fn02">[2]</A></SUP></P>
<BLOCKQUOTE>
<P class=docFootnote><SUP><A name=ch01fn02>[2]</A></SUP><A name="example assumes"></A> This example assumes that the module is not autoloaded by the kernel. <FONT class=extract>If you enable <SPAN class=docEmphasis>Automatic Kernel Module Loading</SPAN> (<TT>CONFIG_KMOD</TT></FONT><A name="when it"></A><FONT class=extract>) during configuration, the kernel automatically runs modprobe with the appropriate arguments when it detects missing subsystems. You'll learn about module autoloading in </FONT><A class=docLink href="http://www.embeddedlinux.org.cn/EssentialLinuxDeviceDrivers/final/ch04.html#ch04"><FONT class=extract>Chapter 4</FONT></A><A name="the Groundwork"></A><FONT class=extract>, "Laying the Groundwork."</FONT></P></BLOCKQUOTE>
<DIV class=docText><PRE><SPAN class=docEmphStrong>bash&gt; modprobe vfat</SPAN>
<SPAN class=docEmphStrong>bash&gt; lsmod</SPAN>
Module       Size     Used by
vfat         14208    0
fat          49052    1 vfat
nls_base     9728     2 vfat, fat</PRE></DIV><BR>
<P class=docText><A name=iddle3029></A><A name="see in"></A>As you see in the lsmod output, modprobe inserts three modules rather than one. modprobe first figures out that it has to insert <SPAN class=docEmphasis>/lib/modules/X.Y.Z/kernel/fs/vfat/vfat.ko.</SPAN><A name="when it"></A> But when it peeks into the dependency file <SPAN class=docEmphasis>/lib/modules/X.Y.Z/modules.dep</SPAN><A name="has to"></A>, it finds the following line and realizes that it has to load two other dependent modules first:</P>
<DIV class=docText><PRE>/lib/modules/X.Y.Z/kernel/fs/vfat/vfat.ko:
/lib/modules/X.Y.Z/kernel/fs/fat/fat.ko
/lib/modules/X.Y.Z/kernel/fs/nls/nls_base.ko</PRE></DIV><BR>
<P class=docText>It then proceeds to load <SPAN class=docEmphasis>fat.ko</SPAN> and <SPAN class=docEmphasis>nls_base.ko</SPAN> before attempting to insert <SPAN class=docEmphasis>vfat.ko</SPAN><A name="modules you"></A>, thus automatically loading all the modules you need to mount your VFAT partition.