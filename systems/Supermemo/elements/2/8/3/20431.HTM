<H3 style="BORDER-BOTTOM-STYLE: none; PADDING-BOTTOM: 0px; LINE-HEIGHT: 1.6; MARGIN: 0.3em 0px 0px; BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: black; FONT-SIZE: 1.17em; OVERFLOW: hidden; FONT-WEIGHT: bold; PADDING-TOP: 0.5em"><SPAN id=Mount_preparations class=mw-headline>Mount preparations</SPAN><SPAN style="LINE-HEIGHT: 1em; DISPLAY: inline-block; FONT-FAMILY: sans-serif; WHITE-SPACE: nowrap; MARGIN-LEFT: 1em; FONT-SIZE: small; VERTICAL-ALIGN: baseline; FONT-WEIGHT: normal; -webkit-user-select: none" class=mw-editsection><SPAN style="COLOR: rgb(85,85,85); MARGIN-LEFT: 0px; MARGIN-RIGHT: 0px" class=mw-editsection-bracket>[</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title="Edit section: Mount preparations" href="http://en.wikipedia.org/w/index.php?title=Initrd&amp;action=edit&amp;section=3">edit</A><SPAN style="COLOR: rgb(85,85,85); MARGIN-LEFT: 0px; MARGIN-RIGHT: 0px" class=mw-editsection-bracket>]</SPAN></SPAN></H3>
<P style="MARGIN: 0.5em 0px">Some Linux distributions such as<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title=Debian href="http://en.wikipedia.org/wiki/Debian">Debian</A><SPAN class=Apple-converted-space>&nbsp;</SPAN>will generate a customized initrd image which contains only whatever is necessary to boot some particular computer, such as<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" class=mw-redirect title="Advanced Technology Attachment" href="http://en.wikipedia.org/wiki/Advanced_Technology_Attachment">ATA</A>,<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title=SCSI href="http://en.wikipedia.org/wiki/SCSI">SCSI</A><SPAN class=Apple-converted-space>&nbsp;</SPAN>and filesystem<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title="Loadable kernel module" href="http://en.wikipedia.org/wiki/Loadable_kernel_module">kernel modules</A>. These typically embed the location and type of the root file system.</P>
<P style="MARGIN: 0.5em 0px">Other Linux distributions (such as<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title="Fedora (operating system)" href="http://en.wikipedia.org/wiki/Fedora_(operating_system)">Fedora</A><SPAN class=Apple-converted-space>&nbsp;</SPAN>and<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title="Ubuntu (operating system)" href="http://en.wikipedia.org/wiki/Ubuntu_(operating_system)">Ubuntu</A>) generate a more generic initrd image. These start only with the device name of the root file system (or its<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title="Universally unique identifier" href="http://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</A>) and must discover everything else at boot time. In this case, the software must perform a complex cascade of tasks to get the root file system mounted:</P>
<UL style="PADDING-BOTTOM: 0px; LINE-HEIGHT: 1.6; LIST-STYLE-TYPE: disc; MARGIN: 0.3em 0px 0px 1.6em; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; LIST-STYLE-IMAGE: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAANAQMAAABb8jbLAAAABlBMVEX///8AUow5QSOjAAAAAXRSTlMAQObYZgAAABNJREFUCB1jYEABBQw/wLCAgQEAGpIDyT0IVcsAAAAASUVORK5CYII=); PADDING-TOP: 0px">
<LI style="MARGIN-BOTTOM: 0.1em">Any hardware drivers that the boot process depends on must be loaded. A common arrangement is to pack kernel modules for common storage devices onto the initrd and then invoke a<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" class=mw-redirect title=Hotplug href="http://en.wikipedia.org/wiki/Hotplug">hotplug</A><SPAN class=Apple-converted-space>&nbsp;</SPAN>agent to pull in modules matching the computer's detected hardware. 
<LI style="MARGIN-BOTTOM: 0.1em">On systems which display a boot<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title="Splash screen" href="http://en.wikipedia.org/wiki/Splash_screen">splash screen</A>, the video hardware must be initialized and a user-space helper started to paint animations onto the display in lockstep with the boot process. 
<LI style="MARGIN-BOTTOM: 0.1em">If the root file system is on NFS, it must then: 
<UL style="PADDING-BOTTOM: 0px; LINE-HEIGHT: 1.6; LIST-STYLE-TYPE: disc; MARGIN: 0.3em 0px 0px 1.6em; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; LIST-STYLE-IMAGE: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAANAQMAAABb8jbLAAAABlBMVEX///8AUow5QSOjAAAAAXRSTlMAQObYZgAAABNJREFUCB1jYEABBQw/wLCAgQEAGpIDyT0IVcsAAAAASUVORK5CYII=); PADDING-TOP: 0px">
<LI style="MARGIN-BOTTOM: 0.1em">Bring up the primary<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" class=mw-redirect title="Network card" href="http://en.wikipedia.org/wiki/Network_card">network interface</A>. 
<LI style="MARGIN-BOTTOM: 0.1em">Invoke a<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title="Dynamic Host Configuration Protocol" href="http://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol">DHCP</A><SPAN class=Apple-converted-space>&nbsp;</SPAN>client, with which it can obtain a DHCP lease. 
<LI style="MARGIN-BOTTOM: 0.1em">Extract the name of the NFS share and the address of the NFS server from the lease. 
<LI style="MARGIN-BOTTOM: 0.1em">Mount the NFS share.</LI></UL>
<LI style="MARGIN-BOTTOM: 0.1em">If the root file system appears to be on a software RAID device, there is no way of knowing which devices the RAID volume spans; the standard<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title=Mdadm href="http://en.wikipedia.org/wiki/Mdadm">MD utilities</A><SPAN class=Apple-converted-space>&nbsp;</SPAN>must be invoked to scan all available block devices and bring the required ones online. 
<LI style="MARGIN-BOTTOM: 0.1em">If the root file system appears to be on a<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" class=mw-redirect title="Logical volume" href="http://en.wikipedia.org/wiki/Logical_volume">logical volume</A>, the LVM utilities must be invoked to scan for and activate the<A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title="Volume group" href="http://en.wikipedia.org/wiki/Volume_group">volume group</A><SPAN class=Apple-converted-space>&nbsp;</SPAN>containing it. 
<LI style="MARGIN-BOTTOM: 0.1em">If the root file system is on an encrypted block device: 
<UL style="PADDING-BOTTOM: 0px; LINE-HEIGHT: 1.6; LIST-STYLE-TYPE: disc; MARGIN: 0.3em 0px 0px 1.6em; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; LIST-STYLE-IMAGE: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAANAQMAAABb8jbLAAAABlBMVEX///8AUow5QSOjAAAAAXRSTlMAQObYZgAAABNJREFUCB1jYEABBQw/wLCAgQEAGpIDyT0IVcsAAAAASUVORK5CYII=); PADDING-TOP: 0px">
<LI style="MARGIN-BOTTOM: 0.1em">Invoke a helper script to prompt the user to type in a passphrase and/or insert a hardware token (such as a<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title="Smart card" href="http://en.wikipedia.org/wiki/Smart_card">smart card</A>or a USB security<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title=Dongle href="http://en.wikipedia.org/wiki/Dongle">dongle</A>). 
<LI style="MARGIN-BOTTOM: 0.1em">Create a decryption target with the<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title="Device mapper" href="http://en.wikipedia.org/wiki/Device_mapper">device mapper</A>.</LI></UL></LI></UL>
<P style="MARGIN: 0.5em 0px">Some distributions use an<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title="Event-driven architecture" href="http://en.wikipedia.org/wiki/Event-driven_architecture">event-driven</A><SPAN class=Apple-converted-space>&nbsp;</SPAN>hotplug agent such as<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title=Udev href="http://en.wikipedia.org/wiki/Udev">udev</A>, which invokes helper programs as hardware devices, disk partitions and storage volumes matching certain rules come online. This allows discovery to run in parallel, and to progressively cascade into arbitrary nestings of LVM, RAID or encryption to get at the root file system.</P>
<P style="MARGIN: 0.5em 0px">When the root file system finally becomes visible:</P>
<UL style="PADDING-BOTTOM: 0px; LINE-HEIGHT: 1.6; LIST-STYLE-TYPE: disc; MARGIN: 0.3em 0px 0px 1.6em; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; LIST-STYLE-IMAGE: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAANAQMAAABb8jbLAAAABlBMVEX///8AUow5QSOjAAAAAXRSTlMAQObYZgAAABNJREFUCB1jYEABBQw/wLCAgQEAGpIDyT0IVcsAAAAASUVORK5CYII=); PADDING-TOP: 0px">
<LI style="MARGIN-BOTTOM: 0.1em">Any maintenance tasks which cannot run on a mounted root file system are done. 
<LI style="MARGIN-BOTTOM: 0.1em">The root file system is mounted read-only. 
<LI style="MARGIN-BOTTOM: 0.1em">Any processes which must continue running (such as the splash screen helper and its command<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title="Named pipe" href="http://en.wikipedia.org/wiki/Named_pipe">FIFO</A>) are hoisted into the newly mounted root file system.</LI></UL>
<P style="MARGIN: 0.5em 0px">The final root file system cannot simply be mounted over<SPAN class=Apple-converted-space>&nbsp;</SPAN><TT style="FONT-FAMILY: monospace, Courier">/</TT>, since that would make the scripts and tools on the initial root file system inaccessible for any final cleanup tasks:</P>
<UL style="PADDING-BOTTOM: 0px; LINE-HEIGHT: 1.6; LIST-STYLE-TYPE: disc; MARGIN: 0.3em 0px 0px 1.6em; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; LIST-STYLE-IMAGE: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAANAQMAAABb8jbLAAAABlBMVEX///8AUow5QSOjAAAAAXRSTlMAQObYZgAAABNJREFUCB1jYEABBQw/wLCAgQEAGpIDyT0IVcsAAAAASUVORK5CYII=); PADDING-TOP: 0px">
<LI style="MARGIN-BOTTOM: 0.1em">On an initrd, the new root is mounted at a temporary mount point and rotated into place with<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="PADDING-RIGHT: 13px; BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(102,51,102); TEXT-DECORATION: none" class="external text" href="http://linux.die.net/man/8/pivot_root" rel=nofollow>pivot_root(8)</A><SPAN class=Apple-converted-space>&nbsp;</SPAN>(which was introduced specifically for this purpose). This leaves the initial root file system at a mount point (such as<SPAN class=Apple-converted-space>&nbsp;</SPAN><TT style="FONT-FAMILY: monospace, Courier">/initrd</TT>) where normal boot scripts can later unmount it to free up memory held by the initrd. 
<LI style="MARGIN-BOTTOM: 0.1em">On an initramfs, the initial root file system cannot be rotated away.<SUP style="LINE-HEIGHT: 1; FONT-STYLE: normal; FONT-SIZE: 11px; FONT-WEIGHT: normal" id=cite_ref-6 class=reference><A style="WHITE-SPACE: nowrap; BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" href="http://en.wikipedia.org/wiki/Initrd#cite_note-6"><SPAN>[</SPAN>6<SPAN>]</SPAN></A></SUP><SPAN class=Apple-converted-space>&nbsp;</SPAN>Instead, it is simply emptied and the final root file system mounted over the top.</LI></UL>
<P style="MARGIN: 0.5em 0px">Most initial root file systems implement<SPAN class=Apple-converted-space>&nbsp;</SPAN><TT style="FONT-FAMILY: monospace, Courier">/linuxrc</TT><SPAN class=Apple-converted-space>&nbsp;</SPAN>or<SPAN class=Apple-converted-space>&nbsp;</SPAN><TT style="FONT-FAMILY: monospace, Courier">/init</TT><SPAN class=Apple-converted-space>&nbsp;</SPAN>as a shell script and thus include a minimal shell (usually<A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title="Almquist shell" href="http://en.wikipedia.org/wiki/Almquist_shell">/bin/ash</A>) along with some essential user-space utilities (usually the<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title=BusyBox href="http://en.wikipedia.org/wiki/BusyBox">BusyBox</A><SPAN class=Apple-converted-space>&nbsp;</SPAN>toolkit). To further save space, the shell, utilities and their supporting libraries are typically compiled with space optimizations enabled (such as with<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title="GNU Compiler Collection" href="http://en.wikipedia.org/wiki/GNU_Compiler_Collection">gcc</A>'s "-Os" flag) and linked against<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title=Klibc href="http://en.wikipedia.org/wiki/Klibc">klibc</A>, a minimal version of the<SPAN class=Apple-converted-space>&nbsp;</SPAN><A style="BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" title="C standard library" href="http://en.wikipedia.org/wiki/C_standard_library">C library</A><SPAN class=Apple-converted-space>&nbsp;</SPAN>written specifically for this purpose.<SUP style="LINE-HEIGHT: 1; FONT-STYLE: normal; FONT-SIZE: 11px; FONT-WEIGHT: normal" id=cite_ref-7 class=reference><A style="WHITE-SPACE: nowrap; BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: rgb(11,0,128); TEXT-DECORATION: none" href="http://en.wikipedia.org/wiki/Initrd#cite_note-7"><SPAN>[</SPAN>7<SPAN>]</SPAN></A></SUP>