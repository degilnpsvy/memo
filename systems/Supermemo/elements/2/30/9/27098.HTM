/**<BR>&nbsp;* <FONT class=clozed>kstrndup</FONT> - allocate space for and copy an existing string<BR>&nbsp;* @s: the string to duplicate<BR>&nbsp;* @max: read at most @max chars from @s<BR>&nbsp;* @gfp: the GFP mask used in the kmalloc() call when allocating memory<BR>&nbsp;*/<BR>char *kstrndup(const char *s, size_t max, gfp_t gfp)<BR>{<BR>&nbsp;size_t len;<BR>&nbsp;char *buf; 
<P></P>
<P>&nbsp;if (!s)<BR>&nbsp;&nbsp;return NULL;</P>
<P>&nbsp;len = strnlen(s, max);<BR>&nbsp;buf = kmalloc_track_caller(len+1, gfp);<BR>&nbsp;if (buf) {<BR>&nbsp;&nbsp;memcpy(buf, s, len);<BR>&nbsp;&nbsp;buf[len] = '\0';<BR>&nbsp;}<BR>&nbsp;return buf;<BR>}<BR>EXPORT_SYMBOL(kstrndup);