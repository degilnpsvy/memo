/**<BR>&nbsp;* memdup_user - duplicate memory region from user space<BR>&nbsp;*<BR>&nbsp;* @src: source address in user space<BR>&nbsp;* @len: number of bytes to copy<BR>&nbsp;*<BR>&nbsp;* Returns an ERR_PTR() on failure.<BR>&nbsp;*/<BR>void *memdup_user(const void __user *src, size_t len)<BR>{<BR>&nbsp;void *p;</P>
<P>&nbsp;/*<BR>&nbsp; * Always use GFP_KERNEL, since copy_from_user() can sleep and<BR>&nbsp; * cause pagefault, which makes it pointless to use GFP_NOFS<BR>&nbsp; * or GFP_ATOMIC.<BR>&nbsp; */<BR>&nbsp;p = kmalloc_track_caller(len, GFP_KERNEL);<BR>&nbsp;if (!p)<BR>&nbsp;&nbsp;return ERR_PTR(-ENOMEM);</P>
<P>&nbsp;if (copy_from_user(p, src, len)) {<BR>&nbsp;&nbsp;kfree(p);<BR>&nbsp;&nbsp;return ERR_PTR(-EFAULT);<BR>&nbsp;}</P>
<P>&nbsp;return p;<BR>}<BR>EXPORT_SYMBOL(memdup_user);