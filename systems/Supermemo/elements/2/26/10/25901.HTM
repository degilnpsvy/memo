<H2>Linux&#35774;&#22791;&#27169;&#22411;(9)_device resource management</H2>
<P class=date>&#20316;&#32773;&#65306;<A href="http://www.wowotech.net/author/2">&#34583;&#34583;</A> &#21457;&#24067;&#20110;&#65306;2014-9-24 23:28 &#20998;&#31867;&#65306;<A href="http://www.wowotech.net/sort/device_model">&#32479;&#19968;&#35774;&#22791;&#27169;&#22411;</A> </P>
<H4>1. &#21069;&#35328;</H4>
<P><FONT color=#0000ff><STRONG>&#34583;&#34583;&#24314;&#35758;&#65292;&#27599;&#19968;&#20010;Linux&#39537;&#21160;&#24037;&#31243;&#24072;&#65292;&#37117;&#33021;&#30596;&#19968;&#30524;&#26412;&#25991;&#12290;</STRONG></FONT></P>
<P>&#20043;&#25152;&#20197;&#29992;&#8220;&#30596;&#8221;&#65292;&#22240;&#27492;&#23427;&#24456;&#31616;&#21333;&#65292;&#20960;&#20046;&#19981;&#38656;&#35201;&#33457;&#36153;&#24515;&#24605;&#23601;&#33021;&#29702;&#35299;&#12290;&#20043;&#25152;&#26377;&#36825;&#24314;&#35758;&#65292;&#26159;&#22240;&#20026;&#23427;&#38750;&#24120;&#23454;&#29992;&#65292;&#21487;&#20197;&#35299;&#31572;&#19968;&#20123;&#22256;&#24785;&#65292;&#21487;&#20197;&#20351;&#25105;&#20204;&#30340;&#20195;&#30721;&#21464;&#24471;&#31616;&#21333;&#12289;&#31616;&#27905;&#12290;&#20808;&#30475;&#19968;&#20010;&#20363;&#23376;&#65306;</P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,128,0)">/* drivers/media/platform/soc_camera/mx1_camera.c, line 695 */</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">static</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> __init mx1_camera_probe(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *pdev)</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN> {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN>     ...</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN>     res = platform_get_resource(pdev, IORESOURCE_MEM, 0);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum7 style="COLOR: rgb(96,96,96)">   7:</SPAN>     irq = platform_get_irq(pdev, 0);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum8 style="COLOR: rgb(96,96,96)">   8:</SPAN>     <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (!res || (<SPAN style="COLOR: rgb(0,0,255)">int</SPAN>)irq &lt;= 0) {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum9 style="COLOR: rgb(96,96,96)">   9:</SPAN>         err = -ENODEV;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum10 style="COLOR: rgb(96,96,96)">  10:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">goto</SPAN> exit;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum11 style="COLOR: rgb(96,96,96)">  11:</SPAN>     }</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum12 style="COLOR: rgb(96,96,96)">  12:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum13 style="COLOR: rgb(96,96,96)">  13:</SPAN>     clk = clk_get(&amp;pdev-&gt;dev, <SPAN style="COLOR: rgb(0,96,128)">"csi_clk"</SPAN>);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum14 style="COLOR: rgb(96,96,96)">  14:</SPAN>     <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (IS_ERR(clk)) {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum15 style="COLOR: rgb(96,96,96)">  15:</SPAN>         err = PTR_ERR(clk);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum16 style="COLOR: rgb(96,96,96)">  16:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">goto</SPAN> exit;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum17 style="COLOR: rgb(96,96,96)">  17:</SPAN>     }</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum18 style="COLOR: rgb(96,96,96)">  18:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum19 style="COLOR: rgb(96,96,96)">  19:</SPAN>     pcdev = kzalloc(<SPAN style="COLOR: rgb(0,0,255)">sizeof</SPAN>(*pcdev), GFP_KERNEL);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum20 style="COLOR: rgb(96,96,96)">  20:</SPAN>     <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (!pcdev) {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum21 style="COLOR: rgb(96,96,96)">  21:</SPAN>         dev_err(&amp;pdev-&gt;dev, <SPAN style="COLOR: rgb(0,96,128)">"Could not allocate pcdev\n"</SPAN>);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum22 style="COLOR: rgb(96,96,96)">  22:</SPAN>         err = -ENOMEM;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum23 style="COLOR: rgb(96,96,96)">  23:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">goto</SPAN> exit_put_clk;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum24 style="COLOR: rgb(96,96,96)">  24:</SPAN>     }</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum25 style="COLOR: rgb(96,96,96)">  25:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum26 style="COLOR: rgb(96,96,96)">  26:</SPAN>     ...</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum27 style="COLOR: rgb(96,96,96)">  27:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum28 style="COLOR: rgb(96,96,96)">  28:</SPAN>     <SPAN style="COLOR: rgb(0,128,0)">/*</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum29 style="COLOR: rgb(96,96,96)">  29:</SPAN> <SPAN style="COLOR: rgb(0,128,0)">     * Request the regions.</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum30 style="COLOR: rgb(96,96,96)">  30:</SPAN> <SPAN style="COLOR: rgb(0,128,0)">     */</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum31 style="COLOR: rgb(96,96,96)">  31:</SPAN>     <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (!request_mem_region(res-&gt;start, resource_size(res), DRIVER_NAME)) {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum32 style="COLOR: rgb(96,96,96)">  32:</SPAN>         err = -EBUSY;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum33 style="COLOR: rgb(96,96,96)">  33:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">goto</SPAN> exit_kfree;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum34 style="COLOR: rgb(96,96,96)">  34:</SPAN>     }</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum35 style="COLOR: rgb(96,96,96)">  35:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum36 style="COLOR: rgb(96,96,96)">  36:</SPAN>     base = ioremap(res-&gt;start, resource_size(res));</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum37 style="COLOR: rgb(96,96,96)">  37:</SPAN>     <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (!base) {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum38 style="COLOR: rgb(96,96,96)">  38:</SPAN>         err = -ENOMEM;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum39 style="COLOR: rgb(96,96,96)">  39:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">goto</SPAN> exit_release;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum40 style="COLOR: rgb(96,96,96)">  40:</SPAN>     }</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum41 style="COLOR: rgb(96,96,96)">  41:</SPAN>     ...</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum42 style="COLOR: rgb(96,96,96)">  42:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum43 style="COLOR: rgb(96,96,96)">  43:</SPAN>     <SPAN style="COLOR: rgb(0,128,0)">/* request dma */</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum44 style="COLOR: rgb(96,96,96)">  44:</SPAN>     pcdev-&gt;dma_chan = imx_dma_request_by_prio(DRIVER_NAME, DMA_PRIO_HIGH);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum45 style="COLOR: rgb(96,96,96)">  45:</SPAN>     <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (pcdev-&gt;dma_chan &lt; 0) {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum46 style="COLOR: rgb(96,96,96)">  46:</SPAN>         dev_err(&amp;pdev-&gt;dev, <SPAN style="COLOR: rgb(0,96,128)">"Can't request DMA for MX1 CSI\n"</SPAN>);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum47 style="COLOR: rgb(96,96,96)">  47:</SPAN>         err = -EBUSY;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum48 style="COLOR: rgb(96,96,96)">  48:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">goto</SPAN> exit_iounmap;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum49 style="COLOR: rgb(96,96,96)">  49:</SPAN>     }</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum50 style="COLOR: rgb(96,96,96)">  50:</SPAN>     ...</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum51 style="COLOR: rgb(96,96,96)">  51:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum52 style="COLOR: rgb(96,96,96)">  52:</SPAN>     <SPAN style="COLOR: rgb(0,128,0)">/* request irq */</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum53 style="COLOR: rgb(96,96,96)">  53:</SPAN>     err = claim_fiq(&amp;fh);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum54 style="COLOR: rgb(96,96,96)">  54:</SPAN>     <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (err) {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum55 style="COLOR: rgb(96,96,96)">  55:</SPAN>         dev_err(&amp;pdev-&gt;dev, <SPAN style="COLOR: rgb(0,96,128)">"Camera interrupt register failed\n"</SPAN>);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum56 style="COLOR: rgb(96,96,96)">  56:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">goto</SPAN> exit_free_dma;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum57 style="COLOR: rgb(96,96,96)">  57:</SPAN>     }</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum58 style="COLOR: rgb(96,96,96)">  58:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum59 style="COLOR: rgb(96,96,96)">  59:</SPAN>     ...</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum60 style="COLOR: rgb(96,96,96)">  60:</SPAN>     err = soc_camera_host_register(&amp;pcdev-&gt;soc_host);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum61 style="COLOR: rgb(96,96,96)">  61:</SPAN>     <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (err)</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum62 style="COLOR: rgb(96,96,96)">  62:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">goto</SPAN> exit_free_irq;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum63 style="COLOR: rgb(96,96,96)">  63:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum64 style="COLOR: rgb(96,96,96)">  64:</SPAN>     dev_info(&amp;pdev-&gt;dev, <SPAN style="COLOR: rgb(0,96,128)">"MX1 Camera driver loaded\n"</SPAN>);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum65 style="COLOR: rgb(96,96,96)">  65:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum66 style="COLOR: rgb(96,96,96)">  66:</SPAN>     <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> 0;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum67 style="COLOR: rgb(96,96,96)">  67:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum68 style="COLOR: rgb(96,96,96)">  68:</SPAN> exit_free_irq:</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum69 style="COLOR: rgb(96,96,96)">  69:</SPAN>     disable_fiq(irq);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum70 style="COLOR: rgb(96,96,96)">  70:</SPAN>     mxc_set_irq_fiq(irq, 0);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum71 style="COLOR: rgb(96,96,96)">  71:</SPAN>     release_fiq(&amp;fh);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum72 style="COLOR: rgb(96,96,96)">  72:</SPAN> exit_free_dma:</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum73 style="COLOR: rgb(96,96,96)">  73:</SPAN>     imx_dma_free(pcdev-&gt;dma_chan);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum74 style="COLOR: rgb(96,96,96)">  74:</SPAN> exit_iounmap:</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum75 style="COLOR: rgb(96,96,96)">  75:</SPAN>     iounmap(base);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum76 style="COLOR: rgb(96,96,96)">  76:</SPAN> exit_release:</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum77 style="COLOR: rgb(96,96,96)">  77:</SPAN>     release_mem_region(res-&gt;start, resource_size(res));</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum78 style="COLOR: rgb(96,96,96)">  78:</SPAN> exit_kfree:</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum79 style="COLOR: rgb(96,96,96)">  79:</SPAN>     kfree(pcdev);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum80 style="COLOR: rgb(96,96,96)">  80:</SPAN> exit_put_clk:</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum81 style="COLOR: rgb(96,96,96)">  81:</SPAN>     clk_put(clk);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum82 style="COLOR: rgb(96,96,96)">  82:</SPAN> exit:</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum83 style="COLOR: rgb(96,96,96)">  83:</SPAN>     <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> err;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum84 style="COLOR: rgb(96,96,96)">  84:</SPAN> }</PRE><!--CRLF--></DIV></DIV>
<P>&#30456;&#20449;&#27599;&#19968;&#20010;&#20889;&#36807;Linux driver&#30340;&#24037;&#31243;&#24072;&#65292;&#37117;&#22312;probe&#20989;&#25968;&#20013;&#36935;&#21040;&#36807;&#19978;&#38754;&#30340;&#22256;&#24785;&#65306;&#35201;&#39034;&#24207;&#30003;&#35831;&#22810;&#31181;&#36164;&#28304;&#65288;IRQ&#12289;Clock&#12289;memory&#12289;regions&#12289;ioremap&#12289;dma&#12289;&#31561;&#31561;&#65289;&#65292;&#21482;&#35201;&#20219;&#24847;&#19968;&#31181;&#36164;&#28304;&#30003;&#35831;&#22833;&#36133;&#65292;&#23601;&#35201;&#22238;&#28378;&#37322;&#25918;&#20043;&#21069;&#30003;&#35831;&#30340;&#25152;&#26377;&#36164;&#28304;&#12290;&#20110;&#26159;&#20989;&#25968;&#30340;&#26368;&#21518;&#65292;&#19968;&#23450;&#20250;&#20986;&#29616;&#24456;&#22810;&#30340;goto&#26631;&#31614;&#65288;&#22914;&#19978;&#38754;&#30340;exit_free_irq&#12289;exit_free_dma&#12289;&#31561;&#31561;&#65289;&#65292;&#24182;&#22312;&#30003;&#35831;&#36164;&#28304;&#20986;&#38169;&#26102;&#65292;&#23567;&#24515;&#32764;&#32764;&#30340;goto&#21040;&#27491;&#30830;&#30340;&#26631;&#31614;&#19978;&#65292;&#20197;&#20415;&#37322;&#25918;&#24050;&#30003;&#35831;&#36164;&#28304;&#12290;</P>
<P>&#27491;&#20687;&#19978;&#38754;&#20195;&#30721;&#19968;&#26679;&#65292;&#25972;&#20010;&#20989;&#25968;&#34987;&#22823;&#27573;&#30340;&#12289;&#37325;&#22797;&#30340;&#8220;if (condition) { err = xxx; goto xxx; }&#8221;&#20805;&#26021;&#65292;&#28010;&#36153;&#31934;&#21147;&#65292;&#23481;&#26131;&#20986;&#38169;&#65292;&#19981;&#32654;&#35266;&#12290;&#26377;&#22256;&#24785;&#65292;&#23601;&#26377;&#25913;&#21892;&#30340;&#20313;&#22320;&#65292;&#26368;&#32456;&#65292;Linux&#35774;&#22791;&#27169;&#22411;&#20511;&#21161;device resource management&#65288;&#35774;&#22791;&#36164;&#28304;&#31649;&#29702;&#65289;&#65292;&#24110;&#25105;&#20204;&#35299;&#20915;&#20102;&#36825;&#20010;&#38382;&#39064;&#12290;&#23601;&#26159;&#65306;driver&#20320;&#21482;&#31649;&#30003;&#35831;&#23601;&#34892;&#20102;&#65292;&#19981;&#29992;&#32771;&#34385;&#37322;&#25918;&#65292;&#25105;&#35774;&#22791;&#27169;&#22411;&#24110;&#20320;&#37322;&#25918;&#12290;&#26368;&#32456;&#65292;&#25105;&#20204;&#30340;driver&#21487;&#20197;&#36825;&#26679;&#20889;&#65306;</P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">static</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> __init mx1_camera_probe(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *pdev)</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN> {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN>     ...</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN>  </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN>     res = platform_get_resource(pdev, IORESOURCE_MEM, 0);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN>     irq = platform_get_irq(pdev, 0);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum7 style="COLOR: rgb(96,96,96)">   7:</SPAN>     <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (!res || (<SPAN style="COLOR: rgb(0,0,255)">int</SPAN>)irq &lt;= 0) {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum8 style="COLOR: rgb(96,96,96)">   8:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> -ENODEV;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum9 style="COLOR: rgb(96,96,96)">   9:</SPAN>     }</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum10 style="COLOR: rgb(96,96,96)">  10:</SPAN>  </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum11 style="COLOR: rgb(96,96,96)">  11:</SPAN>     clk = devm_clk_get(&amp;pdev-&gt;dev, <SPAN style="COLOR: rgb(0,96,128)">"csi_clk"</SPAN>);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum12 style="COLOR: rgb(96,96,96)">  12:</SPAN>     <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (IS_ERR(clk)) {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum13 style="COLOR: rgb(96,96,96)">  13:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> PTR_ERR(clk);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum14 style="COLOR: rgb(96,96,96)">  14:</SPAN>     }</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum15 style="COLOR: rgb(96,96,96)">  15:</SPAN>  </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum16 style="COLOR: rgb(96,96,96)">  16:</SPAN>     pcdev = devm_kzalloc(&amp;pdev-&gt;dev, <SPAN style="COLOR: rgb(0,0,255)">sizeof</SPAN>(*pcdev), GFP_KERNEL);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum17 style="COLOR: rgb(96,96,96)">  17:</SPAN>     <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (!pcdev) {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum18 style="COLOR: rgb(96,96,96)">  18:</SPAN>         dev_err(&amp;pdev-&gt;dev, <SPAN style="COLOR: rgb(0,96,128)">"Could not allocate pcdev\n"</SPAN>);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum19 style="COLOR: rgb(96,96,96)">  19:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> -ENOMEM;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum20 style="COLOR: rgb(96,96,96)">  20:</SPAN>     }</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum21 style="COLOR: rgb(96,96,96)">  21:</SPAN>  </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum22 style="COLOR: rgb(96,96,96)">  22:</SPAN>     ...</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum23 style="COLOR: rgb(96,96,96)">  23:</SPAN>  </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum24 style="COLOR: rgb(96,96,96)">  24:</SPAN>     <SPAN style="COLOR: rgb(0,128,0)">/*</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum25 style="COLOR: rgb(96,96,96)">  25:</SPAN> <SPAN style="COLOR: rgb(0,128,0)">     * Request the regions.</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum26 style="COLOR: rgb(96,96,96)">  26:</SPAN> <SPAN style="COLOR: rgb(0,128,0)">     */</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum27 style="COLOR: rgb(96,96,96)">  27:</SPAN>     <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (!devm_request_mem_region(&amp;pdev-&gt;dev, res-&gt;start, resource_size(res), DRIVER_NAME)) {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum28 style="COLOR: rgb(96,96,96)">  28:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> -EBUSY;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum29 style="COLOR: rgb(96,96,96)">  29:</SPAN>     }</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum30 style="COLOR: rgb(96,96,96)">  30:</SPAN>  </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum31 style="COLOR: rgb(96,96,96)">  31:</SPAN>     base = devm_ioremap(&amp;pdev-&gt;dev, res-&gt;start, resource_size(res));</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum32 style="COLOR: rgb(96,96,96)">  32:</SPAN>     <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (!base) {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum33 style="COLOR: rgb(96,96,96)">  33:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> -ENOMEM;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum34 style="COLOR: rgb(96,96,96)">  34:</SPAN>     }</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum35 style="COLOR: rgb(96,96,96)">  35:</SPAN>     ...</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum36 style="COLOR: rgb(96,96,96)">  36:</SPAN>  </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum37 style="COLOR: rgb(96,96,96)">  37:</SPAN>     <SPAN style="COLOR: rgb(0,128,0)">/* request dma */</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum38 style="COLOR: rgb(96,96,96)">  38:</SPAN>     pcdev-&gt;dma_chan = imx_dma_request_by_prio(DRIVER_NAME, DMA_PRIO_HIGH);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum39 style="COLOR: rgb(96,96,96)">  39:</SPAN>     <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (pcdev-&gt;dma_chan &lt; 0) {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum40 style="COLOR: rgb(96,96,96)">  40:</SPAN>         dev_err(&amp;pdev-&gt;dev, <SPAN style="COLOR: rgb(0,96,128)">"Can't request DMA for MX1 CSI\n"</SPAN>);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum41 style="COLOR: rgb(96,96,96)">  41:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> -EBUSY;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum42 style="COLOR: rgb(96,96,96)">  42:</SPAN>     }</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum43 style="COLOR: rgb(96,96,96)">  43:</SPAN>     ...</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum44 style="COLOR: rgb(96,96,96)">  44:</SPAN>  </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum45 style="COLOR: rgb(96,96,96)">  45:</SPAN>     <SPAN style="COLOR: rgb(0,128,0)">/* request irq */</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum46 style="COLOR: rgb(96,96,96)">  46:</SPAN>     err = claim_fiq(&amp;fh);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum47 style="COLOR: rgb(96,96,96)">  47:</SPAN>     <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (err) {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum48 style="COLOR: rgb(96,96,96)">  48:</SPAN>         dev_err(&amp;pdev-&gt;dev, <SPAN style="COLOR: rgb(0,96,128)">"Camera interrupt register failed\n"</SPAN>);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum49 style="COLOR: rgb(96,96,96)">  49:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> err;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum50 style="COLOR: rgb(96,96,96)">  50:</SPAN>     }</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum51 style="COLOR: rgb(96,96,96)">  51:</SPAN>  </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum52 style="COLOR: rgb(96,96,96)">  52:</SPAN>     ...</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum53 style="COLOR: rgb(96,96,96)">  53:</SPAN>     err = soc_camera_host_register(&amp;pcdev-&gt;soc_host);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum54 style="COLOR: rgb(96,96,96)">  54:</SPAN>     <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (err)</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum55 style="COLOR: rgb(96,96,96)">  55:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> err;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum56 style="COLOR: rgb(96,96,96)">  56:</SPAN>  </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum57 style="COLOR: rgb(96,96,96)">  57:</SPAN>     dev_info(&amp;pdev-&gt;dev, <SPAN style="COLOR: rgb(0,96,128)">"MX1 Camera driver loaded\n"</SPAN>);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum58 style="COLOR: rgb(96,96,96)">  58:</SPAN>  </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum59 style="COLOR: rgb(96,96,96)">  59:</SPAN>     <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> 0;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum60 style="COLOR: rgb(96,96,96)">  60:</SPAN> }</PRE><!--CRLF--></DIV></DIV>
<P>&#24590;&#20040;&#20570;&#21040;&#21602;&#65311;&#27880;&#24847;&#19978;&#38754;&#8220;devm_&#8221;&#24320;&#22836;&#30340;&#25509;&#21475;&#65292;&#31572;&#26696;&#23601;&#22312;&#37027;&#37324;&#12290;&#19981;&#35201;&#20877;&#20351;&#29992;&#37027;&#20123;&#24120;&#35268;&#30340;&#36164;&#28304;&#30003;&#35831;&#25509;&#21475;&#65292;&#29992;devm_xxx&#30340;&#25509;&#21475;&#20195;&#26367;&#12290;&#20026;&#20102;&#20445;&#25345;&#20860;&#23481;&#65292;&#36825;&#20123;&#26032;&#25509;&#21475;&#21644;&#26087;&#25509;&#21475;&#30340;&#21442;&#25968;&#20445;&#25345;&#19968;&#33268;&#65292;&#21482;&#26159;&#21517;&#23383;&#21069;&#21152;&#20102;&#8220;devm_&#8221;&#65292;&#24182;&#22810;&#21152;&#19968;&#20010;struct device&#25351;&#38024;&#12290;</P>
<H4>2. devm_xxx</H4>
<P>&#19979;&#38754;&#21015;&#20030;&#19968;&#20123;&#24120;&#29992;&#30340;&#36164;&#28304;&#30003;&#35831;&#25509;&#21475;&#65292;&#23427;&#20204;&#30001;&#21508;&#20010;framework&#65288;&#22914;clock&#12289;regulator&#12289;gpio&#12289;&#31561;&#31561;&#65289;&#22522;&#20110;device resource management&#23454;&#29616;&#12290;&#20351;&#29992;&#26102;&#65292;&#30452;&#25509;&#24573;&#30053;&#8220;devm_&#8221;&#30340;&#21069;&#32512;&#65292;&#21518;&#38754;&#21097;&#19979;&#30340;&#37096;&#20998;&#65292;driver&#24037;&#31243;&#24072;&#37117;&#24456;&#29087;&#24713;&#12290;&#21482;&#38656;&#35760;&#20303;&#19968;&#28857;&#65292;driver&#21487;&#20197;&#21482;&#30003;&#35831;&#65292;&#19981;&#37322;&#25918;&#65292;&#35774;&#22791;&#27169;&#22411;&#20250;&#24110;&#24537;&#37322;&#25918;&#12290;&#19981;&#36807;&#22914;&#26524;&#20026;&#20102;&#20005;&#35880;&#65292;&#22312;driver remove&#26102;&#65292;&#21487;&#20197;&#20027;&#21160;&#37322;&#25918;&#65288;&#20063;&#26377;&#30456;&#24212;&#30340;&#25509;&#21475;&#65292;&#36825;&#37324;&#27809;&#26377;&#21015;&#20986;&#65289;&#12290;</P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> *devm_kzalloc(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device *dev, size_t size, gfp_t gfp);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> __iomem *devm_ioremap_resource(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device *dev, </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN>   <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> resource *res);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> __iomem *devm_ioremap(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device *dev, resource_size_t offset,</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN>   <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">long</SPAN> size);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum7 style="COLOR: rgb(96,96,96)">   7:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum8 style="COLOR: rgb(96,96,96)">   8:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> clk *devm_clk_get(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device *dev, <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">char</SPAN> *id);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum9 style="COLOR: rgb(96,96,96)">   9:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum10 style="COLOR: rgb(96,96,96)">  10:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> devm_gpio_request(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device *dev, <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> gpio,</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum11 style="COLOR: rgb(96,96,96)">  11:</SPAN>   <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">char</SPAN> *label);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum12 style="COLOR: rgb(96,96,96)">  12:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum13 style="COLOR: rgb(96,96,96)">  13:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">static</SPAN> <SPAN style="COLOR: rgb(0,0,255)">inline</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> pinctrl * devm_pinctrl_get_select(</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum14 style="COLOR: rgb(96,96,96)">  14:</SPAN>   <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device *dev, <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">char</SPAN> *name)</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum15 style="COLOR: rgb(96,96,96)">  15:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum16 style="COLOR: rgb(96,96,96)">  16:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">static</SPAN> <SPAN style="COLOR: rgb(0,0,255)">inline</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> pwm_device *devm_pwm_get(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device *dev,</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum17 style="COLOR: rgb(96,96,96)">  17:</SPAN>   <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">char</SPAN> *consumer);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum18 style="COLOR: rgb(96,96,96)">  18:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum19 style="COLOR: rgb(96,96,96)">  19:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> regulator *devm_regulator_get(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device *dev, <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">char</SPAN> *id);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum20 style="COLOR: rgb(96,96,96)">  20:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum21 style="COLOR: rgb(96,96,96)">  21:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">static</SPAN> <SPAN style="COLOR: rgb(0,0,255)">inline</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> devm_request_irq(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device *dev, <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> irq, </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum22 style="COLOR: rgb(96,96,96)">  22:</SPAN>   irq_handler_t handler, <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">long</SPAN> irqflags, </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum23 style="COLOR: rgb(96,96,96)">  23:</SPAN>   <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">char</SPAN> *devname, <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> *dev_id);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum24 style="COLOR: rgb(96,96,96)">  24:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum25 style="COLOR: rgb(96,96,96)">  25:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> reset_control *devm_reset_control_get(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device *dev, </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum26 style="COLOR: rgb(96,96,96)">  26:</SPAN>   <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">char</SPAN> *id);</PRE><!--CRLF--></DIV></DIV>
<H4>3. &#20160;&#20040;&#26159;&#8220;&#35774;&#22791;&#36164;&#28304;&#8221;</H4>
<P>&#19968;&#20010;&#35774;&#22791;&#33021;&#24037;&#20316;&#65292;&#38656;&#35201;&#20381;&#36182;&#24456;&#22810;&#30340;&#22806;&#37096;&#26465;&#20214;&#65292;&#22914;&#20379;&#30005;&#12289;&#26102;&#38047;&#31561;&#31561;&#65292;&#36825;&#20123;&#22806;&#37096;&#26465;&#20214;&#31216;&#20316;&#35774;&#22791;&#36164;&#28304;&#65288;device resouce&#65289;&#12290;&#23545;&#20110;&#29616;&#20195;&#35745;&#31639;&#26426;&#30340;&#20307;&#31995;&#32467;&#26500;&#65292;&#21487;&#33021;&#30340;&#36164;&#28304;&#21253;&#25324;&#65306;</P>
<BLOCKQUOTE>
<P>a&#65289;power&#65292;&#20379;&#30005;&#12290; <BR>b&#65289;clock&#65292;&#26102;&#38047;&#12290; <BR>c&#65289;memory&#65292;&#20869;&#23384;&#65292;&#22312;kernel&#20013;&#19968;&#33324;&#20351;&#29992;kzalloc&#20998;&#37197;&#12290; <BR>d&#65289;GPIO&#65292;&#29992;&#25143;&#21644;CPU&#20132;&#25442;&#31616;&#21333;&#25511;&#21046;&#12289;&#29366;&#24577;&#31561;&#20449;&#24687;&#12290; <BR>e&#65289;IRQ&#65292;&#35302;&#21457;&#20013;&#26029;&#12290; <BR>f&#65289;DMA&#65292;&#26080;CPU&#21442;&#19982;&#24773;&#20917;&#19979;&#36827;&#34892;&#25968;&#25454;&#20256;&#36755;&#12290; <BR>g&#65289;&#34394;&#25311;&#22320;&#22336;&#31354;&#38388;&#65292;&#19968;&#33324;&#20351;&#29992;ioremap&#12289;request_region&#31561;&#20998;&#37197;&#12290; <BR>h&#65289;&#31561;&#31561;</P></BLOCKQUOTE>
<P>&#32780;&#22312;Linux kernel&#30340;&#30524;&#20013;&#65292;&#8220;&#36164;&#28304;&#8221;&#30340;&#23450;&#20041;&#26356;&#20026;&#24191;&#20041;&#65292;&#27604;&#22914;PWM&#12289;RTC&#12289;Reset&#65292;&#37117;&#21487;&#20197;&#25277;&#35937;&#20026;&#36164;&#28304;&#65292;&#20379;driver&#20351;&#29992;&#12290;</P>
<P>&#22312;&#36739;&#26089;&#30340;kernel&#20013;&#65292;&#31995;&#32479;&#36824;&#19981;&#26159;&#29305;&#21035;&#22797;&#26434;&#65292;&#19988;&#21508;&#20010;framework&#36824;&#27809;&#26377;&#25104;&#22411;&#65292;&#22240;&#27492;&#22823;&#22810;&#30340;&#36164;&#28304;&#37117;&#30001;driver&#33258;&#34892;&#32500;&#25252;&#12290;&#20294;&#38543;&#30528;&#31995;&#32479;&#22797;&#26434;&#24230;&#30340;&#22686;&#21152;&#65292;driver&#20043;&#38388;&#20849;&#29992;&#36164;&#28304;&#30340;&#24773;&#20917;&#36234;&#26469;&#36234;&#22810;&#65292;&#21516;&#26102;&#30005;&#28304;&#31649;&#29702;&#30340;&#38656;&#27714;&#20063;&#36234;&#26469;&#36234;&#36843;&#20999;&#12290;&#20110;&#26159;kernel&#23601;&#23558;&#21508;&#20010;resource&#30340;&#31649;&#29702;&#26435;&#25910;&#22238;&#65292;&#22522;&#20110;&#8220;device resource management&#8221;&#30340;&#26694;&#26550;&#65292;&#30001;&#21508;&#20010;framework&#32479;&#19968;&#31649;&#29702;&#65292;&#21253;&#25324;&#20998;&#37197;&#21644;&#22238;&#25910;&#12290; <BR></P>
<H4>4. device resource management&#30340;&#36719;&#20214;&#26694;&#26550;</H4>
<P><A href="http://www.wowotech.net/content/uploadfile/201409/9838563badc0945a6e5e5c95013ecc7720140925151511.gif"><IMG title="device resource management" style="BORDER-LEFT-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; FLOAT: none; MARGIN-LEFT: auto; DISPLAY: block; BORDER-TOP-WIDTH: 0px; MARGIN-RIGHT: auto" border=0 alt="device resource management" src="http://www.wowotech.net/content/uploadfile/201409/6c5054b79c0e8e282069e5081f10de6420140925151512.gif" width=640 height=363></A> device resource management&#20301;&#20110;&#8220;drivers/base/devres.c&#8221;&#20013;&#65292;&#23427;&#30340;&#23454;&#29616;&#38750;&#24120;&#31616;&#21333;&#65292;&#20026;&#20160;&#20040;&#21602;&#65311;&#22240;&#20026;&#36164;&#28304;&#30340;&#31181;&#31867;&#26377;&#24456;&#22810;&#65292;&#34920;&#29616;&#24418;&#24335;&#20063;&#22810;&#31181;&#22810;&#26679;&#65292;&#32780;devres&#19981;&#21487;&#33021;&#19968;&#19968;&#30693;&#24773;&#65292;&#20063;&#23601;&#19981;&#33021;&#36827;&#34892;&#20855;&#20307;&#30340;&#20998;&#37197;&#21644;&#22238;&#25910;&#12290;&#22240;&#27492;&#65292;devres&#33021;&#20570;&#30340;&#65288;&#20063;&#26159;&#23427;&#30340;&#21807;&#19968;&#21151;&#33021;&#65289;&#65292;&#23601;&#26159;&#65306;</P>
<BLOCKQUOTE>
<P>&#25552;&#20379;&#19968;&#31181;&#26426;&#21046;&#65292;&#23558;&#31995;&#32479;&#20013;&#26576;&#20010;&#35774;&#22791;&#30340;&#25152;&#26377;&#36164;&#28304;&#65292;&#20197;&#38142;&#34920;&#30340;&#24418;&#24335;&#65292;&#32452;&#32455;&#36215;&#26469;&#65292;&#20197;&#20415;&#22312;driver detach&#30340;&#26102;&#20505;&#65292;&#33258;&#21160;&#37322;&#25918;&#12290;</P></BLOCKQUOTE>
<P>&#32780;&#26356;&#20026;&#20855;&#20307;&#30340;&#20107;&#24773;&#65292;&#22914;&#24590;&#20040;&#25277;&#35937;&#26576;&#19968;&#31181;&#35774;&#22791;&#65292;&#21017;&#30001;&#19978;&#23618;&#30340;framework&#36127;&#36131;&#12290;&#36825;&#20123;framework&#21253;&#25324;&#65306;regulator framework&#65288;&#31649;&#29702;power&#36164;&#28304;&#65289;&#65292;clock framework&#65288;&#31649;&#29702;clock&#36164;&#28304;&#65289;&#65292;interrupt framework&#65288;&#31649;&#29702;&#20013;&#26029;&#36164;&#28304;&#65289;&#12289;gpio framework&#65288;&#31649;&#29702;gpio&#36164;&#28304;&#65289;&#65292;pwm framework&#65288;&#31649;&#29702;PWM&#65289;&#65292;&#31561;&#31561;&#12290;</P>
<P>&#20854;&#23427;&#30340;driver&#65292;&#20301;&#20110;&#36825;&#20123;framework&#20043;&#19978;&#65292;&#20351;&#29992;&#23427;&#20204;&#25552;&#20379;&#30340;&#26426;&#21046;&#21644;&#25509;&#21475;&#65292;&#24320;&#21457;&#36215;&#26469;&#23601;&#38750;&#24120;&#26041;&#20415;&#20102;&#12290;</P>
<H4>5. &#20195;&#30721;&#20998;&#26512;</H4>
<H5>5.1 &#25968;&#25454;&#32467;&#26500;</H5>
<P>&#20808;&#20174;struct device&#24320;&#22987;&#21543;&#65281;&#35813;&#32467;&#26500;&#20013;&#26377;&#19968;&#20010;&#21517;&#31216;&#20026;&#8220;devres_head&#8221;&#30340;&#38142;&#34920;&#22836;&#65292;&#29992;&#20110;&#20445;&#23384;&#35813;&#35774;&#22791;&#30003;&#35831;&#30340;&#25152;&#26377;&#36164;&#28304;&#65292;&#22914;&#19979;&#65306;</P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN>         ...</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN>         spinlock_t              devres_lock;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> list_head        devres_head;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN>         ...</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN> }</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum7 style="COLOR: rgb(96,96,96)">   7:</SPAN>&nbsp; </PRE><!--CRLF--></DIV></DIV>
<P>&#37027;&#36164;&#28304;&#30340;&#25968;&#25454;&#32467;&#26500;&#21602;&#65311;&#22312;&#8220;drivers/base/devres.c&#8221;&#20013;&#65292;&#21517;&#31216;&#20026;struct devres&#65292;&#22914;&#19979;&#65306;</P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> devres {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> devres_node              node;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN>         <SPAN style="COLOR: rgb(0,128,0)">/* -- 3 pointers */</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">long</SPAN> <SPAN style="COLOR: rgb(0,0,255)">long</SPAN>              data[]; <SPAN style="COLOR: rgb(0,128,0)">/* guarantee ull alignment */</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN> };</PRE><!--CRLF--></DIV></DIV>
<P>&#21643;&#19968;&#30475;&#38750;&#24120;&#31616;&#21333;&#65292;&#19968;&#20010;struct devres_node&#30340;&#21464;&#37327;node&#65292;&#19968;&#20010;&#38646;&#38271;&#24230;&#25968;&#32452;data&#65292;&#20294;&#20854;&#20013;&#26377;&#26080;&#31351;&#22885;&#22937;&#65292;&#35753;&#25105;&#20204;&#32487;&#32493;&#20998;&#26512;&#12290;</P>
<P>node&#29992;&#20110;&#23558;devres&#32452;&#32455;&#36215;&#26469;&#65292;&#26041;&#20415;&#25554;&#20837;&#21040;device&#32467;&#26500;&#30340;devres_head&#38142;&#34920;&#20013;&#65292;&#22240;&#27492;&#19968;&#23450;&#20063;&#26377;&#19968;&#20010;list_head&#65288;&#35265;&#19979;&#38754;&#30340;entry&#65289;&#12290;&#21478;&#22806;&#65292;&#36164;&#28304;&#30340;&#23384;&#22312;&#24418;&#24335;&#21040;&#24213;&#26159;&#20160;&#20040;&#65292;device resource management&#24182;&#19981;&#30693;&#24773;&#65292;&#22240;&#27492;&#38656;&#35201;&#19978;&#23618;&#27169;&#22359;&#25552;&#20379;&#19968;&#20010;release&#30340;&#22238;&#35843;&#20989;&#25968;&#65292;&#29992;&#20110;release&#36164;&#28304;&#65292;&#22914;&#19979;&#65306;</P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> devres_node {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> list_head                entry;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN>         dr_release_t                    release;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN> <SPAN style="COLOR: rgb(204,102,51)">#ifdef</SPAN> CONFIG_DEBUG_DEVRES</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">char</SPAN>                      *name;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN>         size_t                          size;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum7 style="COLOR: rgb(96,96,96)">   7:</SPAN> <SPAN style="COLOR: rgb(204,102,51)">#endif</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum8 style="COLOR: rgb(96,96,96)">   8:</SPAN> };</PRE><!--CRLF--></DIV></DIV>
<P>&#25243;&#24320;&#29992;&#20110;debug&#30340;&#21464;&#37327;&#19981;&#35828;&#65292;&#20063;&#24456;&#31616;&#21333;&#65292;&#19968;&#20010;entry list_head&#65292;&#19968;&#20010;release&#22238;&#35843;&#20989;&#25968;&#12290;&#30475;&#19981;&#20986;&#24590;&#20040;&#25277;&#35937;&#36164;&#28304;&#21834;&#65281;&#21035;&#24613;&#65292;&#22885;&#22937;&#37117;&#22312;data&#36825;&#20010;&#38646;&#38271;&#24230;&#25968;&#32452;&#19978;&#38754;&#21602;&#12290;</P>
<P><FONT color=#0000ff>&#27880;1&#65306;&#19981;&#30693;&#36947;&#24744;&#26159;&#21542;&#27880;&#24847;&#21040;&#65292;devres&#26377;&#20851;&#30340;&#25968;&#25454;&#32467;&#26500;&#65292;&#26159;&#22312;devres.c&#20013;&#23450;&#20041;&#30340;&#65288;&#26159;C&#25991;&#20214;&#21734;&#65281;&#65289;&#12290;&#25442;&#21477;&#35805;&#35828;&#65292;&#26159;&#23545;&#20854;&#23427;&#27169;&#22359;&#36879;&#26126;&#30340;&#12290;&#36825;&#30495;&#26159;&#20248;&#38597;&#30340;&#35774;&#35745;&#65288;&#23613;&#37327;&#23631;&#34109;&#32454;&#33410;&#65289;&#65281;</FONT></P>
<H5>5.2 &#19968;&#20010;&#26080;&#20851;&#35805;&#39064;&#65306;&#38646;&#38271;&#24230;&#25968;&#32452;</H5>
<P>&#38646;&#38271;&#24230;&#25968;&#32452;&#30340;&#33521;&#25991;&#21407;&#21517;&#20026;Arrays of Length Zero&#65292;&#26159;GNU C&#30340;&#35268;&#33539;&#65292;&#20027;&#35201;&#29992;&#36884;&#26159;&#29992;&#26469;&#20316;&#20026;&#32467;&#26500;&#20307;&#30340;&#26368;&#21518;&#19968;&#20010;&#25104;&#21592;&#65292;&#28982;&#21518;&#29992;&#23427;&#26469;&#35775;&#38382;&#27492;&#32467;&#26500;&#20307;&#23545;&#35937;&#20043;&#21518;&#30340;&#19968;&#27573;&#20869;&#23384;&#65288;&#36890;&#24120;&#26159;&#21160;&#24577;&#20998;&#37197;&#30340;&#20869;&#23384;&#65289;&#12290;&#20160;&#20040;&#24847;&#24605;&#21602;&#65311;</P>
<P>&#20197;struct devres&#20026;&#20363;&#65292;node&#21464;&#37327;&#30340;&#38271;&#24230;&#20026;3&#20010;&#25351;&#38024;&#30340;&#38271;&#24230;&#65292;&#32780;struct devres&#30340;&#38271;&#24230;&#20063;&#26159;3&#20010;&#25351;&#38024;&#30340;&#38271;&#24230;&#12290;&#32780;data&#21482;&#26159;&#19968;&#20010;&#26631;&#35760;&#65292;&#24403;&#26377;&#20154;&#20998;&#37197;&#20102;&#22823;&#20110;3&#20010;&#25351;&#38024;&#38271;&#24230;&#30340;&#31354;&#38388;&#24182;&#25226;&#23427;&#36716;&#25442;&#20026;struct devres&#31867;&#22411;&#30340;&#21464;&#37327;&#21518;&#65292;&#25105;&#20204;&#23601;&#21487;&#20197;&#36890;&#36807;data&#26469;&#35775;&#38382;&#22810;&#20986;&#26469;&#30340;memory&#12290;&#20063;&#23601;&#26159;&#35828;&#65292;&#26377;&#20102;&#38646;&#38271;&#24230;&#25968;&#32452;data&#65292;struct devres&#32467;&#26500;&#30340;&#38271;&#24230;&#21487;&#20197;&#19981;&#23450;&#65292;&#23436;&#20840;&#20381;&#36182;&#20110;&#20320;&#20998;&#37197;&#30340;&#31354;&#38388;&#30340;&#22823;&#23567;&#12290;&#26377;&#20160;&#20040;&#29992;&#21602;&#65311;</P>
<P>&#20197;&#26412;&#25991;&#30340;&#24212;&#29992;&#22330;&#26223;&#20026;&#20363;&#65292;&#22810;&#20986;&#26469;&#30340;&#12289;&#21487;&#36890;&#36807;data&#35775;&#38382;&#30340;&#31354;&#38388;&#65292;&#27491;&#26159;&#20855;&#20307;&#30340;device resource&#25152;&#21344;&#30340;&#31354;&#38388;&#12290;&#36164;&#28304;&#30340;&#31867;&#22411;&#19981;&#21516;&#65292;&#21344;&#29992;&#30340;&#31354;&#38388;&#30340;&#22810;&#23569;&#20063;&#19981;&#21516;&#65292;&#20294;devres&#27169;&#22359;&#30340;&#20027;&#35201;&#21151;&#33021;&#21448;&#26159;&#37322;&#25918;&#36164;&#28304;&#25152;&#21344;&#30340;&#36164;&#28304;&#12290;&#36825;&#26159;&#23601;&#26159;&#38646;&#38271;&#24230;&#25968;&#32452;&#30340;&#21151;&#33021;&#20043;&#19968;&#65292;&#22240;&#20026;&#25972;&#20010;memory&#31354;&#38388;&#26159;&#36830;&#32493;&#30340;&#65292;&#22240;&#27492;&#21487;&#20197;&#36890;&#36807;&#37322;devres&#25351;&#38024;&#65292;&#37322;&#25918;&#25152;&#26377;&#30340;&#31354;&#38388;&#65292;&#21253;&#25324;data&#25152;&#25351;&#30340;&#37027;&#29255;&#19981;&#23450;&#38271;&#24230;&#30340;&#12289;&#20855;&#20307;&#36164;&#28304;&#25152;&#29992;&#30340;&#31354;&#38388;&#12290;</P>
<P>&#38646;&#38271;&#24230;&#25968;&#32452;&#65288;data[0]&#65289;&#65292;&#22312;&#19981;&#21516;&#30340;C&#29256;&#26412;&#20013;&#65292;&#26377;&#19981;&#21516;&#30340;&#23454;&#29616;&#26041;&#26696;&#65292;&#21253;&#25324;1&#38271;&#24230;&#25968;&#32452;&#65288;data[1]&#65289;&#21644;&#19981;&#23450;&#38271;&#24230;&#25968;&#32452;&#65288;data[]&#65292;&#26412;&#25991;&#25152;&#25551;&#36848;&#23601;&#26159;&#36825;&#19968;&#31181;&#65289;&#65292;&#20855;&#20307;&#21487;&#21442;&#32771;GCC&#30340;&#35268;&#33539;&#65306;</P>
<P><A title=https://gcc.gnu.org/onlinedocs/gcc/Zero-Length.html href="https://gcc.gnu.org/onlinedocs/gcc/Zero-Length.html">https://gcc.gnu.org/onlinedocs/gcc/Zero-Length.html</A></P>
<H5>5.3 &#21521;&#19978;&#23618;framework&#25552;&#20379;&#30340;&#25509;&#21475;&#65306;devres_alloc/devres_free&#12289;devres_add/devres_remove</H5>
<P>&#20808;&#30475;&#19968;&#20010;&#20351;&#29992;device resource management&#30340;&#20363;&#23376;&#65288;IRQ&#27169;&#22359;&#65289;&#65306;</P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,128,0)">/* include/linux/interrupt.h */</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">static</SPAN> <SPAN style="COLOR: rgb(0,0,255)">inline</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> __must_check</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN> devm_request_irq(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device *dev, <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> irq, irq_handler_t handler,</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN>                  <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">long</SPAN> irqflags, <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">char</SPAN> *devname, <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> *dev_id)</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN> {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> devm_request_threaded_irq(dev, irq, handler, NULL, irqflags,</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum7 style="COLOR: rgb(96,96,96)">   7:</SPAN>                                          devname, dev_id);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum8 style="COLOR: rgb(96,96,96)">   8:</SPAN> }</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum9 style="COLOR: rgb(96,96,96)">   9:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum10 style="COLOR: rgb(96,96,96)">  10:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum11 style="COLOR: rgb(96,96,96)">  11:</SPAN> <SPAN style="COLOR: rgb(0,128,0)">/* kernel/irq/devres.c */</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum12 style="COLOR: rgb(96,96,96)">  12:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> devm_request_threaded_irq(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device *dev, <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> irq,</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum13 style="COLOR: rgb(96,96,96)">  13:</SPAN>                               irq_handler_t handler, irq_handler_t thread_fn,</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum14 style="COLOR: rgb(96,96,96)">  14:</SPAN>                               <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">long</SPAN> irqflags, <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">char</SPAN> *devname,</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum15 style="COLOR: rgb(96,96,96)">  15:</SPAN>                               <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> *dev_id)</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum16 style="COLOR: rgb(96,96,96)">  16:</SPAN> {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum17 style="COLOR: rgb(96,96,96)">  17:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> irq_devres *dr;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum18 style="COLOR: rgb(96,96,96)">  18:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> rc;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum19 style="COLOR: rgb(96,96,96)">  19:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum20 style="COLOR: rgb(96,96,96)">  20:</SPAN>         dr = devres_alloc(devm_irq_release, <SPAN style="COLOR: rgb(0,0,255)">sizeof</SPAN>(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> irq_devres),</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum21 style="COLOR: rgb(96,96,96)">  21:</SPAN>                           GFP_KERNEL);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum22 style="COLOR: rgb(96,96,96)">  22:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (!dr)</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum23 style="COLOR: rgb(96,96,96)">  23:</SPAN>                 <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> -ENOMEM;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum24 style="COLOR: rgb(96,96,96)">  24:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum25 style="COLOR: rgb(96,96,96)">  25:</SPAN>         rc = request_threaded_irq(irq, handler, thread_fn, irqflags, devname,</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum26 style="COLOR: rgb(96,96,96)">  26:</SPAN>                                   dev_id);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum27 style="COLOR: rgb(96,96,96)">  27:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (rc) {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum28 style="COLOR: rgb(96,96,96)">  28:</SPAN>                 devres_free(dr);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum29 style="COLOR: rgb(96,96,96)">  29:</SPAN>                 <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> rc;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum30 style="COLOR: rgb(96,96,96)">  30:</SPAN>         }</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum31 style="COLOR: rgb(96,96,96)">  31:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum32 style="COLOR: rgb(96,96,96)">  32:</SPAN>         dr-&gt;irq = irq;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum33 style="COLOR: rgb(96,96,96)">  33:</SPAN>         dr-&gt;dev_id = dev_id;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum34 style="COLOR: rgb(96,96,96)">  34:</SPAN>         devres_add(dev, dr);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum35 style="COLOR: rgb(96,96,96)">  35:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum36 style="COLOR: rgb(96,96,96)">  36:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> 0;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum37 style="COLOR: rgb(96,96,96)">  37:</SPAN> }</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum38 style="COLOR: rgb(96,96,96)">  38:</SPAN> EXPORT_SYMBOL(devm_request_threaded_irq);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum39 style="COLOR: rgb(96,96,96)">  39:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum40 style="COLOR: rgb(96,96,96)">  40:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> devm_free_irq(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device *dev, <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> irq, <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> *dev_id)</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum41 style="COLOR: rgb(96,96,96)">  41:</SPAN> {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum42 style="COLOR: rgb(96,96,96)">  42:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> irq_devres match_data = { irq, dev_id };</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum43 style="COLOR: rgb(96,96,96)">  43:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum44 style="COLOR: rgb(96,96,96)">  44:</SPAN>         WARN_ON(devres_destroy(dev, devm_irq_release, devm_irq_match,</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum45 style="COLOR: rgb(96,96,96)">  45:</SPAN>                                &amp;match_data));</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum46 style="COLOR: rgb(96,96,96)">  46:</SPAN>         free_irq(irq, dev_id);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum47 style="COLOR: rgb(96,96,96)">  47:</SPAN> }</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum48 style="COLOR: rgb(96,96,96)">  48:</SPAN> EXPORT_SYMBOL(devm_free_irq);</PRE><!--CRLF--></DIV></DIV>
<P>&#21069;&#38754;&#25105;&#20204;&#25552;&#36807;&#65292;&#19978;&#23618;&#30340;IRQ framework&#65292;&#20250;&#25552;&#20379;&#20004;&#20010;&#21644;request_irq/free_irq&#22522;&#26412;&#20860;&#23481;&#30340;&#25509;&#21475;&#65292;&#36825;&#20004;&#20010;&#25509;&#21475;&#30340;&#23454;&#29616;&#38750;&#24120;&#31616;&#21333;&#65292;&#23601;&#26159;&#22312;&#21407;&#26377;&#30340;&#23454;&#29616;&#20043;&#19978;&#65292;&#23553;&#35013;&#19968;&#23618;devres&#30340;&#25805;&#20316;&#65292;&#22914;&#35201;&#21253;&#25324;&#65306;</P>
<P>1&#65289;&#19968;&#20010;&#33258;&#23450;&#20041;&#30340;&#25968;&#25454;&#32467;&#26500;&#65288;struct irq_devres&#65289;&#65292;&#29992;&#20110;&#20445;&#23384;&#21644;resource&#26377;&#20851;&#30340;&#20449;&#24687;&#65288;&#23545;&#20013;&#26029;&#26469;&#35828;&#65292;&#23601;&#26159;IRQ num&#65289;&#65292;&#22914;&#19979;&#65306;</P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,128,0)">/*</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN> <SPAN style="COLOR: rgb(0,128,0)"> * Device resource management aware IRQ request/free implementation.</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN> <SPAN style="COLOR: rgb(0,128,0)"> */</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> irq_devres {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> irq;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> *dev_id;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum7 style="COLOR: rgb(96,96,96)">   7:</SPAN> };</PRE><!--CRLF--></DIV></DIV>
<P>2&#65289;&#19968;&#20010;&#29992;&#20110;release resource&#30340;&#22238;&#35843;&#20989;&#25968;&#65288;&#36825;&#37324;&#30340;release&#65292;&#21644;memory&#26080;&#20851;&#65292;&#20363;&#22914;free IRQ&#65289;&#65292;&#22914;&#19979;&#65306;</P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">static</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> devm_irq_release(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device *dev, <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> *res)</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN> {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> irq_devres *<SPAN style="COLOR: rgb(0,0,255)">this</SPAN> = res;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN>         free_irq(<SPAN style="COLOR: rgb(0,0,255)">this</SPAN>-&gt;irq, <SPAN style="COLOR: rgb(0,0,255)">this</SPAN>-&gt;dev_id);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN> }</PRE><!--CRLF--></DIV></DIV>
<BLOCKQUOTE>
<P>&#22240;&#20026;&#22238;&#35843;&#20989;&#25968;&#26159;&#30001;devres&#27169;&#22359;&#35843;&#29992;&#30340;&#65292;&#30001;&#23427;&#30340;&#21442;&#25968;&#21487;&#30693;&#65292;struct irq_devres&#21464;&#37327;&#23601;&#26159;&#23454;&#38469;&#30340;&#8220;&#36164;&#28304;&#8221;&#65292;&#20294;&#23545;devres&#32780;&#35328;&#65292;&#23427;&#24182;&#19981;&#30693;&#36947;&#35813;&#36164;&#28304;&#30340;&#23454;&#38469;&#24418;&#24577;&#65292;&#22240;&#32780;&#26159;void&#31867;&#22411;&#25351;&#38024;&#12290;&#20063;&#21482;&#26377;&#36825;&#26679;&#65292;devres&#27169;&#22359;&#25165;&#21487;&#20197;&#32479;&#19968;&#30340;&#22788;&#29702;&#25152;&#26377;&#31867;&#22411;&#30340;&#36164;&#28304;&#12290;</P></BLOCKQUOTE>
<P>3&#65289;&#20197;&#22238;&#35843;&#20989;&#25968;&#12289;resource&#30340;size&#20026;&#21442;&#25968;&#65292;&#35843;&#29992;devres_alloc&#25509;&#21475;&#65292;&#20026;resource&#20998;&#37197;&#31354;&#38388;&#12290;&#35813;&#25509;&#21475;&#30340;&#23450;&#20041;&#22914;&#19979;&#65306;</P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> * devres_alloc(dr_release_t release, size_t size, gfp_t gfp)</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN> {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> devres *dr;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN>         dr = alloc_dr(release, size, gfp);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (unlikely(!dr))</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum7 style="COLOR: rgb(96,96,96)">   7:</SPAN>                 <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> NULL;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum8 style="COLOR: rgb(96,96,96)">   8:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> dr-&gt;data;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum9 style="COLOR: rgb(96,96,96)">   9:</SPAN> }</PRE><!--CRLF--></DIV></DIV>
<P>&#35843;&#29992;alloc_dr&#65292;&#20998;&#37197;&#19968;&#20010;struct devres&#31867;&#22411;&#30340;&#21464;&#37327;&#65292;&#24182;&#36820;&#22238;&#20854;&#20013;&#30340;data&#25351;&#38024;&#65288;5.2&#23567;&#33410;&#35762;&#36807;&#20102;&#65292;data&#21464;&#37327;&#23454;&#38469;&#19978;&#26159;&#36164;&#28304;&#30340;&#20195;&#34920;&#65289;&#12290;alloc_dr&#30340;&#23450;&#20041;&#22914;&#19979;&#65306;</P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">static</SPAN> __always_inline <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> devres * alloc_dr(dr_release_t release,</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN>                                                 size_t size, gfp_t gfp)</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN> {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN>         size_t tot_size = <SPAN style="COLOR: rgb(0,0,255)">sizeof</SPAN>(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> devres) + size;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> devres *dr;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum7 style="COLOR: rgb(96,96,96)">   7:</SPAN>         dr = kmalloc_track_caller(tot_size, gfp);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum8 style="COLOR: rgb(96,96,96)">   8:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (unlikely(!dr))</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum9 style="COLOR: rgb(96,96,96)">   9:</SPAN>                 <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> NULL;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum10 style="COLOR: rgb(96,96,96)">  10:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum11 style="COLOR: rgb(96,96,96)">  11:</SPAN>         memset(dr, 0, tot_size);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum12 style="COLOR: rgb(96,96,96)">  12:</SPAN>         INIT_LIST_HEAD(&amp;dr-&gt;node.entry);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum13 style="COLOR: rgb(96,96,96)">  13:</SPAN>         dr-&gt;node.release = release;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum14 style="COLOR: rgb(96,96,96)">  14:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> dr;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum15 style="COLOR: rgb(96,96,96)">  15:</SPAN> }</PRE><!--CRLF--></DIV></DIV>
<P>&#30475;&#31532;&#19968;&#21477;&#23601;&#21487;&#20197;&#20102;&#65292;&#22312;&#36164;&#28304;size&#20043;&#21069;&#65292;&#21152;&#19968;&#20010;struct devres&#30340;size&#65292;&#23601;&#26159;total&#20998;&#37197;&#30340;&#31354;&#38388;&#12290;&#38500;&#21435;struct devres&#30340;&#65292;&#23601;&#26159;&#36164;&#28304;&#30340;&#65288;&#30001;data&#25351;&#38024;&#35775;&#38382;&#65289;&#12290;&#20043;&#21518;&#26159;&#21021;&#22987;&#21270;struct devres&#21464;&#37327;&#30340;node&#12290;</P>
<P>4&#65289;&#35843;&#29992;&#21407;&#26469;&#30340;&#20013;&#26029;&#27880;&#20876;&#25509;&#21475;&#65288;&#36825;&#37324;&#26159;request_threaded_irq&#65289;&#65292;&#27880;&#20876;&#20013;&#26029;&#12290;&#35813;&#27493;&#39588;&#21644;device resource management&#26080;&#20851;&#12290;</P>
<P>5&#65289;&#27880;&#20876;&#25104;&#21151;&#21518;&#65292;&#20197;&#35774;&#22791;&#25351;&#38024;&#65288;dev&#65289;&#21644;&#36164;&#28304;&#25351;&#38024;&#65288;dr&#65289;&#20026;&#21442;&#25968;&#65292;&#35843;&#29992;devres_add&#65292;&#23558;&#36164;&#28304;&#28155;&#21152;&#21040;&#35774;&#22791;&#30340;&#36164;&#28304;&#38142;&#34920;&#22836;&#65288;devres_head&#65289;&#20013;&#65292;&#35813;&#25509;&#21475;&#23450;&#20041;&#22914;&#19979;&#65306;</P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> devres_add(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device *dev, <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> *res)</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN> {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> devres *dr = container_of(res, <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> devres, data);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">long</SPAN> flags;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN>         spin_lock_irqsave(&amp;dev-&gt;devres_lock, flags);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum7 style="COLOR: rgb(96,96,96)">   7:</SPAN>         add_dr(dev, &amp;dr-&gt;node);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum8 style="COLOR: rgb(96,96,96)">   8:</SPAN>         spin_unlock_irqrestore(&amp;dev-&gt;devres_lock, flags);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum9 style="COLOR: rgb(96,96,96)">   9:</SPAN> }</PRE><!--CRLF--></DIV></DIV>
<P>&#20174;&#36164;&#28304;&#25351;&#38024;&#20013;&#65292;&#21462;&#20986;&#23436;&#25972;&#30340;struct devres&#25351;&#38024;&#65292;&#35843;&#29992;add_dr&#25509;&#21475;&#12290;add_dr&#20063;&#24456;&#31616;&#21333;&#65292;&#25226;struct devres&#25351;&#38024;&#25346;&#21040;&#35774;&#22791;&#30340;devres_head&#20013;&#21363;&#21487;&#65306;</P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">static</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> add_dr(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device *dev, <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> devres_node *node)</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN> {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN>         devres_log(dev, node, <SPAN style="COLOR: rgb(0,96,128)">"ADD"</SPAN>);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN>         BUG_ON(!list_empty(&amp;node-&gt;entry));</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN>         list_add_tail(&amp;node-&gt;entry, &amp;dev-&gt;devres_head);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN> }</PRE><!--CRLF--></DIV></DIV>
<P>6&#65289;&#22914;&#26524;&#22833;&#36133;&#65292;&#21487;&#20197;&#36890;&#36807;devres_free&#25509;&#21475;&#37322;&#25918;&#36164;&#28304;&#21344;&#29992;&#30340;&#31354;&#38388;&#65292;devm_free_irq&#25509;&#21475;&#20013;&#65292;&#20250;&#35843;&#29992;devres_destroy&#25509;&#21475;&#65292;&#23558;devres&#20174;devres_head&#20013;&#31227;&#38500;&#65292;&#24182;&#37322;&#25918;&#36164;&#28304;&#12290;&#36825;&#37324;&#23601;&#19981;&#35814;&#32454;&#25551;&#36848;&#20102;&#12290;</P>
<H5>5.4 &#21521;&#35774;&#22791;&#27169;&#22411;&#25552;&#20379;&#30340;&#25509;&#21475;&#65306;devres_release_all</H5>
<P>&#36825;&#37324;&#26159;&#37325;&#28857;&#65292;&#29992;&#20110;&#33258;&#21160;&#37322;&#25918;&#36164;&#28304;&#12290;</P>
<P>&#20808;&#22238;&#24518;&#19968;&#19979;&#35774;&#22791;&#27169;&#22411;&#20013;probe&#30340;&#27969;&#31243;&#65288;&#21487;&#21442;&#32771;&#8220;<A href="http://www.wowotech.net/linux_kenrel/device_and_driver.html">Linux&#35774;&#22791;&#27169;&#22411;(5)_device&#21644;device driver</A>&#8221;&#65289;&#65292;devres_release_all&#25509;&#21475;&#34987;&#35843;&#29992;&#30340;&#26102;&#26426;&#26377;&#20004;&#20010;&#65306;</P>
<P>1&#65289;probe&#22833;&#36133;&#26102;&#65292;&#35843;&#29992;&#36807;&#31243;&#20026;&#65288;&#23601;&#19981;&#35814;&#32454;&#30340;&#36148;&#20195;&#30721;&#20102;&#65289;&#65306;</P>
<P>__driver_attach/__device_attach--&gt;driver_probe_device&#8212;&gt;really_probe&#65292;really_probe&#35843;&#29992;driver&#25110;&#32773;bus&#30340;probe&#25509;&#21475;&#65292;&#22914;&#26524;&#22833;&#36133;&#65288;&#36820;&#22238;&#20540;&#38750;&#38646;&#65292;&#21487;&#21442;&#32771;&#26412;&#25991;&#24320;&#22836;&#30340;&#20363;&#23376;&#65289;&#65292;&#21017;&#20250;&#35843;&#29992;devres_release_all&#12290;</P>
<P>2&#65289;deriver dettach&#26102;&#65288;&#23601;&#26159;driver remove&#26102;&#65289;</P>
<P>driver_detach/bus_remove_device--&gt;__device_release_driver--&gt;devres_release_all</P>
<P>devres_release_all&#30340;&#23454;&#29616;&#22914;&#19979;&#65306;</P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> devres_release_all(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device *dev)</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN> {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">long</SPAN> flags;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN>         <SPAN style="COLOR: rgb(0,128,0)">/* Looks like an uninitialized device structure */</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (WARN_ON(dev-&gt;devres_head.next == NULL))</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum7 style="COLOR: rgb(96,96,96)">   7:</SPAN>                 <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> -ENODEV;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum8 style="COLOR: rgb(96,96,96)">   8:</SPAN>         spin_lock_irqsave(&amp;dev-&gt;devres_lock, flags);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum9 style="COLOR: rgb(96,96,96)">   9:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> release_nodes(dev, dev-&gt;devres_head.next, &amp;dev-&gt;devres_head,</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum10 style="COLOR: rgb(96,96,96)">  10:</SPAN>                              flags);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum11 style="COLOR: rgb(96,96,96)">  11:</SPAN> }</PRE><!--CRLF--></DIV></DIV>
<P>&#20197;&#35774;&#22791;&#25351;&#38024;&#20026;&#21442;&#25968;&#65292;&#30452;&#25509;&#35843;&#29992;release_nodes&#65306;</P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">static</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> release_nodes(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device *dev, <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> list_head *first,</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN>                          <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> list_head *end, <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">long</SPAN> flags)</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN>         __releases(&amp;dev-&gt;devres_lock)</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN> {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN>         LIST_HEAD(todo);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> cnt;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum7 style="COLOR: rgb(96,96,96)">   7:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> devres *dr, *tmp;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum8 style="COLOR: rgb(96,96,96)">   8:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum9 style="COLOR: rgb(96,96,96)">   9:</SPAN>         cnt = remove_nodes(dev, first, end, &amp;todo);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum10 style="COLOR: rgb(96,96,96)">  10:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum11 style="COLOR: rgb(96,96,96)">  11:</SPAN>         spin_unlock_irqrestore(&amp;dev-&gt;devres_lock, flags);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum12 style="COLOR: rgb(96,96,96)">  12:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum13 style="COLOR: rgb(96,96,96)">  13:</SPAN>         <SPAN style="COLOR: rgb(0,128,0)">/* Release.  Note that both devres and devres_group are</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum14 style="COLOR: rgb(96,96,96)">  14:</SPAN> <SPAN style="COLOR: rgb(0,128,0)">         * handled as devres in the following loop.  This is safe.</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum15 style="COLOR: rgb(96,96,96)">  15:</SPAN> <SPAN style="COLOR: rgb(0,128,0)">         */</SPAN></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum16 style="COLOR: rgb(96,96,96)">  16:</SPAN>         list_for_each_entry_safe_reverse(dr, tmp, &amp;todo, node.entry) {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum17 style="COLOR: rgb(96,96,96)">  17:</SPAN>                 devres_log(dev, &amp;dr-&gt;node, <SPAN style="COLOR: rgb(0,96,128)">"REL"</SPAN>);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum18 style="COLOR: rgb(96,96,96)">  18:</SPAN>                 dr-&gt;node.release(dev, dr-&gt;data);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum19 style="COLOR: rgb(96,96,96)">  19:</SPAN>                 kfree(dr);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum20 style="COLOR: rgb(96,96,96)">  20:</SPAN>         }</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum21 style="COLOR: rgb(96,96,96)">  21:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum22 style="COLOR: rgb(96,96,96)">  22:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> cnt;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum23 style="COLOR: rgb(96,96,96)">  23:</SPAN> }</PRE><!--CRLF--></DIV></DIV>
<P>release_nodes&#20250;&#20808;&#35843;&#29992;remove_nodes&#65292;&#23558;&#35774;&#22791;&#25152;&#26377;&#30340;struct devres&#25351;&#38024;&#20174;&#35774;&#22791;&#30340;devres_head&#20013;&#31227;&#38500;&#12290;&#28982;&#21518;&#65292;&#35843;&#29992;&#25152;&#26377;&#36164;&#28304;&#30340;release&#22238;&#35843;&#20989;&#25968;&#65288;&#22914;5.3&#23567;&#33410;&#25551;&#36848;&#30340;devm_irq_release&#65289;&#65292;&#22238;&#35843;&#20989;&#25968;&#20250;&#22238;&#25910;&#20855;&#20307;&#30340;&#36164;&#28304;&#65288;&#22914;free_irq)&#12290;&#26368;&#21518;&#65292;&#35843;&#29992;free&#65292;&#37322;&#25918;devres&#20197;&#21450;&#36164;&#28304;&#25152;&#21344;&#30340;&#31354;&#38388;&#12290;</P>
<P>&nbsp;</P>
<P><EM>&#21407;&#21019;&#25991;&#31456;&#65292;&#36716;&#21457;&#35831;&#27880;&#26126;&#20986;&#22788;&#12290;&#34583;&#31389;&#31185;&#25216;</EM>&#65292;<A href="http://www.wowotech.net/linux_kenrel/device_resource_management.html">www.wowotech.net</A>&#12290;