<H2>Linux&#35774;&#22791;&#27169;&#22411;(8)_platform&#35774;&#22791;</H2>
<P class=date>&#20316;&#32773;&#65306;<A href="http://www.wowotech.net/author/2">&#34583;&#34583;</A> &#21457;&#24067;&#20110;&#65306;2014-4-28 10:24 &#20998;&#31867;&#65306;<A href="http://www.wowotech.net/sort/device_model">&#32479;&#19968;&#35774;&#22791;&#27169;&#22411;</A> </P>
<H4>1. &#21069;&#35328; </H4>
<P><FONT class=extract>&#22312;Linux&#35774;&#22791;&#27169;&#22411;&#30340;&#25277;&#35937;&#20013;&#65292;&#23384;&#22312;&#30528;&#19968;&#31867;&#31216;&#20316;&#8220;Platform Device&#8221;&#30340;&#35774;&#22791;&#65292;&#20869;&#26680;&#26159;&#36825;&#26679;&#25551;&#36848;&#23427;&#20204;&#30340;&#65288;Documentation/driver-model/platform.txt&#65289;&#65306; </FONT></P>
<BLOCKQUOTE>
<P><FONT class=extract>Platform devices are devices that typically appear as autonomous entities in the system. This includes legacy port-based devices and host bridges to peripheral buses, and most controllers integrated into system-on-chip platforms.&nbsp; What they usually have in common is direct addressing from a CPU bus.&nbsp; Rarely, a platform_device will be connected through a segment of some other kind of bus; but its registers will still be directly addressable. </FONT></P></BLOCKQUOTE>
<P><FONT class=extract>&#27010;&#25324;&#26469;&#35828;&#65292;Platform&#35774;&#22791;&#21253;&#25324;&#65306;&#22522;&#20110;&#31471;&#21475;&#30340;&#35774;&#22791;&#65288;&#24050;&#19981;&#25512;&#33616;&#20351;&#29992;&#65292;&#20445;&#30041;&#19979;&#26469;&#21482;&#20026;&#20860;&#23481;&#26087;&#35774;&#22791;&#65292;legacy&#65289;&#65307;&#36830;&#25509;&#29289;&#29702;&#24635;&#32447;&#30340;&#26725;&#35774;&#22791;&#65307;&#38598;&#25104;&#22312;SOC&#24179;&#21488;&#19978;&#38754;&#30340;&#25511;&#21046;&#22120;&#65307;&#36830;&#25509;&#22312;&#20854;&#23427;bus&#19978;&#30340;&#35774;&#22791;&#65288;&#24456;&#23569;&#35265;&#65289;&#12290;&#31561;&#31561;&#12290; </FONT></P>
<P><FONT class=extract>&#36825;&#20123;&#35774;&#22791;&#26377;&#19968;&#20010;&#22522;&#26412;&#30340;&#29305;&#24449;&#65306;&#21487;&#20197;&#36890;&#36807;CPU bus&#30452;&#25509;&#23547;&#22336;&#65288;&#20363;&#22914;&#22312;&#23884;&#20837;&#24335;&#31995;&#32479;&#24120;&#35265;&#30340;&#8220;&#23492;&#23384;&#22120;&#8221;&#65289;&#12290;&#22240;&#27492;&#65292;&#30001;&#20110;&#36825;&#20010;&#20849;&#24615;&#65292;&#20869;&#26680;&#22312;&#35774;&#22791;&#27169;&#22411;&#30340;&#22522;&#30784;&#19978;&#65288;device&#21644;device_driver&#65289;&#65292;&#23545;&#36825;&#20123;&#35774;&#22791;&#36827;&#34892;&#20102;&#26356;&#36827;&#19968;&#27493;&#30340;&#23553;&#35013;&#65292;&#25277;&#35937;&#20986;paltform bus&#12289;platform device&#21644;platform driver&#65292;&#20197;&#20415;&#39537;&#21160;&#24320;&#21457;&#20154;&#21592;&#21487;&#20197;&#26041;&#20415;&#30340;&#24320;&#21457;&#36825;&#31867;&#35774;&#22791;&#30340;&#39537;&#21160;&#12290; </FONT></P>
<P><FONT class=extract>&#21487;&#20197;&#35828;&#65292;paltform&#35774;&#22791;&#23545;Linux&#39537;&#21160;&#24037;&#31243;&#24072;&#26159;&#38750;&#24120;&#37325;&#35201;&#30340;&#65292;&#22240;&#20026;&#25105;&#20204;&#32534;&#20889;&#30340;&#22823;&#22810;&#25968;&#35774;&#22791;&#39537;&#21160;&#65292;&#37117;&#26159;&#20026;&#20102;&#39537;&#21160;plaftom&#35774;&#22791;&#12290;</FONT>&#26412;&#25991;&#25105;&#20204;&#23601;&#26469;&#30475;&#30475;Platform&#35774;&#22791;&#22312;&#20869;&#26680;&#20013;&#30340;&#23454;&#29616;&#12290; </P>
<H4>2. Platform&#27169;&#22359;&#30340;&#36719;&#20214;&#26550;&#26500; </H4>
<P>&#20869;&#26680;&#20013;Platform&#35774;&#22791;&#26377;&#20851;&#30340;&#23454;&#29616;&#20301;&#20110;include/linux/platform_device.h&#21644;drivers/base/platform.c&#20004;&#20010;&#25991;&#20214;&#20013;&#65292;&#23427;&#30340;&#36719;&#20214;&#26550;&#26500;&#22914;&#19979;&#65306; </P>
<P><A href="http://www.wowotech.net/content/uploadfile/201405/8cf2e12b367205a9c1c7888e2dcb818520140507093250.gif"><IMG title=Platform&#35774;&#22791;&#36719;&#20214;&#26550;&#26500; style="BORDER-LEFT-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; FLOAT: none; MARGIN-LEFT: auto; DISPLAY: block; BORDER-TOP-WIDTH: 0px; MARGIN-RIGHT: auto" border=0 alt=Platform&#35774;&#22791;&#36719;&#20214;&#26550;&#26500; src="http://www.wowotech.net/content/uploadfile/201405/17339e2f323c0379fb16bdbea9aaf29720140507093251.gif" width=640 height=364></A> </P>
<P>&#30001;&#22270;&#29255;&#21487;&#30693;&#65292;<FONT class=extract>Platform&#35774;&#22791;&#22312;&#20869;&#26680;&#20013;&#30340;&#23454;&#29616;&#20027;&#35201;&#21253;&#25324;&#19977;&#20010;&#37096;&#20998;&#65306; </FONT></P>
<P><FONT class=extract>Platform Bus&#65292;&#22522;&#20110;&#24213;&#23618;bus&#27169;&#22359;&#65292;&#25277;&#35937;&#20986;&#19968;&#20010;&#34394;&#25311;&#30340;Platform bus&#65292;&#29992;&#20110;&#25346;&#36733;Platform&#35774;&#22791;&#65307; <BR>Platform Device&#65292;&#22522;&#20110;&#24213;&#23618;device&#27169;&#22359;&#65292;&#25277;&#35937;&#20986;Platform Device&#65292;&#29992;&#20110;&#34920;&#31034;Platform&#35774;&#22791;&#65307; <BR>Platform Driver&#65292;&#22522;&#20110;&#24213;&#23618;device_driver&#27169;&#22359;&#65292;&#25277;&#35937;&#20986;Platform Driver&#65292;&#29992;&#20110;&#39537;&#21160;Platform&#35774;&#22791;&#12290;</FONT> </P>
<P>&#20854;&#20013;Platform Device&#21644;Platform Driver&#20250;&#20250;&#20854;&#23427;Driver&#25552;&#20379;&#23553;&#35013;&#22909;&#30340;API&#65292;&#20855;&#20307;&#21487;&#21442;&#32771;&#21518;&#38754;&#30340;&#25551;&#36848;&#12290; </P>
<H4>3. Platform&#27169;&#22359;&#21521;&#20854;&#23427;&#27169;&#22359;&#25552;&#20379;&#30340;API&#27719;&#25972; </H4>
<P>Platform&#25552;&#20379;&#30340;&#25509;&#21475;&#21253;&#25324;&#65306;Platform Device&#21644;Platform Driver&#20004;&#20010;&#25968;&#25454;&#32467;&#26500;&#65292;&#20197;&#21450;&#23427;&#20204;&#30340;&#25805;&#20316;&#20989;&#25968;&#12290; </P>
<H5>3.1 &#25968;&#25454;&#32467;&#26500; </H5>
<P>1. <FONT class=extract>&#29992;&#20110;&#25277;&#35937;Platform&#35774;&#22791;&#30340;&#25968;&#25454;&#32467;&#26500;----&#8220;struct platform_device&#8221;&#65306; </FONT></P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,128,0)">/* include/linux/platform_device.h, line 22 */</SPAN></FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device {</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">char</SPAN>      *name;</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">int</SPAN>             id;</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">bool</SPAN>            id_auto; </FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device   dev;</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum7 style="COLOR: rgb(96,96,96)">   7:</SPAN>         u32             num_resources;</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum8 style="COLOR: rgb(96,96,96)">   8:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> resource *resource;</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum9 style="COLOR: rgb(96,96,96)">   9:</SPAN>&nbsp; </FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum10 style="COLOR: rgb(96,96,96)">  10:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device_id *id_entry;</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum11 style="COLOR: rgb(96,96,96)">  11:</SPAN>         </FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum12 style="COLOR: rgb(96,96,96)">  12:</SPAN>         <SPAN style="COLOR: rgb(0,128,0)">/* MFD cell pointer */</SPAN></FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum13 style="COLOR: rgb(96,96,96)">  13:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> mfd_cell *mfd_cell;</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum14 style="COLOR: rgb(96,96,96)">  14:</SPAN>&nbsp; </FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum15 style="COLOR: rgb(96,96,96)">  15:</SPAN>         <SPAN style="COLOR: rgb(0,128,0)">/* arch specific additions */</SPAN></FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum16 style="COLOR: rgb(96,96,96)">  16:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> pdev_archdata    archdata;</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum17 style="COLOR: rgb(96,96,96)">  17:</SPAN> };</FONT></PRE><!--CRLF--></DIV></DIV>
<BLOCKQUOTE>
<P><FONT class=extract>&#35813;&#32467;&#26500;&#30340;&#35299;&#37322;&#22914;&#19979;&#65306; </FONT></P>
<P><FONT class=extract>dev&#65292;&#30495;&#27491;&#30340;&#35774;&#22791;&#65288;Platform&#35774;&#22791;&#21482;&#26159;&#19968;&#20010;&#29305;&#27530;&#30340;&#35774;&#22791;&#65292;&#22240;&#27492;&#20854;&#26680;&#24515;&#36923;&#36753;&#36824;&#26159;&#30001;&#24213;&#23618;&#30340;&#27169;&#22359;&#23454;&#29616;&#65289;&#12290; </FONT></P>
<P><FONT class=extract>name&#65292;&#35774;&#22791;&#30340;&#21517;&#31216;&#65292;&#21644;struct device&#32467;&#26500;&#20013;&#30340;init_name&#65288;"</FONT><A href="http://www.wowotech.net/linux_kenrel/device_and_driver.html"><FONT class=extract>Linux&#35774;&#22791;&#27169;&#22411;(5)_device&#21644;device driver</FONT></A><FONT class=extract>&#8221;&#65289;&#24847;&#20041;&#30456;&#21516;&#12290;&#23454;&#38469;&#19978;&#65292;&#35813;&#21517;&#31216;&#22312;&#35774;&#22791;&#27880;&#20876;&#26102;&#65292;&#20250;&#25335;&#36125;&#21040;dev.init_name&#20013;&#12290; </FONT></P>
<P><FONT class=extract>id&#65292;&#29992;&#20110;&#26631;&#35782;&#35813;&#35774;&#22791;&#30340;ID&#12290; <BR>&#22312;&#8220;</FONT><A href="http://www.wowotech.net/linux_kenrel/bus.html"><FONT class=extract>Linux&#35774;&#22791;&#27169;&#22411;(6)_Bus</FONT></A><FONT class=extract>&#8221;&#20013;&#26377;&#25552;&#36807;&#65292;&#20869;&#26680;&#20801;&#35768;&#23384;&#22312;&#22810;&#20010;&#21517;&#31216;&#30456;&#21516;&#30340;&#35774;&#22791;&#12290;&#32780;&#35774;&#22791;&#39537;&#21160;&#30340;probe&#65292;&#20381;&#36182;&#20110;&#21517;&#31216;&#65292;Linux&#37319;&#21462;&#30340;&#31574;&#30053;&#26159;&#65306;&#22312;bus&#30340;&#35774;&#22791;&#38142;&#34920;&#20013;&#26597;&#25214;device&#65292;&#21644;&#23545;&#24212;&#30340;device_driver&#27604;&#23545;name&#65292;&#22914;&#26524;&#30456;&#21516;&#65292;&#21017;&#26597;&#30475;&#35813;&#35774;&#22791;&#26159;&#21542;&#24050;&#32463;&#32465;&#23450;&#20102;driver&#65288;&#26597;&#30475;&#20854;dev-&gt;driver&#25351;&#38024;&#26159;&#21542;&#20026;&#31354;&#65289;&#65292;&#22914;&#26524;&#24050;&#32465;&#23450;&#65292;&#21017;&#19981;&#20250;&#25191;&#34892;probe&#21160;&#20316;&#65292;&#22914;&#26524;&#27809;&#26377;&#32465;&#23450;&#65292;&#21017;&#20197;&#35813;device&#30340;&#25351;&#38024;&#20026;&#21442;&#25968;&#65292;&#35843;&#29992;driver&#30340;probe&#25509;&#21475;&#12290; <BR>&#22240;&#27492;&#65292;&#22312;driver&#30340;probe&#25509;&#21475;&#20013;&#65292;&#36890;&#36807;&#21028;&#26029;&#35774;&#22791;&#30340;ID&#65292;&#21487;&#20197;&#30693;&#36947;&#27492;&#27425;&#39537;&#21160;&#30340;&#35774;&#22791;&#26159;&#21738;&#20010;&#12290; </FONT></P>
<P><FONT class=extract>id_auto&#65292;&#25351;&#31034;&#22312;&#27880;&#20876;&#35774;&#22791;&#26102;&#65292;&#26159;&#21542;&#33258;&#21160;&#36171;&#20104;ID&#20540;&#65288;&#19981;&#38656;&#35201;&#20154;&#20026;&#25351;&#23450;&#21862;&#65292;&#21487;&#20197;&#25042;&#19968;&#28857;&#21862;&#65289;&#12290; </FONT></P>
<P><FONT class=extract>num_resources&#12289;resource&#65292;&#35813;&#35774;&#22791;&#30340;&#36164;&#28304;&#25551;&#36848;&#65292;&#30001;struct resource&#65288;include/linux/ioport.h&#65289;&#32467;&#26500;&#25277;&#35937;&#12290; <BR></FONT><FONT class=extract><SPAN style="COLOR: rgb(0,0,255)">&#22312;Linux&#20013;&#65292;&#31995;&#32479;&#36164;&#28304;&#21253;&#25324;I/O&#12289;Memory&#12289;Register&#12289;IRQ&#12289;DMA&#12289;Bus&#31561;&#22810;&#31181;&#31867;&#22411;&#12290;&#36825;&#20123;&#36164;&#28304;&#22823;&#22810;&#20855;&#26377;&#29420;&#21344;&#24615;&#65292;&#19981;&#20801;&#35768;&#22810;&#20010;&#35774;&#22791;&#21516;&#26102;&#20351;&#29992;&#65292;&#22240;&#27492;Linux&#20869;&#26680;&#25552;&#20379;&#20102;&#19968;&#20123;API&#65292;&#29992;&#20110;&#20998;&#37197;&#12289;&#31649;&#29702;&#36825;&#20123;&#36164;&#28304;&#12290; <BR>&#24403;&#26576;&#20010;&#35774;&#22791;&#38656;&#35201;&#20351;&#29992;&#26576;&#20123;&#36164;&#28304;&#26102;&#65292;&#21482;&#38656;&#21033;&#29992;struct resource&#32452;&#32455;&#36825;&#20123;&#36164;&#28304;&#65288;&#22914;&#21517;&#31216;&#12289;&#31867;&#22411;&#12289;&#36215;&#22987;&#12289;&#32467;&#26463;&#22320;&#22336;&#31561;&#65289;&#65292;&#24182;&#20445;&#23384;&#22312;&#35813;&#35774;&#22791;&#30340;resource&#25351;&#38024;&#20013;&#21363;&#21487;&#12290;&#28982;&#21518;&#22312;&#35774;&#22791;probe&#26102;&#65292;&#35774;&#22791;&#38656;&#27714;&#20250;&#35843;&#29992;&#36164;&#28304;&#31649;&#29702;&#25509;&#21475;&#65292;&#20998;&#37197;&#12289;&#20351;&#29992;&#36825;&#20123;&#36164;&#28304;&#12290;&#32780;&#20869;&#26680;&#30340;&#36164;&#28304;&#31649;&#29702;&#36923;&#36753;&#65292;&#21487;&#20197;&#21028;&#26029;&#36825;&#20123;&#36164;&#28304;&#26159;&#21542;&#24050;&#34987;&#20351;&#29992;&#12289;&#26159;&#21542;&#21487;&#34987;&#20351;&#29992;&#31561;&#31561;&#12290;</SPAN> </FONT></P>
<P><FONT class=extract>id_entry&#65292;&#21644;&#20869;&#26680;&#27169;&#22359;&#30456;&#20851;&#30340;&#20869;&#23481;&#65292;&#26242;&#19981;&#35828;&#26126;&#12290; </FONT></P>
<P><FONT class=extract>mfd_cell&#65292;&#21644;MFD&#35774;&#22791;&#30456;&#20851;&#30340;&#20869;&#23481;&#65292;&#26242;&#19981;&#35828;&#26126;&#12290; </FONT></P>
<P><FONT class=extract>archdata&#65292;&#19968;&#20010;&#22855;&#33897;&#30340;&#23384;&#22312;&#65281;&#65281;&#23427;&#30340;&#30446;&#30340;&#26159;&#20026;&#20102;&#20445;&#23384;&#19968;&#20123;architecture&#30456;&#20851;&#30340;&#25968;&#25454;&#65292;&#21435;&#30475;&#30475;arch/arm/include/asm/device.h&#20013;struct pdev_archdata&#32467;&#26500;&#30340;&#23450;&#20041;&#65292;&#23601;&#30693;&#36947;&#36825;&#31181;&#25918;&#32437;&#30340;&#35774;&#35745;&#26377;&#22810;&#20040;&#22403;&#22334;&#20102;&#12290;&#19981;&#31649;&#23427;&#20102;&#65281;&#65281;</FONT>&nbsp;&nbsp; </P></BLOCKQUOTE>
<P>2. <FONT class=extract>&#29992;&#20110;&#25277;&#35937;Platform&#35774;&#22791;&#39537;&#21160;&#30340;&#25968;&#25454;&#32467;&#26500;----&#8220;struct platform_driver&#8221;&#65306; </FONT></P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,128,0)">/* include/linux/platform_device.h, line 173 */</SPAN></FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_driver {</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> (*probe)(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> (*remove)(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> (*shutdown)(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> (*suspend)(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *, pm_message_t state);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum7 style="COLOR: rgb(96,96,96)">   7:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> (*resume)(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum8 style="COLOR: rgb(96,96,96)">   8:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device_driver driver;</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum9 style="COLOR: rgb(96,96,96)">   9:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device_id *id_table;</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum10 style="COLOR: rgb(96,96,96)">  10:</SPAN> };</FONT></PRE><!--CRLF--></DIV></DIV>
<BLOCKQUOTE>
<P><FONT class=extract>struct platform_driver&#32467;&#26500;&#21644;struct device_driver&#38750;&#24120;&#31867;&#20284;&#65292;&#26080;&#38750;&#23601;&#26159;&#25552;&#20379;probe&#12289;remove&#12289;suspend&#12289;resume&#31561;&#22238;&#35843;&#20989;&#25968;&#65292;&#36825;&#37324;&#19981;&#20877;&#32454;&#35828;&#12290; </FONT></P>
<P><FONT class=extract>&#21478;&#22806;&#36825;&#37324;&#26377;&#19968;&#20010;id_table&#30340;&#25351;&#38024;&#65292;&#35813;&#25351;&#38024;&#21644;"</FONT><A href="http://www.wowotech.net/linux_kenrel/device_and_driver.html"><FONT class=extract>Linux&#35774;&#22791;&#27169;&#22411;(5)_device&#21644;device driver</FONT></A><FONT class=extract>&#8221;&#25152;&#25551;&#36848;&#30340;of_match_table&#12289;acpi_match_table&#30340;&#21151;&#33021;&#31867;&#20284;&#65306;&#25552;&#20379;&#20854;&#23427;&#26041;&#24335;&#30340;&#35774;&#22791;probe&#12290; <BR><SPAN style="COLOR: rgb(255,0,0)">&#25105;&#20204;&#22312;"</SPAN></FONT><A href="http://www.wowotech.net/linux_kenrel/device_and_driver.html"><SPAN style="COLOR: rgb(255,0,0)"><FONT class=extract>Linux&#35774;&#22791;&#27169;&#22411;(5)_device&#21644;device driver</FONT></SPAN></A><SPAN style="COLOR: rgb(255,0,0)"><FONT class=extract>&#8221;&#35762;&#36807;&#65292;&#20869;&#26680;&#20250;&#22312;&#21512;&#36866;&#30340;&#26102;&#26426;&#26816;&#26597;device&#21644;device_driver&#30340;&#21517;&#23383;&#65292;&#22914;&#26524;&#21305;&#37197;&#65292;&#21017;&#25191;&#34892;probe&#12290;&#20854;&#23454;&#38500;&#20102;&#21517;&#31216;&#20043;&#22806;&#65292;&#36824;&#26377;&#19968;&#20123;&#23485;&#27867;&#30340;&#21305;&#37197;&#26041;&#24335;&#65292;&#20363;&#22914;&#36825;&#37324;&#25552;&#21040;&#30340;&#21508;&#31181;match table&#65292;&#20855;&#20307;&#21407;&#29702;&#23601;&#20808;&#19981;&#32599;&#21990;&#20102;&#65292;&#24466;&#28155;&#28902;&#24700;&#65281;&#23601;&#24403;&#27809;&#30475;&#35265;&#65292;&#21621;&#21621;&#12290;</FONT> <BR></SPAN></P></BLOCKQUOTE>
<H5>3.2 Platform Device&#25552;&#20379;&#30340;API </H5>
<P><FONT class=extract>Platform Device&#20027;&#35201;&#25552;&#20379;&#35774;&#22791;&#30340;&#20998;&#37197;&#12289;&#27880;&#20876;&#31561;&#25509;&#21475;&#65292;&#20379;&#20854;&#23427;driver&#20351;&#29992;&#65292;&#20855;&#20307;&#21253;&#25324;&#65306; </FONT></P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,128,0)">/* include/linux/platform_device.h */</SPAN></FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> platform_device_register(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> platform_device_unregister(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN>&nbsp; </FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> arch_setup_pdev_archdata(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> resource *platform_get_resource(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *,</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum7 style="COLOR: rgb(96,96,96)">   7:</SPAN>                                               <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN>, <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN>);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum8 style="COLOR: rgb(96,96,96)">   8:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> platform_get_irq(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *, <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN>);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum9 style="COLOR: rgb(96,96,96)">   9:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> resource *platform_get_resource_byname(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *,</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum10 style="COLOR: rgb(96,96,96)">  10:</SPAN>                                                      <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN>,</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum11 style="COLOR: rgb(96,96,96)">  11:</SPAN>                                                      <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">char</SPAN> *);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum12 style="COLOR: rgb(96,96,96)">  12:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> platform_get_irq_byname(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *, <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">char</SPAN> *);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum13 style="COLOR: rgb(96,96,96)">  13:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> platform_add_devices(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device **, <SPAN style="COLOR: rgb(0,0,255)">int</SPAN>);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum14 style="COLOR: rgb(96,96,96)">  14:</SPAN>&nbsp; </FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum15 style="COLOR: rgb(96,96,96)">  15:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *platform_device_register_full(</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum16 style="COLOR: rgb(96,96,96)">  16:</SPAN>                 <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device_info *pdevinfo);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum17 style="COLOR: rgb(96,96,96)">  17:</SPAN>&nbsp; </FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum18 style="COLOR: rgb(96,96,96)">  18:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">static</SPAN> <SPAN style="COLOR: rgb(0,0,255)">inline</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *platform_device_register_resndata(</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum19 style="COLOR: rgb(96,96,96)">  19:</SPAN>                 <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device *parent, <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">char</SPAN> *name, <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> id,</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum20 style="COLOR: rgb(96,96,96)">  20:</SPAN>                 <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> resource *res, <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> num,</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum21 style="COLOR: rgb(96,96,96)">  21:</SPAN>                 <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> *data, size_t size)</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum22 style="COLOR: rgb(96,96,96)">  22:</SPAN>&nbsp; </FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum23 style="COLOR: rgb(96,96,96)">  23:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">static</SPAN> <SPAN style="COLOR: rgb(0,0,255)">inline</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *platform_device_register_simple(</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum24 style="COLOR: rgb(96,96,96)">  24:</SPAN>                 <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">char</SPAN> *name, <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> id,</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum25 style="COLOR: rgb(96,96,96)">  25:</SPAN>                 <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> resource *res, <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> num)</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum26 style="COLOR: rgb(96,96,96)">  26:</SPAN>&nbsp; </FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum27 style="COLOR: rgb(96,96,96)">  27:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">static</SPAN> <SPAN style="COLOR: rgb(0,0,255)">inline</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *platform_device_register_data(</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum28 style="COLOR: rgb(96,96,96)">  28:</SPAN>                 <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> device *parent, <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">char</SPAN> *name, <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> id,</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum29 style="COLOR: rgb(96,96,96)">  29:</SPAN>                 <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> *data, size_t size)</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum30 style="COLOR: rgb(96,96,96)">  30:</SPAN>&nbsp; </FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum31 style="COLOR: rgb(96,96,96)">  31:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *platform_device_alloc(<SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">char</SPAN> *name, <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> id);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum32 style="COLOR: rgb(96,96,96)">  32:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> platform_device_add_resources(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *pdev,</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum33 style="COLOR: rgb(96,96,96)">  33:</SPAN>                                          <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> resource *res,</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum34 style="COLOR: rgb(96,96,96)">  34:</SPAN>                                          <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> num);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum35 style="COLOR: rgb(96,96,96)">  35:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> platform_device_add_data(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *pdev,</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum36 style="COLOR: rgb(96,96,96)">  36:</SPAN>                                     <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> *data, size_t size);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum37 style="COLOR: rgb(96,96,96)">  37:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> platform_device_add(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *pdev);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum38 style="COLOR: rgb(96,96,96)">  38:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> platform_device_del(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *pdev);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum39 style="COLOR: rgb(96,96,96)">  39:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> platform_device_put(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *pdev);</FONT></PRE><!--CRLF--></DIV></DIV>
<BLOCKQUOTE>
<P><FONT class=extract>platform_device_register&#12289;platform_device_unregister&#65292;Platform&#35774;&#22791;&#30340;&#27880;&#20876;/&#27880;&#38144;&#25509;&#21475;&#65292;&#21644;&#24213;&#23618;&#30340;device_register&#31561;&#25509;&#21475;&#31867;&#20284;&#12290; </FONT></P>
<P><FONT class=extract>arch_setup_pdev_archdata&#65292;&#35774;&#32622;platform_device&#21464;&#37327;&#20013;&#30340;archdata&#25351;&#38024;&#12290; </FONT></P>
<P><FONT class=extract>platform_get_resource&#12289;platform_get_irq&#12289;platform_get_resource_byname&#12289;platform_get_irq_byname&#65292;&#36890;&#36807;&#36825;&#20123;&#25509;&#21475;&#65292;&#21487;&#20197;&#33719;&#21462;platform_device&#21464;&#37327;&#20013;&#30340;resource&#20449;&#24687;&#65292;&#20197;&#21450;&#30452;&#25509;&#33719;&#21462;IRQ&#30340;number&#31561;&#31561;&#12290; </FONT></P>
<P><FONT class=extract>platform_device_register_full&#12289;platform_device_register_resndata&#12289;platform_device_register_simple&#12289;platform_device_register_data&#65292;&#20854;&#23427;&#24418;&#24335;&#30340;&#35774;&#22791;&#27880;&#20876;&#12290;&#35843;&#29992;&#32773;&#21482;&#38656;&#35201;&#25552;&#20379;&#19968;&#20123;&#24517;&#35201;&#30340;&#20449;&#24687;&#65292;&#22914;name&#12289;ID&#12289;resource&#31561;&#65292;Platform&#27169;&#22359;&#23601;&#20250;&#33258;&#21160;&#20998;&#37197;&#19968;&#20010;struct platform_device&#21464;&#37327;&#65292;&#22635;&#20805;&#20869;&#23481;&#21518;&#65292;&#27880;&#20876;&#21040;&#20869;&#26680;&#20013;&#12290; </FONT></P>
<P><FONT class=extract>platform_device_alloc&#65292;&#20197;name&#21644;id&#20026;&#21442;&#25968;&#65292;&#21160;&#24577;&#20998;&#37197;&#19968;&#20010;struct platform_device&#21464;&#37327;&#12290; </FONT></P>
<P><FONT class=extract>platform_device_add_resources&#65292;&#21521;platform device&#20013;&#22686;&#21152;&#36164;&#28304;&#25551;&#36848;&#12290; </FONT></P>
<P><FONT class=extract>platform_device_add_data&#65292;&#21521;platform device&#20013;&#28155;&#21152;&#33258;&#23450;&#20041;&#30340;&#25968;&#25454;&#65288;&#20445;&#23384;&#22312;pdev-&gt;dev.platform_data&#25351;&#38024;&#20013;&#65289;&#12290; </FONT></P>
<P><FONT class=extract>platform_device_add&#12289;platform_device_del&#12289;platform_device_put&#65292;&#20854;&#23427;&#25805;&#20316;&#25509;&#21475;&#12290;</FONT> </P></BLOCKQUOTE>
<H5>3.3 Platform Driver&#25552;&#20379;&#30340;API </H5>
<P><FONT class=extract>Platform Driver&#25552;&#20379;struct platform_driver&#30340;&#20998;&#37197;&#12289;&#27880;&#20876;&#31561;&#21151;&#33021;&#65292;&#20855;&#20307;&#22914;&#19979;&#65306; </FONT></P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,128,0)">/* include/linux/platform_device.h */</SPAN></FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN>&nbsp; </FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> platform_driver_register(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_driver *);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> platform_driver_unregister(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_driver *);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN>&nbsp; </FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN> <SPAN style="COLOR: rgb(0,128,0)">/* non-hotpluggable platform devices may use this so that probe() and</SPAN></FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum7 style="COLOR: rgb(96,96,96)">   7:</SPAN> <SPAN style="COLOR: rgb(0,128,0)"> * its support may live in __init sections, conserving runtime memory.</SPAN></FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum8 style="COLOR: rgb(96,96,96)">   8:</SPAN> <SPAN style="COLOR: rgb(0,128,0)"> */</SPAN></FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum9 style="COLOR: rgb(96,96,96)">   9:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> platform_driver_probe(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_driver *driver,</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum10 style="COLOR: rgb(96,96,96)">  10:</SPAN>                 <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> (*probe)(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *));</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum11 style="COLOR: rgb(96,96,96)">  11:</SPAN>&nbsp; </FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum12 style="COLOR: rgb(96,96,96)">  12:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">static</SPAN> <SPAN style="COLOR: rgb(0,0,255)">inline</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> *platform_get_drvdata(<SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *pdev)</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum13 style="COLOR: rgb(96,96,96)">  13:</SPAN>&nbsp; </FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum14 style="COLOR: rgb(96,96,96)">  14:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">static</SPAN> <SPAN style="COLOR: rgb(0,0,255)">inline</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> platform_set_drvdata(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *pdev,</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum15 style="COLOR: rgb(96,96,96)">  15:</SPAN>                                         <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> *data)</FONT></PRE><!--CRLF--></DIV></DIV>
<BLOCKQUOTE>
<P><FONT class=extract>platform_driver_registe&#12289;platform_driver_unregister&#65292;platform driver&#30340;&#27880;&#20876;&#12289;&#27880;&#38144;&#25509;&#21475;&#12290; </FONT></P>
<P><FONT class=extract>platform_driver_probe&#65292;&#20027;&#21160;&#25191;&#34892;probe&#21160;&#20316;&#12290; </FONT></P>
<P><FONT class=extract>platform_set_drvdata&#12289;platform_get_drvdata&#65292;&#35774;&#32622;&#25110;&#32773;&#33719;&#21462;driver&#20445;&#23384;&#22312;device&#21464;&#37327;&#20013;&#30340;&#31169;&#26377;&#25968;&#25454;&#12290;</FONT> </P></BLOCKQUOTE>
<H5>3.4 &#25042;&#20154;API </H5>
<P><FONT class=extract>&#21448;&#26159;&#27880;&#20876;platform device&#65292;&#21448;&#26159;&#27880;&#20876;platform driver&#65292;&#30475;&#30528;&#25402;&#21872;&#21990;&#30340;&#12290;&#19981;&#36807;&#20869;&#26680;&#24819;&#21040;&#20102;&#36825;&#28857;&#65292;&#25152;&#20197;&#25552;&#20379;&#19968;&#20010;&#25042;&#20154;API&#65292;&#21487;&#20197;&#21516;&#26102;&#27880;&#20876;platform driver&#65292;&#24182;&#20998;&#37197;&#19968;&#20010;platform device&#65306; </FONT></P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *platform_create_bundle(</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_driver *driver, <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> (*probe)(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *),</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> resource *res, <SPAN style="COLOR: rgb(0,0,255)">unsigned</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> n_res,</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">const</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> *data, size_t size);</FONT></PRE><!--CRLF--></DIV></DIV>
<BLOCKQUOTE>
<P><FONT class=extract>&#21482;&#35201;&#25552;&#20379;&#19968;&#20010;platform_driver&#65288;&#35201;&#25226;driver&#30340;probe&#25509;&#21475;&#26174;&#24335;&#30340;&#20256;&#20837;&#65289;&#65292;&#24182;&#21578;&#30693;&#35813;&#35774;&#22791;&#21344;&#29992;&#30340;&#36164;&#28304;&#20449;&#24687;&#65292;platform&#27169;&#22359;&#23601;&#20250;&#24110;&#24537;&#20998;&#37197;&#36164;&#28304;&#65292;&#24182;&#25191;&#34892;probe&#25805;&#20316;&#12290;&#23545;&#20110;&#37027;&#20123;&#19981;&#38656;&#35201;&#28909;&#25300;&#25554;&#30340;&#35774;&#22791;&#26469;&#35828;&#65292;&#36825;&#31181;&#26041;&#24335;&#26159;&#26368;&#30465;&#20107;&#30340;&#20102;&#12290;</FONT>&nbsp;&nbsp; </P></BLOCKQUOTE>
<H5>3.5 Early platform device/driver </H5>
<P><FONT class=extract>&#20869;&#26680;&#21551;&#21160;&#26102;&#65292;&#35201;&#23436;&#25104;&#19968;&#23450;&#30340;&#21021;&#22987;&#21270;&#25805;&#20316;&#20043;&#21518;&#65292;&#25165;&#20250;&#22788;&#29702;device&#21644;driver&#30340;&#27880;&#20876;&#21450;probe&#65292;&#22240;&#27492;&#22312;&#36825;&#20043;&#21069;&#65292;&#24120;&#35268;&#30340;platform&#35774;&#22791;&#26159;&#26080;&#27861;&#20351;&#29992;&#30340;&#12290;&#20294;&#26159;&#22312;Linux&#20013;&#65292;&#26377;&#20123;&#35774;&#22791;&#38656;&#35201;&#23613;&#26089;&#20351;&#29992;&#65288;&#22914;&#22312;&#21551;&#21160;&#36807;&#31243;&#20013;&#20805;&#24403;console&#36755;&#20986;&#30340;serial&#35774;&#22791;&#65289;&#65292;&#25152;&#20197;platform&#27169;&#22359;&#25552;&#20379;&#20102;&#19968;&#31181;&#31216;&#20316;Early platform device/driver&#30340;&#26426;&#21046;&#65292;&#20801;&#35768;&#39537;&#21160;&#24320;&#21457;&#20154;&#21592;&#65292;&#22312;&#24320;&#21457;&#39537;&#21160;&#26102;&#65292;&#21521;&#20869;&#26680;&#27880;&#20876;&#21487;&#22312;&#20869;&#26680;&#26089;&#26399;&#21551;&#21160;&#36807;&#31243;&#20013;&#20351;&#29992;&#30340;driver&#12290;&#36825;&#20123;&#26426;&#21046;&#25552;&#20379;&#20102;&#22914;&#19979;&#25509;&#21475;&#65306; </FONT></P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> early_platform_driver_register(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> early_platform_driver *epdrv,</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN>                                           <SPAN style="COLOR: rgb(0,0,255)">char</SPAN> *buf);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> early_platform_add_devices(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device **devs, <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> num);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN>&nbsp; </FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">static</SPAN> <SPAN style="COLOR: rgb(0,0,255)">inline</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> is_early_platform_device(<SPAN style="COLOR: rgb(0,0,255)">struct</SPAN> platform_device *pdev)</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN> {</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum7 style="COLOR: rgb(96,96,96)">   7:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> !pdev-&gt;dev.driver;</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum8 style="COLOR: rgb(96,96,96)">   8:</SPAN> }</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum9 style="COLOR: rgb(96,96,96)">   9:</SPAN>&nbsp; </FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum10 style="COLOR: rgb(96,96,96)">  10:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> early_platform_driver_register_all(<SPAN style="COLOR: rgb(0,0,255)">char</SPAN> *class_str);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum11 style="COLOR: rgb(96,96,96)">  11:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> early_platform_driver_probe(<SPAN style="COLOR: rgb(0,0,255)">char</SPAN> *class_str,</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum12 style="COLOR: rgb(96,96,96)">  12:</SPAN>                                        <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> nr_probe, <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> user_only);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum13 style="COLOR: rgb(96,96,96)">  13:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">extern</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> early_platform_cleanup(<SPAN style="COLOR: rgb(0,0,255)">void</SPAN>);</FONT></PRE><!--CRLF--></DIV></DIV>
<BLOCKQUOTE>
<P><FONT class=extract>early_platform_driver_register&#65292;&#27880;&#20876;&#19968;&#20010;&#29992;&#20110;Early device&#30340;driver&#12290; </FONT></P>
<P><FONT class=extract>early_platform_add_devices&#65292;&#28155;&#21152;&#19968;&#20010;Early device&#12290; </FONT></P>
<P><FONT class=extract>is_early_platform_device&#65292;&#21028;&#26029;&#25351;&#23450;&#30340;device&#26159;&#21542;&#26159;Early device&#12290; </FONT></P>
<P><FONT class=extract>early_platform_driver_register_all&#65292;&#23558;&#25351;&#23450;class&#30340;&#25152;&#26377;driver&#27880;&#20876;&#20026;Early device driver&#12290; </FONT></P>
<P><FONT class=extract>early_platform_driver_probe&#65292;probe&#25351;&#23450;class&#30340;Early device&#12290; </FONT></P>
<P><FONT class=extract>early_platform_cleanup&#65292;&#28165;&#38500;&#25152;&#26377;&#30340;Early device/driver&#12290;</FONT> </P></BLOCKQUOTE>
<H4>4. Platform&#27169;&#22359;&#30340;&#20869;&#37096;&#21160;&#20316;&#35299;&#26512; </H4>
<H5>4.1 Platform&#27169;&#22359;&#30340;&#21021;&#22987;&#21270; </H5>
<P><FONT class=extract>Platform&#27169;&#22359;&#30340;&#21021;&#22987;&#21270;&#26159;&#30001;drivers/base/platform.c&#20013;platform_bus_init&#25509;&#21475;&#23436;&#25104;&#30340;&#65292;&#35813;&#25509;&#21475;&#30340;&#23454;&#29616;&#21644;&#21160;&#20316;&#22914;&#19979;&#65306; </FONT></P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> __init platform_bus_init(<SPAN style="COLOR: rgb(0,0,255)">void</SPAN>)</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN> {</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> error;</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN>&nbsp; </FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN>         early_platform_cleanup();</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN>&nbsp; </FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum7 style="COLOR: rgb(96,96,96)">   7:</SPAN>         error = device_register(&amp;platform_bus);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum8 style="COLOR: rgb(96,96,96)">   8:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (error)</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum9 style="COLOR: rgb(96,96,96)">   9:</SPAN>                 <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> error;</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum10 style="COLOR: rgb(96,96,96)">  10:</SPAN>         error =  bus_register(&amp;platform_bus_type);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum11 style="COLOR: rgb(96,96,96)">  11:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (error)</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum12 style="COLOR: rgb(96,96,96)">  12:</SPAN>                 device_unregister(&amp;platform_bus);</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><FONT class=extract><SPAN id=lnum13 style="COLOR: rgb(96,96,96)">  13:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> error;</FONT></PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><FONT class=extract><SPAN id=lnum14 style="COLOR: rgb(96,96,96)">  14:</SPAN> }</FONT></PRE><!--CRLF--></DIV></DIV>
<BLOCKQUOTE>
<P><FONT class=extract>early_platform_cleanup&#65292;&#28165;&#38500;&#25152;&#26377;&#21644;Early device/driver&#30456;&#20851;&#30340;&#20195;&#30721;&#12290;&#22240;&#20026;&#25191;&#34892;&#21040;&#36825;&#37324;&#30340;&#26102;&#20505;&#65292;&#35777;&#26126;&#31995;&#32479;&#24050;&#32463;&#23436;&#25104;&#20102;Early&#38454;&#27573;&#30340;&#21551;&#21160;&#65292;&#36716;&#32780;&#36827;&#34892;&#27491;&#24120;&#30340;&#35774;&#22791;&#21021;&#22987;&#21270;&#12289;&#21551;&#21160;&#25805;&#20316;&#65292;&#25152;&#20197;&#19981;&#20877;&#38656;&#35201;Early Platform&#30456;&#20851;&#30340;&#19996;&#35199;&#12290; </FONT></P>
<P><FONT class=extract>device_register&#65292;&#27880;&#20876;&#19968;&#20010;&#21517;&#31216;&#20026;platform_bus&#30340;&#35774;&#22791;&#65292;&#35813;&#35774;&#22791;&#30340;&#23450;&#20041;&#38750;&#24120;&#31616;&#21333;&#65292;&#21482;&#21253;&#21547;init_name&#65288;&#20026;&#8220;platform&#8221;&#65289;&#12290;&#35813;&#27493;&#39588;&#20250;&#22312;sysfs&#20013;&#21019;&#24314;&#8220;/sys/devices/platform/&#8221;&#30446;&#24405;&#65292;&#25152;&#26377;&#30340;Platform&#35774;&#22791;&#65292;&#37117;&#20250;&#21253;&#21547;&#22312;&#27492;&#30446;&#24405;&#19979;&#12290; </FONT></P>
<P><FONT class=extract>bus_register&#65292;&#27880;&#20876;&#19968;&#20010;&#21517;&#31216;&#20026;platform_bus_type&#30340;bus&#65292;&#35813;bus&#30340;&#23450;&#20041;&#22914;&#19979;&#65306; <BR>struct bus_type platform_bus_type = { <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = "platform", <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .dev_attrs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = platform_dev_attrs, <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .match&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = platform_match, <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .uevent&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = platform_uevent, <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .pm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = &amp;platform_dev_pm_ops, <BR>}; <BR>&#35813;&#27493;&#39588;&#20250;&#22312;sysfs&#20013;&#21019;&#24314;&#8220;/sys/bus/platform/&#8221;&#30446;&#24405;&#65292;&#21516;&#26102;&#65292;&#32467;&#21512;&#8220;</FONT><A href="http://www.wowotech.net/linux_kenrel/bus.html"><FONT class=extract>Linux&#35774;&#22791;&#27169;&#22411;(6)_Bus</FONT></A><FONT class=extract>&#8221;&#30340;&#25551;&#36848;&#65292;&#20250;&#22312;&#8220;/sys/bus/platform/&#8221;&#30446;&#24405;&#19979;&#65292;&#21019;&#24314;uevent attribute&#65288;/sys/bus/platform/uevent&#65289;&#12289;devices&#30446;&#24405;&#12289;drivers&#30446;&#24405;&#12289;drivers_probe&#21644;drivers_autoprobe&#20004;&#20010;attribute&#65288;/sys/bus/platform/drivers_probe&#21644;/sys/bus/platform/drivers_autoprobe&#65289;&#12290;</FONT> </P></BLOCKQUOTE>
<H5>4.2 <FONT class=extract>platform device&#21644;platform driver&#30340;&#27880;&#20876; </FONT></H5>
<P><FONT class=extract>&#32467;&#21512;&#31532;3&#31456;&#30340;&#25551;&#36848;&#65292;platform device&#21644;platform driver&#30340;&#27880;&#20876;&#65292;&#30001;platform_device_add&#21644;platform_driver_register&#20004;&#20010;&#25509;&#21475;&#23454;&#38469;&#23454;&#29616;&#12290;&#20854;&#20869;&#37096;&#21160;&#20316;&#20998;&#21035;&#22914;&#19979;&#12290; </FONT></P>
<P><FONT class=extract>platform_device_add&#30340;&#20869;&#37096;&#21160;&#20316;&#65306; </FONT></P>
<BLOCKQUOTE>
<P><FONT class=extract>&#22914;&#26524;&#35813;&#35774;&#22791;&#27809;&#26377;&#25351;&#23450;&#29238;&#35774;&#22791;&#65292;&#23558;&#20854;&#29238;&#35774;&#22791;&#35774;&#32622;&#20026;platform_bus&#65292;&#21363;&#8220;/sys/devices/platform/&#8221;&#25152;&#20195;&#34920;&#30340;&#35774;&#22791;&#65292;&#36825;&#26102;&#35813;&#35774;&#22791;&#30340;sysfs&#30446;&#24405;&#21363;&#20026;&#8220;/sys/devices/platform/xxx_device&#8221;&#12290; </FONT></P>
<P><FONT class=extract>&#23558;&#35813;&#35774;&#22791;&#30340;bus&#25351;&#23450;&#20026;platform_bus_type&#65288;pdev-&gt;dev.bus = &amp;platform_bus_type&#65289;&#12290; </FONT></P>
<P><FONT class=extract>&#26681;&#25454;&#35774;&#22791;&#30340;ID&#65292;&#20462;&#25913;&#25110;&#32773;&#35774;&#32622;&#35774;&#22791;&#30340;&#21517;&#31216;&#12290;&#23545;&#20110;&#22810;&#20010;&#21516;&#21517;&#30340;&#35774;&#22791;&#65292;&#21487;&#20197;&#20351;&#29992;ID&#21306;&#20998;&#65292;&#22312;&#36825;&#37324;&#23558;&#23454;&#38469;&#21517;&#31216;&#20462;&#25913;&#20026;&#8220;name.id&#8221;&#30340;&#24418;&#24335;&#12290; </FONT></P>
<P><FONT class=extract>&#35843;&#29992;resource&#27169;&#22359;&#30340;insert_resource&#25509;&#21475;&#65292;&#23558;&#35813;&#35774;&#22791;&#38656;&#35201;&#20351;&#29992;&#30340;resource&#32479;&#19968;&#31649;&#29702;&#36215;&#26469;&#65288;<SPAN style="COLOR: rgb(255,0,0)">&#25105;&#20204;&#30693;&#36947;&#65292;&#22312;&#36825;&#20043;&#21069;&#65292;&#21482;&#26159;&#22768;&#26126;&#20102;&#26412;&#35774;&#22791;&#38656;&#35201;&#20351;&#29992;&#21738;&#20123;resource&#65292;&#20294;resource&#27169;&#22359;&#24182;&#19981;&#30693;&#24773;&#65292;&#20063;&#23601;&#26080;&#20174;&#31649;&#29702;&#65292;&#22240;&#27492;&#38656;&#35201;&#21578;&#30693;</SPAN>&#65289;&#12290; </FONT></P>
<P><FONT class=extract>&#35843;&#29992;device_add&#25509;&#21475;&#65292;&#23558;&#20869;&#23884;&#30340;struct device&#21464;&#37327;&#28155;&#21152;&#21040;&#20869;&#26680;&#20013;&#12290; </FONT></P></BLOCKQUOTE>
<P><FONT class=extract>platform_driver_register&#30340;&#20869;&#37096;&#21160;&#20316;&#65306; </FONT></P>
<BLOCKQUOTE>
<P><FONT class=extract>&#23558;&#35813;driver&#30340;bus&#25351;&#23450;&#20026;platform_bus_type&#65288;drv-&gt;driver.bus = &amp;platform_bus_type&#65289;&#12290; </FONT></P>
<P><FONT class=extract>&#22914;&#26524;&#35813;platform driver&#25552;&#20379;&#20102;probe&#12289;remove&#12289;shutdown&#31561;&#22238;&#35843;&#20989;&#25968;&#65292;&#23558;&#35813;&#23427;&#20869;&#23884;&#30340;struct driver&#21464;&#37327;&#30340;probe&#12289;remove&#12289;shutdown&#31561;&#25351;&#38024;&#65292;&#35774;&#32622;&#20026;platform&#27169;&#22359;&#25552;&#20379;&#20989;&#25968;&#65292;&#21253;&#25324;platform_drv_probe&#12289;platform_drv_remove&#21644;platform_drv_shutdown&#12290;&#22240;&#20026;probe&#31561;&#21160;&#20316;&#20250;&#20174;struct driver&#21464;&#37327;&#24320;&#22987;&#65292;&#32463;&#36807;platform_drv_xxx&#31561;&#25509;&#21475;&#30340;&#36716;&#25509;&#65292;&#23601;&#21487;&#20197;&#21040;&#36798;platform diver&#33258;&#36523;&#30340;&#22238;&#35843;&#20989;&#25968;&#20013;&#12290; </FONT></P>
<P><FONT class=extract>&#35843;&#29992;driver_register&#25509;&#21475;&#65292;&#23558;&#20869;&#23884;&#30340;struct driver&#21464;&#37327;&#28155;&#21152;&#21040;&#20869;&#26680;&#20013;&#12290;</FONT> </P></BLOCKQUOTE>
<H5>4.3 platform&#35774;&#22791;&#30340;probe </H5>
<P>&#25105;&#20204;&#22312;&#8220;<A href="http://www.wowotech.net/linux_kenrel/bus.html">Linux&#35774;&#22791;&#27169;&#22411;(6)_Bus</A>&#8221;&#20013;&#35762;&#36807;&#65292;&#35774;&#22791;&#30340;probe&#65292;&#37117;&#21457;&#29983;&#22312;&#21521;&#25351;&#23450;&#30340;bus&#28155;&#21152;device&#25110;&#32773;device_driver&#26102;&#65292;&#30001;bus&#27169;&#22359;&#30340;bus_probe_device&#65292;&#25110;&#32773;device_driver&#27169;&#22359;driver_attach&#25509;&#21475;&#35302;&#21457;&#12290;&#36825;&#37324;&#23601;&#19981;&#20877;&#35814;&#32454;&#25551;&#36848;&#20102;&#12290; </P>
<P>&nbsp;</P>
<P><EM><FONT color=#808080>&#21407;&#21019;&#25991;&#31456;&#65292;&#36716;&#21457;&#35831;&#27880;&#26126;&#20986;&#22788;&#12290;&#34583;&#31389;&#31185;&#25216;</FONT></EM>&#65292;<A href="http://www.wowotech.net/linux_kenrel/platform_device.html">www.wowotech.net</A>&#12290;