The bus type structure contains a list of all devices that are on that bus type in the system. When device_register is called for a device, it is inserted into the end of this list. 
<P></P>
<P>The bus object also contains a list of all drivers of that bus type. When driver_register is called for a driver, it is inserted at the end of this list.</P>
<P><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1168" name=1168>1168</A><SPAN class=c>/**<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1169" name=1169>1169</A> * device_register - register a device with the system.<BR><A class=hl href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1170" name=1170>1170</A> * @dev: pointer to the device structure<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1171" name=1171>1171</A> *<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1172" name=1172>1172</A> * This happens in two clean steps - initialize the device<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1173" name=1173>1173</A> * and add it to the system. The two steps can be called<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1174" name=1174>1174</A> * separately, but this is the easiest and most common.<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1175" name=1175>1175</A> * I.e. you should only call the two helpers separately if<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1176" name=1176>1176</A> * have a clearly defined need to use and refcount the device<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1177" name=1177>1177</A> * before it is added to the hierarchy.<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1178" name=1178>1178</A> *<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1179" name=1179>1179</A> * For more information, see the kerneldoc for device_initialize()<BR><A class=hl href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1180" name=1180>1180</A> * and device_add().<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1181" name=1181>1181</A> *<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1182" name=1182>1182</A> * NOTE: _Never_ directly free @dev after calling this function, even<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1183" name=1183>1183</A> * if it returned an error! Always use put_device() to give up the<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1184" name=1184>1184</A> * reference initialized in this function instead.<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1185" name=1185>1185</A> */</SPAN><BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1186" name=1186>1186</A><B>int</B> <A class=xf name=device_register></A><A class=xf href="http://172.21.12.145:8080/source/s?refs=device_register&amp;project=linux-4.5">device_register</A>(<B>struct</B> <A href="http://172.21.12.145:8080/source/s?defs=device&amp;project=linux-4.5">device</A> *<A class=xa name=dev></A><A class=xa href="http://172.21.12.145:8080/source/s?refs=dev&amp;project=linux-4.5">dev</A>)<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1187" name=1187>1187</A>{<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1188" name=1188>1188</A> <A href="http://172.21.12.145:8080/source/s?defs=device_initialize&amp;project=linux-4.5">device_initialize</A>(<A href="http://172.21.12.145:8080/source/s?defs=dev&amp;project=linux-4.5">dev</A>);<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1189" name=1189>1189</A> <B>return</B> <A href="http://172.21.12.145:8080/source/s?defs=device_add&amp;project=linux-4.5">device_add</A>(<A href="http://172.21.12.145:8080/source/s?defs=dev&amp;project=linux-4.5">dev</A>);<BR><A class=hl href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1190" name=1190>1190</A>}<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/core.c#1191" name=1191>1191</A><A href="http://172.21.12.145:8080/source/s?defs=EXPORT_SYMBOL_GPL&amp;project=linux-4.5">EXPORT_SYMBOL_GPL</A>(<A class=xv name=device_register></A><A class=xv href="http://172.21.12.145:8080/source/s?refs=device_register&amp;project=linux-4.5">device_register</A>);</P>
<P><A class=hl href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#140" name=140>140</A><SPAN class=c>/**<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#141" name=141>141</A> * driver_register - register driver with bus<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#142" name=142>142</A> * @drv: driver to register<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#143" name=143>143</A> *<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#144" name=144>144</A> * We pass off most of the work to the bus_add_driver() call,<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#145" name=145>145</A> * since most of the things we have to do deal with the bus<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#146" name=146>146</A> * structures.<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#147" name=147>147</A> */</SPAN><BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#148" name=148>148</A><B>int</B> <A class=xf name=driver_register></A><A class=xf href="http://172.21.12.145:8080/source/s?refs=driver_register&amp;project=linux-4.5">driver_register</A>(<B>struct</B> <A href="http://172.21.12.145:8080/source/s?defs=device_driver&amp;project=linux-4.5">device_driver</A> *<A class=xa name=drv></A><A class=xa href="http://172.21.12.145:8080/source/s?refs=drv&amp;project=linux-4.5">drv</A>)<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#149" name=149>149</A>{<BR><A class=hl href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#150" name=150>150</A> <B>int</B> <A class=xl name=ret></A><A class=xl href="http://172.21.12.145:8080/source/s?refs=ret&amp;project=linux-4.5">ret</A>;<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#151" name=151>151</A> <B>struct</B> <A href="http://172.21.12.145:8080/source/s?defs=device_driver&amp;project=linux-4.5">device_driver</A> *<A class=xl name=other></A><A class=xl href="http://172.21.12.145:8080/source/s?refs=other&amp;project=linux-4.5">other</A>;<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#152" name=152>152</A><BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#153" name=153>153</A> <A href="http://172.21.12.145:8080/source/s?defs=BUG_ON&amp;project=linux-4.5">BUG_ON</A>(!<A href="http://172.21.12.145:8080/source/s?defs=drv&amp;project=linux-4.5">drv</A>-&gt;<A class=d href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#bus">bus</A>-&gt;p);<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#154" name=154>154</A><BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#155" name=155>155</A> <B>if</B> ((<A href="http://172.21.12.145:8080/source/s?defs=drv&amp;project=linux-4.5">drv</A>-&gt;<A class=d href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#bus">bus</A>-&gt;<A href="http://172.21.12.145:8080/source/s?defs=probe&amp;project=linux-4.5">probe</A> &amp;&amp; <A href="http://172.21.12.145:8080/source/s?defs=drv&amp;project=linux-4.5">drv</A>-&gt;<A href="http://172.21.12.145:8080/source/s?defs=probe&amp;project=linux-4.5">probe</A>) ||<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#156" name=156>156</A> &nbsp;&nbsp;&nbsp; (<A href="http://172.21.12.145:8080/source/s?defs=drv&amp;project=linux-4.5">drv</A>-&gt;<A class=d href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#bus">bus</A>-&gt;<A href="http://172.21.12.145:8080/source/s?defs=remove&amp;project=linux-4.5">remove</A> &amp;&amp; <A href="http://172.21.12.145:8080/source/s?defs=drv&amp;project=linux-4.5">drv</A>-&gt;<A href="http://172.21.12.145:8080/source/s?defs=remove&amp;project=linux-4.5">remove</A>) ||<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#157" name=157>157</A> &nbsp;&nbsp;&nbsp; (<A href="http://172.21.12.145:8080/source/s?defs=drv&amp;project=linux-4.5">drv</A>-&gt;<A class=d href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#bus">bus</A>-&gt;<A href="http://172.21.12.145:8080/source/s?defs=shutdown&amp;project=linux-4.5">shutdown</A> &amp;&amp; <A href="http://172.21.12.145:8080/source/s?defs=drv&amp;project=linux-4.5">drv</A>-&gt;<A href="http://172.21.12.145:8080/source/s?defs=shutdown&amp;project=linux-4.5">shutdown</A>))<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#158" name=158>158</A> <A href="http://172.21.12.145:8080/source/s?defs=printk&amp;project=linux-4.5">printk</A>(<A href="http://172.21.12.145:8080/source/s?defs=KERN_WARNING&amp;project=linux-4.5">KERN_WARNING</A> <SPAN class=s>"Driver '%s' needs updating - please use "</SPAN><BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#159" name=159>159</A> <SPAN class=s>"bus_type methods\n"</SPAN>, <A href="http://172.21.12.145:8080/source/s?defs=drv&amp;project=linux-4.5">drv</A>-&gt;<A class=d href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#name">name</A>);<BR><A class=hl href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#160" name=160>160</A><BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#161" name=161>161</A> <A class=d href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#other">other</A> = <A href="http://172.21.12.145:8080/source/s?defs=driver_find&amp;project=linux-4.5">driver_find</A>(<A href="http://172.21.12.145:8080/source/s?defs=drv&amp;project=linux-4.5">drv</A>-&gt;<A class=d href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#name">name</A>, <A href="http://172.21.12.145:8080/source/s?defs=drv&amp;project=linux-4.5">drv</A>-&gt;<A class=d href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#bus">bus</A>);<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#162" name=162>162</A> <B>if</B> (<A class=d href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#other">other</A>) {<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#163" name=163>163</A> <A href="http://172.21.12.145:8080/source/s?defs=printk&amp;project=linux-4.5">printk</A>(<A href="http://172.21.12.145:8080/source/s?defs=KERN_ERR&amp;project=linux-4.5">KERN_ERR</A> <SPAN class=s>"Error: Driver '%s' is already registered, "</SPAN><BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#164" name=164>164</A> <SPAN class=s>"aborting...\n"</SPAN>, <A href="http://172.21.12.145:8080/source/s?defs=drv&amp;project=linux-4.5">drv</A>-&gt;<A class=d href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#name">name</A>);<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#165" name=165>165</A> <B>return</B> -<A href="http://172.21.12.145:8080/source/s?defs=EBUSY&amp;project=linux-4.5">EBUSY</A>;<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#166" name=166>166</A> }<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#167" name=167>167</A><BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#168" name=168>168</A> <A class=d href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#ret">ret</A> = <A href="http://172.21.12.145:8080/source/s?defs=bus_add_driver&amp;project=linux-4.5">bus_add_driver</A>(<A href="http://172.21.12.145:8080/source/s?defs=drv&amp;project=linux-4.5">drv</A>);<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#169" name=169>169</A> <B>if</B> (<A class=d href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#ret">ret</A>)<BR><A class=hl href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#170" name=170>170</A> <B>return</B> <A class=d href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#ret">ret</A>;<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#171" name=171>171</A> <A class=d href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#ret">ret</A> = <A class=d href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#driver_add_groups">driver_add_groups</A>(<A href="http://172.21.12.145:8080/source/s?defs=drv&amp;project=linux-4.5">drv</A>, <A href="http://172.21.12.145:8080/source/s?defs=drv&amp;project=linux-4.5">drv</A>-&gt;<A href="http://172.21.12.145:8080/source/s?defs=groups&amp;project=linux-4.5">groups</A>);<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#172" name=172>172</A> <B>if</B> (<A class=d href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#ret">ret</A>) {<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#173" name=173>173</A> <A href="http://172.21.12.145:8080/source/s?defs=bus_remove_driver&amp;project=linux-4.5">bus_remove_driver</A>(<A href="http://172.21.12.145:8080/source/s?defs=drv&amp;project=linux-4.5">drv</A>);<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#174" name=174>174</A> <B>return</B> <A class=d href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#ret">ret</A>;<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#175" name=175>175</A> }<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#176" name=176>176</A> <A href="http://172.21.12.145:8080/source/s?defs=kobject_uevent&amp;project=linux-4.5">kobject_uevent</A>(&amp;<A href="http://172.21.12.145:8080/source/s?defs=drv&amp;project=linux-4.5">drv</A>-&gt;p-&gt;<A href="http://172.21.12.145:8080/source/s?defs=kobj&amp;project=linux-4.5">kobj</A>, <A href="http://172.21.12.145:8080/source/s?defs=KOBJ_ADD&amp;project=linux-4.5">KOBJ_ADD</A>);<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#177" name=177>177</A><BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#178" name=178>178</A> <B>return</B> <A class=d href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#ret">ret</A>;<BR><A class=l href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#179" name=179>179</A>}<BR><A class=hl href="http://172.21.12.145:8080/source/xref/linux-4.5/drivers/base/driver.c#180" name=180>180</A><A href="http://172.21.12.145:8080/source/s?defs=EXPORT_SYMBOL_GPL&amp;project=linux-4.5">EXPORT_SYMBOL_GPL</A>(<A class=xv name=driver_register></A><A class=xv href="http://172.21.12.145:8080/source/s?refs=driver_register&amp;project=linux-4.5">driver_register</A>);</P><PRE>&nbsp;</PRE>