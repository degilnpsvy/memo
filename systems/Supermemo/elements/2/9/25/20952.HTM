--- 3.1 Shared Makefile 
<P></P>
<P>&nbsp;An external module always includes a wrapper makefile that<BR>&nbsp;supports building the module using "make" with no arguments.<BR>&nbsp;This target is not used by kbuild; it is only for convenience.<BR>&nbsp;Additional functionality, such as test targets, can be included<BR>&nbsp;but should be filtered out from kbuild due to possible name<BR>&nbsp;clashes.</P>
<P>&nbsp;Example 1:<BR>&nbsp;&nbsp;--&gt; filename: Makefile<BR><FONT class=clozed>&nbsp;&nbsp;ifneq ($(KERNELRELEASE),)<BR>&nbsp;&nbsp;# kbuild part of makefile<BR>&nbsp;&nbsp;obj-m&nbsp; := 8123.o<BR>&nbsp;&nbsp;8123-y := 8123_if.o 8123_pci.o 8123_bin.o</FONT></P>
<P><FONT class=clozed>&nbsp;&nbsp;else<BR>&nbsp;&nbsp;# normal makefile<BR>&nbsp;&nbsp;KDIR ?= /lib/modules/`uname -r`/build</FONT></P>
<P><FONT class=clozed>&nbsp;&nbsp;default:<BR>&nbsp;&nbsp;&nbsp;$(MAKE) -C $(KDIR) M=$$PWD</FONT></P>
<P><FONT class=clozed>&nbsp;&nbsp;# Module specific targets<BR>&nbsp;&nbsp;genbin:<BR>&nbsp;&nbsp;&nbsp;echo "X" &gt; 8123_bin.o_shipped</FONT></P>
<P><FONT class=clozed>&nbsp;&nbsp;endif</FONT></P>
<P>&nbsp;The check for KERNELRELEASE is used to separate the two parts<BR>&nbsp;of the makefile. In the example, kbuild will only see the two<BR>&nbsp;assignments, whereas "make" will see everything except these<BR>&nbsp;two assignments. This is due to two passes made on the file:<BR>&nbsp;the first pass is by the "make" instance run on the command<BR>&nbsp;line; the second pass is by the kbuild system, which is<BR>&nbsp;initiated by the parameterized "make" in the default target.