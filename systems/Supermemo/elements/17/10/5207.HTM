It&#8217;s much more efficient to allow the test-and-set operation to run without a prior guarantee of atomicity so that the &#8220;set&#8221; succeeds only if it was atomic. Software needs to be told whether the set succeeded: Then unsuccessful test-and-set sequences can be hidden inside the wait() function and retried as necessary.( 15. Of course, you&#8217;d better make sure that there are no circumstances where it ends up retrying forever&#8212;but with other kinds of semaphores, you always have to make sure a waiting task comes back sometime. )