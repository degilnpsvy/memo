static TranslationBlock *tb_find_slow(CPUState *cpu,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; target_ulong pc,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; target_ulong cs_base,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; uint32_t flags)<BR>{<BR>&nbsp;&nbsp;&nbsp; TranslationBlock *tb;</P>
<P>&nbsp;&nbsp;&nbsp; tb = tb_find_physical(cpu, pc, cs_base, flags);<BR>&nbsp;&nbsp;&nbsp; if (tb) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; goto found;<BR>&nbsp;&nbsp;&nbsp; }</P>
<P>#ifdef CONFIG_USER_ONLY<BR>&nbsp;&nbsp;&nbsp; /* mmap_lock is needed by tb_gen_code, and mmap_lock must be<BR>&nbsp;&nbsp;&nbsp;&nbsp; * taken outside tb_lock.&nbsp; Since we're momentarily dropping<BR>&nbsp;&nbsp;&nbsp;&nbsp; * tb_lock, there's a chance that our desired tb has been<BR>&nbsp;&nbsp;&nbsp;&nbsp; * translated.<BR>&nbsp;&nbsp;&nbsp;&nbsp; */<BR>&nbsp;&nbsp;&nbsp; tb_unlock();<BR>&nbsp;&nbsp;&nbsp; mmap_lock();<BR>&nbsp;&nbsp;&nbsp; tb_lock();<BR>&nbsp;&nbsp;&nbsp; tb = tb_find_physical(cpu, pc, cs_base, flags);<BR>&nbsp;&nbsp;&nbsp; if (tb) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mmap_unlock();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; goto found;<BR>&nbsp;&nbsp;&nbsp; }<BR>#endif</P>
<P>&nbsp;&nbsp;&nbsp; /* if no translated code available, then translate it now */<BR>&nbsp;&nbsp;&nbsp; tb = tb_gen_code(cpu, pc, cs_base, flags, 0);</P>
<P>#ifdef CONFIG_USER_ONLY<BR>&nbsp;&nbsp;&nbsp; mmap_unlock();<BR>#endif</P>
<P>found:<BR>&nbsp;&nbsp;&nbsp; /* we add the TB in the virtual pc hash table */<BR>&nbsp;&nbsp;&nbsp; cpu-&gt;tb_jmp_cache[tb_jmp_cache_hash_func(pc)] = tb;<BR>&nbsp;&nbsp;&nbsp; return tb;<BR>}