static CPAccessResult pmreg_access(CPUARMState *env, const ARMCPRegInfo *ri,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bool isread)<BR>{<BR>&nbsp;&nbsp;&nbsp; /* Performance monitor registers user accessibility is controlled<BR>&nbsp;&nbsp;&nbsp;&nbsp; * by PMUSERENR. MDCR_EL2.TPM and MDCR_EL3.TPM allow configurable<BR>&nbsp;&nbsp;&nbsp;&nbsp; * trapping to EL2 or EL3 for other accesses.<BR>&nbsp;&nbsp;&nbsp;&nbsp; */<BR>&nbsp;&nbsp;&nbsp; int el = arm_current_el(env);</P>
<P>&nbsp;&nbsp;&nbsp; if (el == 0 &amp;&amp; !env-&gt;cp15.c9_pmuserenr) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return CP_ACCESS_TRAP;<BR>&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; if (el &lt; 2 &amp;&amp; (env-&gt;cp15.mdcr_el2 &amp; MDCR_TPM)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;&amp; !arm_is_secure_below_el3(env)) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return CP_ACCESS_TRAP_EL2;<BR>&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; if (el &lt; 3 &amp;&amp; (env-&gt;cp15.mdcr_el3 &amp; MDCR_TPM)) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return CP_ACCESS_TRAP_EL3;<BR>&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp; return CP_ACCESS_OK;<BR>}