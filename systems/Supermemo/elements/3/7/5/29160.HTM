static inline int kref_put_mutex(struct kref *kref,<BR>&nbsp;&nbsp;&nbsp;&nbsp; void (*release)(struct kref *kref),<BR>&nbsp;&nbsp;&nbsp;&nbsp; struct mutex *lock)<BR>{<BR>&nbsp;WARN_ON(release == NULL);<BR>&nbsp;if (unlikely(!atomic_add_unless(&amp;kref-&gt;refcount, -1, 1))) {<BR>&nbsp;&nbsp;mutex_lock(lock);<BR>&nbsp;&nbsp;if (unlikely(!atomic_dec_and_test(&amp;kref-&gt;refcount))) {<BR>&nbsp;&nbsp;&nbsp;mutex_unlock(lock);<BR>&nbsp;&nbsp;&nbsp;return 0;<BR>&nbsp;&nbsp;}<BR>&nbsp;&nbsp;release(kref);<BR>&nbsp;&nbsp;return 1;<BR>&nbsp;}<BR>&nbsp;return 0;<BR>}