You must initialize the kref after you allocate it.&nbsp; To do this, call<BR>kref_init as so: 
<P></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp; struct my_data *data;</P>
<P><FONT class=clozed>&nbsp;&nbsp;&nbsp;&nbsp; data = kmalloc(sizeof(*data), GFP_KERNEL);<BR>&nbsp;&nbsp;&nbsp;&nbsp; if (!data)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return -ENOMEM;<BR>&nbsp;&nbsp;&nbsp;&nbsp; kref_init(&amp;data-&gt;refcount)</FONT>;</P>
<P>This sets the refcount in the kref to 1.