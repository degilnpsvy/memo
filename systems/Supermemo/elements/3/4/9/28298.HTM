DeviceState *qdev_try_create(BusState *bus, const char *type)<BR>{<BR>&nbsp;&nbsp;&nbsp; DeviceState *dev; 
<P></P>
<P>&nbsp;&nbsp;&nbsp; if (object_class_by_name(type) == NULL) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return NULL;<BR>&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; dev = DEVICE(object_new(type));<BR>&nbsp;&nbsp;&nbsp; if (!dev) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return NULL;<BR>&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp; if (!bus) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* Assert that the device really is a SysBusDevice before<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * we put it onto the sysbus. Non-sysbus devices which aren't<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * being put onto a bus should be created with object_new(TYPE_FOO),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * not qdev_create(NULL, TYPE_FOO).<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; g_assert(object_dynamic_cast(OBJECT(dev), TYPE_SYS_BUS_DEVICE));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bus = sysbus_get_default();<BR>&nbsp;&nbsp;&nbsp; }</P>
<P>&nbsp;&nbsp;&nbsp; qdev_set_parent_bus(dev, bus);<BR>&nbsp;&nbsp;&nbsp; object_unref(OBJECT(dev));<BR>&nbsp;&nbsp;&nbsp; return dev;<BR>}