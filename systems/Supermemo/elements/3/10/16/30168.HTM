&nbsp;unsigned long flags;<BR>&nbsp;int count; 
<P></P>
<P>&nbsp;raw_spin_lock_irqsave(&amp;sem-&gt;lock, flags);<BR>&nbsp;count = sem-&gt;count - 1;<BR>&nbsp;if (likely(count &gt;= 0))<BR>&nbsp;&nbsp;sem-&gt;count = count;<BR>&nbsp;raw_spin_unlock_irqrestore(&amp;sem-&gt;lock, flags);</P>
<P>&nbsp;return (count &lt; 0);