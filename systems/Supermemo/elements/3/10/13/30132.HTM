Platform&#27169;&#22359;&#30340;&#21021;&#22987;&#21270;&#26159;&#30001;drivers/base/platform.c&#20013;platform_bus_init&#25509;&#21475;&#23436;&#25104;&#30340;&#65292;&#35813;&#25509;&#21475;&#30340;&#23454;&#29616;&#21644;&#21160;&#20316;&#22914;&#19979;&#65306; </P>
<DIV id=codeSnippetWrapper style='OVERFLOW: auto; CURSOR: text; FONT-SIZE: 8pt; BORDER-TOP: silver 1px solid; FONT-FAMILY: "Courier New", courier, monospace; BORDER-RIGHT: silver 1px solid; WIDTH: 97.5%; BORDER-BOTTOM: silver 1px solid; PADDING-BOTTOM: 4px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 4px; PADDING-LEFT: 4px; MARGIN: 20px 0px 10px; BORDER-LEFT: silver 1px solid; LINE-HEIGHT: 12pt; PADDING-RIGHT: 4px; MAX-HEIGHT: 200px; BACKGROUND-COLOR: rgb(244,244,244)'>
<DIV id=codeSnippet style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum1 style="COLOR: rgb(96,96,96)">   1:</SPAN> <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> __init platform_bus_init(<SPAN style="COLOR: rgb(0,0,255)">void</SPAN>)</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum2 style="COLOR: rgb(96,96,96)">   2:</SPAN> {</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum3 style="COLOR: rgb(96,96,96)">   3:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">int</SPAN> error;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum4 style="COLOR: rgb(96,96,96)">   4:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum5 style="COLOR: rgb(96,96,96)">   5:</SPAN>         early_platform_cleanup();</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum6 style="COLOR: rgb(96,96,96)">   6:</SPAN>&nbsp; </PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum7 style="COLOR: rgb(96,96,96)">   7:</SPAN>         error = device_register(&amp;platform_bus);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum8 style="COLOR: rgb(96,96,96)">   8:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (error)</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum9 style="COLOR: rgb(96,96,96)">   9:</SPAN>                 <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> error;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum10 style="COLOR: rgb(96,96,96)">  10:</SPAN>         error =  bus_register(&amp;platform_bus_type);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum11 style="COLOR: rgb(96,96,96)">  11:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">if</SPAN> (error)</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum12 style="COLOR: rgb(96,96,96)">  12:</SPAN>                 device_unregister(&amp;platform_bus);</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: white'><SPAN id=lnum13 style="COLOR: rgb(96,96,96)">  13:</SPAN>         <SPAN style="COLOR: rgb(0,0,255)">return</SPAN> error;</PRE><!--CRLF--><PRE style='OVERFLOW: visible; FONT-SIZE: 8pt; FONT-FAMILY: "Courier New", courier, monospace; WIDTH: 100%; COLOR: black; PADDING-BOTTOM: 0px; DIRECTION: ltr; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0em; LINE-HEIGHT: 12pt; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(244,244,244)'><SPAN id=lnum14 style="COLOR: rgb(96,96,96)">  14:</SPAN> }</PRE><!--CRLF--></DIV></DIV>
<BLOCKQUOTE>
<P>early_platform_cleanup&#65292;&#28165;&#38500;&#25152;&#26377;&#21644;Early device/driver&#30456;&#20851;&#30340;&#20195;&#30721;&#12290;&#22240;&#20026;&#25191;&#34892;&#21040;&#36825;&#37324;&#30340;&#26102;&#20505;&#65292;&#35777;&#26126;&#31995;&#32479;&#24050;&#32463;&#23436;&#25104;&#20102;Early&#38454;&#27573;&#30340;&#21551;&#21160;&#65292;&#36716;&#32780;&#36827;&#34892;&#27491;&#24120;&#30340;&#35774;&#22791;&#21021;&#22987;&#21270;&#12289;&#21551;&#21160;&#25805;&#20316;&#65292;&#25152;&#20197;&#19981;&#20877;&#38656;&#35201;Early Platform&#30456;&#20851;&#30340;&#19996;&#35199;&#12290; </P>
<P>device_register&#65292;&#27880;&#20876;&#19968;&#20010;&#21517;&#31216;&#20026;platform_bus&#30340;&#35774;&#22791;&#65292;&#35813;&#35774;&#22791;&#30340;&#23450;&#20041;&#38750;&#24120;&#31616;&#21333;&#65292;&#21482;&#21253;&#21547;init_name&#65288;&#20026;&#8220;platform&#8221;&#65289;&#12290;&#35813;&#27493;&#39588;&#20250;&#22312;sysfs&#20013;&#21019;&#24314;&#8220;/sys/devices/platform/&#8221;&#30446;&#24405;&#65292;&#25152;&#26377;&#30340;Platform&#35774;&#22791;&#65292;&#37117;&#20250;&#21253;&#21547;&#22312;&#27492;&#30446;&#24405;&#19979;&#12290; </P>
<P>bus_register&#65292;&#27880;&#20876;&#19968;&#20010;&#21517;&#31216;&#20026;platform_bus_type&#30340;bus&#65292;&#35813;bus&#30340;&#23450;&#20041;&#22914;&#19979;&#65306; <BR>struct bus_type platform_bus_type = { <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = "platform", <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .dev_attrs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = platform_dev_attrs, <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .match&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = platform_match, <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .uevent&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = platform_uevent, <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .pm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = &amp;platform_dev_pm_ops, <BR>}; <BR>&#35813;&#27493;&#39588;&#20250;&#22312;sysfs&#20013;&#21019;&#24314;&#8220;/sys/bus/platform/&#8221;&#30446;&#24405;&#65292;&#21516;&#26102;&#65292;&#32467;&#21512;&#8220;<A href="http://www.wowotech.net/linux_kenrel/bus.html">Linux&#35774;&#22791;&#27169;&#22411;(6)_Bus</A>&#8221;&#30340;&#25551;&#36848;&#65292;&#20250;&#22312;&#8220;/sys/bus/platform/&#8221;&#30446;&#24405;&#19979;&#65292;&#21019;&#24314;uevent attribute&#65288;/sys/bus/platform/uevent&#65289;&#12289;devices&#30446;&#24405;&#12289;drivers&#30446;&#24405;&#12289;drivers_probe&#21644;drivers_autoprobe&#20004;&#20010;attribute&#65288;/sys/bus/platform/drivers_probe&#21644;/sys/bus/platform/drivers_autoprobe&#65289;&#12290; </P></BLOCKQUOTE>