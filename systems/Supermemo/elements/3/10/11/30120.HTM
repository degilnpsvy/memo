<STRONG>Kobject&#30340;&#20998;&#37197;&#21644;&#37322;&#25918;</STRONG> </P>
<P>&#21069;&#38754;&#35762;&#36807;&#65292;Kobject&#24517;&#39035;&#21160;&#24577;&#20998;&#37197;&#65292;&#32780;&#19981;&#33021;&#38745;&#24577;&#23450;&#20041;&#25110;&#32773;&#20301;&#20110;&#22534;&#26632;&#20043;&#19978;&#65292;&#23427;&#30340;&#20998;&#37197;&#26041;&#27861;&#26377;&#20004;&#31181;&#12290; </P>
<P>1. &#36890;&#36807;kmalloc&#33258;&#34892;&#20998;&#37197;&#65288;&#19968;&#33324;&#26159;&#36319;&#38543;&#19978;&#23618;&#25968;&#25454;&#32467;&#26500;&#20998;&#37197;&#65289;&#65292;&#24182;&#22312;&#21021;&#22987;&#21270;&#21518;&#28155;&#21152;&#21040;kernel&#12290;&#36825;&#31181;&#26041;&#27861;&#28041;&#21450;&#22914;&#19979;&#25509;&#21475;&#65306;</P>
<P><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#92" name=92>92</A><B>extern</B> <B>void</B> <A href="http://172.29.26.110:8080/source/s?defs=kobject_init&amp;project=Linux-v4.7">kobject_init</A>(<B>struct</B> <A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#kobject">kobject</A> *<A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>, <B>struct</B> <A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#kobj_type">kobj_type</A> *<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#ktype">ktype</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#93" name=93>93</A><B>extern</B> <A href="http://172.29.26.110:8080/source/s?defs=__printf&amp;project=Linux-v4.7">__printf</A>(<SPAN class=n>3</SPAN>, <SPAN class=n>4</SPAN>) <A href="http://172.29.26.110:8080/source/s?defs=__must_check&amp;project=Linux-v4.7">__must_check</A><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#94" name=94>94</A><B>int</B> <A href="http://172.29.26.110:8080/source/s?defs=kobject_add&amp;project=Linux-v4.7">kobject_add</A>(<B>struct</B> <A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#kobject">kobject</A> *<A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>, <B>struct</B> <A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#kobject">kobject</A> *<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#parent">parent</A>,<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#95" name=95>95</A> <B>const</B> <B>char</B> *<A href="http://172.29.26.110:8080/source/s?defs=fmt&amp;project=Linux-v4.7">fmt</A>, ...);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#96" name=96>96</A><B>extern</B> <A href="http://172.29.26.110:8080/source/s?defs=__printf&amp;project=Linux-v4.7">__printf</A>(<SPAN class=n>4</SPAN>, <SPAN class=n>5</SPAN>) <A href="http://172.29.26.110:8080/source/s?defs=__must_check&amp;project=Linux-v4.7">__must_check</A><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#97" name=97>97</A><B>int</B> <A href="http://172.29.26.110:8080/source/s?defs=kobject_init_and_add&amp;project=Linux-v4.7">kobject_init_and_add</A>(<B>struct</B> <A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#kobject">kobject</A> *<A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>,<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#98" name=98>98</A> <B>struct</B> <A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#kobj_type">kobj_type</A> *<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#ktype">ktype</A>, <B>struct</B> <A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#kobject">kobject</A> *<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#parent">parent</A>,<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#99" name=99>99</A> <B>const</B> <B>char</B> *<A href="http://172.29.26.110:8080/source/s?defs=fmt&amp;project=Linux-v4.7">fmt</A>, ...);</P>
<P>&nbsp;kobject_init&#65292;&#21021;&#22987;&#21270;&#36890;&#36807;kmalloc&#31561;&#20869;&#23384;&#20998;&#37197;&#20989;&#25968;&#33719;&#24471;&#30340;struct kobject&#25351;&#38024;&#12290;&#20027;&#35201;&#25191;&#34892;&#36923;&#36753;&#20026;&#65306; </P>
<BLOCKQUOTE>
<UL>
<LI>&#30830;&#35748;kobj&#21644;ktype&#19981;&#20026;&#31354; 
<LI>&#22914;&#26524;&#35813;&#25351;&#38024;&#24050;&#32463;&#21021;&#22987;&#21270;&#36807;&#65288;&#21028;&#26029;kobj-&gt;state_initialized&#65289;&#65292;&#25171;&#21360;&#38169;&#35823;&#25552;&#31034;&#21450;&#22534;&#26632;&#20449;&#24687;&#65288;&#20294;&#19981;&#26159;&#33268;&#21629;&#38169;&#35823;&#65292;&#25152;&#20197;&#36824;&#21487;&#20197;&#32487;&#32493;&#65289; 
<LI>&#21021;&#22987;&#21270;kobj&#20869;&#37096;&#30340;&#21442;&#25968;&#65292;&#21253;&#25324;&#24341;&#29992;&#35745;&#25968;&#12289;list&#12289;&#21508;&#31181;&#26631;&#24535;&#31561; 
<LI>&#26681;&#25454;&#36755;&#20837;&#21442;&#25968;&#65292;&#23558;ktype&#25351;&#38024;&#36171;&#20104;kobj-&gt;ktype </LI></UL>
<P>kobject_add&#65292;&#23558;&#21021;&#22987;&#21270;&#23436;&#25104;&#30340;kobject&#28155;&#21152;&#21040;kernel&#20013;&#65292;&#21442;&#25968;&#21253;&#25324;&#38656;&#35201;&#28155;&#21152;&#30340;kobject&#12289;&#35813;kobject&#30340;parent&#65288;&#29992;&#20110;&#24418;&#25104;&#23618;&#27425;&#32467;&#26500;&#65292;&#21487;&#20197;&#20026;&#31354;&#65289;&#12289;&#29992;&#20110;&#25552;&#20379;kobject name&#30340;&#26684;&#24335;&#21270;&#23383;&#31526;&#20018;&#12290;&#20027;&#35201;&#25191;&#34892;&#36923;&#36753;&#20026;&#65306; </P>
<UL>
<LI>&#30830;&#35748;kobj&#19981;&#20026;&#31354;&#65292;&#30830;&#35748;kobj&#24050;&#32463;&#21021;&#22987;&#21270;&#65292;&#21542;&#21017;&#38169;&#35823;&#36864;&#20986; 
<LI>&#35843;&#29992;&#20869;&#37096;&#25509;&#21475;kobject_add_varg&#65292;&#23436;&#25104;&#28155;&#21152;&#25805;&#20316; </LI></UL>
<P>kobject_init_and_add&#65292;&#26159;&#19978;&#38754;&#20004;&#20010;&#25509;&#21475;&#30340;&#32452;&#21512;&#65292;&#19981;&#20877;&#35828;&#26126;&#12290; </P>
<P>==========================&#20869;&#37096;&#25509;&#21475;====================================== </P>
<P>kobject_add_varg&#65292;&#35299;&#26512;&#26684;&#24335;&#21270;&#23383;&#31526;&#20018;&#65292;&#23558;&#32467;&#26524;&#36171;&#20104;kobj-&gt;name&#65292;&#20043;&#21518;&#35843;&#29992;kobject_add_internal&#25509;&#21475;&#65292;&#23436;&#25104;&#30495;&#27491;&#30340;&#28155;&#21152;&#25805;&#20316;&#12290; </P>
<P>kobject_add_internal&#65292;&#23558;kobject&#28155;&#21152;&#21040;kernel&#12290;&#20027;&#35201;&#25191;&#34892;&#36923;&#36753;&#20026;&#65306; </P>
<UL>
<LI>&#26657;&#39564;kobj&#20197;&#21450;kobj-&gt;name&#30340;&#21512;&#27861;&#24615;&#65292;&#33509;&#19981;&#21512;&#27861;&#25171;&#21360;&#38169;&#35823;&#20449;&#24687;&#24182;&#36864;&#20986; 
<LI>&#35843;&#29992;kobject_get&#22686;&#21152;&#35813;kobject&#30340;parent&#30340;&#24341;&#29992;&#35745;&#25968;&#65288;&#22914;&#26524;&#23384;&#22312;parent&#30340;&#35805;&#65289; 
<LI>&#22914;&#26524;&#23384;&#22312;kset&#65288;&#21363;kobj-&gt;kset&#19981;&#20026;&#31354;&#65289;&#65292;&#21017;&#35843;&#29992;kobj_kset_join&#25509;&#21475;&#21152;&#20837;kset&#12290;&#21516;&#26102;&#65292;&#22914;&#26524;&#35813;kobject&#27809;&#26377;parent&#65292;&#21364;&#23384;&#22312;kset&#65292;&#21017;&#23558;&#23427;&#30340;parent&#35774;&#20026;kset&#65288;kset&#26159;&#19968;&#20010;&#29305;&#27530;&#30340;kobject&#65289;&#65292;&#24182;&#22686;&#21152;kset&#30340;&#24341;&#29992;&#35745;&#25968; 
<LI>&#36890;&#36807;create_dir&#25509;&#21475;&#65292;<SPAN style="WHITE-SPACE: normal">&#35843;&#29992;sysfs&#30340;&#30456;&#20851;&#25509;&#21475;&#65292;</SPAN>&#22312;sysfs&#19979;&#21019;&#24314;&#35813;kobject&#23545;&#24212;&#30340;&#30446;&#24405; 
<LI>&#22914;&#26524;&#21019;&#24314;&#22833;&#36133;&#65292;&#25191;&#34892;&#21518;&#32493;&#30340;&#22238;&#28378;&#25805;&#20316;&#65292;&#21542;&#21017;&#23558;kobj-&gt;state_in_sysfs&#32622;&#20026;1 </LI></UL>
<P>kobj_kset_join&#65292;&#36127;&#36131;&#23558;kobj&#21152;&#20837;&#21040;&#23545;&#24212;kset&#30340;&#38142;&#34920;&#20013;&#12290; </P></BLOCKQUOTE>
<P>&#36825;&#31181;&#26041;&#24335;&#20998;&#37197;&#30340;kobject&#65292;&#20250;&#22312;&#24341;&#29992;&#35745;&#25968;&#21464;&#20026;0&#26102;&#65292;&#30001;kobject_put&#35843;&#29992;&#20854;ktype&#30340;release&#25509;&#21475;&#65292;&#37322;&#25918;&#20869;&#23384;&#31354;&#38388;&#65292;&#20855;&#20307;&#21487;&#21442;&#32771;&#21518;&#38754;&#26377;&#20851;kobject_put&#30340;&#35762;&#35299;&#12290; </P>
<P>2. &#20351;&#29992;kobject_create&#21019;&#24314; </P>
<P>Kobject&#27169;&#22359;&#21487;&#20197;&#20351;&#29992;kobject_create&#33258;&#34892;&#20998;&#37197;&#31354;&#38388;&#65292;&#24182;&#20869;&#32622;&#20102;&#19968;&#20010;ktype&#65288;dynamic_kobj_ktype&#65289;&#65292;&#29992;&#20110;&#22312;&#35745;&#25968;&#20026;0&#26159;&#37322;&#25918;&#31354;&#38388;&#12290;&#20195;&#30721;&#22914;&#19979;&#65306; </P>
<P><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#103" name=103>103</A><B>extern</B> <B>struct</B> <A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#kobject">kobject</A> * <A href="http://172.29.26.110:8080/source/s?defs=__must_check&amp;project=Linux-v4.7">__must_check</A> <A href="http://172.29.26.110:8080/source/s?defs=kobject_create&amp;project=Linux-v4.7">kobject_create</A>(<B>void</B>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#104" name=104>104</A><B>extern</B> <B>struct</B> <A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#kobject">kobject</A> * <A href="http://172.29.26.110:8080/source/s?defs=__must_check&amp;project=Linux-v4.7">__must_check</A> <A href="http://172.29.26.110:8080/source/s?defs=kobject_create_and_add&amp;project=Linux-v4.7">kobject_create_and_add</A>(<B>const</B> <B>char</B> *<A href="http://172.29.26.110:8080/source/s?defs=name&amp;project=Linux-v4.7">name</A>,<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#105" name=105>105</A> <B>struct</B> <A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#kobject">kobject</A> *<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#parent">parent</A>);</P>
<P><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#696" name=696>696</A><B>static</B> <B>void</B> <A class=xf name=dynamic_kobj_release></A><A class=xf href="http://172.29.26.110:8080/source/s?refs=dynamic_kobj_release&amp;project=Linux-v4.7">dynamic_kobj_release</A>(<B>struct</B> <A href="http://172.29.26.110:8080/source/s?defs=kobject&amp;project=Linux-v4.7">kobject</A> *<A class=xa name=kobj></A><A class=xa href="http://172.29.26.110:8080/source/s?refs=kobj&amp;project=Linux-v4.7">kobj</A>)<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#697" name=697>697</A>{<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#698" name=698>698</A> <A href="http://172.29.26.110:8080/source/s?defs=pr_debug&amp;project=Linux-v4.7">pr_debug</A>(<SPAN class=s>"kobject: (%p): %s\n"</SPAN>, <A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>, <A href="http://172.29.26.110:8080/source/s?defs=__func__&amp;project=Linux-v4.7">__func__</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#699" name=699>699</A> <A href="http://172.29.26.110:8080/source/s?defs=kfree&amp;project=Linux-v4.7">kfree</A>(<A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>);<BR><A class=hl href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#700" name=700>700</A>}<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#701" name=701>701</A><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#702" name=702>702</A><B>static</B> <B>struct</B> <A href="http://172.29.26.110:8080/source/s?defs=kobj_type&amp;project=Linux-v4.7">kobj_type</A> <A class=xv name=dynamic_kobj_ktype></A><A class=xv href="http://172.29.26.110:8080/source/s?refs=dynamic_kobj_ktype&amp;project=Linux-v4.7">dynamic_kobj_ktype</A> = {<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#703" name=703>703</A> .<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#release">release</A> = <A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#dynamic_kobj_release">dynamic_kobj_release</A>,<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#704" name=704>704</A> .<A href="http://172.29.26.110:8080/source/s?defs=sysfs_ops&amp;project=Linux-v4.7">sysfs_ops</A> = &amp;<A href="http://172.29.26.110:8080/source/s?defs=kobj_sysfs_ops&amp;project=Linux-v4.7">kobj_sysfs_ops</A>,<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#705" name=705>705</A>};</P>
<BLOCKQUOTE>
<P>kobject_create&#65292;&#35813;&#25509;&#21475;&#20026;kobj&#20998;&#37197;&#20869;&#23384;&#31354;&#38388;&#65292;&#24182;&#20197;dynamic_kobj_ktype&#20026;&#21442;&#25968;&#65292;&#35843;&#29992;kobject_init&#25509;&#21475;&#65292;&#23436;&#25104;&#21518;&#32493;&#30340;&#21021;&#22987;&#21270;&#25805;&#20316;&#12290; </P>
<P>kobject_create_and_add&#65292;&#26159;kobject_create&#21644;kobject_add&#30340;&#32452;&#21512;&#65292;&#19981;&#20877;&#35828;&#26126;&#12290; </P>
<P>dynamic_kobj_release&#65292;&#30452;&#25509;&#35843;&#29992;kfree&#37322;&#25918;kobj&#30340;&#31354;&#38388;&#12290;</P></BLOCKQUOTE>