<STRONG>Kobject&#24341;&#29992;&#35745;&#25968;&#30340;&#20462;&#25913;</STRONG> 
<P></P>
<P>&#36890;&#36807;kobject_get&#21644;kobject_put&#21487;&#20197;&#20462;&#25913;kobject&#30340;&#24341;&#29992;&#35745;&#25968;&#65292;&#24182;&#22312;&#35745;&#25968;&#20026;0&#26102;&#65292;&#35843;&#29992;ktype&#30340;release&#25509;&#21475;&#65292;&#37322;&#25918;&#21344;&#29992;&#31354;&#38388;&#12290;</P>
<P><A class=hl href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#110" name=110>110</A><B>extern</B> <B>struct</B> <A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#kobject">kobject</A> *<A href="http://172.29.26.110:8080/source/s?defs=kobject_get&amp;project=Linux-v4.7">kobject_get</A>(<B>struct</B> <A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#kobject">kobject</A> *<A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#111" name=111>111</A><B>extern</B> <B>void</B> <A href="http://172.29.26.110:8080/source/s?defs=kobject_put&amp;project=Linux-v4.7">kobject_put</A>(<B>struct</B> <A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/include/linux/kobject.h#kobject">kobject</A> *<A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>);</P>
<BLOCKQUOTE>
<P>kobject_get&#65292;&#35843;&#29992;kref_get&#65292;&#22686;&#21152;&#24341;&#29992;&#35745;&#25968;&#12290; </P>
<P>kobject_put&#65292;&#20197;&#20869;&#37096;&#25509;&#21475;kobject_release&#20026;&#21442;&#25968;&#65292;&#35843;&#29992;kref_put&#12290;kref&#27169;&#22359;&#20250;&#22312;&#24341;&#29992;&#35745;&#25968;&#20026;&#38646;&#26102;&#65292;&#35843;&#29992;kobject_release&#12290; </P>
<P>==========================&#20869;&#37096;&#25509;&#21475;====================================== </P>
<P>kobject_release&#65292;&#36890;&#36807;kref&#32467;&#26500;&#65292;&#33719;&#21462;kobject&#25351;&#38024;&#65292;&#24182;&#35843;&#29992;kobject_cleanup&#25509;&#21475;&#32487;&#32493;&#12290; </P>
<P>kobject_cleanup&#65292;&#36127;&#36131;&#37322;&#25918;kobject&#21344;&#29992;&#30340;&#31354;&#38388;&#65292;&#20027;&#35201;&#25191;&#34892;&#36923;&#36753;&#22914;&#19979;&#65306; </P>
<UL>
<LI>&#26816;&#26597;&#35813;kobject&#26159;&#21542;&#26377;ktype&#65292;&#22914;&#26524;&#27809;&#26377;&#65292;&#25171;&#21360;&#35686;&#21578;&#20449;&#24687; 
<LI>&#22914;&#26524;&#35813;kobject&#21521;&#29992;&#25143;&#31354;&#38388;&#21457;&#36865;&#20102;ADD uevent&#20294;&#27809;&#26377;&#21457;&#36865;REMOVE uevent&#65292;&#34917;&#21457;REMOVE uevent 
<LI>&#22914;&#26524;&#35813;kobject&#26377;&#22312;sysfs&#25991;&#20214;&#31995;&#32479;&#27880;&#20876;&#65292;&#35843;&#29992;kobject_del&#25509;&#21475;&#65292;&#21024;&#38500;&#23427;&#22312;sysfs&#20013;&#30340;&#27880;&#20876; 
<LI>&#35843;&#29992;&#35813;kobject&#30340;ktype&#30340;release&#25509;&#21475;&#65292;&#37322;&#25918;&#20869;&#23384;&#31354;&#38388; 
<LI>&#37322;&#25918;&#35813;kobject&#30340;name&#25152;&#21344;&#29992;&#30340;&#20869;&#23384;&#31354;&#38388;</LI></UL>
<P>&nbsp;</P>
<P><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#611" name=611>611</A><SPAN class=c>/*<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#612" name=612>612</A> * kobject_cleanup - free kobject resources.<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#613" name=613>613</A> * @kobj: object to cleanup<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#614" name=614>614</A> */</SPAN><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#615" name=615>615</A><B>static</B> <B>void</B> <A class=xf name=kobject_cleanup></A><A class=xf href="http://172.29.26.110:8080/source/s?refs=kobject_cleanup&amp;project=Linux-v4.7">kobject_cleanup</A>(<B>struct</B> <A href="http://172.29.26.110:8080/source/s?defs=kobject&amp;project=Linux-v4.7">kobject</A> *<A class=xa name=kobj></A><A class=xa href="http://172.29.26.110:8080/source/s?refs=kobj&amp;project=Linux-v4.7">kobj</A>)<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#616" name=616>616</A>{<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#617" name=617>617</A>	<B>struct</B> <A href="http://172.29.26.110:8080/source/s?defs=kobj_type&amp;project=Linux-v4.7">kobj_type</A> *t = <A href="http://172.29.26.110:8080/source/s?defs=get_ktype&amp;project=Linux-v4.7">get_ktype</A>(<A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#618" name=618>618</A>	<B>const</B> <B>char</B> *<A class=xl name=name></A><A class=xl href="http://172.29.26.110:8080/source/s?refs=name&amp;project=Linux-v4.7">name</A> = <A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>-&gt;<A class=xl name=name></A><A class=xl href="http://172.29.26.110:8080/source/s?refs=name&amp;project=Linux-v4.7">name</A>;<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#619" name=619>619</A><BR><A class=hl href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#620" name=620>620</A>	<A href="http://172.29.26.110:8080/source/s?defs=pr_debug&amp;project=Linux-v4.7">pr_debug</A>(<SPAN class=s>"kobject: '%s' (%p): %s, parent %p\n"</SPAN>,<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#621" name=621>621</A>		 <A href="http://172.29.26.110:8080/source/s?defs=kobject_name&amp;project=Linux-v4.7">kobject_name</A>(<A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>), <A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>, <A href="http://172.29.26.110:8080/source/s?defs=__func__&amp;project=Linux-v4.7">__func__</A>, <A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>-&gt;<A href="http://172.29.26.110:8080/source/s?defs=parent&amp;project=Linux-v4.7">parent</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#622" name=622>622</A><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#623" name=623>623</A>	<B>if</B> (t &amp;&amp; !t-&gt;<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#release">release</A>)<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#624" name=624>624</A>		<A href="http://172.29.26.110:8080/source/s?defs=pr_debug&amp;project=Linux-v4.7">pr_debug</A>(<SPAN class=s>"kobject: '%s' (%p): does not have a release() "</SPAN><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#625" name=625>625</A>			 <SPAN class=s>"function, it is broken and must be fixed.\n"</SPAN>,<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#626" name=626>626</A>			 <A href="http://172.29.26.110:8080/source/s?defs=kobject_name&amp;project=Linux-v4.7">kobject_name</A>(<A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>), <A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#627" name=627>627</A><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#628" name=628>628</A>	<SPAN class=c>/* send "remove" if the caller did not do it but sent "add" */</SPAN><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#629" name=629>629</A>	<B>if</B> (<A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>-&gt;<A href="http://172.29.26.110:8080/source/s?defs=state_add_uevent_sent&amp;project=Linux-v4.7">state_add_uevent_sent</A> &amp;&amp; !<A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>-&gt;<A href="http://172.29.26.110:8080/source/s?defs=state_remove_uevent_sent&amp;project=Linux-v4.7">state_remove_uevent_sent</A>) {<BR><A class=hl href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#630" name=630>630</A>		<A href="http://172.29.26.110:8080/source/s?defs=pr_debug&amp;project=Linux-v4.7">pr_debug</A>(<SPAN class=s>"kobject: '%s' (%p): auto cleanup 'remove' event\n"</SPAN>,<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#631" name=631>631</A>			 <A href="http://172.29.26.110:8080/source/s?defs=kobject_name&amp;project=Linux-v4.7">kobject_name</A>(<A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>), <A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#632" name=632>632</A>		<A href="http://172.29.26.110:8080/source/s?defs=kobject_uevent&amp;project=Linux-v4.7">kobject_uevent</A>(<A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>, <A href="http://172.29.26.110:8080/source/s?defs=KOBJ_REMOVE&amp;project=Linux-v4.7">KOBJ_REMOVE</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#633" name=633>633</A>	}<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#634" name=634>634</A><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#635" name=635>635</A>	<SPAN class=c>/* remove from sysfs if the caller did not do it */</SPAN><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#636" name=636>636</A>	<B>if</B> (<A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>-&gt;<A href="http://172.29.26.110:8080/source/s?defs=state_in_sysfs&amp;project=Linux-v4.7">state_in_sysfs</A>) {<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#637" name=637>637</A>		<A href="http://172.29.26.110:8080/source/s?defs=pr_debug&amp;project=Linux-v4.7">pr_debug</A>(<SPAN class=s>"kobject: '%s' (%p): auto cleanup kobject_del\n"</SPAN>,<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#638" name=638>638</A>			 <A href="http://172.29.26.110:8080/source/s?defs=kobject_name&amp;project=Linux-v4.7">kobject_name</A>(<A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>), <A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#639" name=639>639</A>		<A href="http://172.29.26.110:8080/source/s?defs=kobject_del&amp;project=Linux-v4.7">kobject_del</A>(<A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>);<BR><A class=hl href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#640" name=640>640</A>	}<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#641" name=641>641</A><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#642" name=642>642</A>	<B>if</B> (t &amp;&amp; t-&gt;<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#release">release</A>) {<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#643" name=643>643</A>		<A href="http://172.29.26.110:8080/source/s?defs=pr_debug&amp;project=Linux-v4.7">pr_debug</A>(<SPAN class=s>"kobject: '%s' (%p): calling ktype release\n"</SPAN>,<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#644" name=644>644</A>			 <A href="http://172.29.26.110:8080/source/s?defs=kobject_name&amp;project=Linux-v4.7">kobject_name</A>(<A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>), <A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#645" name=645>645</A>		t-&gt;<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#release">release</A>(<A href="http://172.29.26.110:8080/source/s?defs=kobj&amp;project=Linux-v4.7">kobj</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#646" name=646>646</A>	}<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#647" name=647>647</A><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#648" name=648>648</A>	<SPAN class=c>/* free name if we allocated it */</SPAN><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#649" name=649>649</A>	<B>if</B> (<A href="http://172.29.26.110:8080/source/s?defs=name&amp;project=Linux-v4.7">name</A>) {<BR><A class=hl href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#650" name=650>650</A>		<A href="http://172.29.26.110:8080/source/s?defs=pr_debug&amp;project=Linux-v4.7">pr_debug</A>(<SPAN class=s>"kobject: '%s': free name\n"</SPAN>, <A href="http://172.29.26.110:8080/source/s?defs=name&amp;project=Linux-v4.7">name</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#651" name=651>651</A>		<A href="http://172.29.26.110:8080/source/s?defs=kfree_const&amp;project=Linux-v4.7">kfree_const</A>(<A href="http://172.29.26.110:8080/source/s?defs=name&amp;project=Linux-v4.7">name</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#652" name=652>652</A>	}<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/lib/kobject.c#653" name=653>653</A>}</P></BLOCKQUOTE>