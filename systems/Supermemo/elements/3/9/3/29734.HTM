driver_probe_device() returns 0 and the @dev-&gt;driver is set ( This is set in the really_probe() )</P>
<P><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#701" name=701>701</A><B>static</B> <B>int</B> <A class=xf name=__driver_attach></A><A class=xf href="http://172.29.26.110:8080/source/s?refs=__driver_attach&amp;project=Linux-v4.7">__driver_attach</A>(<B>struct</B> <A href="http://172.29.26.110:8080/source/s?defs=device&amp;project=Linux-v4.7">device</A> *<A class=xa name=dev></A><A class=xa href="http://172.29.26.110:8080/source/s?refs=dev&amp;project=Linux-v4.7">dev</A>, <B>void</B> *<A class=xa name=data></A><A class=xa href="http://172.29.26.110:8080/source/s?refs=data&amp;project=Linux-v4.7">data</A>)<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#702" name=702>702</A>{<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#703" name=703>703</A>	<B>struct</B> <A href="http://172.29.26.110:8080/source/s?defs=device_driver&amp;project=Linux-v4.7">device_driver</A> *<A class=xl name=drv></A><A class=xl href="http://172.29.26.110:8080/source/s?refs=drv&amp;project=Linux-v4.7">drv</A> = <A href="http://172.29.26.110:8080/source/s?defs=data&amp;project=Linux-v4.7">data</A>;<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#704" name=704>704</A>	<B>int</B> <A class=xl name=ret></A><A class=xl href="http://172.29.26.110:8080/source/s?refs=ret&amp;project=Linux-v4.7">ret</A>;<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#705" name=705>705</A><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#706" name=706>706</A>	<SPAN class=c>/*<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#707" name=707>707</A>	 * Lock device and try to bind to it. We drop the error<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#708" name=708>708</A>	 * here and always return 0, because we need to keep trying<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#709" name=709>709</A>	 * to bind to devices and some drivers will return an error<BR><A class=hl href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#710" name=710>710</A>	 * simply if it didn't support the device.<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#711" name=711>711</A>	 *<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#712" name=712>712</A>	 * driver_probe_device() will spit a warning if there<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#713" name=713>713</A>	 * is an error.<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#714" name=714>714</A>	 */</SPAN><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#715" name=715>715</A><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#716" name=716>716</A>	<A href="http://172.29.26.110:8080/source/s?defs=ret&amp;project=Linux-v4.7">ret</A> = <A href="http://172.29.26.110:8080/source/s?defs=driver_match_device&amp;project=Linux-v4.7">driver_match_device</A>(<A href="http://172.29.26.110:8080/source/s?defs=drv&amp;project=Linux-v4.7">drv</A>, <A href="http://172.29.26.110:8080/source/s?defs=dev&amp;project=Linux-v4.7">dev</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#717" name=717>717</A>	<B>if</B> (<A href="http://172.29.26.110:8080/source/s?defs=ret&amp;project=Linux-v4.7">ret</A> == 0) {<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#718" name=718>718</A>		<SPAN class=c>/* no match */</SPAN><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#719" name=719>719</A>		<B>return</B> 0;<BR><A class=hl href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#720" name=720>720</A>	} <B>else</B> <B>if</B> (<A href="http://172.29.26.110:8080/source/s?defs=ret&amp;project=Linux-v4.7">ret</A> == -<A href="http://172.29.26.110:8080/source/s?defs=EPROBE_DEFER&amp;project=Linux-v4.7">EPROBE_DEFER</A>) {<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#721" name=721>721</A>		<A href="http://172.29.26.110:8080/source/s?defs=dev_dbg&amp;project=Linux-v4.7">dev_dbg</A>(<A href="http://172.29.26.110:8080/source/s?defs=dev&amp;project=Linux-v4.7">dev</A>, <SPAN class=s>"Device match requests probe deferral\n"</SPAN>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#722" name=722>722</A>		<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#driver_deferred_probe_add">driver_deferred_probe_add</A>(<A href="http://172.29.26.110:8080/source/s?defs=dev&amp;project=Linux-v4.7">dev</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#723" name=723>723</A>	} <B>else</B> <B>if</B> (<A href="http://172.29.26.110:8080/source/s?defs=ret&amp;project=Linux-v4.7">ret</A> &lt; 0) {<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#724" name=724>724</A>		<A href="http://172.29.26.110:8080/source/s?defs=dev_dbg&amp;project=Linux-v4.7">dev_dbg</A>(<A href="http://172.29.26.110:8080/source/s?defs=dev&amp;project=Linux-v4.7">dev</A>, <SPAN class=s>"Bus failed to match device: %d"</SPAN>, <A href="http://172.29.26.110:8080/source/s?defs=ret&amp;project=Linux-v4.7">ret</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#725" name=725>725</A>		<B>return</B> <A href="http://172.29.26.110:8080/source/s?defs=ret&amp;project=Linux-v4.7">ret</A>;<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#726" name=726>726</A>	} <SPAN class=c>/* ret &gt; 0 means positive match */</SPAN><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#727" name=727>727</A><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#728" name=728>728</A>	<B>if</B> (<A href="http://172.29.26.110:8080/source/s?defs=dev&amp;project=Linux-v4.7">dev</A>-&gt;<A href="http://172.29.26.110:8080/source/s?defs=parent&amp;project=Linux-v4.7">parent</A>)	<SPAN class=c>/* Needed for USB */</SPAN><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#729" name=729>729</A>		<A href="http://172.29.26.110:8080/source/s?defs=device_lock&amp;project=Linux-v4.7">device_lock</A>(<A href="http://172.29.26.110:8080/source/s?defs=dev&amp;project=Linux-v4.7">dev</A>-&gt;<A href="http://172.29.26.110:8080/source/s?defs=parent&amp;project=Linux-v4.7">parent</A>);<BR><A class=hl href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#730" name=730>730</A>	<A href="http://172.29.26.110:8080/source/s?defs=device_lock&amp;project=Linux-v4.7">device_lock</A>(<A href="http://172.29.26.110:8080/source/s?defs=dev&amp;project=Linux-v4.7">dev</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#731" name=731>731</A>	<B>if</B> (!<A href="http://172.29.26.110:8080/source/s?defs=dev&amp;project=Linux-v4.7">dev</A>-&gt;<A href="http://172.29.26.110:8080/source/s?defs=driver&amp;project=Linux-v4.7">driver</A>)<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#732" name=732>732</A>		<A class=d href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#driver_probe_device">driver_probe_device</A>(<A href="http://172.29.26.110:8080/source/s?defs=drv&amp;project=Linux-v4.7">drv</A>, <A href="http://172.29.26.110:8080/source/s?defs=dev&amp;project=Linux-v4.7">dev</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#733" name=733>733</A>	<A href="http://172.29.26.110:8080/source/s?defs=device_unlock&amp;project=Linux-v4.7">device_unlock</A>(<A href="http://172.29.26.110:8080/source/s?defs=dev&amp;project=Linux-v4.7">dev</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#734" name=734>734</A>	<B>if</B> (<A href="http://172.29.26.110:8080/source/s?defs=dev&amp;project=Linux-v4.7">dev</A>-&gt;<A href="http://172.29.26.110:8080/source/s?defs=parent&amp;project=Linux-v4.7">parent</A>)<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#735" name=735>735</A>		<A href="http://172.29.26.110:8080/source/s?defs=device_unlock&amp;project=Linux-v4.7">device_unlock</A>(<A href="http://172.29.26.110:8080/source/s?defs=dev&amp;project=Linux-v4.7">dev</A>-&gt;<A href="http://172.29.26.110:8080/source/s?defs=parent&amp;project=Linux-v4.7">parent</A>);<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#736" name=736>736</A><BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#737" name=737>737</A>	<B>return</B> 0;<BR><A class=l href="http://172.29.26.110:8080/source/xref/Linux-v4.7/drivers/base/dd.c#738" name=738>738</A>}