/**<BR>&nbsp;* <SPAN class=cloze>[...]</SPAN> - acquire the semaphore within a specified time<BR>&nbsp;* @sem: the semaphore to be acquired<BR>&nbsp;* @timeout: how long to wait before failing<BR>&nbsp;*<BR>&nbsp;* Attempts to acquire the semaphore.&nbsp; If no more tasks are allowed to<BR>&nbsp;* acquire the semaphore, calling this function will put the task to sleep.<BR>&nbsp;* If the semaphore is not released within the specified number of jiffies,<BR>&nbsp;* this function returns -ETIME.&nbsp; It returns 0 if the semaphore was acquired.<BR>&nbsp;*/<BR>int <SPAN class=cloze><FONT color=#000000>[...]</FONT></SPAN>(struct semaphore *sem, long timeout)<BR>{<BR>&nbsp;unsigned long flags;<BR>&nbsp;int result = 0; 
<P></P>
<P>&nbsp;raw_spin_lock_irqsave(&amp;sem-&gt;lock, flags);<BR>&nbsp;if (likely(sem-&gt;count &gt; 0))<BR>&nbsp;&nbsp;sem-&gt;count--;<BR>&nbsp;else<BR>&nbsp;&nbsp;result = __down_timeout(sem, timeout);<BR>&nbsp;raw_spin_unlock_irqrestore(&amp;sem-&gt;lock, flags);</P>
<P>&nbsp;return result;<BR>}<BR>EXPORT_SYMBOL(<SPAN class=cloze><FONT color=#000000>[...]</FONT></SPAN>);