/* Map EL and handler into a PSTATE_MODE.&nbsp; */<BR>static inline unsigned int aarch64_pstate_mode(unsigned int el, bool handler)<BR>{<BR>&nbsp;&nbsp;&nbsp; return (el &lt;&lt; 2) | handler;<BR>}</P>
<P>/* Return the current PSTATE value. For the moment we don't support 32&lt;-&gt;64 bit<BR>&nbsp;* interprocessing, so we don't attempt to sync with the cpsr state used by<BR>&nbsp;* the 32 bit decoder.<BR>&nbsp;*/<BR>static inline uint32_t pstate_read(CPUARMState *env)<BR>{<BR>&nbsp;&nbsp;&nbsp; int ZF;</P>
<P>&nbsp;&nbsp;&nbsp; ZF = (env-&gt;ZF == 0);<BR>&nbsp;&nbsp;&nbsp; return (env-&gt;NF &amp; 0x80000000) | (ZF &lt;&lt; 30)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | (env-&gt;CF &lt;&lt; 29) | ((env-&gt;VF &amp; 0x80000000) &gt;&gt; 3)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | env-&gt;pstate | env-&gt;daif;<BR>}</P>
<P>static inline void pstate_write(CPUARMState *env, uint32_t val)<BR>{<BR>&nbsp;&nbsp;&nbsp; env-&gt;ZF = (~val) &amp; PSTATE_Z;<BR>&nbsp;&nbsp;&nbsp; env-&gt;NF = val;<BR>&nbsp;&nbsp;&nbsp; env-&gt;CF = (val &gt;&gt; 29) &amp; 1;<BR>&nbsp;&nbsp;&nbsp; env-&gt;VF = (val &lt;&lt; 3) &amp; 0x80000000;<BR>&nbsp;&nbsp;&nbsp; env-&gt;daif = val &amp; PSTATE_DAIF;<BR>&nbsp;&nbsp;&nbsp; env-&gt;pstate = val &amp; ~CACHED_PSTATE_BITS;<BR>}