<H1 lang=en id=firstHeading class=firstHeading>Cache coloring</H1>
<DIV id=bodyContent class=mw-body-content>
<DIV id=siteSub>From Wikipedia, the free encyclopedia</DIV>
<DIV id=contentSub></DIV></DIV>
<P>In <A title="Computer science" href="https://en.wikipedia.org/wiki/Computer_science">computer science</A>, <B>cache coloring</B> (also known as <B>page coloring</B>) is the process of attempting to allocate free <A title="Page (computer science)" class=mw-redirect href="https://en.wikipedia.org/wiki/Page_%28computer_science%29">pages</A> that are contiguous from the <A title="CPU cache" href="https://en.wikipedia.org/wiki/CPU_cache">CPU cache</A>'s point of view, in order to maximize the total number of pages cached by the processor. Cache coloring is typically employed by low-level <A title="Dynamic memory allocation" class=mw-redirect href="https://en.wikipedia.org/wiki/Dynamic_memory_allocation">dynamic memory allocation</A> code in the <A title="Operating system" href="https://en.wikipedia.org/wiki/Operating_system">operating system</A>, when mapping <A title="Virtual memory" href="https://en.wikipedia.org/wiki/Virtual_memory">virtual memory</A> to <A title="Physical memory" class=mw-redirect href="https://en.wikipedia.org/wiki/Physical_memory">physical memory</A>. A virtual memory subsystem that lacks cache coloring is less deterministic with regards to cache performance, as differences in page allocation from one program run to the next can lead to large differences in program performance.</P>
<P></P>
<DIV id=toc class=toc>
<DIV id=toctitle>
<H2>Contents</H2></DIV></DIV>
<DIV id=toc class=toc>
<UL>
<LI class="toclevel-1 tocsection-1"><A href="https://en.wikipedia.org/wiki/Cache_coloring#Details_of_operations"><SPAN class=tocnumber>1</SPAN> <SPAN class=toctext>Details of operations</SPAN></A></LI>
<LI class="toclevel-1 tocsection-2"><A href="https://en.wikipedia.org/wiki/Cache_coloring#Implementations"><SPAN class=tocnumber>2</SPAN> <SPAN class=toctext>Implementations</SPAN></A></LI>
<LI class="toclevel-1 tocsection-3"><A href="https://en.wikipedia.org/wiki/Cache_coloring#References"><SPAN class=tocnumber>3</SPAN> <SPAN class=toctext>References</SPAN></A></LI>
<LI class="toclevel-1 tocsection-4"><A href="https://en.wikipedia.org/wiki/Cache_coloring#External_links"><SPAN class=tocnumber>4</SPAN> <SPAN class=toctext>External links</SPAN></A></LI></UL></DIV>
<P></P>
<H2><SPAN id=Details_of_operations class=mw-headline>Details of operations</SPAN></H2>
<DIV class=thumbinner style="WIDTH: 402px"><A class=image href="https://en.wikipedia.org/wiki/File:Page_Coloring_Ja.JPG"><IMG class=thumbimage alt="" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e8/Page_Coloring_Ja.JPG/400px-Page_Coloring_Ja.JPG" width=400 height=257 data-file-height="510" data-file-width="794" srcset="//upload.wikimedia.org/wikipedia/commons/thumb/e/e8/Page_Coloring_Ja.JPG/600px-Page_Coloring_Ja.JPG 1.5x, //upload.wikimedia.org/wikipedia/commons/e/e8/Page_Coloring_Ja.JPG 2x"></A> 
<DIV class=thumbcaption>
<DIV class=magnify></DIV></DIV></DIV>
<DIV class="thumb tleft">
<DIV class=thumbinner style="WIDTH: 402px">
<DIV class=thumbcaption>Illustration of cache coloring. Left is <A title="Virtual memory" href="https://en.wikipedia.org/wiki/Virtual_memory">virtual memory</A> spaces, center is the physical memory space, and right is the <A title="CPU cache" href="https://en.wikipedia.org/wiki/CPU_cache">CPU cache</A>.</DIV></DIV></DIV>
<P>A physically indexed CPU cache is designed such that addresses in adjacent physical memory blocks take different positions ("cache lines") in the cache, but this is not the case when it comes to virtual memory; when virtually adjacent but not physically adjacent memory blocks are allocated, they could potentially both take the same position in the cache. Coloring is a technique implemented in memory management software, which solves this problem by selecting pages that do not contend with neighbor pages.</P>
<P>Physical memory pages are "colored" so that pages with different "colors" have different positions in CPU cache memory. When allocating sequential pages in virtual memory for processes, the kernel collects pages with different "colors" and maps them to the virtual memory. In this way, sequential pages in virtual memory do not contend for the same cache line.</P>
<H2><SPAN id=Implementations class=mw-headline>Implementations</SPAN></H2>
<P>This code adds a significant amount of complexity to the virtual memory allocation subsystem, but the result is well worth the effort.<SUP id=cite_ref-freebsd.org_1-0 class=reference><A href="https://en.wikipedia.org/wiki/Cache_coloring#cite_note-freebsd.org-1">[1]</A></SUP> Page coloring makes virtual memory as deterministic as physical memory with regard to cache performance. Page coloring is employed in <A title="Operating system" href="https://en.wikipedia.org/wiki/Operating_system">operating systems</A> such as <A title="Solaris (operating system)" href="https://en.wikipedia.org/wiki/Solaris_%28operating_system%29">Solaris</A>,<SUP id=cite_ref-2 class=reference><A href="https://en.wikipedia.org/wiki/Cache_coloring#cite_note-2">[2]</A></SUP> <A title=FreeBSD href="https://en.wikipedia.org/wiki/FreeBSD">FreeBSD</A>,<SUP id=cite_ref-freebsd.org_1-1 class=reference><A href="https://en.wikipedia.org/wiki/Cache_coloring#cite_note-freebsd.org-1">[1]</A></SUP> <A title=NetBSD href="https://en.wikipedia.org/wiki/NetBSD">NetBSD</A>,<SUP id=cite_ref-netbsd.org_3-0 class=reference><A href="https://en.wikipedia.org/wiki/Cache_coloring#cite_note-netbsd.org-3">[3]</A></SUP> and <A title="Windows NT" href="https://en.wikipedia.org/wiki/Windows_NT">Windows NT</A>.<SUP id=cite_ref-stanford.edu_4-0 class=reference><A href="https://en.wikipedia.org/wiki/Cache_coloring#cite_note-stanford.edu-4">[4]</A></SUP>