<H1 class=title>Exercise 46: A Project Skeleton</H1>
<P id=p1>This will be where you start learning how to set up a good project "skeleton" directory. This skeleton directory will have all the basics you need to get a new project up and running. It will have your project layout, automated tests, modules, and install scripts. When you go to make a new project, just copy this directory to a new name and edit the files to get started.</P>
<DIV id=installing-python-packages class=section>
<H1>Installing Python Packages</H1>
<P id=p2>Before you can begin this exercise you need to install some software for Python by using a tool called "pip" to install new modules. Here's the problem though. You are at a point where it's difficult for me to help you do that and keep this book sane and clean. There are so many ways to install software on so many computers that I'd have to spend 10 pages walking you through every step, and let me tell you I am a lazy guy.</P>
<P id=p3>Rather than tell you how to do it exactly, I'm going to tell you what you should install, and then you tell you to watch the video that accompanies this exercise and follow along. You will have to struggle with this part of the exercise though as giving accurate and current installation instructions is tricky. Computers change frequently so you may have to do some research if you get stuck.</P>
<P id=p4>Install the following Python packages:</P>
<OL class="arabic simple">
<LI>pip from <A class="reference external" href="http://pypi.python.org/pypi/pip"><FONT color=#000080>http://pypi.python.org/pypi/pip</FONT></A></LI>
<LI>distribute from <A class="reference external" href="http://pypi.python.org/pypi/distribute"><FONT color=#000080>http://pypi.python.org/pypi/distribute</FONT></A></LI>
<LI>nose from <A class="reference external" href="http://pypi.python.org/pypi/nose/"><FONT color=#000080>http://pypi.python.org/pypi/nose/</FONT></A></LI>
<LI>virtualenv from <A class="reference external" href="http://pypi.python.org/pypi/virtualenv"><FONT color=#000080>http://pypi.python.org/pypi/virtualenv</FONT></A></LI></OL>
<P id=p5>Do not just download these packages and install them by hand. Instead see how other people recommend you install these packages and use them for your particular system. The process will be different for most versions of Linux, OSX, and definitely different for Windows.</P>
<P id=p6>I am warning you; this will be frustrating. In the business we call this "yak shaving." Yak shaving is any activity that is mind numblingly, irritatingly boring and tedious that you have to do before you can do something else that's more fun. You want to create cool Python projects, but you can't do that until you set up a skeleton directory, but you can't set up a skeleton directory until you install some packages, but you can't install packages until you install package installers, and you can't install package installers until you figure out how your system installs software in general, and so on.</P>
<P id=p7>Struggle through this anyway. Consider it your trial by annoyance to get into the programmer club. Every programmer has to do these annoying tedious tasks before they can do something cool.</P>
<DIV class=note>
<P id=p8 class="first admonition-title">Note</P>
<P id=p9>Sometimes the Python installer does not add the <TT class="docutils literal"><SPAN class=pre>C:\Python27\Script</SPAN></TT> to the system <TT class="docutils literal">PATH</TT>. If this is the case for you, go back and add this to the path just like you did for <TT class="docutils literal"><SPAN class=pre>C:\Python27</SPAN></TT> in Exercise 0 with:</P><PRE class="last literal-block">[Environment]::SetEnvironmentVariable("Path",
"$env:Path;C:\Python27\Scripts", "User")
</PRE></DIV></DIV>
<DIV id=creating-the-skeleton-project-directory class=section>
<H1>Creating the Skeleton Project Directory</H1>
<P id=p10>First, create the structure of your skeleton directory with these commands:</P><PRE class="code console literal-block"><SPAN class="generic prompt">$</SPAN> mkdir projects
<SPAN class="generic prompt">$</SPAN> <SPAN class="name builtin">cd</SPAN> projects/
<SPAN class="generic prompt">$</SPAN> mkdir skeleton
<SPAN class="generic prompt">$</SPAN> <SPAN class="name builtin">cd</SPAN> skeleton
<SPAN class="generic prompt">$</SPAN> mkdir bin NAME tests docs
</PRE>
<P id=p11>I use a directory named <TT class="docutils literal">projects</TT> to store all the various things I'm working on. Inside that directory I have my <TT class="docutils literal">skeleton</TT> directory that I put the basis of my projects into. The directory <TT class="docutils literal">NAME</TT> will be renamed to whatever you are calling your project's main module when you use the skeleton.</P>
<P id=p12>Next we need to set up some initial files. Here's how you do that on Linux/OSX:</P><PRE class="code console literal-block"><SPAN class="generic prompt">$</SPAN> touch NAME/__init__.py
<SPAN class="generic prompt">$</SPAN> touch tests/__init__.py
</PRE>
<P id=p13>Here's the same thing on Windows PowerShell:</P><PRE class="code console literal-block"><SPAN class="generic prompt">$</SPAN> new-item -type file NAME/__init__.py
<SPAN class="generic prompt">$</SPAN> new-item -type file tests/__init__.py
</PRE>
<P id=p14>That creates an empty Python module directories we can put our code in. Then we need to create a <TT class="docutils literal">setup.py</TT> file we can use to install our project later if we want:</P>
<TABLE class=highlighttable>
<TBODY>
<TR></TR></TBODY></TABLE></DIV>
<TABLE class=highlighttable>
<TBODY>
<TR>
<TD class=code>
<DIV class=highlight><PRE><SPAN></SPAN><A name=python--skeleton--setup.py-idio.html-1></A><SPAN class=k>try</SPAN><SPAN class=p>:</SPAN>
<A name=python--skeleton--setup.py-idio.html-2></A>    <SPAN class=kn>from</SPAN> <SPAN class=nn>setuptools</SPAN> <SPAN class=kn>import</SPAN> <SPAN class=n>setup</SPAN>
<A name=python--skeleton--setup.py-idio.html-3></A><SPAN class=k>except</SPAN> <SPAN class=ne>ImportError</SPAN><SPAN class=p>:</SPAN>
<A name=python--skeleton--setup.py-idio.html-4></A>    <SPAN class=kn>from</SPAN> <SPAN class=nn>distutils.core</SPAN> <SPAN class=kn>import</SPAN> <SPAN class=n>setup</SPAN>
<A name=python--skeleton--setup.py-idio.html-5></A>
<A name=python--skeleton--setup.py-idio.html-6></A><SPAN class=n>config</SPAN> <SPAN class=o>=</SPAN> <SPAN class=p>{</SPAN>
<A name=python--skeleton--setup.py-idio.html-7></A>    <SPAN class=s1>'description'</SPAN><SPAN class=p>:</SPAN> <SPAN class=s1>'My Project'</SPAN><SPAN class=p>,</SPAN>
<A name=python--skeleton--setup.py-idio.html-8></A>    <SPAN class=s1>'author'</SPAN><SPAN class=p>:</SPAN> <SPAN class=s1>'My Name'</SPAN><SPAN class=p>,</SPAN>
<A name=python--skeleton--setup.py-idio.html-9></A>    <SPAN class=s1>'url'</SPAN><SPAN class=p>:</SPAN> <SPAN class=s1>'URL to get it at.'</SPAN><SPAN class=p>,</SPAN>
<A name=python--skeleton--setup.py-idio.html-10></A>    <SPAN class=s1>'download_url'</SPAN><SPAN class=p>:</SPAN> <SPAN class=s1>'Where to download it.'</SPAN><SPAN class=p>,</SPAN>
<A name=python--skeleton--setup.py-idio.html-11></A>    <SPAN class=s1>'author_email'</SPAN><SPAN class=p>:</SPAN> <SPAN class=s1>'My email.'</SPAN><SPAN class=p>,</SPAN>
<A name=python--skeleton--setup.py-idio.html-12></A>    <SPAN class=s1>'version'</SPAN><SPAN class=p>:</SPAN> <SPAN class=s1>'0.1'</SPAN><SPAN class=p>,</SPAN>
<A name=python--skeleton--setup.py-idio.html-13></A>    <SPAN class=s1>'install_requires'</SPAN><SPAN class=p>:</SPAN> <SPAN class=p>[</SPAN><SPAN class=s1>'nose'</SPAN><SPAN class=p>],</SPAN>
<A name=python--skeleton--setup.py-idio.html-14></A>    <SPAN class=s1>'packages'</SPAN><SPAN class=p>:</SPAN> <SPAN class=p>[</SPAN><SPAN class=s1>'NAME'</SPAN><SPAN class=p>],</SPAN>
<A name=python--skeleton--setup.py-idio.html-15></A>    <SPAN class=s1>'scripts'</SPAN><SPAN class=p>:</SPAN> <SPAN class=p>[],</SPAN>
<A name=python--skeleton--setup.py-idio.html-16></A>    <SPAN class=s1>'name'</SPAN><SPAN class=p>:</SPAN> <SPAN class=s1>'projectname'</SPAN>
<A name=python--skeleton--setup.py-idio.html-17></A><SPAN class=p>}</SPAN>
<A name=python--skeleton--setup.py-idio.html-18></A>
<A name=python--skeleton--setup.py-idio.html-19></A><SPAN class=n>setup</SPAN><SPAN class=p>(</SPAN><SPAN class=o>**</SPAN><SPAN class=n>config</SPAN><SPAN class=p>)</SPAN>
</PRE></DIV></TD></TR></TBODY></TABLE>
<P id=p15>Edit this file so that it has your contact information and is ready to go for when you copy it.</P>
<P id=p16>Finally you will want a simple skeleton file for tests named <TT class="docutils literal">tests/NAME_tests.py</TT>:</P>
<TABLE class=highlighttable>
<TBODY>
<TR></TR></TBODY></TABLE>
<DIV id=creating-the-skeleton-project-directory class=section>
<TABLE class=highlighttable>
<TBODY>
<TR>
<TD class=code>
<DIV class=highlight><PRE><SPAN></SPAN><A name=python--skeleton--tests--NAME_tests.py-idio.html-1></A><SPAN class=kn>from</SPAN> <SPAN class=nn>nose.tools</SPAN> <SPAN class=kn>import</SPAN> <SPAN class=o>*</SPAN>
<A name=python--skeleton--tests--NAME_tests.py-idio.html-2></A><SPAN class=kn>import</SPAN> <SPAN class=nn>NAME</SPAN>
<A name=python--skeleton--tests--NAME_tests.py-idio.html-3></A>
<A name=python--skeleton--tests--NAME_tests.py-idio.html-4></A><SPAN class=k>def</SPAN> <SPAN class=nf>setup</SPAN><SPAN class=p>():</SPAN>
<A name=python--skeleton--tests--NAME_tests.py-idio.html-5></A>    <SPAN class=k>print</SPAN> <SPAN class=s2>"SETUP!"</SPAN>
<A name=python--skeleton--tests--NAME_tests.py-idio.html-6></A>
<A name=python--skeleton--tests--NAME_tests.py-idio.html-7></A><SPAN class=k>def</SPAN> <SPAN class=nf>teardown</SPAN><SPAN class=p>():</SPAN>
<A name=python--skeleton--tests--NAME_tests.py-idio.html-8></A>    <SPAN class=k>print</SPAN> <SPAN class=s2>"TEAR DOWN!"</SPAN>
<A name=python--skeleton--tests--NAME_tests.py-idio.html-9></A>
<A name=python--skeleton--tests--NAME_tests.py-idio.html-10></A><SPAN class=k>def</SPAN> <SPAN class=nf>test_basic</SPAN><SPAN class=p>():</SPAN>
<A name=python--skeleton--tests--NAME_tests.py-idio.html-11></A>    <SPAN class=k>print</SPAN> <SPAN class=s2>"I RAN!"</SPAN>
</PRE></DIV></TD></TR></TBODY></TABLE>
<DIV id=final-directory-structure class=section>
<H2>Final Directory Structure</H2>
<P id=p17>When you are done setting all of this up, your directory should look like mine here:</P><PRE class="code console literal-block"><SPAN class="generic output">skeleton/
     NAME/
         __init__.py
     bin/
     docs/
     setup.py
     tests/
         NAME_tests.py
         __init__.py</SPAN>
</PRE>
<P id=p18>And from now on, you should run your commands from that work with this directory from this point. If you can't do <TT class="docutils literal">ls <SPAN class=pre>-R</SPAN></TT> and see this same structure, then you are in the wrong place. For example, people commonly go into the <TT class="docutils literal">tests/</TT> directory to try to run files there, which won't work. To run your application's tests, you would need to be <EM>above</EM> <TT class="docutils literal">tests/</TT> and this location I have above. So, if you try this:</P><PRE class="code console literal-block"><SPAN class="generic prompt">$</SPAN> <SPAN class="name builtin">cd</SPAN> tests/   <SPAN class="comment single"># WRONG! WRONG! WRONG!
</SPAN><SPAN class="generic prompt">$</SPAN><SPAN class="comment single"></SPAN> nosetests
<SPAN class="generic output">
----------------------------------------------------------------------
Ran 0 tests in 0.000s

OK</SPAN>
</PRE>
<P id=p19>Then that is <EM>wrong</EM>! You have to be above tests, so assuming you made this mistake, you would fix it by doing this:</P><PRE class="code console literal-block"><SPAN class="generic prompt">$</SPAN> <SPAN class="name builtin">cd</SPAN> ..   <SPAN class="comment single"># get out of tests/
</SPAN><SPAN class="generic prompt">$</SPAN><SPAN class="comment single"></SPAN> ls      <SPAN class="comment single"># CORRECT! you are now in the right spot
</SPAN><SPAN class="generic output">NAME                bin             docs            setup.py        tests
</SPAN><SPAN class="generic prompt">$</SPAN> nosetests
<SPAN class="generic output">.
----------------------------------------------------------------------
Ran 1 test in 0.004s

OK</SPAN>
</PRE>
<P id=p20>Remember this because people make this mistake quite frequently.</P></DIV></DIV>
<DIV id=testing-your-setup class=section>
<H1>Testing Your Setup</H1>
<P id=p21>After you get all that installed you should be able to do this:</P><PRE class="code console literal-block"><SPAN class="generic prompt">$</SPAN> nosetests
<SPAN class="generic output">.
----------------------------------------------------------------------
Ran 1 test in 0.007s

OK</SPAN>
</PRE>
<P id=p22>I'll explain what this <TT class="docutils literal">nosetests</TT> thing is doing in the next exercise, but for now if you do not see that, you probably got something wrong. Make sure you put <TT class="docutils literal">__init__.py</TT> files in your <TT class="docutils literal">NAME</TT> and <TT class="docutils literal">tests</TT> directories and make sure you got <TT class="docutils literal">tests/NAME_tests.py</TT> right.</P></DIV>
<DIV id=using-the-skeleton class=section>
<H1>Using the Skeleton</H1>
<P id=p23>You are now done with most of your yak shaving. Whenever you want to start a new project, just do this:</P>
<OL class="arabic simple">
<LI>Make a copy of your skeleton directory. Name it after your new project.</LI>
<LI>Rename (move) the <TT class="docutils literal">NAME</TT> directory to be the name of your project or whatever you want to call your root module.</LI>
<LI>Edit your <TT class="docutils literal">setup.py</TT> to have all the information for your project.</LI>
<LI>Rename <TT class="docutils literal">tests/NAME_tests.py</TT> to also have your module name.</LI>
<LI>Double check it's all working by using <TT class="docutils literal">nosetests</TT> again.</LI>
<LI>Start coding.</LI></OL></DIV>
<DIV id=required-quiz class=section>
<H1>Required Quiz</H1>
<P id=p24>This exercise doesn't have Study Drills but a quiz you should complete:</P>
<OL class="arabic simple">
<LI>Read about how to use all of the things you installed.</LI>
<LI>Read about the <TT class="docutils literal">setup.py</TT> file and all it has to offer. Warning: it is not a very well-written piece of software, so it will be very strange to use.</LI>
<LI>Make a project and start putting code into the module, then get the module working.</LI>
<LI>Put a script in the <TT class="docutils literal">bin</TT> directory that you can run. Read about how you can make a Python script that's runnable for your system.</LI>
<LI>Mention the <TT class="docutils literal">bin</TT> script you created in your <TT class="docutils literal">setup.py</TT> so that it gets installed.</LI>
<LI>Use your <TT class="docutils literal">setup.py</TT> to install your own module and make sure it works, then use <TT class="docutils literal">pip</TT> to uninstall it.</LI></OL></DIV>
<DIV id=common-student-questions class=section>
<H1>Common Student Questions</H1>
<DL class=docutils>
<DT>Do these instructions work on Windows?</DT>
<DD>They should, but depending on the version of Windows you may need to struggle with the setup a bit to get it working. Just keep researching and trying it until you get it, or see if you can ask a more experienced Python+Windows friend to help out.</DD>
<DT>It seems I can't run <TT class="docutils literal">nosetests</TT> on Windows?</DT>
<DD>Sometimes the Python installer does not add the <TT class="docutils literal"><SPAN class=pre>C:\Python27\Script</SPAN></TT> to the system <TT class="docutils literal">PATH</TT>. If this is the case for you, go back and add this to the path just like you did for <TT class="docutils literal"><SPAN class=pre>C:\Python27</SPAN></TT> in Exercise 0.</DD>
<DT>What do I put in the config dictionary in my <TT class="docutils literal">setup.py</TT>?</DT>
<DD>Make sure you read the documentation for distutils at <A class="reference external" href="http://docs.python.org/distutils/setupscript.html"><FONT color=#000080>http://docs.python.org/distutils/setupscript.html</FONT></A>.</DD>
<DT>I can't seem to load the <TT class="docutils literal">NAME</TT> module and just get an ImportError.</DT>
<DD>Make sure you made the <TT class="docutils literal">NAME/__init__.py</TT> file. If you're on Windows make sure you didn't accidentally name it <TT class="docutils literal">NAME/__init__.py.txt</TT> which happens by default with some editors.</DD>
<DT>Why do we need a <TT class="docutils literal">bin/</TT> folder at all?</DT>
<DD>This is just a standard place to put scripts that are run on the command line, not a place to put modules.</DD>
<DT>Do you have a real world example project?</DT>
<DD>There are many projects written in Python that do this, but try this simple one I created: <A class="reference external" href="https://gitorious.org/python-modargs"><FONT color=#000080>https://gitorious.org/python-modargs</FONT></A>.</DD>
<DT>My <TT class="docutils literal">nosetests</TT> run only shows one test being run. Is that right?</DT>
<DD>Yes, that's what my output shows too.</DD></DL></DIV>