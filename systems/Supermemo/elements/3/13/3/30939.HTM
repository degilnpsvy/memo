<H1 class=title>Exercise 47: Automated Testing</H1>
<P id=p1>Having to type commands into your game over and over to make sure it's working is annoying. Wouldn't it be better to write little pieces of code that test your code? Then when you make a change, or add a new thing to your program, you just "run your tests" and the tests make sure things are still working. These automated tests won't catch all your bugs, but they will cut down on the time you spend repeatedly typing and running your code.</P>
<P id=p2>Every exercise after this one will not have a <EM>What You Should See</EM> section, but instead will have a <EM>What You Should Test</EM> section. You will be writing automated tests for all of your code starting now, and this will hopefully make you an even better programmer.</P>
<P id=p3>I won't try to explain why you should write automated tests. I will only say that you are trying to be a programmer, and programmers automate boring and tedious tasks. Testing a piece of software is definitely boring and tedious, so you might as well write a little bit of code to do it for you.</P>
<P id=p4>That should be all the explanation you need because <EM>your</EM> reason for writing unit tests is to make your brain stronger. You have gone through this book writing code to do things. Now you are going to take the next leap and write code that knows about other code you have written. This process of writing a test that runs some code you have written <EM>forces</EM> you to understand clearly what you have just written. It solidifies in your brain exactly what it does and why it works and gives you a new level of attention to detail.</P>
<DIV id=writing-a-test-case class=section>
<H1>Writing a Test Case</H1>
<P id=p5>We're going to take a very simple piece of code and write one simple test. We're going to base this little test on a new project from your project skeleton.</P>
<P id=p6>First, make a <TT class="docutils literal">ex47</TT> project from your project skeleton. Here are the steps you would take. I'm going to give these instructions in English rather than show you how to type them so that <EM>you</EM> have to figure it out.</P>
<OL class="arabic simple">
<LI>Copy <TT class="docutils literal">skeleton</TT> to <TT class="docutils literal">ex47</TT>.</LI>
<LI>Rename everything with <TT class="docutils literal">NAME</TT> to <TT class="docutils literal">ex47</TT>.</LI>
<LI>Change the word <TT class="docutils literal">NAME</TT> in all the files to <TT class="docutils literal">ex47</TT>.</LI>
<LI>Finally, remove all the <TT class="docutils literal">*.pyc</TT> files to make sure you're clean.</LI></OL>
<P id=p7>Refer back to Exercise 46 if you get stuck, and if you can't do this easily then maybe practice it a few times.</P>
<DIV class=note>
<P id=p8 class="first admonition-title">Note</P>
<P id=p9 class=last>Remember that you run the command <TT class="docutils literal">nosetests</TT> to run the tests. You can run them with <TT class="docutils literal">python ex47_tests.py</TT> but it won't work as easily and you'll have to do it for each test file.</P></DIV>
<P id=p10>Next, create a simple file <TT class="docutils literal">ex47/game.py</TT> where you can put the code to test. This will be a very silly little class that we want to test with this code in it:</P>
<TABLE class=highlighttable>
<TBODY>
<TR></TR></TBODY></TABLE></DIV>
<TABLE class=highlighttable>
<TBODY>
<TR>
<TD class=code>
<DIV class=highlight><PRE><SPAN></SPAN><A name=python--ex47--ex47--game.py-idio.html-1></A><SPAN class=k>class</SPAN> <SPAN class=nc>Room</SPAN><SPAN class=p>(</SPAN><SPAN class=nb>object</SPAN><SPAN class=p>):</SPAN>
<A name=python--ex47--ex47--game.py-idio.html-2></A>
<A name=python--ex47--ex47--game.py-idio.html-3></A>    <SPAN class=k>def</SPAN> <SPAN class=nf>__init__</SPAN><SPAN class=p>(</SPAN><SPAN class=bp>self</SPAN><SPAN class=p>,</SPAN> <SPAN class=n>name</SPAN><SPAN class=p>,</SPAN> <SPAN class=n>description</SPAN><SPAN class=p>):</SPAN>
<A name=python--ex47--ex47--game.py-idio.html-4></A>        <SPAN class=bp>self</SPAN><SPAN class=o>.</SPAN><SPAN class=n>name</SPAN> <SPAN class=o>=</SPAN> <SPAN class=n>name</SPAN>
<A name=python--ex47--ex47--game.py-idio.html-5></A>        <SPAN class=bp>self</SPAN><SPAN class=o>.</SPAN><SPAN class=n>description</SPAN> <SPAN class=o>=</SPAN> <SPAN class=n>description</SPAN>
<A name=python--ex47--ex47--game.py-idio.html-6></A>        <SPAN class=bp>self</SPAN><SPAN class=o>.</SPAN><SPAN class=n>paths</SPAN> <SPAN class=o>=</SPAN> <SPAN class=p>{}</SPAN>
<A name=python--ex47--ex47--game.py-idio.html-7></A>
<A name=python--ex47--ex47--game.py-idio.html-8></A>    <SPAN class=k>def</SPAN> <SPAN class=nf>go</SPAN><SPAN class=p>(</SPAN><SPAN class=bp>self</SPAN><SPAN class=p>,</SPAN> <SPAN class=n>direction</SPAN><SPAN class=p>):</SPAN>
<A name=python--ex47--ex47--game.py-idio.html-9></A>        <SPAN class=k>return</SPAN> <SPAN class=bp>self</SPAN><SPAN class=o>.</SPAN><SPAN class=n>paths</SPAN><SPAN class=o>.</SPAN><SPAN class=n>get</SPAN><SPAN class=p>(</SPAN><SPAN class=n>direction</SPAN><SPAN class=p>,</SPAN> <SPAN class=bp>None</SPAN><SPAN class=p>)</SPAN>
<A name=python--ex47--ex47--game.py-idio.html-10></A>
<A name=python--ex47--ex47--game.py-idio.html-11></A>    <SPAN class=k>def</SPAN> <SPAN class=nf>add_paths</SPAN><SPAN class=p>(</SPAN><SPAN class=bp>self</SPAN><SPAN class=p>,</SPAN> <SPAN class=n>paths</SPAN><SPAN class=p>):</SPAN>
<A name=python--ex47--ex47--game.py-idio.html-12></A>        <SPAN class=bp>self</SPAN><SPAN class=o>.</SPAN><SPAN class=n>paths</SPAN><SPAN class=o>.</SPAN><SPAN class=n>update</SPAN><SPAN class=p>(</SPAN><SPAN class=n>paths</SPAN><SPAN class=p>)</SPAN>
</PRE></DIV></TD></TR></TBODY></TABLE>
<P id=p11>Once you have that file, change the unit test skeleton to this:</P>
<TABLE class=highlighttable>
<TBODY>
<TR></TR></TBODY></TABLE>
<DIV id=writing-a-test-case class=section>
<TABLE class=highlighttable>
<TBODY>
<TR>
<TD class=code>
<DIV class=highlight><PRE><SPAN></SPAN><A name=python--ex47--tests--ex47_tests.py-idio.html-1></A><SPAN class=kn>from</SPAN> <SPAN class=nn>nose.tools</SPAN> <SPAN class=kn>import</SPAN> <SPAN class=o>*</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-2></A><SPAN class=kn>from</SPAN> <SPAN class=nn>ex47.game</SPAN> <SPAN class=kn>import</SPAN> <SPAN class=n>Room</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-3></A>
<A name=python--ex47--tests--ex47_tests.py-idio.html-4></A>
<A name=python--ex47--tests--ex47_tests.py-idio.html-5></A><SPAN class=k>def</SPAN> <SPAN class=nf>test_room</SPAN><SPAN class=p>():</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-6></A>    <SPAN class=n>gold</SPAN> <SPAN class=o>=</SPAN> <SPAN class=n>Room</SPAN><SPAN class=p>(</SPAN><SPAN class=s2>"GoldRoom"</SPAN><SPAN class=p>,</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-7></A>                <SPAN class=sd>"""This room has gold in it you can grab. There's a</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-8></A><SPAN class=sd>                door to the north."""</SPAN><SPAN class=p>)</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-9></A>    <SPAN class=n>assert_equal</SPAN><SPAN class=p>(</SPAN><SPAN class=n>gold</SPAN><SPAN class=o>.</SPAN><SPAN class=n>name</SPAN><SPAN class=p>,</SPAN> <SPAN class=s2>"GoldRoom"</SPAN><SPAN class=p>)</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-10></A>    <SPAN class=n>assert_equal</SPAN><SPAN class=p>(</SPAN><SPAN class=n>gold</SPAN><SPAN class=o>.</SPAN><SPAN class=n>paths</SPAN><SPAN class=p>,</SPAN> <SPAN class=p>{})</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-11></A>
<A name=python--ex47--tests--ex47_tests.py-idio.html-12></A><SPAN class=k>def</SPAN> <SPAN class=nf>test_room_paths</SPAN><SPAN class=p>():</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-13></A>    <SPAN class=n>center</SPAN> <SPAN class=o>=</SPAN> <SPAN class=n>Room</SPAN><SPAN class=p>(</SPAN><SPAN class=s2>"Center"</SPAN><SPAN class=p>,</SPAN> <SPAN class=s2>"Test room in the center."</SPAN><SPAN class=p>)</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-14></A>    <SPAN class=n>north</SPAN> <SPAN class=o>=</SPAN> <SPAN class=n>Room</SPAN><SPAN class=p>(</SPAN><SPAN class=s2>"North"</SPAN><SPAN class=p>,</SPAN> <SPAN class=s2>"Test room in the north."</SPAN><SPAN class=p>)</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-15></A>    <SPAN class=n>south</SPAN> <SPAN class=o>=</SPAN> <SPAN class=n>Room</SPAN><SPAN class=p>(</SPAN><SPAN class=s2>"South"</SPAN><SPAN class=p>,</SPAN> <SPAN class=s2>"Test room in the south."</SPAN><SPAN class=p>)</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-16></A>
<A name=python--ex47--tests--ex47_tests.py-idio.html-17></A>    <SPAN class=n>center</SPAN><SPAN class=o>.</SPAN><SPAN class=n>add_paths</SPAN><SPAN class=p>({</SPAN><SPAN class=s1>'north'</SPAN><SPAN class=p>:</SPAN> <SPAN class=n>north</SPAN><SPAN class=p>,</SPAN> <SPAN class=s1>'south'</SPAN><SPAN class=p>:</SPAN> <SPAN class=n>south</SPAN><SPAN class=p>})</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-18></A>    <SPAN class=n>assert_equal</SPAN><SPAN class=p>(</SPAN><SPAN class=n>center</SPAN><SPAN class=o>.</SPAN><SPAN class=n>go</SPAN><SPAN class=p>(</SPAN><SPAN class=s1>'north'</SPAN><SPAN class=p>),</SPAN> <SPAN class=n>north</SPAN><SPAN class=p>)</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-19></A>    <SPAN class=n>assert_equal</SPAN><SPAN class=p>(</SPAN><SPAN class=n>center</SPAN><SPAN class=o>.</SPAN><SPAN class=n>go</SPAN><SPAN class=p>(</SPAN><SPAN class=s1>'south'</SPAN><SPAN class=p>),</SPAN> <SPAN class=n>south</SPAN><SPAN class=p>)</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-20></A>
<A name=python--ex47--tests--ex47_tests.py-idio.html-21></A><SPAN class=k>def</SPAN> <SPAN class=nf>test_map</SPAN><SPAN class=p>():</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-22></A>    <SPAN class=n>start</SPAN> <SPAN class=o>=</SPAN> <SPAN class=n>Room</SPAN><SPAN class=p>(</SPAN><SPAN class=s2>"Start"</SPAN><SPAN class=p>,</SPAN> <SPAN class=s2>"You can go west and down a hole."</SPAN><SPAN class=p>)</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-23></A>    <SPAN class=n>west</SPAN> <SPAN class=o>=</SPAN> <SPAN class=n>Room</SPAN><SPAN class=p>(</SPAN><SPAN class=s2>"Trees"</SPAN><SPAN class=p>,</SPAN> <SPAN class=s2>"There are trees here, you can go east."</SPAN><SPAN class=p>)</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-24></A>    <SPAN class=n>down</SPAN> <SPAN class=o>=</SPAN> <SPAN class=n>Room</SPAN><SPAN class=p>(</SPAN><SPAN class=s2>"Dungeon"</SPAN><SPAN class=p>,</SPAN> <SPAN class=s2>"It's dark down here, you can go up."</SPAN><SPAN class=p>)</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-25></A>
<A name=python--ex47--tests--ex47_tests.py-idio.html-26></A>    <SPAN class=n>start</SPAN><SPAN class=o>.</SPAN><SPAN class=n>add_paths</SPAN><SPAN class=p>({</SPAN><SPAN class=s1>'west'</SPAN><SPAN class=p>:</SPAN> <SPAN class=n>west</SPAN><SPAN class=p>,</SPAN> <SPAN class=s1>'down'</SPAN><SPAN class=p>:</SPAN> <SPAN class=n>down</SPAN><SPAN class=p>})</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-27></A>    <SPAN class=n>west</SPAN><SPAN class=o>.</SPAN><SPAN class=n>add_paths</SPAN><SPAN class=p>({</SPAN><SPAN class=s1>'east'</SPAN><SPAN class=p>:</SPAN> <SPAN class=n>start</SPAN><SPAN class=p>})</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-28></A>    <SPAN class=n>down</SPAN><SPAN class=o>.</SPAN><SPAN class=n>add_paths</SPAN><SPAN class=p>({</SPAN><SPAN class=s1>'up'</SPAN><SPAN class=p>:</SPAN> <SPAN class=n>start</SPAN><SPAN class=p>})</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-29></A>
<A name=python--ex47--tests--ex47_tests.py-idio.html-30></A>    <SPAN class=n>assert_equal</SPAN><SPAN class=p>(</SPAN><SPAN class=n>start</SPAN><SPAN class=o>.</SPAN><SPAN class=n>go</SPAN><SPAN class=p>(</SPAN><SPAN class=s1>'west'</SPAN><SPAN class=p>),</SPAN> <SPAN class=n>west</SPAN><SPAN class=p>)</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-31></A>    <SPAN class=n>assert_equal</SPAN><SPAN class=p>(</SPAN><SPAN class=n>start</SPAN><SPAN class=o>.</SPAN><SPAN class=n>go</SPAN><SPAN class=p>(</SPAN><SPAN class=s1>'west'</SPAN><SPAN class=p>)</SPAN><SPAN class=o>.</SPAN><SPAN class=n>go</SPAN><SPAN class=p>(</SPAN><SPAN class=s1>'east'</SPAN><SPAN class=p>),</SPAN> <SPAN class=n>start</SPAN><SPAN class=p>)</SPAN>
<A name=python--ex47--tests--ex47_tests.py-idio.html-32></A>    <SPAN class=n>assert_equal</SPAN><SPAN class=p>(</SPAN><SPAN class=n>start</SPAN><SPAN class=o>.</SPAN><SPAN class=n>go</SPAN><SPAN class=p>(</SPAN><SPAN class=s1>'down'</SPAN><SPAN class=p>)</SPAN><SPAN class=o>.</SPAN><SPAN class=n>go</SPAN><SPAN class=p>(</SPAN><SPAN class=s1>'up'</SPAN><SPAN class=p>),</SPAN> <SPAN class=n>start</SPAN><SPAN class=p>)</SPAN>
</PRE></DIV></TD></TR></TBODY></TABLE>
<P id=p12>This file imports the <TT class="docutils literal">Room</TT> class you made in the <TT class="docutils literal">ex47.game</TT> module so that you can do tests on it. There is then a set of tests that are functions starting with <TT class="docutils literal">test_</TT>. Inside each test case there's a bit of code that makes a room or a set of rooms, and then makes sure the rooms work the way you expect them to work. It tests out the basic room features, then the paths, then tries out a whole map.</P>
<P id=p13>The important functions here are <TT class="docutils literal">assert_equal</TT> which makes sure that variables you have set or paths you have built in a <TT class="docutils literal">Room</TT> are actually what you think they are. If you get the wrong result, then <TT class="docutils literal">nosetests</TT> will print out an error message so you can go figure it out.</P></DIV>
<DIV id=testing-guidelines class=section>
<H1>Testing Guidelines</H1>
<P id=p14>Follow this general loose set of guidelines when making your tests:</P>
<OL class="arabic simple">
<LI>Test files go in <TT class="docutils literal">tests/</TT> and are named <TT class="docutils literal">BLAH_tests.py</TT> otherwise <TT class="docutils literal">nosetests</TT> won't run them. This also keeps your tests from clashing with your other code.</LI>
<LI>Write one test file for each module you make.</LI>
<LI>Keep your test cases (functions) short, but do not worry if they are a bit messy. Test cases are usually kind of messy.</LI>
<LI>Even though test cases are messy, try to keep them clean and remove any repetitive code you can. Create helper functions that get rid of duplicate code. You will thank me later when you make a change and then have to change your tests. Duplicated code will make changing your tests more difficult.</LI>
<LI>Finally, do not get too attached to your tests. Sometimes, the best way to redesign something is to just delete it and start over.</LI></OL></DIV>
<DIV id=what-you-should-see class=section>
<H1>What You Should See</H1>
<DIV class=highlight><PRE><SPAN></SPAN><A name=python--ex47.sh-session-pyg.html-1></A><SPAN class=gp>$</SPAN> nosetests
<A name=python--ex47.sh-session-pyg.html-2></A><SPAN class=go>...</SPAN>
<A name=python--ex47.sh-session-pyg.html-3></A><SPAN class=go>----------------------------------------------------------------------</SPAN>
<A name=python--ex47.sh-session-pyg.html-4></A><SPAN class=go>Ran 3 tests in 0.008s</SPAN>
<A name=python--ex47.sh-session-pyg.html-5></A>
<A name=python--ex47.sh-session-pyg.html-6></A><SPAN class=go>OK</SPAN>
</PRE></DIV>
<P id=p15>That's what you should see if everything is working right. Try causing an error to see what that looks like and then fix it.</P></DIV>
<DIV id=study-drills class=section>
<H1>Study Drills</H1>
<OL class="arabic simple">
<LI>Go read about nosetests more, and also read about alternatives.</LI>
<LI>Learn about Python's "doc tests" and see if you like them better.</LI>
<LI>Make your room more advanced, and then use it to rebuild your game yet again but this time, unit test as you go.</LI></OL></DIV>
<DIV id=common-student-questions class=section>
<H1>Common Student Questions</H1>
<DL class=docutils>
<DT>I get a syntax error when I run <TT class="docutils literal">nosetests</TT>.</DT>
<DD>If you get that then look at what the error says and fix that line of code or the ones above it. Tools like <TT class="docutils literal">nosetests</TT> are running your code and the test code, so they will find syntax errors the same as running Python will.</DD>
<DT>I can't import <TT class="docutils literal">ex47.game</TT>?</DT>
<DD>
<P id=p16 class=first>Make sure you create the <TT class="docutils literal">ex47/__init__.py</TT> file. Refer to Exercise 46 again to see how it's done. If that's not the problem then do this on OSX/Linux:</P><PRE class=literal-block>export PYTHONPATH=.
</PRE>
<P id=p17>And on Windows:</P><PRE class=literal-block>$env:PYTHONPATH = "$env:PYTHONPATH;."
</PRE>
<P id=p18 class=last>Finally, make sure you're running ther tests with <TT class="docutils literal">nosetests</TT> not with just Python.</P></DD>
<DT>I get <TT class="docutils literal">UserWarning</TT> when I run <TT class="docutils literal">nosetests</TT>.</DT>
<DD>You probably have two versions of Python installed or you aren't using distribute. Go back and install <TT class="docutils literal">distribute</TT> or <TT class="docutils literal">pip</TT> as I describe in Exercise 46.</DD></DL></DIV>