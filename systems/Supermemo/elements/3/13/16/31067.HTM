B4.17 Function calls from Secure state to Non-secure state 
<P></P>
<P>RGVBB <FONT class=extract>If an interstating branch generates a change from Secure state to Non-secure state, then before the Security state change:<BR>&#8226; The return address, which is the address of the instruction after the instruction that caused the function call, the IPSR value, and CONTROL.SFPA are stored onto the current stack, as shown in the following figure. ReturnAddress[0] is set to 1 to indicate a return to the T32 Instruction set state. The IPSR is stacked in the partial RETPSR, and CONTROL.SFPA is stacked in bit [20] of the partial RETPSR.</FONT></P>
<P style="FONT-FAMILY: monospace; COLOR: blue"><FONT class=extract>&nbsp; SP<BR>offset<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +----------------+<BR>&nbsp;0x08&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | &lt;- Original SP (Or at offset 0x0C if at a word-aligned but not doubleword-aligned address.)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +----------------+<BR>&nbsp;0x04&nbsp; | Partial RETPSR |<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +----------------+<BR>&nbsp;0x00&nbsp; | ReturnAddress&nbsp; | &lt;- New SP<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +----------------+</FONT></P>
<P><FONT class=extract>&#8226; If the PE is in Handler mode, IPSR has the value of 1.<BR>&#8226; The FNC_RETURN value is saved in the LR.</FONT><BR>IDKGV <FONT class=extract>Behavior is UNPREDICTABLE when a function call stack frame is not doubleword-aligned.</FONT><BR>ITSVP <FONT class=extract>The PE hardware does not ensure doubleword-alignment of function call stack frames.</FONT><BR>IKWZD <FONT class=extract>ARM recommends that when Secure code calls a Non-secure function, any registers not being used to pass function arguments are set to zero.</FONT>