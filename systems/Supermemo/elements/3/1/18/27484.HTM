<DIV class=multicntwrap>
<DIV class=multicnt>
<DIV>
<H3 class="title pre fs1"><SPAN class=tcnt>Cache &#30340;write back&#21644;write through</SPAN>&nbsp;&nbsp;<SPAN class="bgc0 fc07 fw0 fs0"></SPAN></H3>
<P class="tdep clearfix nbw-act fc06" style="LINE-HEIGHT: 20px"><SPAN class=pleft><SPAN class=blogsep>2011-08-09 11:42:22</SPAN><SPAN class=blogsep>|&nbsp;&nbsp;&#20998;&#31867;&#65306;</SPAN> <A title=cpu class="fc03 m2a" href="http://zhangwenxin82.blog.163.com/blog/#m=0&amp;t=1&amp;c=fks_084065084086087067084080081095085087085070093083095070082">cpu</A> </SPAN><SPAN class="pright fc07 ztag"><SPAN class=blogsep>|</SPAN><SPAN id=$_spanReport class="fc03 m2a">&#20030;&#25253;</SPAN></SPAN> <SPAN class="pright fc07 ztag"><SPAN class=blogsep>|</SPAN><SPAN id=$_fontswitch class="zihao fc03">&#23383;&#21495;</SPAN></SPAN><SPAN id=$_blog_subscribe class="pright pnt fc03"><SPAN class="iblock icn0 icn0-919">&nbsp;</SPAN><A class=m2a>&#35746;&#38405;</A></SPAN> </P></DIV></DIV>
<DIV class=m-shareAndDownLoad>
<DIV class="share-wrap pleft"><SPAN id=$_shareBtn_lofter2 title=&#20998;&#20139;&#21040;LOFTER class="shareitm lofter f-bkicons">&nbsp;</SPAN> <SPAN id=$_shareBtn_sinaweibo2 title=&#20998;&#20139;&#21040;&#26032;&#28010;&#24494;&#21338; class="shareitm sinawb f-bkicons">&nbsp;</SPAN> <SPAN id=$_shareBtn_qq2 title=&#20998;&#20139;&#21040;QQ&#31354;&#38388; class="shareitm qqzone f-bkicons">&nbsp;</SPAN> <SPAN id=$_shareBtn_qqweibo2 title=&#20998;&#20139;&#21040;&#33150;&#35759;&#24494;&#21338; class="shareitm qqweibo f-bkicons">&nbsp;</SPAN> 
<DIV id=$_shareBtn_weixin2 title=&#20998;&#20139;&#21040;&#24494;&#20449; class="shareitm weixin f-bkicons">
<DIV></DIV>
<DIV class=nbw-blog-start></DIV><FONT class=extract>&#20026;&#20102;&#20445;&#35777;cache&#21644;memory&#30340;&#25968;&#25454;&#19968;&#33268;&#24615;&#65292;&#36890;&#24120;&#26377;&#19977;&#31181;&#26041;&#27861;&#65306; <BR><BR>1&#12297;write through&#65306;CPU&#21521;cache&#20889;&#20837;&#25968;&#25454;&#26102;&#65292;&#21516;&#26102;&#21521;memory&#20063;&#20889;&#19968;&#20221;&#65292;&#20351;cache&#21644;memory&#30340;&#25968;&#25454;&#20445;&#25345;&#19968;&#33268;&#12290;&#20248;&#28857;&#26159;&#31616;&#21333;&#65292;&#32570;&#28857;&#26159;&#27599;&#27425;&#37117;&#35201;&#35775;&#38382;memory&#65292;&#36895;&#24230;&#27604;&#36739;&#24930;&#12290; <BR><BR>2&#12297;post write&#65306;CPU&#26356;&#26032;cache&#25968;&#25454;&#26102;&#65292;&#25226;&#26356;&#26032;&#30340;&#25968;&#25454;&#20889;&#20837;&#21040;&#19968;&#20010;&#26356;&#26032;&#32531;&#20914;&#22120;&#65292;&#22312;&#21512;&#36866;&#30340;&#26102;&#20505;&#25165;&#23545;memory&#36827;&#34892;&#26356;&#26032;&#12290;&#36825;&#26679;&#21487;&#20197;&#25552;&#39640;cache&#35775;&#38382;&#36895;&#24230;&#65292;&#20294;&#26159;&#65292;&#22312;&#25968;&#25454;&#36830;&#32493;&#34987;&#26356;&#26032;&#20004;&#27425;&#20197;&#19978;&#30340;&#26102;&#20505;&#65292;&#32531;&#20914;&#21306;&#23558;&#19981;&#22815;&#20351;&#29992;&#65292;&#34987;&#36843;&#21516;&#26102;&#26356;&#26032;memory&#12290; <BR><BR>3&#12297; write back&#65306;&#65315;&#65328;&#65333;&#26356;&#26032;cache&#26102;&#65292;&#21482;&#26159;&#25226;&#26356;&#26032;&#30340;cache&#21306;&#26631;&#35760;&#19968;&#19979;&#65292;&#24182;&#19981;&#21516;&#27493;&#26356;&#26032;memory&#12290;&#21482;&#26159;&#22312;cache&#21306;&#35201;&#34987;&#26032;&#36827;&#20837;&#30340;&#25968;&#25454;&#21462;&#20195;&#26102;&#65292;&#25165;&#26356;&#26032; memory&#12290;&#36825;&#26679;&#20570;&#30340;&#21407;&#22240;&#26159;&#32771;&#34385;&#21040;&#24456;&#22810;&#26102;&#20505;cache&#23384;&#20837;&#30340;&#26159;&#20013;&#38388;&#32467;&#26524;&#65292;&#27809;&#26377;&#24517;&#35201;&#21516;&#27493;&#26356;&#26032;memory&#12290;&#20248;&#28857;&#26159;CPU&#25191;&#34892;&#30340;&#25928;&#29575;&#25552;&#39640;&#65292;&#32570;&#28857;&#26159;&#23454;&#29616;&#36215;&#26469;&#25216; &#26415;&#27604;&#36739;&#22797;&#26434;&#12290;</FONT> <BR><BR>&nbsp; &#22238;&#20889;&#19982;&#36879;&#20889; <BR><BR>&nbsp; <BR>&nbsp; <BR>&nbsp;&nbsp; &#23545;&#20110;cache&#30340;&#31639;&#27861;&#12290;&#22823;&#26041;&#38754;&#26377;&#20004;&#31181;&#65292;Write-Through(&#36890;&#20889;)&#21644;Write-Back(&#22238;&#20889;).&nbsp;&nbsp;&nbsp; Write-Through&#65292;&#20063;&#23601;&#26159;&#35828;OS&#21457;&#36865;&#30340;&#22788;&#29702;data&#30340;&#35831;&#27714;&#65292;&#19968;&#30452;&#35201;&#31561;&#21040;&#20840;&#37096;memory&#37324;&#38754;&#30340;data&#27491;&#30830;&#20889;&#21040;&#31283;&#23450;&#23384;&#20648;media(&#22914;&#30828;&#30424;) &#20013;&#65292;&#28982;&#21518;&#36820;&#22238;&#32473;OS&#25253;&#21578;&#22788;&#29702;&#23436;&#27605;&#65292;&#28982;&#21518;OS&#25165;&#20250;&#21435;update&#20854;&#29366;&#24577;;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#36890;&#24120;&#19981;&#20250;&#26377;dirty cache.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#32780;Write-Back,&#23601;&#26159;&#22312;OS&#21457;&#36865;&#22788;&#29702;data&#30340;&#35831;&#27714;&#21518;&#65292;&#35813;&#31639;&#27861;&#20250;&#23558;&#23427;&#29992;buffer&#23384;&#36215;&#26469;&#65292;&#24182;&#22312;&#27809;&#26377;&#27491;&#30830;&#20889;&#21040;&#31283;&#23450;&#23384;&#20648;media(&#22914;&#30828;&#30424;)&#20013;&#21069;&#65292; &#23601;&#21578;&#35785;OS&#22788;&#29702;&#23436;&#27605;&#65292;&#28982;&#21518;OS&#23601;&#20250;&#21435;update&#65307;&#20294;&#26159;&#35201;&#26159;&#27492;&#26102;&#25481;&#30005;&#25110;&#20854;&#20182;&#25925;&#38556;&#65292;buffer&#30340;&#25968;&#25454;&#27809;&#26377;&#34987;&#20889;&#20837;&#31283;&#23450;&#23384;&#20648;media(&#22914;&#30828;&#30424;)&#65292;&#37027;&#20040;os update&#30340;&#20449;&#24687;&#23601;&#21644;media&#20013;&#30340;&#20449;&#24687;&#19981;&#19968;&#33268;.&#20026;&#20102;&#36991;&#20813;&#36825;&#26679;&#65292;&#25152;&#20197;&#25165;&#29992;NVRAM&#65292;&#23427;&#22312;&#35843;&#30005;&#21518;&#25968;&#25454;&#20173;&#28982;&#19981;&#20002;&#22833;&#65292;&#20294;&#26159;&#22312;&#34987;&#37325;&#26032;&#19978;&#30005;&#21518;&#65292;&#20854;&#25968;&#25454;&#20250;&#26159; dirty&#30340;&#65292;&#20063;&#23601;&#26159;&#27004;&#20027;&#25152;&#25552;&#21040;&#30340;dirty cache(&#22914;&#20309;&#23558;dirty cache&#26356;&#26032;&#21040;media&#65292;&#36825;&#26159;Write-Back&#24212;&#35813;&#20570;&#30340;&#20107;)&#12290;&nbsp;&nbsp;&nbsp; &#36825;&#21644;&#20080;&#21334;&#19996;&#35199;&#30456;&#20284;&#65292;Write-Through&#23601;&#30456;&#24403;&#20110;&#20320;&#20146;&#33258;&#21435;&#20080;&#19996;&#35199;&#65292;&#20320;&#20080;&#21040;&#20160;&#20040;&#23601;&#21487;&#20197;&#20146;&#25163;&#25343;&#21040;&#65307;&#32780;Write-Back&#23601;&#21644;&#20013;&#20171;&#24046;&#19981;&#22810;&#65292;&#20320;&#32473;&#20102;&#20013;&#20171; &#38065;&#65292;&#28982;&#21518;&#23427;&#21578;&#35785;&#20320;&#35828;&#20320;&#30340;&#19996;&#35199;&#20080;&#21040;&#20102;&#65292;&#28982;&#21518;&#23601;&#30456;&#20449;&#25343;&#21040;&#36825;&#20010;&#19996;&#35199;&#20102;&#65292;&#20294;&#26159;&#35201;&#26159;&#20986;&#29616;&#29305;&#27530;&#24773;&#20917;&#20013;&#20171;&#36305;&#20102;(&#25481;&#38142;&#23376;&#20102;)&#65292;&#20320;&#20877;&#21435;&#26816;&#26597;&#65292;&#19996;&#35199;&#21407;&#26469;&#27809;&#26377;&#30495;&#27491;&#21040;&#25163;&#12290; <BR><BR><BR><BR>1.Cache&#30340;&#20004;&#20010;&#31867;&#22411; <BR>&nbsp;&nbsp;&nbsp; --Write Through <BR>&nbsp;&nbsp;&nbsp; &#24403;&#20889;&#25968;&#25454;&#36827;Cache&#26102;&#65292;&#20063;&#21516;&#26102;&#26356;&#26032;&#20102;&#30456;&#24212;&#30340;Memory&#37324;&#30340;&#20869;&#23481; <BR>&nbsp;&nbsp;&nbsp; --Write back <BR>&nbsp;&nbsp;&nbsp; &#21482;&#26159;&#20889;&#21040;Cache&#37324;&#65292;Memory&#30340;&#20869;&#23481;&#35201;&#31561;&#21040;cache&#20445;&#23384;&#30340;&#35201;&#34987;&#21035;&#30340;&#25968;&#25454;&#26367;&#25442;&#25110;&#32773;&#31995;&#32479;&#20570;cache flush&#26102;&#65292;&#25165;&#20250;&#34987;&#26356;&#26032;&#12290; <BR><BR>2.<FONT class=extract>Cache&#30340;&#20004;&#20010;&#20989;&#25968; <BR>&nbsp;&nbsp;&nbsp; --Flush <BR>&nbsp;&nbsp;&nbsp; &#25226;Cache&#20869;&#23481;&#20889;&#22238;Memory,&#24403;Cache&#20026;Write through,&#19981;&#38656;&#35201;Flush <BR>&nbsp;&nbsp;&nbsp; --Invalidate <BR>&nbsp;&nbsp;&nbsp; &#25226;Cache&#20869;&#23481;&#30452;&#25509;&#20002;&#25481;&#19981;&#35201;&#12290;</FONT> <BR><BR>3.Cache&#30340;&#20351;&#29992;&#22330;&#21512; <BR>&nbsp;&nbsp;&nbsp; <FONT class=extract>&#24403;&#26377;DMA&#22312;&#20351;&#29992;memory&#30340;&#26102;&#20505;&#65292;&#19968;&#33324;&#35201;&#29992;&#21040;cache&#30340;&#22788;&#29702;&#12290;&#22240;&#20026;DMA&#22312;&#35775;&#38382;memory&#26102;&#26159;&#19981;&#32463;&#36807;cache&#30340;&#12290;&#27604;&#36739;&#20856;&#22411;&#30340;&#27604;&#22914;&#22312; Ethernet&#65292;wireless,USB&#31561;driver&#37324;&#65292;DMA&#20250;&#25805;&#20316;descriptors&#21644;packet buffers,Driver&#35201;&#20570;&#36825;&#20123;&#22788;&#29702; <BR>&nbsp;&nbsp;&nbsp; --&#22914;&#26524;driver&#20351;&#29992;descripter&#21644;packet buffer&#30340;&#22320;&#22336;&#37117;&#26159;cache&#30340;&#22320;&#22336;&#65292;&#37027;&#20040; <BR>&nbsp;&nbsp;&nbsp; a).Driver&#22312;&#35835;descripter&#37324;&#19968;&#20123;&#29366;&#24577;&#27604;&#22914;Owned by CPU/DMA,&#26377;&#27809;&#26377;&#25910;&#21040;&#21253;&#26102;&#65292;&#35201;&#23545;descripter&#24403;&#21069;&#32467;&#26500;&#37324;&#30340;&#20869;&#23481;&#20570;cache invalidate,&#25910;&#21040;packet&#21518;&#65292;&#20063;&#35201;&#23545;packet buffer&#20570;cache invalidate <BR>&nbsp;&nbsp;&nbsp; b).Driver&#22312;&#20889;descripter&#37324;&#19968;&#20123;&#29366;&#24577;&#27604;&#22914;Owned by DMA,&#35201;&#21457;&#36865;&#21253;&#26102;&#65292;&#35201;&#23545;descripter&#24403;&#21069;&#32467;&#26500;&#37324;&#30340;&#20869;&#23481;&#20570;cache flush,&#21457;&#36865;packet&#26102;&#65292;&#20063;&#35201;&#23545;packet buffer&#20570;cache flush <BR>&nbsp;&nbsp;&nbsp; --&#26377;&#20123;driver&#20250;&#23545;descripter&#20351;&#29992;uncache &#22320;&#22336;&#65292;&#37027;&#20040;&#19978;&#38754;&#20004;&#31181;&#24773;&#20917;&#37324;invalidate/flush&#23601;&#19981;&#29992;&#20570;&#20102;&#12290;&#19968;&#33324;&#24456;&#23569;&#20250;&#23545;packet buffer&#20063;&#29992;uncache&#22320;&#22336;&#30340;&#65292;&#22240;&#20026;&#23545;packet&#20869;&#23481;&#30340;&#22788;&#29702;&#23558;&#20250;&#24456;&#39057;&#32321;&#65292;&#20351;&#29992;uncache&#20250;&#24456;&#24930;&#12290;&#32780;descripter&#19968;&#33324;&#30001;&#20110;&#32467;&#26500;&#27604;&#36739; &#23567;&#65292;&#22914;&#26524;&#20063;&#20351;&#29992;cache&#22320;&#22336;&#30340;&#35805;&#65292;&#20570;invalidate/flush&#30340;&#26102;&#38388;&#28040;&#32791;&#21487;&#33021;&#20250;&#27604;uncache&#30340;&#36824;&#35201;&#22810;&#12290;</FONT></DIV></DIV></DIV></DIV>