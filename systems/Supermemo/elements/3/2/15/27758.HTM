B1.3.1 Modes, privilege and stacks 
<P></P>
<P>Mode, privilege and stack pointer are key concepts used in ARMv7-M.</P>
<P><FONT class=extract>Mode<BR>An M-profile processor supports two operating modes:<BR>&nbsp; Thread mode<BR>&nbsp;&nbsp;&nbsp; Is entered on reset, and can be entered as a result of an exception return.<BR>&nbsp; Handler mode<BR>&nbsp;&nbsp;&nbsp; Is entered as a result of an exception. The processor must be in Handler mode to issue an exception return.</FONT><BR>&nbsp;&nbsp;&nbsp; <BR><FONT class=extract>Privilege<BR>Code can execute as privileged or unprivileged. Unprivileged execution limits or excludes access to some resources. Privileged execution has access to all resources.<BR>Execution in Handler mode is always privileged. Execution in Thread mode can be privileged or unprivileged<FONT class=extract>.</FONT></FONT></P>
<P><FONT class=extract>Stack pointer<BR>The processor implements a banked pair of stack pointers, the Main stack pointer, and the Process stack pointer. See The SP registers on page B1-623 for more information.<BR>In Handler mode, the processor uses the Main stack pointer. In Thread mode it can use either stack pointer.</FONT></P>
<P><FONT class=extract>Table B1-1 shows the possible combinations of mode, privilege and stack pointer usage.</FONT></P>
<P><FONT class=extract>Table B1-1 Mode, privilege and stack relationship&nbsp; </FONT>
<TABLE style="WIDTH: 549pt; BORDER-COLLAPSE: collapse" cellSpacing=0 cellPadding=0 width=731 border=0>
<COLGROUP><FONT class=extract>
<COL style="WIDTH: 62pt; mso-width-source: userset; mso-width-alt: 2624" width=82>
<COL style="WIDTH: 107pt; mso-width-source: userset; mso-width-alt: 4576" width=143>
<COL style="WIDTH: 67pt; mso-width-source: userset; mso-width-alt: 2848" width=89>
<COL style="WIDTH: 313pt; mso-width-source: userset; mso-width-alt: 13344" width=417></FONT>
<TBODY>
<TR style="HEIGHT: 60.75pt" height=81>
<TD class=xl65 style="BORDER-TOP: windowtext 0.5pt solid; HEIGHT: 60.75pt; BORDER-RIGHT: windowtext 0.5pt solid; WIDTH: 62pt; BORDER-BOTTOM: windowtext 0.5pt solid; BORDER-LEFT: windowtext 0.5pt solid; BACKGROUND-COLOR: transparent" height=81 width=82><FONT class=extract size=5 face=&#23435;&#20307;><STRONG>Mode</STRONG></FONT></TD>
<TD class=xl65 style="BORDER-TOP: windowtext 0.5pt solid; BORDER-RIGHT: windowtext 0.5pt solid; WIDTH: 107pt; BORDER-BOTTOM: windowtext 0.5pt solid; BORDER-LEFT: windowtext; BACKGROUND-COLOR: transparent" width=143><FONT class=extract size=5 face=&#23435;&#20307;><STRONG>Privilege</STRONG></FONT></TD>
<TD class=xl66 style="BORDER-TOP: windowtext 0.5pt solid; BORDER-RIGHT: windowtext 0.5pt solid; WIDTH: 67pt; BORDER-BOTTOM: windowtext 0.5pt solid; BORDER-LEFT: windowtext; BACKGROUND-COLOR: transparent" width=89><FONT class=extract size=5 face=&#23435;&#20307;><STRONG>Stack pointer</STRONG></FONT></TD>
<TD class=xl65 style="BORDER-TOP: windowtext 0.5pt solid; BORDER-RIGHT: windowtext 0.5pt solid; WIDTH: 313pt; BORDER-BOTTOM: windowtext 0.5pt solid; BORDER-LEFT: windowtext; BACKGROUND-COLOR: transparent" width=417><STRONG><FONT class=extract size=5 face=&#23435;&#20307;>Typical usage model</FONT></STRONG></TD></TR>
<TR style="HEIGHT: 20.25pt" height=27>
<TD class=xl67 style="BORDER-TOP: windowtext; HEIGHT: 20.25pt; BORDER-RIGHT: windowtext 0.5pt solid; BORDER-BOTTOM: windowtext 0.5pt solid; BORDER-LEFT: windowtext 0.5pt solid; BACKGROUND-COLOR: transparent" height=27><FONT class=extract size=5 face=&#23435;&#20307;>Handler</FONT></TD>
<TD class=xl67 style="BORDER-TOP: windowtext; BORDER-RIGHT: windowtext 0.5pt solid; BORDER-BOTTOM: windowtext 0.5pt solid; BORDER-LEFT: windowtext; BACKGROUND-COLOR: transparent"><FONT class=extract size=5 face=&#23435;&#20307;>Privileged</FONT></TD>
<TD class=xl67 style="BORDER-TOP: windowtext; BORDER-RIGHT: windowtext 0.5pt solid; BORDER-BOTTOM: windowtext 0.5pt solid; BORDER-LEFT: windowtext; BACKGROUND-COLOR: transparent"><FONT class=extract size=5 face=&#23435;&#20307;>Main</FONT></TD>
<TD class=xl68 style="BORDER-TOP: windowtext; BORDER-RIGHT: windowtext 0.5pt solid; WIDTH: 313pt; BORDER-BOTTOM: windowtext 0.5pt solid; BORDER-LEFT: windowtext; BACKGROUND-COLOR: transparent" width=417><FONT class=extract size=5 face=&#23435;&#20307;>Exception handling.</FONT></TD></TR>
<TR style="HEIGHT: 121.5pt" height=162>
<TD class=xl67 style="BORDER-TOP: windowtext; HEIGHT: 324pt; BORDER-RIGHT: windowtext 0.5pt solid; BORDER-BOTTOM: windowtext 0.5pt solid; BORDER-LEFT: windowtext 0.5pt solid; BACKGROUND-COLOR: transparent" height=432 rowSpan=2><FONT class=extract size=5 face=&#23435;&#20307;>Thread</FONT></TD>
<TD class=xl67 style="BORDER-TOP: windowtext; BORDER-RIGHT: windowtext 0.5pt solid; BORDER-BOTTOM: windowtext 0.5pt solid; BORDER-LEFT: windowtext 0.5pt solid; BACKGROUND-COLOR: transparent" rowSpan=2><FONT class=extract size=5 face=&#23435;&#20307;>Privileged</FONT></TD>
<TD class=xl67 style="BORDER-TOP: windowtext; BORDER-RIGHT: windowtext 0.5pt solid; BORDER-BOTTOM: windowtext 0.5pt solid; BORDER-LEFT: windowtext; BACKGROUND-COLOR: transparent"><FONT class=extract size=5 face=&#23435;&#20307;>Main</FONT></TD>
<TD class=xl68 style="BORDER-TOP: windowtext; BORDER-RIGHT: windowtext 0.5pt solid; WIDTH: 313pt; BORDER-BOTTOM: windowtext 0.5pt solid; BORDER-LEFT: windowtext; BACKGROUND-COLOR: transparent" width=417><FONT class=extract size=5 face=&#23435;&#20307;>Execution of a privileged process or thread using a common stack in a system that only supports privileged access.</FONT></TD></TR>
<TR style="HEIGHT: 202.5pt" height=270>
<TD class=xl67 style="BORDER-TOP: windowtext; HEIGHT: 202.5pt; BORDER-RIGHT: windowtext 0.5pt solid; BORDER-BOTTOM: windowtext 0.5pt solid; BORDER-LEFT: windowtext; BACKGROUND-COLOR: transparent" height=270><FONT class=extract size=5 face=&#23435;&#20307;>Process</FONT></TD>
<TD class=xl68 style="BORDER-TOP: windowtext; BORDER-RIGHT: windowtext 0.5pt solid; WIDTH: 313pt; BORDER-BOTTOM: windowtext 0.5pt solid; BORDER-LEFT: windowtext; BACKGROUND-COLOR: transparent" width=417><FONT class=extract size=5 face=&#23435;&#20307;>Execution of a privileged process or thread using a stack reserved for that process or thread in a system that only supports privileged access, or that supports a mix of privileged and unprivileged threads.</FONT></TD></TR>
<TR style="HEIGHT: 121.5pt" height=162>
<TD class=xl67 style="BORDER-TOP: windowtext; HEIGHT: 283.5pt; BORDER-RIGHT: windowtext 0.5pt solid; BORDER-BOTTOM: windowtext 0.5pt solid; BORDER-LEFT: windowtext 0.5pt solid; BACKGROUND-COLOR: transparent" height=378 rowSpan=2><FONT class=extract size=5 face=&#23435;&#20307;>Thread</FONT></TD>
<TD class=xl67 style="BORDER-TOP: windowtext; BORDER-RIGHT: windowtext 0.5pt solid; BORDER-BOTTOM: windowtext 0.5pt solid; BORDER-LEFT: windowtext 0.5pt solid; BACKGROUND-COLOR: transparent" rowSpan=2><FONT class=extract size=5 face=&#23435;&#20307;>Unprivileged</FONT></TD>
<TD class=xl67 style="BORDER-TOP: windowtext; BORDER-RIGHT: windowtext 0.5pt solid; BORDER-BOTTOM: windowtext 0.5pt solid; BORDER-LEFT: windowtext; BACKGROUND-COLOR: transparent"><FONT class=extract size=5 face=&#23435;&#20307;>Main</FONT></TD>
<TD class=xl68 style="BORDER-TOP: windowtext; BORDER-RIGHT: windowtext 0.5pt solid; WIDTH: 313pt; BORDER-BOTTOM: windowtext 0.5pt solid; BORDER-LEFT: windowtext; BACKGROUND-COLOR: transparent" width=417><FONT class=extract size=5 face=&#23435;&#20307;>Execution of an unprivileged process or thread using a common stack in a system that supports privileged and unprivileged access.</FONT></TD></TR>
<TR style="HEIGHT: 162pt" height=216>
<TD class=xl67 style="BORDER-TOP: windowtext; HEIGHT: 162pt; BORDER-RIGHT: windowtext 0.5pt solid; BORDER-BOTTOM: windowtext 0.5pt solid; BORDER-LEFT: windowtext; BACKGROUND-COLOR: transparent" height=216><FONT class=extract size=5 face=&#23435;&#20307;>Process</FONT></TD>
<TD class=xl68 style="BORDER-TOP: windowtext; BORDER-RIGHT: windowtext 0.5pt solid; WIDTH: 313pt; BORDER-BOTTOM: windowtext 0.5pt solid; BORDER-LEFT: windowtext; BACKGROUND-COLOR: transparent" width=417><FONT class=extract size=5 face=&#23435;&#20307;>Execution of an unprivileged process or thread using a stack reserved for that process or thread in a system that supports privileged and unprivileged access.</FONT></TD></TR></TBODY></TABLE></P>
<P>Pseudocode details of processor mode</P>
<P><FONT class=extract>The CurrentModeIsPrivileged() pseudocode function determines whether the current software execution is privileged:<BR>// CurrentModeIsPrivileged()<BR>// =========================<BR>boolean CurrentModeIsPrivileged()<BR>&nbsp; return (CurrentMode == Mode_Handler || CONTROL.nPRIV == &#8216;0&#8217;);</FONT>