<H3 class=docSection1Title>2.6. Canceling Commands and Undoing Changes</H3>
<P class=docText>Sometimes you start a command by accident or change your mind about it. Don't worry: with Emacs, you can quit in the middle or undo it.</P><A name=gnu3-CHP-2-SECT-6.1></A>
<H4 class=docSection2Title>2.6.1 Canceling Commands</H4>
<P class=docText><FONT class=extract>When you want to cancel any </FONT><A name=gnu3-CHP-2-ITERM-1788></A><A name=gnu3-CHP-2-ITERM-1789></A><A name=gnu3-CHP-2-ITERM-1790></A><FONT class=extract>command that's in progress, press <SPAN class=docEmphBold>C-g</SPAN>.</FONT> The word <SPAN class=docEmphBold>Quit</SPAN> appears in the command area. This command is helpful when you are stuck in the minibuffer and didn't really mean to go there. Depending on what you were doing, you may have to press <SPAN class=docEmphBold>C-g</SPAN> a few times.</P><A name=gnu3-CHP-2-SECT-6.2></A>
<H4 class=docSection2Title>2.6.2 Undoing Changes</H4>
<P class=docText>What happens if you make a <A name=gnu3-CHP-2-ITERM-1791></A><A name=gnu3-CHP-2-ITERM-1792></A><A name=gnu3-CHP-2-ITERM-1793></A>mistake while you're editing? <FONT class=extract>You can undo your changes by pressing <SPAN class=docEmphBold>C-_</SPAN> or <SPAN class=docEmphBold>C-x u</SPAN></FONT> (for <SPAN class=docEmphBold>undo</SPAN>; conveniently, the toolbar also has an undo icon, a curved left arrow). By typing <SPAN class=docEmphBold>undo</SPAN> repeatedly, you can gradually work your way back to a point before your mistake.<SUP class=docFootnote><A class=docLink href="file:///D:/&#25105;&#30340;&#37239;&#30424;/&#24037;&#20316;&#30446;&#24405;/Now/learning-gnu-emacs-3rd/0596006489/gnu3-chp-2-sect-6.html#gnu3-chp-2-fnote-7">[7]</A></SUP> Although the <SPAN class=docEmphBold>undo</SPAN> command is very powerful, saving your file frequently, if not compulsively, is nevertheless a good idea. We usually save a file whenever we stop typing&#8212;even if only for a few seconds. <FONT class=extract>Train your fingers to press <SPAN class=docEmphBold>C-x C-s</SPAN> whenever you pause; it's a good habit to form.</FONT></P>
<BLOCKQUOTE>
<P class=docFootnote><SUP><A name=gnu3-CHP-2-FNOTE-7>[7]</A></SUP> <FONT class=extract>If you find that you repeat the undo command frequently, it's worth getting fluent with <SPAN class=docEmphBold>C-_</SPAN>.</FONT> It's true that this requires holding down <SPAN class=docEmphBold>Ctrl</SPAN> and <SPAN class=docEmphBold>Shift</SPAN> at the same time, but once you've got that down, pressing <SPAN class=docEmphBold>_</SPAN> repeatedly is much easier than typing <SPAN class=docEmphBold>C-x u</SPAN> again and again.</P></BLOCKQUOTE>
<P class=docText>If you're used to typing <SPAN class=docEmphBold>C-z</SPAN> to undo, you can easily change Emacs's behavior to match your habits. See "Making Emacs Work the Way You Want" at the end of this chapter for information on CUA mode.</P>
<P class=docText>What if you'd like to redo a command after you type <SPAN class=docEmphBold>undo</SPAN>? There is no formal <SPAN class=docEmphasis>redo</SPAN> command, but you can use <SPAN class=docEmphBold>undo</SPAN> in the following way. <FONT class=extract>Just move the cursor in any direction, and </FONT><A name=gnu3-CHP-2-ITERM-1794></A><A name=gnu3-CHP-2-ITERM-1795></A><FONT class=extract>type <SPAN class=docEmphBold>C-_</SPAN> or <SPAN class=docEmphBold>C-x u</SPAN> again. Emacs redoes the last command you undid. You can repeat it to redo previous <SPAN class=docEmphBold>undo</SPAN>s.</FONT></P>
<P class=docText>Although <SPAN class=docEmphBold>undo</SPAN> is an important command, it can be slow if you want to undo a large number of changes. <A class=docLink href="file:///D:/&#25105;&#30340;&#37239;&#30424;/&#24037;&#20316;&#30446;&#24405;/Now/learning-gnu-emacs-3rd/0596006489/gnu3-chp-2-sect-6.html#gnu3-chp-2-table-11">Table 2-11</A> summarizes three methods for undoing changes and circumstances in which you might want to use them.</P><A name=gnu3-CHP-2-TABLE-11></A>
<H5 class=docTableTitle>Table 2-11. Methods for undoing changes</H5>
<TABLE cellSpacing=0 cellPadding=4 rules=all width="100%" border=1>
<COLGROUP>
<COL>
<COL></COLGROUP>
<THEAD>
<TR>
<TH class=thead scope=col>
<P class=docText><SPAN class=docEmphBold>If you</SPAN>:</P></TH>
<TH class=thead scope=col>
<P class=docText><SPAN class=docEmphBold>Use this command</SPAN>:</P></TH></TR></THEAD>
<TBODY>
<TR>
<TD class=docTableCell>
<P class=docText>Don't like the recent changes you've made and want to undo them one by one</P></TD>
<TD class=docTableCell>
<P class=docText><SPAN class=docEmphBold>C-_</SPAN> <SPAN class=docEmphasis>or</SPAN> <SPAN class=docEmphBold>C-x u</SPAN> (<SPAN class=docEmphBold>undo</SPAN>)</P></TD></TR>
<TR>
<TD class=docTableCell>
<P class=docText><FONT class=extract>Want to undo all changes made since you last saved the file</FONT></P></TD>
<TD class=docTableCell>
<P class=docText><SPAN class=docEmphBold><FONT class=extract>M-x revert-buffer Enter</FONT></SPAN> </P></TD></TR>
<TR>
<TD class=docTableCell>
<P class=docText>Want to go back to an earlier version of the file (the file as it was when you started this editing session)</P></TD>
<TD class=docTableCell>
<P class=docText><SPAN class=docEmphBold>C-x C-f</SPAN> <SPAN class=docEmphasis>filename</SPAN><SPAN class=docEmphBold>~ Enter C-x C-w</SPAN> <SPAN class=docEmphasis>filename</SPAN> <SPAN class=docEmphBold>Enter</SPAN></P></TD></TR></TBODY></TABLE><BR>
<P class=docText>We've already talked about undoing changes with <SPAN class=docEmphBold>undo</SPAN>; next we describe how to revert a buffer from a file and how to go back to an earlier version.</P><A name=gnu3-CHP-2-SECT-6.3></A>
<H4 class=docSection2Title>2.6.3 Reverting a Buffer from a File</H4>
<P class=docText>If the <SPAN class=docEmphBold>undo</SPAN> command isn't <A name=gnu3-CHP-2-ITERM-1796></A><A name=gnu3-CHP-2-ITERM-1797></A><A name=gnu3-CHP-2-ITERM-1798></A>useful, there's another way to restore a file to an earlier state. If you want to get the file back to the state that is stored on disk, type <SPAN class=docEmphBold>M-x revert-buffer Enter</SPAN>. Emacs asks the following question:</P><PRE>Revert buffer from file <TT><I>filename</I></TT>? (yes or no)
</PRE><BR>
<P class=docText>The filename is the name of your original file. Type <SPAN class=docEmphBold>yes</SPAN> if you want to restore the file, or <SPAN class=docEmphBold>no</SPAN> if you've changed your mind. Emacs copies the file stored on disk into the buffer, conveniently forgetting everything that happened since the last time you saved the file. Although this command is called <SPAN class=docEmphBold>revert-buffer</SPAN>, note that it can revert only buffers associated with files.</P><A name=gnu3-CHP-2-SECT-6.4></A>
<H4 class=docSection2Title>2.6.4 Going Back to a Previous Version: Backup Files</H4>
<P class=docText>The first time you save a file during <A name=gnu3-CHP-2-ITERM-1799></A><A name=gnu3-CHP-2-ITERM-1800></A><A name=gnu3-CHP-2-ITERM-1801></A>an editing session, Emacs creates a backup file. If something disastrous happens, and the other techniques for undoing changes won't help you, you can always return to the backup file. The <A name=gnu3-CHP-2-ITERM-1802></A>name of the backup file is the same as the name of the file you're editing, with a tilde (<SPAN class=docEmphBold>~</SPAN>) added. For example, if you are editing the file <SPAN class=docEmphasis>text</SPAN>, the backup file is <SPAN class=docEmphasis>text~</SPAN>.</P>
<P class=docText><FONT class=extract>Emacs doesn't provide any special commands for restoring a buffer from the backup copy. The easiest way to do this is to edit the backup copy and then save it as the real file. For example, if you were working with a file called <SPAN class=docEmphasis>text</SPAN>, you could: exit Emacs by typing <SPAN class=docEmphBold>C-x C-c</SPAN>, then start Emacs again by typing <SPAN class=docEmphBold>emacs</SPAN> <SPAN class=docEmphasis>text~</SPAN>. After the backup file is displayed, save it as the real file by typing <SPAN class=docEmphBold>C-x C-w</SPAN> <SPAN class=docEmphasis>text</SPAN> <SPAN class=docEmphBold>Enter</SPAN>.</FONT> As a safeguard, Emacs asks you before it writes over the original file:</P><PRE>File <TT><I>text</I></TT> exists; overwrite? (y or n)
</PRE><BR>
<P class=docText>Type <SPAN class=docEmphBold>y</SPAN> to overwrite the original <A name=gnu3-CHP-2-ITERM-1803></A><A name=gnu3-CHP-2-ITERM-1804></A>file with the backup file.</P>
<P class=docText>GNU Emacs also has a <A name=gnu3-CHP-2-ITERM-1805></A><A name=gnu3-CHP-2-ITERM-1806></A><A name=gnu3-CHP-2-ITERM-1807></A>numbered backup facility. If you turn on numbered backups, Emacs creates a backup file (with the suffix <SPAN class=docEmphasis>~n~</SPAN>) every time you save your file. <SPAN class=docEmphasis>n</SPAN> increments with each successive save. If you are nervous about deleting older versions, it might be worth using: you can keep all of your old versions forever, if you want to. However, numbered backups can also waste disk space; a happy medium may be to tell Emacs to keep the last <SPAN class=docEmphasis>n</SPAN> versions, where <SPAN class=docEmphasis>n</SPAN> is the number of versions you want to keep. The variables that control numbered backups are described in Appendix A. If you are interested in full-blown version control, check out VC mode, discussed in <A class=docLink href="file:///D:/&#25105;&#30340;&#37239;&#30424;/&#24037;&#20316;&#30446;&#24405;/Now/learning-gnu-emacs-3rd/0596006489/gnu3-chp-12.html#gnu3-chp-12">Chapter 12</A>. <A class=docLink href="file:///D:/&#25105;&#30340;&#37239;&#30424;/&#24037;&#20316;&#30446;&#24405;/Now/learning-gnu-emacs-3rd/0596006489/gnu3-chp-2-sect-6.html#gnu3-chp-2-table-12">Table 2-12</A> <A name=gnu3-CHP-2-ITERM-1808></A><A name=gnu3-CHP-2-ITERM-1809></A><A name=gnu3-CHP-2-ITERM-1810></A><A name=gnu3-CHP-2-ITERM-1811></A>summarizes the commands for stopping commands and undoing changes.</P><A name=gnu3-CHP-2-TABLE-12></A>
<H5 class=docTableTitle>Table 2-12. Stopping and undoing commands</H5>
<TABLE cellSpacing=0 cellPadding=4 rules=all width="100%" border=1>
<COLGROUP>
<COL>
<COL>
<COL></COLGROUP>
<THEAD>
<TR>
<TH class=thead scope=col>
<P class=docText><SPAN class=docEmphBold>Keystrokes</SPAN> </P></TH>
<TH class=thead scope=col>
<P class=docText><SPAN class=docEmphBold>Command name</SPAN> </P></TH>
<TH class=thead scope=col>
<P class=docText><SPAN class=docEmphBold>Action</SPAN> </P></TH></TR></THEAD>
<TBODY>
<TR>
<TD class=docTableCell>
<P class=docText><SPAN class=docEmphBold>C-g</SPAN> </P></TD>
<TD class=docTableCell>
<P class=docText><SPAN class=docEmphBold>keyboard-quit</SPAN> </P></TD>
<TD class=docTableCell>
<P class=docText>Abort current command.</P></TD></TR>
<TR>
<TD class=docTableCell>
<P class=docText><SPAN class=docEmphBold>C-x u</SPAN> </P></TD>
<TD class=docTableCell>
<P class=docText><SPAN class=docEmphBold>advertised-undo<SUP class=docFootnote><A class=docLink href="file:///D:/&#25105;&#30340;&#37239;&#30424;/&#24037;&#20316;&#30446;&#24405;/Now/learning-gnu-emacs-3rd/0596006489/gnu3-chp-2-sect-6.html#gnu3-chp-2-fnote-8">[8]</A></SUP></SPAN> </P></TD>
<TD class=docTableCell>
<P class=docText>Undo last edit (can be done repeatedly).</P></TD></TR>
<TR>
<TD class=docTableCell>
<P class=docText><SPAN class=docEmphBold>C-_</SPAN> <SPAN class=docEmphasis>Edit</SPAN> <IMG src="file:///D:/&#25105;&#30340;&#37239;&#30424;/&#24037;&#20316;&#30446;&#24405;/Now/learning-gnu-emacs-3rd/0596006489/images/ent/u2192.gif" border=0> <SPAN class=docEmphasis>Undo</SPAN></P></TD>
<TD class=docTableCell>
<P class=docText><SPAN class=docEmphBold>undo</SPAN> </P></TD>
<TD class=docTableCell>
<P class=docText>Undo last edit (can be done repeatedly).</P></TD></TR>
<TR>
<TD class=docTableCell>
<P class=docText>(<SPAN class=docEmphasis>none</SPAN>)</P></TD>
<TD class=docTableCell>
<P class=docText><SPAN class=docEmphBold>revert-buffer</SPAN> </P></TD>
<TD class=docTableCell>
<P class=docText>Restore buffer to the state it was in when the file was last saved (or auto-saved).</P></TD></TR></TBODY></TABLE><BR>
<BLOCKQUOTE>
<P class=docFootnote><SUP><A name=gnu3-CHP-2-FNOTE-8>[8]</A></SUP> There is no real difference between <SPAN class=docEmphBold>undo</SPAN> and <SPAN class=docEmphBold>advertised-undo</SPAN>. They work the same way.</P></BLOCKQUOTE><A name=gnu3-CHP-2-SECT-6.5></A>
<H4 class=docSection2Title>2.6.5 Recovering Lost Changes</H4>
<P class=docText>We've just discussed how to <A name=gnu3-CHP-2-ITERM-1812></A><A name=gnu3-CHP-2-ITERM-1813></A><A name=gnu3-CHP-2-ITERM-1814></A>eliminate changes you don't want to keep; getting back changes you've lost is a different kind of problem. You might lose changes if the power goes out momentarily or if the computer you're working on suddenly freezes or is turned off accidentally. You might also lose changes if you exit Emacs abnormally. Luckily, Emacs, being the watchful editor that it is, saves your file for you every so often in <SPAN class=docEmphasis>auto-save files</SPAN>. If you watch carefully, you'll see the message <SPAN class=docEmphBold>Auto saving</SPAN> in the minibuffer from time to time. Using auto-save files, you can get back most, if not all, of your changes. The name of an auto-save file is the same as the name of the file you are editing, with a sharp (<SPAN class=docEmphBold>#</SPAN>) added to the beginning and the end. <FONT class=extract>For example, if you are editing the file <SPAN class=docEmphasis>text</SPAN>, its auto-save file is <SPAN class=docEmphasis>#text#</SPAN>.</FONT></P>
<P class=docText><FONT class=extract>To recover text from an </FONT><A name=gnu3-CHP-2-ITERM-1815></A><A name=gnu3-CHP-2-ITERM-1816></A><FONT class=extract>auto-save file, type <SPAN class=docEmphBold>M-x recover-file Enter</SPAN>.</FONT> Emacs opens a window that lists both the file and its associated auto-save file so that you can compare the time at which they were created, their size, and so forth. Emacs asks you the following question:</P><PRE>Recover auto-save file <TT><I>#text#</I></TT>? (yes or no)
</PRE><BR>
<P class=docText>Type <SPAN class=docEmphBold>yes</SPAN> to confirm that you want to copy the contents of the auto-save file into the current file or <SPAN class=docEmphBold>no</SPAN> if you change your mind. (If you are unsure, you might want to use <SPAN class=docEmphBold>C-x C-f</SPAN> to read the auto-save file <SPAN class=docEmphasis>#text#</SPAN> into a buffer first and look it over carefully before using the <SPAN class=docEmphBold>recover-file</SPAN> command. If you really want to compare the differences between the two versions, see "Comparing Files Between Windows" in <A class=docLink href="file:///D:/&#25105;&#30340;&#37239;&#30424;/&#24037;&#20316;&#30446;&#24405;/Now/learning-gnu-emacs-3rd/0596006489/gnu3-chp-4.html#gnu3-chp-4">Chapter 4</A>.)</P>
<P class=docText>When does Emacs create <A name=gnu3-CHP-2-ITERM-1817></A><A name=gnu3-CHP-2-ITERM-1818></A>auto-save files? <FONT class=extract>Emacs creates an auto-save file every few hundred keystrokes or if Emacs is terminated abnormally</FONT>.<SUP class=docFootnote><A class=docLink href="file:///D:/&#25105;&#30340;&#37239;&#30424;/&#24037;&#20316;&#30446;&#24405;/Now/learning-gnu-emacs-3rd/0596006489/gnu3-chp-2-sect-6.html#gnu3-chp-2-fnote-9">[9]</A></SUP> You can change the frequency with which Emacs creates auto-save files by changing the variable <SPAN class=docEmphBold>auto-save-interval</SPAN>. By default, Emacs creates an auto-save file every 300 keystrokes. For more information on changing variable values, see <A class=docLink href="file:///D:/&#25105;&#30340;&#37239;&#30424;/&#24037;&#20316;&#30446;&#24405;/Now/learning-gnu-emacs-3rd/0596006489/gnu3-chp-10.html#gnu3-chp-10">Chapter 10</A>.</P>
<BLOCKQUOTE>
<P class=docFootnote><SUP><A name=gnu3-CHP-2-FNOTE-9>[9]</A></SUP> We should say that Emacs <SPAN class=docEmphasis>tries</SPAN> to do this. In some cases, Emacs can't, and there is really no guarantee. Power surges and OS crashes are examples of times where things happen so fast that Emacs may not be able to create an auto-save file. But we are surprised at how often it manages to do so.</P></BLOCKQUOTE>
<P class=docText>There's one more important fact to know about Emacs and auto-save files. If you delete a large portion of a file, Emacs stops auto-saving the file and displays a message telling you so. To make Emacs start auto-saving again, save the file with <SPAN class=docEmphBold>C-x C-s</SPAN> or type <SPAN class=docEmphBold>M-1 M-x auto-save Enter</SPAN> (that's the number 1).</P>
<P class=docText>Now you've learned enough commands for most of the editing you'll do with Emacs. At this point, you may want to learn how to make Emacs turn on certain features like auto-fill mode automatically, so you don't have to turn them on every time you enter Emacs. The next section provides a brief introduction to customization; this topic is covered in much greater detail in <A class=docLink href="file:///D:/&#25105;&#30340;&#37239;&#30424;/&#24037;&#20316;&#30446;&#24405;/Now/learning-gnu-emacs-3rd/0596006489/gnu3-chp-10.html#gnu3-chp-10">Chapter 10</A>.